/**
 * DoNotTarckMe Copyright (c) 2008-2014 by Abine, Inc. All Rights Reserved.
 *
 * This software is the confidential and proprietary information
 * of Abine, Inc. ("Confidential Information"), subject
 * to the Non-Disclosure Agreement and/or License Agreement you entered
 * into with Abine. You shall use such Confidential Information only
 * in accordance with the terms of said Agreement(s). Abine makes
 * no representations or warranties about the suitability of the
 * software. The software is provided with ABSOLUTELY NO WARRANTY
 * and Abine will NOT BE LIABLE for ANY DAMAGES resulting from
 * the use of the software.
 *
 * Contact license@getabine.com with any license-related questions.
 *
 * https://www.abine.com
 * @license
 *
 */
/*Copyright (c) 2009 pidder <www.pidder.com>*/
function pidCrypt(){function e(e){e||(e=8);for(var t=new Array(e),n=[],i=0;256>i;i++)n[i]=i;for(i=0;i<t.length;i++)t[i]=n[Math.floor(Math.random()*n.length)];return t}this.setDefaults=function(){this.params.nBits=256,this.params.salt=e(8),this.params.salt=pidCryptUtil.byteArray2String(this.params.salt),this.params.salt=pidCryptUtil.convertToHex(this.params.salt),this.params.blockSize=16,this.params.UTF8=!0,this.params.A0_PAD=!0},this.debug=!0,this.params={},this.params.dataIn="",this.params.dataOut="",this.params.decryptIn="",this.params.decryptOut="",this.params.encryptIn="",this.params.encryptOut="",this.params.key="",this.params.iv="",this.params.clear=!0,this.setDefaults(),this.errors="",this.warnings="",this.infos="",this.debugMsg="",this.setParams=function(e){e||(e={});for(var t in e)this.params[t]=e[t]},this.getParams=function(){return this.params},this.getParam=function(e){return this.params[e]||""},this.clearParams=function(){this.params={}},this.getNBits=function(){return this.params.nBits},this.getOutput=function(){return this.params.dataOut},this.setError=function(e){this.error=e},this.appendError=function(e){return this.errors+=e,""},this.getErrors=function(){return this.errors},this.isError=function(){return this.errors.length>0?!0:!1},this.appendInfo=function(e){return this.infos+=e,""},this.getInfos=function(){return this.infos},this.setDebug=function(e){this.debug=e},this.appendDebug=function(e){return this.debugMsg+=e,""},this.isDebug=function(){return this.debug},this.getAllMessages=function(e){var t={lf:"\n",clr_mes:!1,verbose:15};e||(e=t);for(var n in t)"undefined"==typeof e[n]&&(e[n]=t[n]);var i="",r="";for(var a in this.params){switch(a){case"encryptOut":r=pidCryptUtil.toByteArray(this.params[a].toString()),r=pidCryptUtil.fragment(r.join(),64,e.lf);break;case"key":case"iv":r=pidCryptUtil.formatHex(this.params[a],48);break;default:r=pidCryptUtil.fragment(this.params[a].toString(),64,e.lf)}i+="<p><b>"+a+"</b>:<pre>"+r+"</pre></p>"}return this.debug&&(i+="debug: "+this.debug+e.lf),this.errors.length>0&&1==(1&e.verbose)&&(i+="Errors:"+e.lf+this.errors+e.lf),this.warnings.length>0&&2==(2&e.verbose)&&(i+="Warnings:"+e.lf+this.warnings+e.lf),this.infos.length>0&&4==(4&e.verbose)&&(i+="Infos:"+e.lf+this.infos+e.lf),this.debug&&8==(8&e.verbose)&&(i+="Debug messages:"+e.lf+this.debugMsg+e.lf),e.clr_mes&&(this.errors=this.infos=this.warnings=this.debug=""),i},this.getRandomBytes=function(t){return e(t)}}var ABINE_DNTME=ABINE_DNTME||{};ABINE_DNTME.startTime=Date.now(),window.ABINE_DNTME=window.ABINE_DNTME||ABINE_DNTME,define.unordered=!0,ABINE_DNTME.require=require,ABINE_DNTME.define=define,ABINE_DNTME.define("jquery",["abine/timer"],function(e){function t(e,t,n,i,r){var a="@mozilla.org/parserutils;1";if(a in Components.classes){var o=Components.classes[a].getService(Components.interfaces.nsIParserUtils);if("parseFragment"in o)return o.parseFragment(t,n?o.SanitizerAllowStyle:0,!!r,i,e.documentElement)}return Components.classes["@mozilla.org/feed-unescapehtml;1"].getService(Components.interfaces.nsIScriptableUnescapeHTML).parseFragment(t,!!r,i,e.documentElement)}function n(n){if(!n.abineDntmeJQuery){var i={window:n,document:n.document,navigator:n.navigator,location:n.location,setTimeout:e.setTimeout,clearTimeout:e.clearTimeout,setInterval:e.setInterval,clearInterval:e.clearInterval},r=Components.classes["@mozilla.org/moz/jssubscript-loader;1"].getService(Components.interfaces.mozIJSSubScriptLoader);r.loadSubScript("resource://dntme/content/vendor/jquery-min.js",i),i.$=i.jQuery=n.jQuery,r.loadSubScript("resource://dntme/content/vendor/twitter_bootstrap/bootstrap-tooltip-min.js",i),r.loadSubScript("resource://dntme/content/vendor/jqplot/jquery_jqplot-min.js",i),r.loadSubScript("resource://dntme/content/vendor/jqplot/jqplot_canvasTextRenderer-min.js",i),r.loadSubScript("resource://dntme/content/vendor/jqplot/jqplot_canvasAxisLabelRenderer-min.js",i),r.loadSubScript("resource://dntme/content/vendor/jqplot/jqplot_canvasAxisTickRenderer-min.js",i),r.loadSubScript("resource://dntme/content/vendor/jqplot/jqplot_categoryAxisRenderer-min.js",i),r.loadSubScript("resource://dntme/content/vendor/jqplot/jqplot_barRenderer-min.js",i),r.loadSubScript("resource://dntme/content/vendor/jqplot/jqplot_highlighter-min.js",i),r.loadSubScript("resource://dntme/content/vendor/jqplot/jqplot_bubbleRenderer-min.js",i),n.abineDntmeJQuery=n.jQuery.noConflict(!0);var a=n.abineDntmeJQuery.prototype.html;n.abineDntmeJQuery.prototype.html=function(){if(arguments.length>0&&"string"==typeof arguments[0]){var e=t(n.document,arguments[0],!0);arguments[0]=e}return a.apply(this,arguments)}}return n.abineDntmeJQuery}function i(e,t){try{var i=null;if(e&&e.jquery)return e;if(t&&t.jquery)return t.find(e);if(t&&(i=(t.ownerDocument||t).defaultView||t),!i&&e&&"string"!=typeof e&&(i=(e.ownerDocument||e).defaultView||e),i&&!i.abineDntmeJQuery&&(i=i.top),i)return i.abineDntmeJQuery||n(i),i.abineDntmeJQuery.apply(i,arguments);to.get=stack.trace}catch(r){if("string"==typeof e){var a="Please use a node/document as context to use jQuery from that window sandbox";throw!0&&ABINE_DNTME.log.error(a+"\n"+e+"\n"+r.stack),a}throw"Could not get window object from parameters to stub. Node disconnected from DOM?"}}return"undefined"==typeof $?(i.getRealJQuery=function(e){if(e){var t=(e.ownerDocument||e).defaultView||e;return t.abineDntmeJQuery||n(t),t.abineDntmeJQuery}return i},i):$}),ABINE_DNTME.define("abine/config",[],function(){var e=ABINE_DNTME.config={version:"4.0.1230",buildNum:"1230.3ae1586371ef34a61c70903cfa71f3f7b17ceef3",appName:"DoNotTrackMe: Online Privacy Protection",environment:"production",tags:["chromestore"],crypt:!0,silent:!1,payments:!0,browser:"Chrome",serverHost:"mm.abine.com",webHost:"www.abine.com",webAppHost:"dnt.abine.com",trackerHost:"tracker-production.abine.com",mappingServerHost:"mapping.abine.com",phoneServerHost:"phone.abine.com",licenseServerHost:"license.abine.com",emailServerHost:"emails.abine.com",disposableDomain:"opayq.com",paymentsServerHost:"payments.abine.com",logLevel:"ERROR",pfVersion:".790 Chrome development",mmVersion:"0.0.1 development",features:"accounts,wallet",overriddenKeys:{}};return e.protocol="production"===ABINE_DNTME.config.environment?"https://":"http://",document.documentElement.hasAttribute("abine_webapp")&&(document.documentElement.setAttribute("dnt",e.version),document.documentElement.setAttribute("dnt-features",e.features)),e}),ABINE_DNTME.require("abine/config"),ABINE_DNTME.define("abine/timer",[],function(){var e=1,t={},n=function(n,i){var r=e++,a=Components.classes["@mozilla.org/timer;1"].createInstance(Components.interfaces.nsITimer);return t[r]=a,a.initWithCallback(function(){delete t[r],n()},i,Components.interfaces.nsITimer.TYPE_ONE_SHOT),r},i=function(e){try{e in t&&(t[e].cancel(),delete t[e])}catch(n){}},r=function(n,i){var r=e++,a=Components.classes["@mozilla.org/timer;1"].createInstance(Components.interfaces.nsITimer);return t[r]=a,a.initWithCallback(n,i,Components.interfaces.nsITimer.TYPE_REPEATING_SLACK),r},a={};return a.setTimeout="undefined"!=typeof window&&"function"==typeof window.setTimeout?function(){return ABINE_DNTME.log,window.setTimeout.apply(window,arguments)}:n,a.clearTimeout="undefined"!=typeof window&&"function"==typeof window.clearTimeout?function(){window.clearTimeout.apply(window,arguments)}:i,a.setInterval="undefined"!=typeof window&&"function"==typeof window.setInterval?function(){return window.setInterval.apply(window,arguments)}:r,a.clearInterval="undefined"!=typeof window&&"function"==typeof window.clearInterval?function(){window.clearInterval.apply(window,arguments)}:i,a}),ABINE_DNTME.define(["documentcloud/underscore"],function(){return _}),ABINE_DNTME.define("documentcloud/underscore/async",["documentcloud/underscore","abine/timer"],function(e,t){var n=t.setTimeout,i={},r=e,a=e.async;r.async=i,i.noConflict=function(){return r.async=a,i};var o=function(e,t){if(e.forEach)return e.forEach(t);for(var n=0;n<e.length;n+=1)t(e[n],n,e)},s=function(e,t){if(e.map)return e.map(t);var n=[];return o(e,function(e,i,r){n.push(t(e,i,r))}),n},c=function(e,t,n){return e.reduce?e.reduce(t,n):(o(e,function(e,i,r){n=t(n,e,i,r)}),n)},l=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t};i.nextTick="undefined"!=typeof process&&process.nextTick?process.nextTick:function(e){n(e,0)},i.forEach=function(e,t,n){if(n=n||function(){},!e.length)return n();var i=0;o(e,function(r){t(r,function(t){t?(n(t),n=function(){}):(i+=1,i===e.length&&n(null))})})},i.forEachSeries=function(e,t,n){if(n=n||function(){},!e.length)return n();var i=0,r=function(){t(e[i],function(t){t?(n(t),n=function(){}):(i+=1,i===e.length?n(null):r())})};r()},i.forEachLimit=function(e,t,n,i){if(i=i||function(){},!e.length||0>=t)return i();var r=0,a=0,o=0;!function s(){if(r===e.length)return i();for(;t>o&&a<e.length;)a+=1,o+=1,n(e[a-1],function(t){t?(i(t),i=function(){}):(r+=1,o-=1,r===e.length?i():s())})}()};var d=function(e){return function(){var t=Array.prototype.slice.call(arguments);return e.apply(null,[i.forEach].concat(t))}},u=function(e){return function(){var t=Array.prototype.slice.call(arguments);return e.apply(null,[i.forEachSeries].concat(t))}},f=function(e,t,n,i){var r=[];t=s(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n,i){r[e.index]=i,t(n)})},function(e){i(e,r)})};i.map=d(f),i.mapSeries=u(f),i.reduce=function(e,t,n,r){i.forEachSeries(e,function(e,i){n(t,e,function(e,n){t=n,i(e)})},function(e){r(e,t)})},i.inject=i.reduce,i.foldl=i.reduce,i.reduceRight=function(e,t,n,r){var a=s(e,function(e){return e}).reverse();i.reduce(a,t,n,r)},i.foldr=i.reduceRight;var h=function(e,t,n,i){var r=[];t=s(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n&&r.push(e),t()})},function(){i(s(r.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};i.filter=d(h),i.filterSeries=u(h),i.select=i.filter,i.selectSeries=i.filterSeries;var p=function(e,t,n,i){var r=[];t=s(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n||r.push(e),t()})},function(){i(s(r.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};i.reject=d(p),i.rejectSeries=u(p);var m=function(e,t,n,i){e(t,function(e,t){n(e,function(n){n?(i(e),i=function(){}):t()})},function(){i()})};i.detect=d(m),i.detectSeries=u(m),i.some=function(e,t,n){i.forEach(e,function(e,i){t(e,function(e){e&&(n(!0),n=function(){}),i()})},function(){n(!1)})},i.any=i.some,i.every=function(e,t,n){i.forEach(e,function(e,i){t(e,function(e){e||(n(!1),n=function(){}),i()})},function(){n(!0)})},i.all=i.every,i.sortBy=function(e,t,n){i.map(e,function(e,n){t(e,function(t,i){t?n(t):n(null,{value:e,criteria:i})})},function(e,t){if(e)return n(e);var i=function(e,t){var n=e.criteria,i=t.criteria;return i>n?-1:n>i?1:0};n(null,s(t.sort(i),function(e){return e.value}))})},i.auto=function(e,t){t=t||function(){};var n=l(e);if(!n.length)return t(null);var i={},r=[],a=function(e){r.unshift(e)},s=function(e){for(var t=0;t<r.length;t+=1)if(r[t]===e)return r.splice(t,1),void 0},d=function(){o(r.slice(0),function(e){e()})};a(function(){l(i).length===n.length&&(t(null,i),t=function(){})}),o(n,function(n){var r=e[n]instanceof Function?[e[n]]:e[n],o=function(e){if(e)t(e),t=function(){};else{var r=Array.prototype.slice.call(arguments,1);r.length<=1&&(r=r[0]),i[n]=r,d()}},l=r.slice(0,Math.abs(r.length-1))||[],u=function(){return c(l,function(e,t){return e&&i.hasOwnProperty(t)},!0)&&!i.hasOwnProperty(n)};if(u())r[r.length-1](o,i);else{var f=function(){u()&&(s(f),r[r.length-1](o,i))};a(f)}})},i.waterfall=function(e,t){if(t=t||function(){},!e.length)return t();var n=function(e){return function(r){if(r)t(r),t=function(){};else{var a=Array.prototype.slice.call(arguments,1),o=e.next();o?a.push(n(o)):a.push(t),i.nextTick(function(){e.apply(null,a)})}}};n(i.iterator(e))()},i.parallel=function(e,t){if(t=t||function(){},e.constructor===Array)i.map(e,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)})},t);else{var n={};i.forEach(l(e),function(t,i){e[t](function(e){var r=Array.prototype.slice.call(arguments,1);r.length<=1&&(r=r[0]),n[t]=r,i(e)})},function(e){t(e,n)})}},i.series=function(e,t){if(t=t||function(){},e.constructor===Array)i.mapSeries(e,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)})},t);else{var n={};i.forEachSeries(l(e),function(t,i){e[t](function(e){var r=Array.prototype.slice.call(arguments,1);r.length<=1&&(r=r[0]),n[t]=r,i(e)})},function(e){t(e,n)})}},i.iterator=function(e){var t=function(n){var i=function(){return e.length&&e[n].apply(null,arguments),i.next()};return i.next=function(){return n<e.length-1?t(n+1):null},i};return t(0)},i.apply=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t.concat(Array.prototype.slice.call(arguments)))}};var g=function(e,t,n,i){var r=[];e(t,function(e,t){n(e,function(e,n){r=r.concat(n||[]),t(e)})},function(e){i(e,r)})};i.concat=d(g),i.concatSeries=u(g),i.whilst=function(e,t,n){e()?t(function(r){return r?n(r):(i.whilst(e,t,n),void 0)}):n()},i.until=function(e,t,n){e()?n():t(function(r){return r?n(r):(i.until(e,t,n),void 0)})},i.queue=function(e,t){var n=0,r={tasks:[],concurrency:t,saturated:null,empty:null,drain:null,push:function(e,n){e.constructor!==Array&&(e=[e]),o(e,function(e){r.tasks.push({data:e,callback:"function"==typeof n?n:null}),r.saturated&&r.tasks.length==t&&r.saturated(),i.nextTick(r.process)})},process:function(){if(n<r.concurrency&&r.tasks.length){var t=r.tasks.shift();r.empty&&0==r.tasks.length&&r.empty(),n+=1,e(t.data,function(){n-=1,t.callback&&t.callback.apply(t,arguments),r.drain&&r.tasks.length+n==0&&r.drain(),r.process()})}},length:function(){return r.tasks.length},running:function(){return n}};return r};var y=function(e){return function(t){var n=Array.prototype.slice.call(arguments,1);t.apply(null,n.concat([function(t){var n=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(t?console.error&&console.error(t):console[e]&&o(n,function(t){console[e](t)}))}]))}};return i.log=y("log"),i.dir=y("dir"),i.memoize=function(e,t){var n={},i={};t=t||function(e){return e};var r=function(){var r=Array.prototype.slice.call(arguments),a=r.pop(),o=t.apply(null,r);o in n?a.apply(null,n[o]):o in i?i[o].push(a):(i[o]=[a],e.apply(null,r.concat([function(){n[o]=arguments;var e=i[o];delete i[o];for(var t=0,r=e.length;r>t;t++)e[t].apply(null,arguments)}])))};return r.unmemoized=e,r},i.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},e}),ABINE_DNTME.require(["documentcloud/underscore/async"],function(){}),ABINE_DNTME.define("abine/eventLogger",["abine/config"],function(e){function t(t){var n={},i=t&&t.split?t.split("#"):[];return 4==i.length?(n.error_tag=i[0],n.module=i[1],n.method=i[2],n.message=i[3]):(n.error_tag=n.module=n.method="not well-formed",n.message=t+""),n.browser=e.browser,n.build=e.buildNum,n.environment=e.environment,n.build_tag=e.tags[0],n.server_host=e.serverHost,n.mapping_server_host=e.mappingServerHost,n.license_server_host=e.licenseServerHost,n.phone_server_host=e.phoneServerHost,n.crypt=e.crypt,n.version=e.version,n.user_agent=ABINE_DNTME.userAgent,n}function n(t){var n={error:t},i=ABINE_DNTME.user||ABINE_DNTME.contentuser||ABINE_DNTME.bguser;i&&(n.email_salt=i.getEmailSalt());try{ABINE_DNTME.require(["abine/ajax"],function(t){t.ajax({type:"POST",url:e.protocol+e.serverHost+"/api/errors",data:n,success:function(){a.debug("error reporting successful")},error:function(){a.debug("error reporting failed")}})},null,!0)}catch(r){}}function i(){function e(e){try{Console(e)}catch(t){}}var i=(new Date).toUTCString();if("undefined"!=typeof Components){var r=Components.classes["@mozilla.org/consoleservice;1"].getService(Components.interfaces.nsIConsoleService);return{finest:function(e){r.logStringMessage("[FINEST]["+i+"]: "+e),dump("FINEST: "+e+"\n")},debug:function(e){r.logStringMessage("[DEBUG]["+i+"]: "+e),dump("DEBUG: "+e+"\n")},info:function(e){r.logStringMessage("[INFO]["+i+"]: "+e),dump("INFO: "+e+"\n")},warn:function(e){r.logStringMessage("[WARNING]["+i+"]: "+e),dump("WARNING: "+e+"\n")},error:function(e){r.logStringMessage("[ERROR]["+i+"]: "+e),dump("ERROR: "+e+"\n");var a=ABINE_DNTME.user||ABINE_DNTME.contentuser||ABINE_DNTME.bguser;a&&a.shouldSendErrorReports()&&n(t(e))}}}return"undefined"==typeof console||"undefined"==typeof console.debug?{finest:function(t){e("[FINEST]["+i+"]: "+t)},debug:function(t){e("[DEBUG]["+i+"]: "+t)},info:function(t){e("[INFO]["+i+"]: "+t)},warn:function(t){e("[WARNING]["+i+"]: "+t)},error:function(r){e("[ERROR]["+i+"]: "+r);var a=ABINE_DNTME.user||ABINE_DNTME.contentuser||ABINE_DNTME.bguser;a&&a.shouldSendErrorReports()&&n(t(r))}}:"undefined"!=typeof console?{finest:function(e){console.debug("[FINEST]["+i+"]: "+e)},debug:function(e){console.debug("[DEBUG]["+i+"]: "+e)},info:function(e){console.info("[INFO]["+i+"]: "+e)},warn:function(e){console.warn("[WARNING]["+i+"]: "+e)},error:function(e){console.error("[ERROR]["+i+"]: "+e);var r=ABINE_DNTME.user||ABINE_DNTME.contentuser||ABINE_DNTME.bguser;r&&r.shouldSendErrorReports()&&n(t(e))}}:void 0}var r=function(){},a=i();switch(a.dumpObj=function(e){var t=typeof e;if("object"!=t||null===e)return"string"==t&&(e='"'+e+'"'),String(e);var n,i,r=[],o=e&&e.constructor==Array;for(n in e)i=e[n],t=typeof i,"string"==t?i='"'+i+'"':"object"==t&&null!==i&&(i=a.dumpObj(i)),r.push((o?"":'"'+n+'":')+String(i));return(o?"[":"{")+String(r)+(o?"]":"}")},e.logLevel){case"NONE":a.error=r;case"ERROR":a.warn=r;case"WARN":a.info=r;case"INFO":a.debug=r;case"DEBUG":a.finest=r}return a.stackTrace=function(e){e=e||"";try{does.not=exist}catch(t){var n=(t.stack+"").split("\n");n.length>3&&(n.shift(),n.shift(),n.shift()),e+="\n"+n.join("\n")}this.debug(e)},a.info("Log level set to "+e.logLevel),ABINE_DNTME.log=a,a}),ABINE_DNTME.define("abine/url",function(){function e(e){return e?e.toLowerCase().replace(/\w+/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1)}):e}function t(e){var t=e.match(o);return t&&t.length>1?t[1].toString():e}function n(e){var n=t(e);if(n.match(s)||n.match(c))return n;var i=n.split(".");if(i.length<2)return n;var o=i.pop(),l=i.pop(),d=l+"."+o;if(r.test(d)&&i.length>0&&(o=d,l=i.pop(),d=l+"."+o),a.test(d)&&i.length>0&&!n.match(/signup.wordpress.com|new.aol.com/i)){var u=i.pop();d=u+"."+d}return d}function i(t){if(t=n(t),t.match(s))return t;var i=t.split(".");if(i.length>2){var o=i.pop(),c=i.pop(),t=c+"."+o;if(r.test(t)&&i.length>0&&(o=t,c=i.pop(),t=c+"."+o),a.test(t)&&i.length>0){var l=i.pop();return e(c+" "+l)}return e(c)}return e(i[0])}var r=/^(((co|ac|go|ed|ga|mn|nj|nc|or|ne|in|gr|ca|on|pa|qc|bc|sh|at|va|us|il|tv|me|lg|at|ny|gv|com|edu|org|net|gov|mil|biz)\...)|(163\.com)|(kiev\.ua)|(gob\.pe)|(gen\.tr)|(waw.pl)|(jus.br))$/,a=/^(((go|typepad|tumblr|blogspot|squarespace|wordpress|myshopify|blogfa|blog|blogs|blinkweb|ning|posterous|over-blog|mihanblog|appspot|webs|weebly|onsugar|ucoz|uk|pch|ecwid)(\.com|\.in))|(nic\.in)|((ucoz|spb|narod)\.ru)|(blog\.163\.com)|((gouv|free)\.fr)|(uol\.com\.br)|(web\.id)|(gob\.mx)|(blogg\.se)|(home.pl))$/,o=/^http(?:s)?\:\/\/([^/\?]+)/im,s=/^[0-9\.]+(:[0-9]+)?$/,c=/^localhost(:[0-9]+)?$/;return{getHostname:t,getTLD:n,getSiteName:i}}),ABINE_DNTME.define("abine/pluralizer",[],function(){var e=function(e,t){return 1==e?t:t+"s"},t={};return t.pluralize=e,t}),/**
 * Copyright (c) 2010 Zef Hemel <zef@zef.me>
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following
 * conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 */
ABINE_DNTME.define("persistence",[],function(){function initPersistence(e){if(e.isImmutable)return e;e.isImmutable=function(e){return"id"==e},e.defineProp=function(e,t,n,i){Object.defineProperty?Object.defineProperty(e,t,{get:function(){return i()},set:function(e){n(e)}}):(e.__defineSetter__(t,function(e){n(e)}),e.__defineGetter__(t,function(){return i()}))},e.set=function(t,n,i){if(e.isImmutable(n))throw new Error("immutable field: "+n);t[n]=i},e.get=function(e,t){return 1==arguments.length?e:e[t]},function(){function n(e){return E[e]}function i(e){this.trackedObjects={},this.trackedObjectsByEntity={},this.objectsToRemove={},this.objectsRemoved=[],this.globalPropertyListeners={},this.queryCollectionCache={},this.conn=e}function r(i){function a(n,r){var a=t.getArgs(arguments,[{name:"session",optional:!0,check:e.isSession,defaultValue:e},{name:"obj",optional:!0,check:function(e){return e},defaultValue:{}}]);if(c.isMixin)throw new Error("Cannot instantiate mixin");n=a.session,r=a.obj;var s=this;this.id=r.id||e.createUUID(),this._new=!0,this._type=i,this._dirtyProperties={},this._data={},this._data_obj={},this._session=n||e,this.subscribers={};for(var l in c.fields)!function(){if(c.fields.hasOwnProperty(l)){var t=l;e.defineProp(s,t,function(e){var i=s._data[t];(i!==e||i&&e&&i.getTime&&e.getTime)&&(s._data[t]=e,s._dirtyProperties[t]=i,s.triggerEvent("set",s,t,e),s.triggerEvent("change",s,t,e),n.propertyChanged(s,t,i,e))},function(){return s._data[t]}),s._data[l]=o(c.fields[l])}}();for(var d in c.hasOne)c.hasOne.hasOwnProperty(d)&&!function(){var t=d,i=c.hasOne[d].type.meta.isMixin?t+"_class":null;e.defineProp(s,t,function(e){var r=s._data[t],a=s._data_obj[t]||n.trackedObjects[s._data[t]];if(null==e?(s._data[t]=null,s._data_obj[t]=void 0,i&&(s[i]="")):e.id?(s._data[t]=e.id,s._data_obj[t]=e,i&&(s[i]=e._type),n.add(e),n.add(s)):s._data[t]=e,s._dirtyProperties[t]=r,s.triggerEvent("set",s,t,e),s.triggerEvent("change",s,t,e),c.hasOne[t].inverseProperty){var o=s[t];if(o){var l=o[c.hasOne[t].inverseProperty];l.list&&l._filter&&l.triggerEvent("change",s,t,e)}if(a){var l=a[c.hasOne[t].inverseProperty];l.list&&l._filter&&l.triggerEvent("change",s,t,e)}}},function(){if(s._data[t]){if(void 0!==s._data_obj[t])return s._data_obj[t];if(s._data[t]&&n.trackedObjects[s._data[t]])return s._data_obj[t]=n.trackedObjects[s._data[t]],s._data_obj[t];throw new Error("Property '"+t+"' of '"+c.name+"' with id: "+s._data[t]+" not fetched, either prefetch it or fetch it manually.")}return null})}();for(var d in c.hasMany)c.hasMany.hasOwnProperty(d)&&!function(){var t=d;c.hasMany[t].manyToMany?e.defineProp(s,t,function(n){if(!n||!n._items)throw new Error("Not yet supported.");for(var i=n._items,r=0;r<i.length;r++)e.get(s,t).add(i[r])},function(){if(s._data[t])return s._data[t];var i=c.hasMany[t],r=i.type.meta,a=r.hasMany[i.inverseProperty],o=i.mixin?i.mixin.meta.name:c.name,l=a.mixin?a.mixin.meta.name:r.name,d=new e.ManyToManyDbQueryCollection(n,r.name);return d.initManyToMany(s,t),d._manyToManyFetch={table:i.tableName,prop:o+"_"+t,inverseProp:l+"_"+i.inverseProperty,id:s.id},s._data[t]=d,n.uniqueQueryCollection(d)}):e.defineProp(s,t,function(n){if(!n||!n._items)throw new Error("Not yet supported.");for(var i=n._items,r=0;r<i.length;r++)e.get(s,t).add(i[r])},function(){if(s._data[t])return s._data[t];var i=n.uniqueQueryCollection(new e.DbQueryCollection(n,c.hasMany[t].type.meta.name).filter(c.hasMany[t].inverseProperty,"=",s));return s._data[t]=i,i})}();this.initialize&&this.initialize();for(var u in r)r.hasOwnProperty(u)&&"id"!==u&&e.set(s,u,r[u])}function s(t,i,r,a){var o=(t._session,[]),c=n(t._type),l=c.fields;for(var d in r)r.hasOwnProperty(d)&&o.push(d);var u=[],f=[];o.forEach(function(e){r[e]!==!0||c.hasMany[e]?f.push(e):u.push(e)});var h=t._data,p={};u.forEach(function(n){"id"===n?p.id=t.id:p[n]=c.hasOne[n]?h[n]?{id:h[n]}:null:e.entityValToJson(h[n],l[n])}),o=f.slice(),e.asyncForEach(o,function(n,a){c.hasOne[n]?t.fetch(i,n,function(e){e?s(e,i,r[n],function(e){p[n]=e,a()}):(p[n]=null,a())}):c.hasMany[n]&&e.get(t,n).list(function(t){p[n]=[],e.asyncForEach(t,function(e,a){var e=t.pop();r[n]===!0?(p[n].push({id:e.id}),a()):s(e,i,r[n],function(e){p[n].push(e),a()})},a)})},function(){a(p)})}if(_[i])return _[i];var c=E[i];a.prototype=new d,a.meta=c,a.prototype.equals=function(e){return this.id==e.id},a.prototype.toJSON=function(){var e={id:this.id};for(var t in this._data)this._data.hasOwnProperty(t)&&("object"==typeof this._data[t]&&null!=this._data[t]?void 0!=this._data[t].toJSON&&(e[t]=this._data[t].toJSON()):e[t]=this._data[t]);return e},a.prototype.selectJSON=function(n,i,r){var a=this,o=t.getArgs(arguments,[{name:"tx",optional:!0,check:e.isTransaction,defaultValue:null},{name:"props",optional:!1},{name:"callback",optional:!1}]);if(n=o.tx,i=o.props,r=o.callback,!n)return this._session.transaction(function(e){a.selectJSON(e,i,r)}),void 0;var l={};i.forEach(function(e){for(var t=l,n=e.split("."),i=0;i<n.length;i++){var r=n[i];if(i===n.length-1)if("*"===r){t.id=!0;for(var a in c.fields)c.fields.hasOwnProperty(a)&&(t[a]=!0);for(var a in c.hasOne)c.hasOne.hasOwnProperty(a)&&(t[a]=!0);for(var a in c.hasMany)c.hasMany.hasOwnProperty(a)&&(t[a]=!0)}else if("["===r[0]){r=r.substring(1,r.length-1);var o=r.split(/,\s*/);o.forEach(function(e){t[e]=!0})}else t[r]=!0;else t[r]=t[r]||{},t=t[r]}}),s(this,n,l,r)},a.prototype.fetch=function(n,i,a){var o=t.getArgs(arguments,[{name:"tx",optional:!0,check:e.isTransaction,defaultValue:null},{name:"rel",optional:!1,check:t.hasType("string")},{name:"callback",optional:!1,check:t.isCallback()}]);n=o.tx,i=o.rel,a=o.callback;var s=this,l=this._session;if(!n)return l.transaction(function(e){s.fetch(e,i,a)}),void 0;if(this._data[i])if(this._data_obj[i])a&&a(this._data_obj[i]);else{var d=c.hasOne[i].type;d.meta.isMixin&&(d=r(this._data[i+"_class"])),d.load(l,n,this._data[i],function(e){s._data_obj[i]=e,a&&a(e)})}else a&&a(null)},a.prototype.markDirty=function(e){this._dirtyProperties[e]=!0},a.all=function(n){var r=t.getArgs(arguments,[{name:"session",optional:!0,check:e.isSession,defaultValue:e}]);return n=r.session,n.uniqueQueryCollection(new y(n,i))},a.query=function(t,n){e.transaction(function(e){var r="";t&&(r=" where "+t),e.executeSql("SELECT * FROM "+i+r,null,function(e){n(e)})})},a.deleteQuery=function(t,n){e.transaction(function(e){var r="";t&&(r=" where "+t),e.executeSql("DELETE FROM "+i+r,null,function(e){n(e)})})},a.fromSelectJSON=function(n,i,r,o){function s(t){t||(t=new a(n),r.id&&(t.id=r.id)),n.add(t);var s=[];for(var l in r)if(r.hasOwnProperty(l)){if("id"===l)continue;c.fields[l]?e.set(t,l,e.jsonToEntityVal(r[l],c.fields[l])):(c.hasOne[l]||c.hasMany[l])&&s.push(l)}e.asyncForEach(s,function(a,o){if(c.hasOne[a])c.hasOne[a].type.fromSelectJSON(n,i,r[a],function(n){e.set(t,a,n),o()});else if(c.hasMany[a]){var s=e.get(t,a),l=r[a].slice(0),d=c.hasMany[a].type;s.list(i,function(t){e.asyncForEach(l,function(e,r){d.fromSelectJSON(n,i,e,function(e){for(var n=0;n<t.length;n++)if(t[n].id===e.id)return r(),void 0;s.add(e),r()})},function(){o()})})}},function(){o(t)})}var l=t.getArgs(arguments,[{name:"session",optional:!0,check:e.isSession,defaultValue:e},{name:"tx",optional:!0,check:e.isTransaction,defaultValue:null},{name:"jsonObj",optional:!1},{name:"callback",optional:!1,check:t.isCallback()}]);return n=l.session,i=l.tx,r=l.jsonObj,o=l.callback,i?("string"==typeof r&&(r=JSON.parse(r)),r?(r.id?a.load(n,i,r.id,s):s(new a(n)),void 0):(o(null),void 0)):(n.transaction(function(e){a.fromSelectJSON(n,e,r,o)}),void 0)},a.load=function(){var n=t.getArgs(arguments,[{name:"session",optional:!0,check:e.isSession,defaultValue:e},{name:"tx",optional:!0,check:e.isTransaction,defaultValue:null},{name:"id",optional:!1,check:t.hasType("string")},{name:"callback",optional:!0,check:t.isCallback(),defaultValue:function(){}}]);a.findBy(n.session,n.tx,"id",n.id,n.callback)},a.findBy=function(n,i,r,o,s){var c=t.getArgs(arguments,[{name:"session",optional:!0,check:e.isSession,defaultValue:e},{name:"tx",optional:!0,check:e.isTransaction,defaultValue:null},{name:"property",optional:!1,check:t.hasType("string")},{name:"value",optional:!1},{name:"callback",optional:!0,check:t.isCallback(),defaultValue:function(){}}]);if(n=c.session,i=c.tx,r=c.property,o=c.value,s=c.callback,"id"===r&&o in n.trackedObjects)return s(n.trackedObjects[o]),void 0;var l=a.meta;if(l.alternatePK&&r===l.alternatePK&&n.trackedObjectsByEntity){var d=l.name+"."+l.alternatePK;if(!(d in n.trackedObjectsByEntity&&o in n.trackedObjectsByEntity[d]))return a.cached?(s(null),void 0):(a.initCache(function(){a.findBy(n,i,r,o,s)}),void 0);if(n.trackedObjectsByEntity[d][o]in n.trackedObjects)return s(n.trackedObjects[n.trackedObjectsByEntity[d][o]]),void 0;delete n.trackedObjectsByEntity[d][o]}return i?(a.all(n).filter(r,"=",o).one(i,function(e){s(e)}),void 0):(n.transaction(function(e){a.findBy(n,e,r,o,s)}),void 0)},a.index=function(e,t){var n=t||{};"string"==typeof e&&(e=[e]),n.columns=e,c.indexes.push(n)},a.hasMany=function(t,n,i){var r=n.meta;if(r.hasMany[i]){var o=c.name+"_"+t+"_"+r.name,s=r.name+"_"+i+"_"+c.name;o>s&&(o=s),c.hasMany[t]={type:n,inverseProperty:i,manyToMany:!0,tableName:o},r.hasMany[i]={type:a,inverseProperty:t,manyToMany:!0,tableName:o},delete c.hasOne[t],delete c.fields[t+"_class"]}else c.hasMany[t]={type:n,inverseProperty:i},r.hasOne[i]={type:a,inverseProperty:t},c.isMixin&&(r.fields[i+"_class"]=e.typeMapper?e.typeMapper.classNameType:"TEXT")},a.hasOne=function(t,n,i){c.hasOne[t]={type:n,inverseProperty:i},n.meta.isMixin&&(c.fields[t+"_class"]=e.typeMapper?e.typeMapper.classNameType:"TEXT")},a.is=function(e){var t=e.meta;if(!t.isMixin)throw new Error("not a mixin: "+e);e.meta.mixedIns=e.meta.mixedIns||[],e.meta.mixedIns.push(c);for(var n in t.fields)t.fields.hasOwnProperty(n)&&(c.fields[n]=t.fields[n]);for(var i in t.hasOne)t.hasOne.hasOwnProperty(i)&&(c.hasOne[i]=t.hasOne[i]);for(var i in t.hasMany)t.hasMany.hasOwnProperty(i)&&(t.hasMany[i].mixin=e,c.hasMany[i]=t.hasMany[i])};for(var l=e.entityDecoratorHooks,u=0;u<l.length;u++)l[u](a);return _[i]=a,a}function a(){if(e.typeMapper&&e.typeMapper.newUuid)return e.typeMapper.newUuid();for(var t=[],n="0123456789ABCDEF",i=0;32>i;i++)t[i]=n.substr(Math.floor(16*Math.random()),1);t[12]="4",t[16]=n.substr(3&t[16]|8,1);var r=t.join("");return r}function o(t){if(e.typeMapper&&e.typeMapper.defaultValue)return e.typeMapper.defaultValue(t);switch(t){case"TEXT":return"";case"BOOL":return!1;default:return-1!==t.indexOf("INT")?0:-1!==t.indexOf("CHAR")?"":null}}function s(e,t){for(var n=e.length,i=0;n>i;i++){var r=e[i];if(r.equals&&r.equals(t))return!0;if(r===t)return!0}return!1}function c(e,t){for(var n=e.length,i=0;n>i;i++){var r=e[i];if(r.equals&&r.equals(t))return e.splice(i,1),void 0;if(r===t)return e.splice(i,1),void 0}}function l(e,t,n){this.obj=e,this.eventType=t,this.fn=n}function d(){this.subscribers={}}function u(){}function f(e,t){this.left=e,this.right=t}function h(e,t){this.left=e,this.right=t}function p(e,t,n){this.property=e,this.operator=t.toLowerCase(),this.value=n}function m(){}function g(e,t){this.init(e,t,g)}function y(e,t){this.init(e,t,y)}function b(t,n){this.init(t,n,e.ManyToManyDbQueryCollection),this._localAdded=[],this._localRemoved=[]}function v(t){this.init(e,null,v),this._items=t||[]}var E={},_={};e.getEntityMeta=function(){return E},e.trackedObjects={},e.trackedObjectsByEntity={},e.objectsToRemove={},e.objectsRemoved=[],e.globalPropertyListeners={},e.queryCollectionCache={},e.getObjectsToRemove=function(){return this.objectsToRemove},e.getTrackedObjects=function(){return this.trackedObjects},e.entityDecoratorHooks=[],e.flushHooks=[],e.schemaSyncHooks=[],e.debug=!1,e.subscribeToGlobalPropertyListener=function(e,t,n){var i=t+"__"+n;if(i in this.globalPropertyListeners){for(var r=this.globalPropertyListeners[i],a=0;a<r.length;a++)if(r[a]===e)return;this.globalPropertyListeners[i].push(e)}else this.globalPropertyListeners[i]=[e]},e.unsubscribeFromGlobalPropertyListener=function(e,t,n){for(var i=t+"__"+n,r=this.globalPropertyListeners[i],a=0;a<r.length;a++)if(r[a]===e)return r.splice(a,1),void 0},e.propertyChanged=function(e,t,n,i){if(this.trackedObjects[e.id]){var r=e._type,a=r+"__"+t;if(a in this.globalPropertyListeners)for(var o=this.globalPropertyListeners[a],s=0;s<o.length;s++){var c=o[s],l=e._data;l[t]=n;var d=c._filter.match(l);l[t]=i;var u=c._filter.match(l);d!=u&&c.triggerEvent("change",c,e)}}},e.objectRemoved=function(e){var t=e._type;if(this.queryCollectionCache[t]){var n=this.queryCollectionCache[t];for(var i in n)if(n.hasOwnProperty(i)){var r=n[i];r._filter.match(e)&&r.triggerEvent("change",r,e)}}},e.getMeta=n,i.prototype=e,e.Session=i,e.undefine=function(e){_[e]&&delete _[e],e in E&&delete E[e]},e.define=function(e,t){if(E[e])return r(e);var n={name:e,fields:t,isMixin:!1,indexes:[],hasMany:{},hasOne:{}};return E[e]=n,r(e)},e.isDefined=function(e){return!!E[e]},e.defineMixin=function(e,t){var n=this.define(e,t);return n.meta.isMixin=!0,n},e.isTransaction=function(e){return!e||e&&e.executeSql},e.isSession=function(e){return!e||e&&e.schemaSync},e.addToEntityCache=function(e){var t=_[e._type];if(t.meta.cached){var n=t.meta.alternatePK||"id";if(n){var i=e._type+"."+n;i in this.trackedObjectsByEntity||(this.trackedObjectsByEntity[i]={}),this.trackedObjectsByEntity[i][e[n]]=e.id}}},e.clearFromEntityCache=function(e){if(e){var t=_[e._type];if(t.meta.cached){var n=t.meta.alternatePK||"id";if(n){var i=e._type+"."+n;i in this.trackedObjectsByEntity&&e.id==this.trackedObjectsByEntity[i][e[n]]&&delete this.trackedObjectsByEntity[i][e[n]]}}}},e.getEntityByAlternatePK=function(e,t){var n=e.meta.alternatePK;if(n){var i=e.meta.name+"."+n;if(i in this.trackedObjectsByEntity&&t in this.trackedObjectsByEntity[i])return this.trackedObjects[this.trackedObjectsByEntity[i][t]]}return null},e.getCachedEntities=function(e){var t=[];if(e.meta.cached){var n=e.meta.alternatePK||"id";if(n){var i=e.meta.name+"."+n;if(i in this.trackedObjectsByEntity){var r=this.trackedObjectsByEntity[i];for(var a in r)r[a]in this.trackedObjects?t.push(this.trackedObjects[r[a]]):delete r[a]}}}return t},e.add=function(e){if(e){if(!this.trackedObjects[e.id]&&(this.trackedObjects[e.id]=e,this.addToEntityCache(e),e._new))for(var t in e._data)e._data.hasOwnProperty(t)&&this.propertyChanged(e,t,void 0,e._data[t]);return this}},e.forceAdd=function(t){if(t){if(!this.trackedObjects[t.id]||this.trackedObjects[t.id]!=t){var n=_[t._type];if(n.meta.cached){var i=n.meta.alternatePK;if(i){var r=e.getEntityByAlternatePK(n,t[i]);!r||r.id in this.objectsToRemove||r.id!=t.id&&(t.id=r.id)}}if(this.trackedObjects[t.id]=t,this.addToEntityCache(t),t._new)for(var a in t._data)t._data.hasOwnProperty(a)&&this.propertyChanged(t,a,void 0,t._data[a])}return this}},e.remove=function(e){return this.objectsToRemove[e.id]||(this.objectsToRemove[e.id]=e),this.objectsRemoved.push({id:e.id,entity:e._type}),this.objectRemoved(e),this},e.clean=function(){this.trackedObjects={},this.objectsToRemove={},this.objectsRemoved=[],this.globalPropertyListeners={},this.queryCollectionCache={},this.trackedObjectsByEntity={},e.GlobalEvent.triggerEvent("clean")},e.asyncForEach=function(e,t,n){function i(){var r=e.pop();t(r,function(t,r){e.length>0?i():n(t,r)})}e=e.slice(0),e.length>0?i():n()},e.asyncParForEach=function(e,t,n){var i=0,r=e.length;0===r&&n();for(var a=0;r>a;a++)t(e[a],function(e,t){i++,i===r&&n(e,t)})},e.jsonToEntityVal=function(e,t){if(!t)return e;switch(t){case"DATE":return"number"==typeof e?e>1e12?new Date(e):new Date(1e3*e):null;default:return e}},e.entityValToJson=function(e,t){if(!t)return e;switch(t){case"DATE":return e?(e=new Date(e),Math.round(e.getTime()/1e3)):null;default:return e}},e.dump=function(n,i,r){var a=t.getArgs(arguments,[{name:"tx",optional:!0,check:e.isTransaction,defaultValue:null},{name:"entities",optional:!0,check:function(e){return!e||e&&e.length&&!e.apply},defaultValue:null},{name:"callback",optional:!1,check:t.isCallback(),defaultValue:function(){}}]);if(n=a.tx,i=a.entities,r=a.callback,!i){i=[];for(var o in _)_.hasOwnProperty(o)&&i.push(_[o])}var s={};e.asyncParForEach(i,function(t,i){t.all().list(n,function(r){var a=[];e.asyncParForEach(r,function(i,r){var o={},s=t.meta.fields;for(var c in s)s.hasOwnProperty(c)&&(o[c]=e.entityValToJson(i._data[c],s[c]));var l=t.meta.hasOne;for(var d in l)l.hasOwnProperty(d)&&(o[d]=i._data[d]);var u=t.meta.hasMany,f=[];for(var h in u)u.hasOwnProperty(h)&&f.push(h);e.asyncParForEach(f,function(t,r){var a=e.get(i,t);a.list(n,function(e){o[t]=e.map(function(e){return e.id}),r()})},function(){o.id=i.id,a.push(o),r()})},function(){s[t.meta.name]=a,i()})})},function(){r(s)})},e.load=function(n,i,a){var o=t.getArgs(arguments,[{name:"tx",optional:!0,check:e.isTransaction,defaultValue:null},{name:"dump",optional:!1},{name:"callback",optional:!0,check:t.isCallback(),defaultValue:function(){}}]);n=o.tx,i=o.dump,a=o.callback;var s=[],c=this;for(var l in i)if(i.hasOwnProperty(l))for(var d=r(l),u=d.meta.fields,f=i[l],h=0;h<f.length;h++){var p=f[h],m=new d;m.id=p.id;for(var g in p)if(p.hasOwnProperty(g))if(e.isImmutable(g))m[g]=p[g];else if(d.meta.hasMany[g]){var y=d.meta.hasMany[g];if(y.manyToMany&&d.meta.name<y.type.meta.name)continue;var b=e.get(m,g);p[g].length>0&&p[g].forEach(function(e){s.push({Entity:d,coll:b,id:e})})}else e.set(m,g,e.jsonToEntityVal(p[g],u[g]));this.add(m)}c.flush(n,function(){e.asyncForEach(s,function(e,t){e.Entity.load(c,n,e.id,function(n){e.coll.add(n),t()})},function(){c.flush(n,a)})})},e.dumpToJson=function(n,i,r){var a=t.getArgs(arguments,[{name:"tx",optional:!0,check:e.isTransaction,defaultValue:null},{name:"entities",optional:!0,check:function(e){return e&&e.length&&!e.apply},defaultValue:null},{name:"callback",optional:!1,check:t.isCallback(),defaultValue:function(){}}]);n=a.tx,i=a.entities,r=a.callback,this.dump(n,i,function(e){r(JSON.stringify(e))})},e.dumpDatabaseForSync=function(n,i){var r=t.getArgs(arguments,[{name:"entities",optional:!1,check:function(e){return e},defaultValue:null},{name:"callback",optional:!1,check:t.isCallback(),defaultValue:function(){}}]);n=r.entities,i=r.callback,ABINE_DNTME.require(["documentcloud/underscore"],function(t){var r={};t.async.forEach(t.keys(n),function(t,i){e.transaction(function(e){var a="";"all"!=n[t]&&(a=" where "+n[t]),e.executeSql("SELECT * FROM "+t+a,null,function(e){r[t]=e,i()})})},function(){i(r)})})},e.loadFromJson=function(n,i,r){var a=t.getArgs(arguments,[{name:"tx",optional:!0,check:e.isTransaction,defaultValue:null},{name:"jsonDump",optional:!1},{name:"callback",optional:!0,check:t.isCallback(),defaultValue:function(){}}]);n=a.tx,i=a.jsonDump,r=a.callback,this.load(n,JSON.parse(i),r)},e.createUUID=a,l.prototype.unsubscribe=function(){this.obj.removeEventListener(this.eventType,this.fn)},d.prototype.addEventListener=function(e,t){return this.subscribers[e]||(this.subscribers[e]=[]),this.subscribers[e].push(t),new l(this,e,t)},d.prototype.removeEventListener=function(e,t){for(var n=this.subscribers[e],i=0;i<n.length;i++)if(n[i]==t)return this.subscribers[e].splice(i,1),!0;return!1},d.prototype.triggerEvent=function(e){if(this.subscribers[e])for(var t=this.subscribers[e].slice(0),n=0;n<t.length;n++)t[n].apply(null,arguments)},u.prototype.match=function(){return!0},u.prototype.makeFit=function(){},u.prototype.makeNotFit=function(){},u.prototype.toUniqueString=function(){return"NULL"},u.prototype.subscribeGlobally=function(){},u.prototype.unsubscribeGlobally=function(){},f.prototype.match=function(e){return this.left.match(e)&&this.right.match(e)},f.prototype.makeFit=function(e){this.left.makeFit(e),this.right.makeFit(e)},f.prototype.makeNotFit=function(e){this.left.makeNotFit(e),this.right.makeNotFit(e)},f.prototype.toUniqueString=function(){return this.left.toUniqueString()+" AND "+this.right.toUniqueString()},f.prototype.subscribeGlobally=function(e,t){this.left.subscribeGlobally(e,t),this.right.subscribeGlobally(e,t)},f.prototype.unsubscribeGlobally=function(e,t){this.left.unsubscribeGlobally(e,t),this.right.unsubscribeGlobally(e,t)},h.prototype.match=function(e){return this.left.match(e)||this.right.match(e)},h.prototype.makeFit=function(e){this.left.makeFit(e),this.right.makeFit(e)},h.prototype.makeNotFit=function(e){this.left.makeNotFit(e),this.right.makeNotFit(e)},h.prototype.toUniqueString=function(){return this.left.toUniqueString()+" OR "+this.right.toUniqueString()},h.prototype.subscribeGlobally=function(e,t){this.left.subscribeGlobally(e,t),this.right.subscribeGlobally(e,t)},h.prototype.unsubscribeGlobally=function(e,t){this.left.unsubscribeGlobally(e,t),this.right.unsubscribeGlobally(e,t)},p.prototype.match=function(t){var n=this.value,i=e.get(t,this.property);switch(n&&n.getTime&&(n=1e3*Math.round(n.getTime()/1e3),i&&i.getTime&&(i=1e3*Math.round(i.getTime()/1e3))),this.operator){case"=":return i===n;case"!=":return i!==n;case"<":return n>i;case"<=":return n>=i;case">":return i>n;case">=":return i>=n;case"in":return s(n,i);case"not in":return!s(n,i)}},p.prototype.makeFit=function(t){if("="!==this.operator)throw new Error("Sorry, can't perform makeFit for other filters than =");e.set(t,this.property,this.value)},p.prototype.makeNotFit=function(t){if("="!==this.operator)throw new Error("Sorry, can't perform makeNotFit for other filters than =");e.set(t,this.property,null)},p.prototype.subscribeGlobally=function(t,n){e.subscribeToGlobalPropertyListener(t,n,this.property)},p.prototype.unsubscribeGlobally=function(t,n){e.unsubscribeFromGlobalPropertyListener(t,n,this.property)},p.prototype.toUniqueString=function(){var e=this.value;return e&&e._type&&(e=e.id),this.property+this.operator+e},e.NullFilter=u,e.AndFilter=f,e.OrFilter=h,e.PropertyFilter=p,e.uniqueQueryCollection=function(e){var t=e._entityName;if(e._items)return e;this.queryCollectionCache[t]||(this.queryCollectionCache[t]={});var n=e.toUniqueString();return this.queryCollectionCache[t][n]||(this.queryCollectionCache[t][n]=e),this.queryCollectionCache[t][n]},m.prototype=new d,m.prototype.oldAddEventListener=m.prototype.addEventListener,m.prototype.setupSubscriptions=function(){this._filter.subscribeGlobally(this,this._entityName)},m.prototype.teardownSubscriptions=function(){this._filter.unsubscribeGlobally(this,this._entityName)},m.prototype.addEventListener=function(e,t){var n=this,i=this.oldAddEventListener(e,t);return 1===this.subscribers[e].length&&this.setupSubscriptions(),i.oldUnsubscribe=i.unsubscribe,i.unsubscribe=function(){this.oldUnsubscribe(),0===n.subscribers[e].length&&n.teardownSubscriptions()},i},m.prototype.persistQueries=function(){return[]},m.prototype.init=function(t,n,i){this._filter=new u,this._orderColumns=[],this._prefetchFields=[],this._entityName=n,this._constructor=i,this._limit=-1,this._skip=0,this._reverse=!1,this._session=t||e,this.subscribers={}},m.prototype.toUniqueString=function(){var e=this._constructor.name+": "+this._entityName;e+="|Filter:";var t=[];e+=this._filter.toUniqueString(),e+="|Values:";for(var n=0;n<t.length;n++)e+=t+"|^|";e+="|Order:";for(var n=0;n<this._orderColumns.length;n++){var i=this._orderColumns[n];e+=i[0]+", "+i[1]+", "+i[2]}e+="|Prefetch:";for(var n=0;n<this._prefetchFields.length;n++)e+=this._prefetchFields[n];return e+="|Limit:",e+=this._limit,e+="|Skip:",e+=this._skip,e+="|Reverse:",e+=this._reverse},m.prototype.clone=function(e){var t=new this._constructor(this._session,this._entityName);if(t._filter=this._filter,t._prefetchFields=this._prefetchFields.slice(0),t._orderColumns=this._orderColumns.slice(0),t._limit=this._limit,t._skip=this._skip,t._reverse=this._reverse,e){var n={};for(var i in this.subscribers)this.subscribers.hasOwnProperty(i)&&(n[i]=this.subscribers[i].slice(0));t.subscribers=n}else t.subscribers=this.subscribers;return t},m.prototype.filter=function(e,t,n){var i=this.clone(!0);i._filter=new f(this._filter,new p(e,t,n));var r=this._session;return i=r.uniqueQueryCollection(i),r.uniqueQueryCollection(i)},m.prototype.or=function(e){var t=this.clone(!0);return t._filter=new h(this._filter,e),this._session.uniqueQueryCollection(t)},m.prototype.and=function(e){var t=this.clone(!0);return t._filter=new f(this._filter,e),this._session.uniqueQueryCollection(t)},m.prototype.order=function(e,t,n){t=void 0===t?!0:t,n=void 0===n?!0:n;var i=this.clone();return i._orderColumns.push([e,t,n]),this._session.uniqueQueryCollection(i)},m.prototype.limit=function(e){var t=this.clone();return t._limit=e,this._session.uniqueQueryCollection(t)},m.prototype.skip=function(e){var t=this.clone();return t._skip=e,this._session.uniqueQueryCollection(t)},m.prototype.reverse=function(){var e=this.clone();return e._reverse=!0,this._session.uniqueQueryCollection(e)},m.prototype.prefetch=function(e){var t=this.clone();return t._prefetchFields.push(e),this._session.uniqueQueryCollection(t)},m.prototype.selectJSON=function(n,i,a){var o=t.getArgs(arguments,[{name:"tx",optional:!0,check:e.isTransaction,defaultValue:null},{name:"props",optional:!1},{name:"callback",optional:!1}]),s=this._session,c=this;if(n=o.tx,i=o.props,a=o.callback,!n)return s.transaction(function(e){c.selectJSON(e,i,a)}),void 0;r(this._entityName);this.list(function(t){var r=[];e.asyncForEach(t,function(e,t){e.selectJSON(n,i,function(e){r.push(e),t()})},function(){a(r)})})},m.prototype.add=function(e){if(!e.id||!e._type)throw new Error("Cannot add object of non-entity type onto collection.");this._session.add(e),this._filter.makeFit(e),this.triggerEvent("add",this,e),this.triggerEvent("change",this,e)},m.prototype.addAll=function(e){for(var t=0;t<e.length;t++){var n=e[t];this._session.add(n),this._filter.makeFit(n),this.triggerEvent("add",this,n)}this.triggerEvent("change",this)},m.prototype.remove=function(e){if(!e.id||!e._type)throw new Error("Cannot remove object of non-entity type from collection.");this._filter.makeNotFit(e),this.triggerEvent("remove",this,e),this.triggerEvent("change",this,e)},m.prototype.each=function(n,i){var r=t.getArgs(arguments,[{name:"tx",optional:!0,check:e.isTransaction,defaultValue:null},{name:"eachFn",optional:!0,check:t.isCallback()}]);n=r.tx,i=r.eachFn,this.list(n,function(e){for(var t=0;t<e.length;t++)i(e[t])})},m.prototype.forEach=m.prototype.each,m.prototype.one=function(n,i){var r=t.getArgs(arguments,[{name:"tx",optional:!0,check:e.isTransaction,defaultValue:null},{name:"oneFn",optional:!1,check:t.isCallback()}]);n=r.tx,i=r.oneFn;this.limit(1).list(n,function(e){0===e.length?i(null):i(e[0])})},g.prototype=new m,y.prototype=new g,y.prototype.add=function(e){this._session.add(e),this.triggerEvent("add",this,e),this.triggerEvent("change",this,e)},y.prototype.remove=function(e){this._session.remove(e),this.triggerEvent("remove",this,e),this.triggerEvent("change",this,e)},b.prototype=new g,b.prototype.initManyToMany=function(e,t){this._obj=e,this._coll=t},b.prototype.add=function(e){s(this._localAdded,e)||(this._session.add(e),this._localAdded.push(e),this.triggerEvent("add",this,e),this.triggerEvent("change",this,e))},b.prototype.addAll=function(e){for(var t=0;t<e.length;t++){var n=e[t];s(this._localAdded,n)||(this._session.add(n),this._localAdded.push(n),this.triggerEvent("add",this,n))}this.triggerEvent("change",this)},b.prototype.clone=function(){var e=g.prototype.clone.call(this);return e._localAdded=this._localAdded,e._localRemoved=this._localRemoved,e._obj=this._obj,e._coll=this._coll,e},b.prototype.remove=function(e){s(this._localAdded,e)?c(this._localAdded,e):s(this._localRemoved,e)||this._localRemoved.push(e),this.triggerEvent("remove",this,e),this.triggerEvent("change",this,e)},v.prototype=new m,v.prototype.clone=function(){var e=g.prototype.clone.call(this);return e._items=this._items,e},v.prototype.add=function(e){s(this._items,e)||(this._session.add(e),this._items.push(e),this.triggerEvent("add",this,e),this.triggerEvent("change",this,e))},v.prototype.addAll=function(e){for(var t=0;t<e.length;t++){var n=e[t];s(this._items,n)||(this._session.add(n),this._items.push(n),this.triggerEvent("add",this,n))}this.triggerEvent("change",this)},v.prototype.remove=function(e){for(var t=this._items,n=0;n<t.length;n++)t[n]===e&&(this._items.splice(n,1),this.triggerEvent("remove",this,e),this.triggerEvent("change",this,e))},v.prototype.list=function(n,i){var r=t.getArgs(arguments,[{name:"tx",optional:!0,check:e.isTransaction,defaultValue:null},{name:"callback",optional:!0,check:t.isCallback()}]);i=r.callback,(!i||i.executeSql)&&(i=arguments[1]);for(var a=this._items.slice(0),o=this,s=[],c=0;c<a.length;c++)this._filter.match(a[c])&&s.push(a[c]);return s.sort(function(t,n){for(var i=0;i<o._orderColumns.length;i++){var r=o._orderColumns[i][0],a=o._orderColumns[i][1],s=o._orderColumns[i][2],c=e.get(t,r),l=e.get(n,r);if(s||(c=c.toLowerCase(),l=l.toLowerCase()),l>c)return a?-1:1;if(c>l)return a?1:-1}return 0}),this._skip&&s.splice(0,this._skip),this._limit>-1&&(s=s.slice(0,this._limit)),this._reverse&&s.reverse(),i?(i(s),void 0):s},v.prototype.destroyAll=function(e){(!e||e.executeSql)&&(e=arguments[1]),this._items=[],this.triggerEvent("change",this),e&&e()},v.prototype.count=function(n,i){var r=t.getArgs(arguments,[{name:"tx",optional:!0,check:e.isTransaction,defaultValue:null},{name:"callback",optional:!0,check:t.isCallback()}]);n=r.tx,i=r.callback;var a=this.list();return i?(i(a.length),void 0):a.length},e.QueryCollection=m,e.DbQueryCollection=g,e.ManyToManyDbQueryCollection=b,e.LocalQueryCollection=v,e.Observable=d,e.Subscription=l,e.AndFilter=f,e.OrFilter=h,e.PropertyFilter=p,e.GlobalEvent=new d}();var t={};return function(){t.getArgs=function(e,t){for(var n=0,i=0,r={};i<t.length;){var a=t[i],o=e[n];if(a.optional)void 0!==o&&a.check(o)?(r[a.name]=o,n++,i++):(void 0!==a.defaultValue&&(r[a.name]=a.defaultValue),i++);else{if(a.check&&!a.check(o))throw new Error("Invalid value for argument: "+a.name+" Value: "+o);r[a.name]=o,i++,n++}}return r},t.hasProperty=function(e){return function(t){return t&&void 0!==t[e]}},t.hasType=function(e){return function(t){return typeof t===e}},t.isCallback=function(){return function(e){return e&&e.apply}}}(),e.argspec=t,e}var persistence=initPersistence("undefined"!=typeof window&&window.persistence||{});return"undefined"==typeof JSON&&(JSON={}),JSON.stringify||!function(){function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,r,a,o,s=gap,c=t[e];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(c)){for(a=c.length,n=0;a>n;n+=1)o[n]=str(n,c)||"null";return r=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+s+"]":"["+o.join(",")+"]",gap=s,r}if(rep&&"object"==typeof rep)for(a=rep.length,n=0;a>n;n+=1)i=rep[n],"string"==typeof i&&(r=str(i,c),r&&o.push(quote(i)+(gap?": ":":")+r));else for(i in c)Object.hasOwnProperty.call(c,i)&&(r=str(i,c),r&&o.push(quote(i)+(gap?": ":":")+r));return r=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+s+"}":"{"+o.join(",")+"}",gap=s,r}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;n>i;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,i,r=e[t];if(r&&"object"==typeof r)for(n in r)Object.hasOwnProperty.call(r,n)&&(i=walk(r,n),void 0!==i?r[n]=i:delete r[n]);return reviver.call(e,t,r)}var j;if(cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)
})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),persistence}),ABINE_DNTME.define("persistence/store/memory",["persistence"],function(e){e.store||(e.store={}),e.store.memory={},e.store.memory.config=function(e,t){function n(t){var n=r[t._entityName];return n||(n=new e.LocalQueryCollection),n=n.clone(),n._filter=t._filter,n._prefetchFields=t._prefetchFields,n._orderColumns=t._orderColumns,n._limit=t._limit,n._skip=t._skip,n._reverse=t._reverse,n}var i=e.argspec;t=t||"persistenceData";var r={};e.getAllObjects=function(){return r};var a=e.add;e.add=function(t){if(!this.trackedObjects[t.id]){a.call(this,t);var n=t._type;r[n]||(r[n]=new e.LocalQueryCollection,r[n]._session=e),r[n].add(t)}return this};var o=e.forceAdd;e.forceAdd=function(t){if(t){if(!this.trackedObjects[t.id]||this.trackedObjects[t.id]!=t){o.call(this,t);var n=t._type;r[n]||(r[n]=new e.LocalQueryCollection,r[n]._session=e);try{r[n].remove(this.trackedObjects[t.id])}catch(i){}r[n].add(t)}return this}};var s=e.remove;e.remove=function(e){s.call(this,e);var t=e._type;r[t].remove(e)};var c=e.clearFromEntityCache;e.clearFromEntityCache=function(e){if(e){c.call(this,e);var t=e._type;r[t].remove(e)}},e.schemaSync=function(){var t=i.getArgs(arguments,[{name:"tx",optional:!0,check:e.isTransaction,defaultValue:null},{name:"callback",optional:!0,check:i.isCallback(),defaultValue:function(){}},{name:"emulate",optional:!0,check:i.hasType("boolean")}]);t.callback()},e.flush=function(t){var n=i.getArgs(arguments,[{name:"tx",optional:!0,check:e.isTransaction},{name:"callback",optional:!0,check:i.isCallback(),defaultValue:function(){}}]),r=e.flushHooks,a=this;e.asyncForEach(r,function(e,n){e(a,t,n)},function(){var t=e.trackedObjects;for(var i in t)t.hasOwnProperty(i)&&(e.objectsToRemove.hasOwnProperty(i)?delete t[i]:t[i]._dirtyProperties={});n.callback()})},e.transaction=function(e){e({executeSql:function(){}})},e.loadFromLocalStorage=function(e){var n=window.localStorage.getItem(t);n?this.loadFromJson(n,e):e&&e()},e.saveToLocalStorage=function(e){this.dumpToJson(function(n){window.localStorage.setItem(t,n),e&&e()})},e.reset=function(t,n){var a=i.getArgs(arguments,[{name:"tx",optional:!0,check:e.isTransaction,defaultValue:null},{name:"callback",optional:!0,check:i.isCallback(),defaultValue:function(){}}]);t=a.tx,n=a.callback,r={},this.clean(),n()},e.close=function(){},e.DbQueryCollection.prototype.list=function(t,r){var a=i.getArgs(arguments,[{name:"tx",optional:!0,check:e.isTransaction,defaultValue:null},{name:"callback",optional:!1,check:i.isCallback()}]);t=a.tx,r=a.callback;var o=n(this);o.list(null,r)},e.DbQueryCollection.prototype.destroyAll=function(t,r){var a=i.getArgs(arguments,[{name:"tx",optional:!0,check:e.isTransaction,defaultValue:null},{name:"callback",optional:!0,check:i.isCallback(),defaultValue:function(){}}]);t=a.tx,r=a.callback;var o=n(this);o.destroyAll(null,r)},e.DbQueryCollection.prototype.count=function(t,r){var a=i.getArgs(arguments,[{name:"tx",optional:!0,check:e.isTransaction,defaultValue:null},{name:"callback",optional:!1,check:i.isCallback()}]);t=a.tx,r=a.callback;var o=n(this);o.count(null,r)},e.ManyToManyDbQueryCollection=function(t,n){this.init(t,n,e.ManyToManyDbQueryCollection),this._items=[]},e.ManyToManyDbQueryCollection.prototype=new e.LocalQueryCollection,e.ManyToManyDbQueryCollection.prototype.initManyToMany=function(e,t){this._obj=e,this._coll=t},e.ManyToManyDbQueryCollection.prototype.add=function(t,n){if(e.LocalQueryCollection.prototype.add.call(this,t),!n){var i=e.getMeta(this._obj._type),r=i.hasMany[this._coll].inverseProperty;e.get(t,r).add(this._obj,!0)}},e.ManyToManyDbQueryCollection.prototype.remove=function(t,n){if(e.LocalQueryCollection.prototype.remove.call(this,t),!n){var i=e.getMeta(this._obj._type),r=i.hasMany[this._coll].inverseProperty;e.get(t,r).remove(this._obj,!0)}}}}),ABINE_DNTME.define("persistence/caching",["documentcloud/underscore","abine/core","persistence","abine/eventLogger","abine/timer"],function(e,t,n){return n.entityDecoratorHooks.push(function(e){e.enableCaching=function(t,i){"function"==typeof t&&(i=t,t=null),e.cached=!1,e.meta.cached=!0,e.meta.alternatePK=t,n.GlobalEvent.addEventListener("clean",function(){e.cached=!1,i&&i()})}}),null}),ABINE_DNTME.require("persistence/store/memory",function(e){console.log("defined memory: "+e)}),ABINE_DNTME.define("abine/ajax",["jquery"],function(e){return{ajax:e.ajax,get:e.get,getJSON:e.getJSON,post:e.post,getScript:e.getScript}}),ABINE_DNTME.define("abine/assets",["wycats/handlebars"],function(e){function t(e){return chrome.extension.getURL(e)}return e.registerHelper("assetUrl",t),{assetUrl:t}}),ABINE_DNTME.define("abine/backgroundMessenger",["documentcloud/underscore","abine/core"],function(e,t){var n=function(e,t){t&&t.tab&&this.trigger(e.eventName,e.payload,t.tab.id)},i=function(){throw"Error. Attempt to call destroyed BackgroundMessenger."},r=t.BaseClass.extend({initialize:function(){this.listener=e.bind(n,this),chrome.extension.onRequest.addListener(this.listener)},send:function(e,t,n){if(this.trigger(e,t,n),"test"!=n)if(n&&-1!=n||!chrome.tabs){if(!n||"background"==n||-1==n)return;chrome.tabs.sendRequest(n,{eventName:e,payload:"undefined"==typeof t?{}:t})}else chrome.tabs.getSelected(null,function(i){n=i.id,chrome.tabs.sendRequest(n,{eventName:e,payload:"undefined"==typeof t?{}:t})})},broadcast:function(t,n){n=n||{},this.trigger(t,n),chrome.tabs.query({url:chrome.extension.getURL("pages/index.html")},function(i){e(i).each(function(e){chrome.tabs.sendRequest(e.id,{eventName:t,payload:n})})})},broadcastToAllTabs:function(t,n){n=n||{},this.trigger(t,n),chrome.tabs.query({},function(i){e(i).each(function(e){chrome.tabs.sendRequest(e.id,{eventName:t,payload:n})})})},destroy:function(){this.off(),chrome.extension.onRequest.removeListener(n),this.on=this.off=this.trigger=i}});return{implementation:"Chrome",BackgroundMessenger:r}}),ABINE_DNTME.define("abine/browserSyncStorage",["documentcloud/underscore","abine/core"],function(e,t){var n;n=chrome&&chrome.storage&&chrome.storage.sync?t.BaseClass.extend({initialize:function(){},set:function(e,t){chrome.storage.sync.set(e,t)},remove:function(e,t){chrome.storage.sync.remove(e,t)},get:function(e,t){chrome.storage.sync.get(e,t)},clear:function(e){chrome.storage.sync.clear(e)}}):t.BaseClass.extend({initialize:function(){this.storage={}},set:function(t,n){e.extend(this.storage,t),n&&n()},remove:function(t,n){t="string"==typeof t?[t]:t,e.each(t,e.bind(function(e){delete this.storage[e]},this)),n&&n()},get:function(t,n){t="string"==typeof t?[t]:t,n&&n(e.pick(this.storage,t))},clear:function(e){this.storage={},e&&e()}});var i=new n({});return i}),ABINE_DNTME.define("abine/clipboard",["abine/eventLogger"],function(){return{copyToClipboard:function(e){var t=document.createElement("textarea");document.getElementById("navbar").appendChild(t),t.focus(),t.value=e,document.execCommand("selectAll"),document.execCommand("copy"),document.getElementById("navbar").removeChild(t)}}}),ABINE_DNTME.define("abine/conflict_handler",["storage","persistence","abine/localStorage","abine/timer"],function(e,t,n,i){function r(){return openDatabase("idme_data","1.0","Storage for the idme extension",5242880)}function a(e,t,n,i){e.transaction(function(e){e.executeSql(t,null,function(e,t){t.rows.length>0?i(t.rows.item(0)[n]):i(null)},function(){i(null)})})}function o(e){e=e||function(){};var t=r();a(t,"SELECT * FROM sqlite_master WHERE type='table' AND name='Preferences'","name",function(n){c="Preferences"==n,ABINE_DNTME.merged_data_available=c,c?a(t,"select * from Preferences where key = 'regEmail' ","value",function(n){a(t,"select * from Preferences where key = 'entitledToPhone' ","value",function(i){a(t,"select count(*) as cnt from DisposableEmails ","cnt",function(t){e(c,!n||t>1||"true"==i)})})}):e(c)})}function s(n,i){if(i=i||function(){},!n)return i(),void 0;var o=r();a(o,"select * from Preferences where key = 'installAuthToken' ","value",function(n){n&&""!=n?e.Preference.findOrCreate({key:"installAuthToken"},function(e){e.value=n,e.modifiedAt=l(),t.flush(function(){i()})}):i()})}var c=null,l=function(){var e=new Date;return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e};return{installAuthTokenCheck:s,checkForMergedAddon:o,checkForMaskme:function(e){function t(r){if(0>=r)return ABINE_DNTME.maskme_installed=!1,n.setItem("maskme.installed","0"),e(!1),void 0;var a=i.setTimeout(function(){t(r-1)},200);chrome.runtime.sendMessage(ABINE_DNTME.MASKME_EXTENSION_ID,{message:"ping"},function(t){t&&t.installed&&(i.clearTimeout(a),n.setItem("maskme.installed","1"),ABINE_DNTME.maskme_installed=!0,e(!0))})}return"undefined"!=typeof ABINE_DNTME.maskme_installed?(e(ABINE_DNTME.maskme_installed),void 0):("0"===n.getItem("maskme.installed")&&(ABINE_DNTME.maskme_installed=!1,e(!1)),t(3),void 0)}}}),ABINE_DNTME.define("abine/contentMessenger",["documentcloud/underscore","abine/core"],function(e,t){var n=function(e){this.trigger(e.eventName,e.payload)},i=function(){throw"Error. Attempt to call destroyed ContentMessenger."},r=t.BaseClass.extend({initialize:function(){this.listener=e.bind(n,this),chrome.extension.onRequest.addListener(this.listener)},send:function(e,t){this.trigger(e,t),chrome&&chrome.extension&&chrome.extension.sendRequest({eventName:e,payload:"undefined"==typeof t?{}:t})},destroy:function(){this.off(),chrome.extension.onRequest.removeListener(n),this.on=this.off=this.trigger=i}});return{ContentMessenger:r}}),ABINE_DNTME.define("abine/contextMenu",["documentcloud/underscore","abine/core","abine/contextHelper","storage","abine/securityManager"],function(e,t,n,i,r){var a=t.BaseClass.extend({init:function(t){chrome.contextMenus.onClicked.addListener(e.bind(this.onClick,this)),t.on("contentscript:contextmenu:refresh",this.refreshMenu,this),t.on("background:contextmenu:refresh",this.refreshMenu,this),this.messenger=t},refreshMenu:function(t){this.alreadyRefreshing||(this.domain=t.domain,this.alreadyRefreshing=!0,chrome.contextMenus.removeAll(e.bind(function(){return this.domain.indexOf("chrome-extension://")>=0||ABINE_DNTME.maskme_installed?(this.alreadyRefreshing=!1,void 0):(i.Preference.findBy("key","hasRegistered",e.bind(function(n){return!n||n.isFalse()?(this.alreadyRefreshing=!1,void 0):(r.isLocked()?chrome.contextMenus.create({title:"DoNotTrackMe",contexts:["editable"],id:"abine_dntme_context_root"},e.bind(function(){chrome.contextMenus.create({title:"locked, click to unlock",contexts:["editable"],id:"abine_dntme_unlock",parentId:"abine_dntme_context_root"},e.bind(function(){this.alreadyRefreshing=!1},this))},this)):i.Blacklist.findBy("domain",t.domain,e.bind(function(n){n&&n.tracker?chrome.contextMenus.create({title:"DoNotTrackMe",contexts:["editable"],id:"abine_dntme_context_root"},e.bind(function(){chrome.contextMenus.create({title:"You have asked DoNotTrackMe to ignore this website",contexts:["editable"],id:"abine_dntme_blacklisted",parentId:"abine_dntme_context_root"},e.bind(function(){this.alreadyRefreshing=!1},this))},this)):this.createStaticMenu(t.domain,e.bind(function(){this.createDynamicMenu(t.domain,e.bind(function(){this.alreadyRefreshing=!1},this))},this))},this)),void 0)},this)),void 0)},this)))},onClick:function(e,t){n.onClick(this.messenger,e.menuItemId,t.id,this.domain)},createDynamicMenu:function(t,n){chrome.contextMenus.create({title:"Emails for "+t,contexts:["editable"],id:"abine_dntme_logins",parentId:"abine_dntme_context_root"},function(){i.DisposableEmail.listCached("label",t,function(t){0==t.length?chrome.contextMenus.create({title:"You have no emails here",contexts:["editable"],id:"abine_dntme_no_accounts",parentId:"abine_dntme_logins"},n):e.async.forEachSeries(t,function(e,t){chrome.contextMenus.create({title:e.getAddress(),contexts:["editable"],id:"abine_dntme_accountfield_"+e.id,parentId:"abine_dntme_logins"},t)},n)})})},createStaticMenu:function(t,n){e.async.series([function(e){chrome.contextMenus.create({title:"DoNotTrackMe",contexts:["editable"],id:"abine_dntme_context_root"},e)},function(e){chrome.contextMenus.create({title:"Email",contexts:["editable"],parentId:"abine_dntme_context_root",id:"abine_dntme_email_parent"},e)},function(e){chrome.contextMenus.create({title:"Mask My Email",contexts:["editable"],parentId:"abine_dntme_email_parent",id:"abine_dntme_email_mask"},e)},function(e){chrome.contextMenus.create({title:"Use My Email",contexts:["editable"],parentId:"abine_dntme_email_parent",id:"abine_dntme_email_disclose"},e)},function(e){chrome.contextMenus.create({title:"Password",contexts:["editable"],parentId:"abine_dntme_context_root",id:"abine_dntme_password_parent"},e)},function(e){chrome.contextMenus.create({title:"Generate strong password",contexts:["editable"],parentId:"abine_dntme_password_parent",id:"abine_dntme_password_mask"},e)},function(e){chrome.contextMenus.create({title:"Phone",contexts:["editable"],parentId:"abine_dntme_context_root",id:"abine_dntme_phone_parent"},e)},function(e){i.DisposablePhone.index(null,function(t){t.length>0?chrome.contextMenus.create({title:"Mask my Phone",contexts:["editable"],parentId:"abine_dntme_phone_parent",id:"abine_dntme_phone_mask"},e):e()})},function(e){i.ShieldedPhone.index(null,function(t){t.length>0?chrome.contextMenus.create({title:"Disclose my phone",contexts:["editable"],parentId:"abine_dntme_phone_parent",id:"abine_dntme_phone_disclose"},e):chrome.contextMenus.create({title:"Set up your phone",contexts:["editable"],parentId:"abine_dntme_phone_parent",id:"abine_dntme_setup_phone"},e)})},function(e){i.Preference.findBy("key","entitledToPayments",function(t){t&&t.isTrue()?chrome.contextMenus.create({title:"Credit Card",contexts:["editable"],parentId:"abine_dntme_context_root",id:"abine_dntme_card_parent"},function(){i.Preference.findBy("key","hasEnabledPayments",function(t){t&&t.isTrue()?chrome.contextMenus.create({title:"Mask my Credit Card",contexts:["editable"],parentId:"abine_dntme_card_parent",id:"abine_dntme_card_mask"},e):chrome.contextMenus.create({title:"Activate Masked Cards",contexts:["editable"],parentId:"abine_dntme_card_parent",id:"abine_dntme_activate_card"},e)})}):e()})}],function(){n()})}});return{contextMenuHelper:new a}}),ABINE_DNTME.define("abine/dntmeUpgrade",["storage","persistence","abine/localStorage","abine/conflict_handler"],function(e,t,n,i){function r(){var e=5242880;f=openDatabase("abine2","1.1","abine2",e)}function a(e,t){f.transaction(function(n){n.executeSql("SELECT * FROM trackers",[],function(n,i){e.trackerMap={};for(var r=0;r<i.rows.length;r++)e.trackerMap[i.rows.item(r).domain]||(e.trackerMap[i.rows.item(r).domain]={}),e.trackerMap[i.rows.item(r).domain][i.rows.item(r).name]=i.rows.item(r).blocked;t()},function(){t()})})}function o(e,t){f.transaction(function(n){n.executeSql("SELECT * from blockcount",[],function(n,i){e.totals={};for(var r=0;r<i.rows.length;r++){var a=i.rows.item(r).name,o=i.rows.item(r).value;"totalOptout"!=a&&("totalb"==a&&(a="total"),e.totals[a]=o)}t()},function(){t()})})}function s(e,t){f.transaction(function(n){n.executeSql("SELECT * from settings",[],function(n,i){e.settings={};for(var r=0;r<i.rows.length;r++){var a=i.rows.item(r).name;if(!a.match(/rules|converted|reason/)){var o=i.rows.item(r).value;e.settings[a.toLowerCase()]=o}}"dntp.useglobalallow"in e.settings&&(e.settings["dntp.useglobalallow"]=""!=e.settings["dntp.useglobalallow"]),"dntp.showmedals"in e.settings&&(e.settings["dntp.showmedals"]=""!=e.settings["dntp.showmedals"]),t()},function(){t()})})}function c(e,t){n.getItem("global.blocked")&&(e.settings||(e.settings={}),e.settings.defaultBlocked="0"!=n.getItem("global.blocked")),n.getItem("origin")&&(e.settings||(e.settings={}),e.settings.origin=n.getItem("origin")),e.badTrackers={},e.dailyTotals={},n.getItem("badTrackerTotals")&&(e.badTrackers.totals=JSON.parse(n.getItem("badTrackerTotals")));for(var i=(new Date).getFullYear(),r=2011;i>=r;r++){n.getItem("dailyTotals"+r)&&(e.dailyTotals[r]=JSON.parse(n.getItem("dailyTotals"+r)));for(var a in e.badTrackers.totals){var o=a+"."+r;n.getItem("badTrackerDaily."+o)&&("daily"in e.badTrackers||(e.badTrackers.daily={}),e.badTrackers.daily[o]=JSON.parse(n.getItem("badTrackerDaily."+o)))}}t()}function l(){return openDatabase("idme_data","1.0","Storage for the idme extension",5242880)}function d(e){function t(i,o){if(o>=r.length)return e(a),void 0;var s=r[o];i.executeSql("SELECT * FROM sqlite_master WHERE type='table' AND name='"+s+"'",null,function(e,i){i.rows.length>0?(a[s]={schema:i.rows.item(0).sql},n(e,o)):t(e,o+1)})}function n(e,n){var i=r[n];e.executeSql("SELECT * FROM "+i,null,function(e,r){for(var o=[],s=r.rows.length,c=0;s>c;c++)o.push(r.rows.item(c));a[i].rows=o,t(e,n+1)})}if(null===u)return i.checkForMergedAddon(function(t){u=t,d(e)}),void 0;if(u===!1)return e(null),void 0;var r="AccountField,Accounts,DisposableCards,DisposableEmails,Preferences,ShieldedEmails,Sites".split(","),a={};l().transaction(function(e){t(e,0)})}var u=null,f=null;return{getMaskmeData:d,getOldData:function(e){if(n.getItem("upgradeDone"))return e(null),void 0;n.setItem("upgradeDone",!0),r();var t={};a(t,function(){o(t,function(){s(t,function(){c(t,function(){e(t)})})})})}}}),ABINE_DNTME.define("abine/intl",[],function(){return{getText:function(e,t){var n=null;e=e.replace(/\./g,"_");try{n=chrome.i18n.getMessage(e,t)}catch(i){}return n&&""!=n||(n="***"+e),n}}}),ABINE_DNTME.define("abine/localStorage",[],function(){return window.localStorage}),ABINE_DNTME.define("abine/tabs",["abine/core","abine/url"],function(e,t){var n=e.BaseClass.extend({init:function(e){chrome.tabs.onActivated.addListener(function(n){-1!=n.tabId&&chrome.tabs.get(n.tabId,function(n){n&&n.url&&(n.url.match("https?://")||n.url.match("chrome-extension://"))&&e.send("background:contextmenu:refresh",{domain:t.getTLD(n.url)})})}),chrome.windows.onFocusChanged.addListener(function(n){-1!=n&&chrome.windows.get(n,{populate:!0},function(n){if(n&&n.tabs)for(var i=0;i<n.tabs.length;i++)n.tabs[i].active&&n.tabs[i].url&&(n.tabs[i].url.match("https?://")||n.tabs[i].url.match("chrome-extension://"))&&e.send("background:contextmenu:refresh",{domain:t.getTLD(n.tabs[i].url)})})})}});return{tabHelper:new n}}),ABINE_DNTME.define("abine/toolbar",["documentcloud/underscore","abine/timer","jquery","abine/securityManager","storage"],function(e,t,n,i){function r(){}function a(e){var t=[255,0,0,255],n=[0,255,0,255],i=[225,193,0,255],r=n;e.total>e.blocked+e.suggested?r=t:e.suggested>0&&(r=i);var a=e.total+"";if(e.disabled&&(a="off",r=t),chrome.browserAction.setBadgeText({text:a,tabId:e.tabId}),chrome.browserAction.setBadgeBackgroundColor({color:r,tabId:e.tabId}),e.isBadge)chrome.browserAction.setIcon({path:e.iconPath,tabId:e.tabId});else if(e.customImage){var o=document.createElement("canvas"),s=o.getContext("2d"),c=new Image;c.onload=function(){s.drawImage(this,0,0),chrome.browserAction.setIcon({imageData:s.getImageData(0,0,c.width,c.height),tabId:e.tabId})},c.src=e.customImage}else chrome.browserAction.setIcon({path:"/images/Icon.png",tabId:e.tabId})}return{freshInstall:r,updateIcon:a}}),ABINE_DNTME.define("abine/tour",[],function(){return{show:function(e){chrome.tabs.insertCSS(e,{file:"/pages/postinstall.css"}),chrome.tabs.executeScript(e,{file:"/pages/postinstall.js",allFrames:!1,runAt:"document_end"})}}}),ABINE_DNTME.define("abine/window",["documentcloud/underscore","abine/timer","jquery"],function(e,t,n){APPLICATION_CSS="pages/application.css";var i=function(){},r=function(e,n){e.documentElement?e.documentElement.appendChild(n):t.setTimeout(function(){r(e,n)},100)},a=function(e){var t,i=e.getElementsByTagName("head")[0];i&&(t=e.createElement("link"),t.setAttribute("rel","stylesheet"),t.setAttribute("href",chrome.extension.getURL(APPLICATION_CSS)),i.appendChild(t)),n("body",e).css("backgroundColor","transparent")};return{createTab:function(t,n){function r(i){var r=e.find(i,function(e){return-1!=e.url.indexOf(o)});r||t.doNotOpenNewTab?r&&(chrome.tabs.update(r.id,{active:!0,url:a}),chrome.windows.get(r.windowId,function(e){"minimized"==e.state&&chrome.windows.update(e.id,{state:"normal"}),chrome.windows.update(e.id,{focused:!0}),n()})):(chrome.tabs.create({active:!0,url:a}),n())}n=n||i;var a=t.localUrl?chrome.extension.getURL(t.localUrl):t.url;if(t.force)return chrome.tabs.create({active:!0,url:a}),n(),void 0;var o=a.replace(/http[s]?/i,"").replace(/\?.*/i,"").replace(/\#.*/i,"");chrome.tabs.query({},r)},openWindow:function(e,t,n){chrome.windows.create({url:e,width:t,height:n,focused:!0,type:"popup"})},reloadTab:function(t,n){function r(i){var r=e.find(i,function(e){return-1!=e.url.indexOf(o)});r||t.doNotOpenNewTab?r&&(chrome.tabs.reload(r.id),t.doNotActivate||(chrome.tabs.update(r.id,{active:!0}),chrome.windows.get(r.windowId,function(e){"minimized"==e.state&&chrome.windows.update(e.id,{state:"normal"}),chrome.windows.update(e.id,{focused:!0}),n()}))):(chrome.tabs.create({active:!0,url:a}),n())}n=n||i;var a=t.localUrl?chrome.extension.getURL(t.localUrl):t.url,o=a.replace(/http[s]?/i,"").replace(/\?.*/i,"").replace(/\#.*/i,"");chrome.tabs.query({},r)},createPanel:function(t){var n=t.localUrl?chrome.extension.getURL(t.localUrl):t.url,i=t.document||document||window.document,o=t.panelWidth?t.panelWidth:368;if(!i)throw"Error. abine/window createPanel called without a document context.";var s=i.createElement("div");s.className=t.className||"abineContentPanel",e.extend(s.style,{backgroundColor:"transparent",margin:"0",padding:"0"},t.style);var c=i.createElement("iframe");return e.extend(c,{className:"abineContentFrame",width:o+"px",allowTransparency:"true",frameborder:0,height:t.panelHeight+"px",scrolling:"no",src:n?n:""}),e.extend(c.style,{position:"relative",background:"transparent",borderWidth:"0px",opacity:1,margin:"0",padding:"0",height:t.panelHeight+"px",width:o+"px"}),s.appendChild(c),c.onload=function(){a(c.contentDocument),t.ready&&t.ready.call(c,c.contentDocument,c)},r(i,s,c),c},autoResizePanels:function(t){var i=t.document||document||window.document,r=(i.getElementsByTagName("body")[0],i.getElementsByClassName(t.className||"abineContentPanel"));e(r).each(function(e){var i=n("iframe",e)[0];i.scrolling="no",n(i).height("auto");var r=n(i).width(),a=i.contentDocument.body.offsetHeight;t.extraWidth&&(r+=t.extraWidth),t.extraHeight&&(a+=t.extraHeight),n(i).width(r),n(i).height(a),e.style.width=r+"px",e.style.height=a+"px";try{var o=parseInt(e.style.left),s=o+e.offsetWidth,c=e.ownerDocument.defaultView.innerWidth,l=e.ownerDocument.documentElement.scrollLeft+c;if(s>l){var d=s-l;if(o-d>0)e.style.left=o-d+"px";else if(e.style.left="0px",s-o>c){var u=Math.round(c/(s-o)*100);u-=1,80>u&&(u=80),i.style.zoom=u+"%",i.contentDocument.body.style.zoom=u+"%"}}}catch(f){}})},removePanels:function(t){var n=t.document||document||window.document;if(t.iframe){var i=t.iframe.parentNode;return i&&i.parentNode&&i.parentNode.removeChild(i),void 0}var r=n.getElementsByClassName("abineContentPanel");e(r).each(function(e){e&&e.parentNode&&e.parentNode.removeChild(e)})}}}),ABINE_DNTME.define("abine/backgroundEventLogger",["abine/config","storage","persistence","documentcloud/underscore"],function(e,t,n,i){function r(t){var n={},i=t?t.split("#"):[];return 4==i.length?(n.error_tag=i[0],n.module=i[1],n.method=i[2],n.message=i[3]):(n.error_tag=n.module=n.method="not well-formed",n.message=t),n.browser=e.browser,n.build=e.buildNum,n.environment=e.environment,n.build_tag=e.tags[0],n.server_host=e.serverHost,n.mapping_server_host=e.mappingServerHost,n.license_server_host=e.licenseServerHost,n.phone_server_host=e.phoneServerHost,n.crypt=e.crypt,n.version=e.version,n.user_agent=window.navigator.userAgent,n}function a(n){var r={error:n},a=function(t){t&&(r.email_salt=t),ABINE_DNTME.require(["abine/ajax"],function(t){t.ajax({type:"POST",url:e.protocol+e.serverHost+"/api/errors",data:r,success:function(){c.debug("error reporting successful")},error:function(){c.debug("error reporting failed")}})})};t.Preference?t.Preference.findBy("key","Salt.ShieldedEmail",i.bind(function(e){a(e.value)},this)):a()}function o(){function e(e){try{Console(e)}catch(t){}}var n=(new Date).toUTCString();if("undefined"==typeof console||"undefined"==typeof console.debug)return{finest:function(t){e("[FINEST]["+n+"]: "+t)},debug:function(t){e("[DEBUG]["+n+"]: "+t)},info:function(t){e("[INFO]["+n+"]: "+t)},warn:function(t){e("[WARNING]["+n+"]: "+t)},error:function(n){e("[ERROR]["+date+"]: "+n),t.Preference&&t.Preference.findBy("key","shouldSendErrorReports",function(e){e.isTrue()&&a(r(n))})}};if("undefined"!=typeof console)return{finest:function(e){console.debug("[FINEST]["+n+"]: "+e)},debug:function(e){console.debug("[DEBUG]["+n+"]: "+e)},info:function(e){console.info("[INFO]["+n+"]: "+e)},warn:function(e){console.warn("[WARNING]["+n+"]: "+e)},error:function(e){console.error("[ERROR]["+n+"]: "+e),t.Preference&&t.Preference.findBy("key","shouldSendErrorReports",function(t){t.isTrue()&&a(r(e))})}};if("undefined"!=typeof Components){var i=Components.classes["@mozilla.org/consoleservice;1"].getService(Components.interfaces.nsIConsoleService);return{finest:function(e){i.logStringMessage("[FINEST]["+n+"]: "+e),dump("FINEST: "+e+"\n")},debug:function(e){i.logStringMessage("[DEBUG]["+n+"]: "+e),dump("DEBUG: "+e+"\n")},info:function(e){i.logStringMessage("[INFO]["+n+"]: "+e),dump("INFO: "+e+"\n")},warn:function(e){i.logStringMessage("[WARNING]["+n+"]: "+e),dump("WARNING: "+e+"\n")},error:function(e){i.logStringMessage("[ERROR]["+n+"]: "+e),dump("ERROR: "+e+"\n"),t.Preference&&t.Preference.findBy("key","shouldSendErrorReports",function(t){t&&t.isTrue()&&a(r(e))})}}}}var s=function(){},c=o();switch(c.dumpObj=function(e){var t=typeof e;if("object"!=t||null===e)return"string"==t&&(e='"'+e+'"'),String(e);var n,i,r=[],a=e&&e.constructor==Array;for(n in e)i=e[n],t=typeof i,"string"==t?i='"'+i+'"':"object"==t&&null!==i&&(i=c.dumpObj(i)),r.push((a?"":'"'+n+'":')+String(i));return(a?"[":"{")+String(r)+(a?"]":"}")},e.logLevel){case"NONE":c.error=s;case"ERROR":c.warn=s;case"WARN":c.info=s;case"INFO":c.debug=s;case"DEBUG":c.finest=s}return c.info("Log level set to "+e.logLevel),ABINE_DNTME.log=c,c}),ABINE_DNTME.define("abine/backgroundInit",["abine/storageRouter","abine/storage/registry","abine/window","storage","abine/securityManager","abine/stubs","abine/toolbar","abine/timer","abine/ajax","abine/config","abine/pageEvents","abine/tabs","persistence","abine/mappingServer","modules","documentcloud/underscore","abine/browserSyncStorage","abine/core","abine/dntmeInit","abine/conflict_handler","abine/saveForms","abine/formSubmitDetector","abine/localStorage","abine/responseCodes","abine/proxies","abine/licenseServer"],function(e,t,n,i,r,a,o,s,c,l,d,u,f,h,p,m,g,y,b,v,E,_,T,k){function w(n){if(!B){a.start(n),_.formSubmitDetector.init(n),E.init(n),B=!0,m.each(m.values(p),function(e){e.setMessenger&&e.setMessenger(n)}),u.tabHelper.init(n);var i=new e.StorageRouter({messenger:n,noMigrations:!0,ready:function(){try{N(n)}catch(e){}}});t.registerStorageEntities(i),C(n)}}function A(e,t){if(e=e.split("."),t=t.split("."),e.length>t.length)return!0;for(var n=0;n<e.length;n++){if(parseInt(e[n],10)<parseInt(t[n],10))return!1;if(parseInt(e[n],10)>parseInt(t[n],10))return!0}return!1}function N(e){q.trigger("storage:initialized"),i.Preference.findBy("key","new_version",function(e){e&&(e.value==l.version||A(e.value,l.version))&&(f.remove(e),f.flush())}),v.checkForMaskme(function(t){try{b.initialize(e)}catch(n){!0&&ABINE_DNTME.log.error("error during dntme initialization "+n.message+n.stack)}R||(R=!0,d.initialize(e),r.load(e),p.criticalProcess.setMessenger(e),P(function(e){var t=0;e&&(t=9e5),s.setTimeout(m.bind(function(){p.mappingsModule.startDailyMappingCheck()},this),t)}))})}function D(e){e=e||F,i.Preference.batchCreateOrModify([{key:"installUserAgent",value:ABINE_DNTME.userAgent},{key:"installVersion",value:l.version},{key:"installTags",value:l.tags[0]},{key:"installDate",value:Date.now()}],function(){e()}),l.silent&&i.Preference.batchCreateOrModify([{key:"showMedals",value:"false"},{key:"suggestProtectedEmail",value:"false"},{key:"suggestProtectedPhone",value:"false"},{key:"suggestProtectedCard",value:"false"},{key:"showTrackersOnload",value:"false"},{key:"showWeeklyReports",value:"false"}],function(){e()})}function M(e){e=e||F;var t="http://";"production"==ABINE_DNTME.config.environment&&(t="https://");var n=t+ABINE_DNTME.config.webHost+"/maskme/v2/tag.php?currentTag="+l.tags[0];c.ajax({url:n,success:function(t){try{t=JSON.parse(t)}catch(n){t={}}if("Firefox"==ABINE_DNTME.config.browser){try{Components.utils["import"]("resource://gre/modules/Preferences.jsm")}catch(n){Components.utils["import"]("resource://services-common/preferences.js")}try{var r=new Preferences("extensions.dntme.");r.has("tag")&&(t={abineMaskMeTag:r.get("tag")},r.reset("tag"))}catch(n){}}t&&""!=t&&t.abineMaskMeTag&&""!=t.abineMaskMeTag?(l.tags.unshift(t.abineMaskMeTag),i.Preference.createOrModify({key:"dynamicTag",value:t.abineMaskMeTag},function(){e()})):e()},error:function(){e()}})}function P(e){e=e||F,i.Preference.findBy("key","freshInstall",function(t){if(!t||"false"===t.value)return i.Preference.findBy("key","dynamicTag",function(t){t&&l.tags.unshift(t.value),l.silent||-1==l.tags[0].toUpperCase().indexOf("YT14")||(l.silent=!0),p.licenseModule.startDailyTouch(function(){O(function(){x(function(){e()})})})}),void 0;l.silent||-1==l.tags[0].toUpperCase().indexOf("YT14")||(l.silent=!0);var n=!0;t.value="false",f.add(t),o.freshInstall(),D(function(){M(function(){v.checkForMergedAddon(function(t,a){v.installAuthTokenCheck(t,function(){p.licenseModule.startDailyTouch(function(){x(function(){I(function(){if(l.silent)e(n);else{var o="http://"+ABINE_DNTME.config.webHost+"/donottrackme/postinstall?";ABINE_DNTME.maskme_installed&&(o+="maskme=1&"),t&&a&&(o+="merged=1&",i.Preference.createOrModify({key:"mergedMigrationPending",value:"true"},function(){})),ABINE_DNTME.dntme_upgrade&&(o+="upgrade=1&"),o+="webapp="+("production"==ABINE_DNTME.config.environment?"https://":"http://")+ABINE_DNTME.config.webAppHost,o+="&tour=1",S(o,function(){r.openPage(o,!0),e(n)})}})})})})})})})})}function S(e,t){t=t||F,i.Preference.createOrModify({key:"postInstallUrl",value:e},function(){t()})}function C(e){e.on("window:createTab",function(e){e.panelData&&(ABINE_DNTME.lastPanel||(ABINE_DNTME.lastPanel={}),ABINE_DNTME.lastPanel[e.panelData.action]=e.panelData.type),n.createTab(e)})}function I(e){try{var t=[H,L],n=m.after(t.length,e);i.Preference.findBy("key","splitTests",function(i){if(i&&i.value){var r=JSON.parse(i.value);m.each(t,function(e){e(r,n)})}else e()})}catch(r){e()}}function x(e){try{i.Preference.findBy("key","configOverrides",function(t){if(t&&t.value){var n=JSON.parse(t.value);for(var i in n)i in ABINE_DNTME.config&&(ABINE_DNTME.config[i]=n[i],ABINE_DNTME.config.overriddenKeys[i]=!0)}e()})}catch(t){e()}}function O(e){i.Preference.createOrModify({key:"showTrackersOnload",value:"false"},function(){e()})}var B=!1,F=function(){},R=!1,L=function(e,t){t()},H=function(e,t){if(e){var n=e.intrusive01;l.silent||null==n?t():(p.licenseModule.logSplitData({bucket_id:n,test_data:{int0:1}}),n==k.SPLIT_INTRUSIVE_NON_INTRUSIVE?i.Preference.createOrModify({key:"showTrackersOnload",value:"false"},function(){t()}):t())}else t()};ABINE_DNTME.bguser={shouldSendErrorReports:function(){var e=i.Preference.getSync("shouldSendErrorReports");return e&&e.isTrue()},getEmailSalt:function(){var e=i.Preference.getSync("Salt.ShieldedEmail");return e&&e.value}};var q={initialize:w};return m.extend(q,y.Events),q}),ABINE_DNTME.define("abine/badgeManager",["documentcloud/underscore"],function(){return{badges:{totalBlocked:{levels:[{name:"dntp.badges.bronze",limit:500,cssClass:"Bronze",icon:"/images/bronze-sm.png"},{name:"dntp.badges.silver",limit:5e3,cssClass:"Silver",icon:"/images/silver-sm.png"},{name:"dntp.badges.gold",limit:1e4,cssClass:"Gold",icon:"/images/gold-sm.png"},{name:"dntp.badges.platinum",cssClass:"Platinum",limit:25e3,icon:"/images/platinum-sm.png",level:1}],text:"dntp.badges.totalBlocked.text",title:"dntp.badges.totalBlocked.title",badgeText:"dntp.badges.totalBlocked.badgeText"},socialBlocked:{levels:[{name:"dntp.badges.bronze",limit:100,cssClass:"Bronze",icon:"/badge/bronze.png"},{name:"dntp.badges.silver",limit:1e3,cssClass:"Silver",icon:"/badge/silver.png"},{name:"dntp.badges.gold",limit:5e3,cssClass:"Gold",icon:"/badge/gold.png"},{name:"dntp.badges.platinum",cssClass:"Platinum",limit:15e3,icon:"/badge/platinum.png",level:1}],text:"dntp.badges.socialBlocked.text",title:"dntp.badges.socialBlocked.title",badgeText:"dntp.badges.socialBlocked.badgeText"}},getBadgeAt:function(e,t){var n={name:"None",limit:-1,icon:"/badge/nobadge.png"},i=this.badges[e];
if(t>=0){var r=i.levels;if(t>=r.length)for(var a=r.length-1;t>=a;a++){var o={name:r[a].name,cssClass:r[a].cssClass,limit:r[a].limit+(0==e.indexOf("social")?1e4:25e3),icon:r[a].icon,level:r[a].level+1};r.push(o)}n=r[t]}return n.title=i.title,n.text=i.text,n.badgeText=i.badgeText,n.setting=e,n},compute:function(e){for(var t={},n="totalBlocked",i=0,r=-1;;){var a=this.getBadgeAt(n,i);if(a.limit>e)break;a.limit<e&&(r=i,t=a),i++}return{badgeIndex:r,badge:t}}}}),ABINE_DNTME.define("abine/core",["documentcloud/underscore"],function(e){var t={on:function(e,t,n){var i=this._callbacks||(this._callbacks={}),r=i[e]||(i[e]={}),a=r.tail||(r.tail=r.next={});return a.callback=t,a.context=n,r.tail=a.next={},this},off:function(e,t){var n,i,r;if(e){if(n=this._callbacks)if(t){if(i=n[e])for(;(r=i)&&(i=i.next);)if(i.callback===t){r.next=i.next,i.context=i.callback=null;break}}else n[e]={}}else this._callbacks=null;return this},trigger:function(e){var t,n,i,r,a,o=["all",e];if(!(n=this._callbacks))return this;for(;a=o.pop();)if(t=n[a])for(r="all"==a?arguments:Array.prototype.slice.call(arguments,1);t=t.next;)(i=t.callback)&&i.apply(t.context||this,r);return this},once:function(e,t,n){function i(){return r.off(e,i),t.apply(this,arguments)}var r=this;return this.on(e,i,n)},onceAny:function(){function e(){for(var n=0;n<t.length;n++)this.off.apply(this,[t[n][0],e]),this.off.apply(this,t[n])}for(var t=arguments,n=0;n<arguments.length;n++)this.on.apply(this,arguments[n]),this.on.apply(this,[arguments[n][0],e]);return this}};t.bind=t.on,t.unbind=t.off;var n=function(){},i=function(t,i,r){var a;return a=i&&i.hasOwnProperty("constructor")?i.constructor:function(){return t.apply(this,arguments)},e.extend(a,t),n.prototype=t.prototype,a.prototype=new n,i&&e.extend(a.prototype,i),r&&e.extend(a,r),a.prototype.constructor=a,a.__super__=t.prototype,a},r=function(e,t){var n=i(this,e,t);return n.extend=this.extend,n},a=function(){this.initialize.apply(this,arguments)};return e.extend(a.prototype,t,{initialize:function(){}}),a.extend=r,{BaseClass:a,Events:t}}),ABINE_DNTME.define("abine/contentManager",["documentcloud/underscore","jquery","abine/core","abine/contentMessenger","abine/window","abine/timer","abine/formAnalyzer","abine/formStrategy","models","abine/config","abine/url","abine/proxies","abine/views/unlockPanel","abine/views/notificationPanel","abine/assets","abine/views/paymentHelperPanel","abine/views/dntmePanel","abine/formSubmitDetector"],function(e,t,n,i,r,a,o,s,c,l,d,u,f,h,p,m,g,y){function b(){}function v(e){var t=0,n=0;if(e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return{left:t,top:n}}var E={zIndex:"2147483647",position:"absolute",top:"20px",right:"20px",overflow:"hidden",borderWidth:"0px",background:"transparent",backgroundColor:"transparent"};allowedHostsRegex="development"==l.environment?/(^(.+\.)?abine\.com$)|(^(.+\.)?idme\.dev$)|(^(.+\.)?license-platform\.dev$)|(^(.+\.)?idme-platform\.dev$)|(^localhost(:[0-9]+)?$)/i:/^(.+\.)?abine\.com$/i;var _=n.BaseClass.extend({initialize:function(n){return this._locked=null,this.document=n.document,this.href=this.document.URL?this.document.URL:this.document.location?this.document.location.href:null,this.host=this.href.replace(/http[s]?:\/\//i,"").replace(/\/.*/i,""),this.domain=n.domain||(this.href?d.getTLD(this.href):null),this.document.documentElement.hasAttribute("abine_webapp")&&(this.document.documentElement.setAttribute("dnt",l.version),this.document.documentElement.setAttribute("dnt-features",l.features)),!n.force&&this.document.defaultView&&this.document.defaultView!=this.document.defaultView.top?(this.messenger={send:function(){}},void 0):(this.messenger=new i.ContentMessenger({eventAggregator:n.eventAggregator,document:n.document}),(this.document.defaultView&&this.document.defaultView!=this.document.defaultView.top||(this.messenger.on("background:dntme:show",e.bind(this.showDNTMe,this)),this.document.defaultView))&&(this.formSubmitDetectorHelper=new y.FormSubmitContentHelper(this.messenger,this.document.defaultView),"Firefox"==ABINE_DNTME.config.browser?(u.connect(null),this.tabId=this.messenger.messengerId):u.connect(this.messenger,e.bind(function(e){this.tabId=e},this)),u.securityManager.isMaskmeInstalled(e.bind(function(n){n?(this._disableFormHelpers=!0,this.maskme_installed=!0,this._locked=!0,this.loadUserPreferences()):(this.document.defaultView&&this.document.defaultView==this.document.defaultView.top&&(this.messenger.on("background:saveForm:notification",e.bind(this.showNotification,this)),this.messenger.on("contentManager:processNewFrame",e.bind(function(e){var t=this.document.getElementById(e);if(t){var n=t.contentWindow||t.contentDocument;n&&(n.document&&(n=n.document),this.setupFormsInFrame(n,t))}},this))),t(this.document).ready(e.bind(this.hookDocumentEventHandlers,this,this.document)),this.lockedCB=e.bind(this.locked,this),this.unlockedCB=e.bind(this.unlocked,this),u.securityManager.on("background:securityManager:locked",this.lockedCB),u.securityManager.on("background:securityManager:unlocked",this.unlockedCB),u.securityManager.isLocked(e.bind(function(n){this._locked=n,this.domain&&this.messenger.send("contentscript:contextmenu:refresh",{domain:this.domain}),t(this.document).bind("contextmenu",e.bind(this.trackLastElementClicked,this)),this.messenger.on("background:contextmenu:fill",e.bind(this.fillField,this)),this.messenger.on("background:contextmenu:maskcard",e.bind(this.maskCardContextMenu,this)),this.messenger.on("broadcast:preference:reload",e.bind(function(){this.loadUserPreferences()},this)),ABINE_DNTME.contentuser={shouldSendErrorReports:e.bind(function(){return this.preferences&&this.preferences.isPrefTrue("shouldSendErrorReports")},this),getEmailSalt:e.bind(function(){return this.preferences?this.preferences.getPref("Salt.ShieldedEmail"):"NULL PREFERENCES"},this),hasRegEmail:e.bind(function(){return this.preferences?this.preferences.hasPref("regEmail"):!1},this),shieldedEmails:new c.ShieldedEmailCollection},ABINE_DNTME.contentuser.shieldedEmails.fetchAll()},this)))},this)),this.notifyInit()),void 0)},triggerKeyboardEvent:function(e,t){var n=this.document.createEvent("KeyboardEvent");n.initKeyboardEvent?n.initKeyboardEvent(e,!0,!0,null,!1,!1,!1,!1,9,0):n.initKeyEvent&&n.initKeyEvent(e,!0,!0,null,!1,!1,!1,!1,9,0),t.dispatchEvent(n)},maskCardContextMenu:function(){if(this.lastElementClicked){var n={element:this.lastElementClicked,dataType:"/financial/creditcard/number"};this.createPanel({style:{},secured:!0,panelWidth:450,field:n,ready:e.bind(function(i){var r=new m({field:n,formEl:this.lastElementClicked.parentNode,contentManager:this,fromContextMenu:!0,authToken:this.preferences.getPref("authToken"),beginnerMode:this.preferences.getPref("beginnerMode"),hasRegistered:this.preferences.isPrefTrue("hasRegistered"),entitledToPayments:this.preferences.isPrefTrue("entitledToPayments"),hasEnabledPayments:this.preferences.isPrefTrue("hasEnabledPayments"),entitledToPhone:this.preferences.isPrefTrue("entitledToPhone"),dynamicPanel:null,fields:[n],domain:this.domain,el:t("<div></div>",i).get(0)});t(n.element).one("dntme.closepanel",e.bind(r.closePanel,r)),r.bind("remove",function(){t(n.element).unbind("dntme.closepanel");try{r.remove()}catch(e){}this.removePanels()},this),r.bind("render resize",function(e){e=e||{className:null,extraWidth:null,extraHeight:null},this.autoResizePanels(e.className,e.extraWidth,e.extraHeight)},this),t("body",i).append(r.el)},this)})}},fillField:function(e){var n=e.element||this.lastElementClicked;if(n){"/password"==e.dataType&&(!this.generatedPassword&&e.generatedNow?this.generatedPassword=e.value:this.generatedPassword&&e.generatedNow&&(e.value=this.generatedPassword)),t(n).val(e.value),e.name=n.getAttribute("name"),e.id=n.getAttribute("id"),this.contextForm||(this.contextForm=t("<form maskMeFilled='yes'></form>",this.document));var i=t(n).clone();i.attr("abinedatatype",e.dataType),this.contextForm.append(i),t(this.contextForm.get(0)).data("mmFields",null),this.triggerPanelFillEvent(this.contextForm.get(0),e)}},triggerPanelFillEvent:function(e,t){this.messenger.send("panel:fill",{fieldData:t,formData:o.getFormData(e,this.href)})},trackLastElementClicked:function(e){("input"==e.target.localName||"textarea"==e.target.localName)&&(this.lastElementClicked=e.target)},isLocked:function(){return this._locked},locked:function(){this._locked=!0,this.trigger("locked"),this.domain&&this.messenger.send("contentscript:contextmenu:refresh",{domain:this.domain})},unlocked:function(){this._locked=!1,this.trigger("unlocked"),this.preferences.fetchAll(),this.domain&&this.messenger.send("contentscript:contextmenu:refresh",{domain:this.domain})},notifyInit:function(){if(this.href){var e={url:this.href,domain:this.domain};this.messenger.send("contentManager:init",e),this.trigger("contentManager:init",e)}},start:function(n){function i(){if((!this.document.defaultView||this.document.defaultView==this.document.defaultView.top)&&this.preferences.getPref("showTrackersOnload")&&-1==ABINE_DNTME.config.webAppHost.indexOf(this.domain)){var n=this.domain;u.memoryStore.get(n,e.bind(function(i){(!i||this.shouldShowCardAlertPanel())&&t(this.document).ready(e.bind(function(){var t=new c.TabData({messenger:this.messenger});t.fetch({success:e.bind(function(){this.lastDNTMePanel||t.get("reloadRequired")||this.href.match(/dntmeFullTour=|dntmeTour=/i)||(u.memoryStore.set(n,!0),this.showDNTMe({tabId:this.tabId,compact:!0,cardAlertPanel:this.shouldShowCardAlertPanel()}))},this)})},this))},this))}}function r(){!this.maskme_installed&&this.preferences.getPref("showInTheKnowGrowls")?u.panelsModule.getDNTMeGrowl(this.tabId,e.bind(function(n){n?t(this.document).ready(e.bind(function(){this.showNotification({type:"growl",dynamicPanel:n,neverFade:!0})},this)):i.call(this)},this)):i.call(this)}function o(){this.startFormHelpers(e.bind(function(){r.apply(this),"complete"==this.document.readyState?this.pageLoadDone("skipFormHelpers"):t(this.document.defaultView).load(e.bind(this.pageLoadDone,this))},this))}if(this.document.defaultView){if(n=n||0,null===this._locked)return 20>n&&a.setTimeout(e.bind(function(){this.start(n+1)},this),100),void 0;if(this.blacklist)this.loadUserPreferences(e.bind(o,this));else{this.blacklist=new c.Blacklist({domain:this.domain});try{this.blacklist.fetchByDomain(!1,e.bind(function(){this.blacklisted=this.blacklist.get("tracker"),this.loadUserPreferences(e.bind(o,this))},this))}catch(s){this.loadUserPreferences(e.bind(o,this))}}}},hasText:function(e){var t=this.document?this.document.documentElement:null;return t&&(t.innerText||t.textContent).match(e)},pageLoadDone:function(e){function t(){var e=n.hasText(/signout|logout|sign out|log out/i),t=!e&&n.hasText(/signin|login|signup|sign in|log in/i),i={forms:n.formsData,domain:n.domain,hasLogin:t,hasLogout:e};n.messenger.send("contentManager:formsInitialized",i),n.trigger("contentManager:formsInitialized",i)}var n=this;"skipFormHelpers"==e?t():this.startFormHelpers(t)},loadUserPreferences:function(t){t=t||function(){},this.preferences=new c.PreferenceCollection({}),this.preferences.bind("sync:success",e.once(e.bind(function(){t.call(this)},this))),this.preferences.bind("sync:error",e.bind(function(){t.call(this)},this)),this.preferences.fetchAll()},arrayFromNodeList:function(e){return Array.prototype.slice.call(e)},hookForUserIntent:function(){this.userIntent=!0},disableFormHelpers:function(){t(this.document).off("mousedown",this.hookNewFormsOnClickHandler),this.stopFormHelpers(),this.blacklisted=!0,this._disableFormHelpers=!0},hookNewFormsOnClick:function(n){function i(){a.setTimeout(function(){t(r).trigger("focus")},50)}if(!this.blacklisted){this.formHelpers=this.formHelpers||[];var r=n.target;if("input"===r.nodeName.toLowerCase()){var s=r.form||t(r).closest("form").get(0),c=null;s?(c=e(this.formHelpers).find(function(e){return e.formEl==s?!0:void 0}),c&&o.hasFormChanged(s)&&(c.cleanup(),this.formHelpers=e(this.formHelpers).filter(function(e){return e!=c}),c=null,o.clearFormCache(s)),this.formsData=this.formData||[],c||this.setupFormHelperForFormEl(s,this.formsData,i)):(c=e(this.formHelpers).find(function(e){for(var t=r.parentNode;t&&t!=e.formEl;)t=t.parentNode;return e.formEl==t?!0:void 0}),c?i():this.startFormHelpers(function(){c=e(this.formHelpers).find(function(e){for(var t=r.parentNode;t&&t!=e.formEl;)t=t.parentNode;return e.formEl==t?!0:void 0}),i()}))}}},pageHasCheckoutForm:function(){var e=null;if(this.formsData)var e=this.formsData.filter(function(e){return e.type==o.CHECKOUT_FORM});return e&&e.length>0?!0:!1},shouldShowCardAlertPanel:function(e){return e||this.pageHasCheckoutForm()?!!this.preferences.getPref("suggestProtectedCard"):!1},setupFormHelperForFormEl:function(n,i,r){if(this._disableFormHelpers)return r&&r(),void 0;var a=null,l=null;if(this.domain&&this.domain.match(allowedHostsRegex)&&n.hasAttribute("datatype-ignore"))return r(),void 0;var d=o.getFormSignature(this.domain,n),u=null;if(this.formMappings&&(u=this.formMappings.find(function(e){return e.get("signature")==d?!0:!1})),l=u?u.get("formType"):o.getFormType(n),l==o.LOGIN_FORM?a=s.LoginHelper:l==o.REGISTRATION_FORM?a=s.RegistrationHelper:l==o.OTHER_FORM?a=s.OtherHelper:l==o.LOGIN_REGISTRATION_FORM?a="loginRegisterHelper":l==o.CHECKOUT_FORM&&(a=s.CheckoutHelper),a){var f,h,p={};u&&u.fields&&u.fields.models&&(h={},e.each(u.fields.models,function(e){h[e.get("signature")]=e.get("dataType")}));var m=o.getFields(n,h);e.each(m,function(e){p[e.dataType]=e.signature});var g=n.hasAttribute("action")?n.getAttribute("action"):"";if(i.push({url:g,type:l,fields:p,formSignature:d,visible:t(n).is(":visible")}),"loginRegisterHelper"==a||a==s.LoginHelper){var y=new c.AccountCollection,b=e.bind(function(e){e&&!0&&ABINE_DNTME.log.error("[ERROR CALLBACK]#[abine/common/content_manager]#[setupFormHelperForFormEl]# error while loading accounts for site"),a=e||!y||0==y.length?"loginRegisterHelper"==a?s.RegistrationHelper:a:s.LoginHelper,(a!=s.LoginHelper||this.preferences.getPref("entitledToAccounts"))&&(f=new a({el:n,mappedFields:h,contentManager:this,preferences:this.preferences,accounts:y}),this.formHelpers.push(f)),r()},this);this.domain?y.fetchAllByDomain(this.domain,b):b()}else f=new a({el:n,mappedFields:h,contentManager:this,preferences:this.preferences}),this.formHelpers.push(f),r()}},hookDocumentEventHandlers:function(n){n.userIntentHandler||(n.userIntentHandler=e.bind(this.hookForUserIntent,this),n.hookNewFormsOnClickHandler=e.bind(this.hookNewFormsOnClick,this),t(n).on("keydown",n.userIntentHandler),t(n).on("mousedown",n.userIntentHandler),t(n).on("mousedown",n.hookNewFormsOnClickHandler))},startFormHelpers:function(n){function i(){(!this._retriedForForm||this._retriedForForm<10)&&(this._retriedForForm=(this._retriedForForm||0)+1,a.setTimeout(e.bind(this.startFormHelpers,this),1e3))}if(n=n||b,this._disableFormHelpers)return n(),void 0;if(this.blacklisted)return n(),void 0;var r=Date.now();this.formHelpers=this.formHelpers||[],this.innerFrames=this.innerFrames||{};var s=this.document.getElementsByTagName("form"),l=[];e.each(s,function(e){if(!e.getAttribute("abineGuid")){var n=t(":text, :password",e).length;n>0&&(n>=2?l.unshift(e):l.push(e))}}),l=l.slice(0,10);var d=this.arrayFromNodeList(this.document.getElementsByTagName("iframe"));if(e(d).each(function(t){try{var n=t.contentWindow||t.contentDocument;if(n){n.document&&(n=n.document);try{this.hookDocumentEventHandlers(n)}catch(i){}n.documentElement.mmFormsProcessed=!0;var r=this.arrayFromNodeList(n.getElementsByTagName("form"));if(r.length>0){var a="iframe."+Math.random();this.innerFrames[a]=t,e(r).each(function(e){e.setAttribute("abFrameId",a)}),l=l.concat(r)}}}catch(i){}},this),l=l.concat(o.getFieldGroupsWithoutForm(this.document)),l=e(l).filter(function(e){return!e.getAttribute("abineGuid")}),this.formsData=this.formsData||[],0==l.length)return this.executeLoginPageEvents(i,3),n(),void 0;var u=e.bind(function(){this.executeLoginPageEvents(e.bind(function(){e.async.forEachSeries(l,e.bind(function(e,t){this.setupFormHelperForFormEl(e,this.formsData,t)},this),e.bind(function(e){e&&!0&&ABINE_DNTME.log.error("[ERROR CALLBACK]#[abine/common/content_manager]#[startFormHandlers]# error event in setupFormHelperForFormEl while doing formElements async.forEach");Date.now()-r;n()},this))},this),3)},this);!this.formMappings&&0!==l.length&&this.domain?(this.formMappings=new c.MappedFormCollection({}),this.formMappings.fetchAllByDomain(this.domain,e.bind(function(){u()},this))):u()},executeLoginPageEvents:function(n,i){try{if(this.preferences.getPref("autoLoginHost")==this.domain){var r=this.preferences.getPref("autoLoginEvents")||"";if(r.length>0){for(r=r.split("\n");r.length>0;){var o=r.shift(),s=o.indexOf(" "),c=o.substr(0,s),l=o.substr(s+1);if(c.length>0&&l.length>0&&c.match(/click|focus/)){var d=t(l,this.document);if(d.length>0){this.userIntent=!0,"click"==c?d[0][c]():(t(d).trigger("mousedown"),d.trigger(c));continue}r.unshift(o);break}break}if(this.preferences.setPref("autoLoginEvents",r.join("\n")),r.length>0&&i>0)return a.setTimeout(e.bind(function(){this.executeLoginPageEvents(n,i-1)},this),1e3),void 0}}}catch(u){}n.apply(this,[])},stopFormHelpers:function(){e(this.formHelpers).each(function(e){e.cleanup()}),this.formHelpers=[],this.innerFrames=[]},setupFormsInFrame:function(n,i){if(n.documentElement&&!n.documentElement.mmFormsProcessed&&!this.blacklisted){this.hookDocumentEventHandlers(n),this.formHelpers=this.formHelpers||[],this.innerFrames=this.innerFrames||{},this.formsData=this.formsData||[];var r=null;!i&&n.defaultView&&n.defaultView.frameElement&&(i=n.defaultView.frameElement),i&&(r="iframe."+Math.random(),this.innerFrames[r]=i),n.documentElement.mmFormsProcessed=!0,t(n).bind("click",e.bind(this.hookNewFormsOnClick,this));var a=this.arrayFromNodeList(n.getElementsByTagName("form"));a=a.concat(o.getFieldGroupsWithoutForm(n));var s=[];e.async.forEachSeries(a,e.bind(function(e,t){r&&e.setAttribute("abFrameId",r),this.setupFormHelperForFormEl(e,s,t)},this),e.bind(function(e){e&&!0&&ABINE_DNTME.log.error("[ERROR CALLBACK]#[abine/common/content_manager]#[setupFormsInFrame]# error in setupFormHelperForFormEl while doing formElements async.forEach"),this.formsData=this.formsData.concat(s)},this))}},triggerFocusOnElement:function(e){t(e).trigger("focus")},getPanelForDataType:function(t,n){var i=e.find(t,function(e){return e.field_type==n});return i?i:!1},createPanel:function(t){if(t.style=e.extend({},E,t.style),t.document=this.document,t.field){var n=this.innerFrames;t.ready=e.wrap(t.ready,function(e,i,r){T(i,r.parentElement,t.field.element,n),e(i,r)}),this.closeCurrentPanel(),this._currentPanelField=t.field}return t.panelWidth||(t.panelWidth=400),t.secured&&this.isLocked()&&!t.hasDynamicPanel&&this.preferences.isPrefTrue(t.secured)?(u.memoryStore.get("login-panel-closed",e.bind(function(e){(!e||parseInt(e)+432e5<Date.now())&&(e&&u.memoryStore.set("login-panel-closed",null),this.createLoginPanel(t),r.createPanel(t))},this)),void 0):r.createPanel(t)},/**
       * @license
       * Array Remove Copyright (c) John Resig (MIT Licensed)
       */
removeFromArray:function(e,t,n){var i=e.slice((n||t)+1||e.length);return e.length=0>t?e.length+t:t,e.push.apply(e,i)},processDynamicPanelForField:function(e){var t=this.preferences.getPref("dynamicPanels"),n=t?JSON.parse(t):"",i=!1;if(n&&n.panels&&(i=this.getPanelForDataType(n.panels,e))){parseInt(i.masked_emails)>0&&(i.dontShow=!0);var r=parseFloat(i.show_rate),a=Math.random();a>r&&(i.dontShow=!0)}return{dynamicPanel:i}},closeDNTMe:function(){if(this.lastDNTMePanel)try{this.lastDNTMePanel.remove(),this.lastDNTMePanel=null}catch(e){}},showDNTMe:function(n){n=n||{tabId:this.tabId};var i=this.document.getElementById("mmPostInstallClose");if(i&&t(i).click(),n.hideAfter)if(this.preferences.hasPref("clickedClose")){var r=this.preferences.getPref("clickedClose");if(this.preferences.setPref("clickedClose",r+1),r>n.hideAfter)return}else this.preferences.setPref("clickedClose",1);var a=600;this.createPanel({className:"abineDNTMePanel",panelWidth:n.compact&&"medals"!=n.page?200:311,panelHeight:a,style:{borderRadius:"0px",height:a+"px",position:"fixed",top:n.compact?"50px":E.top},ready:e.bind(function(i,r){if(this.lastDNTMePanel){var a=this.lastDNTMePanel;this.lastDNTMePanel=null;try{a.remove()}catch(o){}try{t(a.iframe.parentNode).remove()}catch(o){}}u.panelsModule.getDNTMePanel(n.tabId,e.bind(function(e){var a=this.lastDNTMePanel=new g({messenger:this.messenger,contentManager:this,domain:this.domain,dynamicPanel:e,compact:n.compact,cardAlertPanel:n.cardAlertPanel,page:n.page,highlight:n.highlight,timeout:n.timeout,notNow:this.preferences.getPref("notNowClicked"),intrusiveSplit:this.preferences.getSplitTest("intrusive01"),registered:this.preferences.getPref("hasRegistered"),premium:this.preferences.getPref("entitledToPhone"),footerCampaign:this.preferences.getPref("footerCampaign"),el:t("<div></div>",i).get(0)});a.iframe=r,a.messenger=this.messenger,a.bind("remove",function(){this.lastDNTMePanel=null;try{a.remove()}catch(e){}try{t(r.parentNode).remove()}catch(e){}},this),a.bind("render resize",function(){this.autoResizePanels("abineDNTMePanel",0,10)},this),a.bind("show-settings",function(e){delete n.compact,n.page="settings",e&&(n.highlight=e.highlight),this.showDNTMe(n)},this),a.bind("show-trackers",function(){delete n.compact,n.page="trackers",this.showDNTMe(n)},this),a.bind("show-dashboard",function(){delete n.compact,n.page="dashboard",this.showDNTMe(n)},this),a.bind("show-medals",function(){n.cardAlertPanel||(n.page="medals",this.showDNTMe(n))},this),a.bind("show-report",function(){n.cardAlertPanel||(n.page="weekly-report",this.showDNTMe(n))},this),a.bind("max-height",function(){this.autoResizePanels("abineDNTMePanel",0,1e3)},this),t("body",i).append(a.el)},this))},this)})},showNotification:function(n){if(this.preferences.getPref("showNotifications")&&n){var i=parseInt(this.preferences.getPref("countNotifications"))+1;this.preferences.setPref("countNotifications",i);var r=i>10?3e3:1e4;if(n.height=n.height?n.height:35,this.lastDNTMePanel)try{this.lastDNTMePanel.remove(),this.lastDNTMePanel=null}catch(a){}this.createPanel({className:"abineNotificationPanel",panelWidth:n.panelWidth,panelHeight:n.height,style:{height:n.height+"px",position:"Firefox"==ABINE_DNTME.config.browser?"absolute":"fixed"},ready:e.bind(function(i,a){var o=!1,s=h.NotificationPanelView,c={notification:n,contentManager:this,domain:this.domain,messenger:this.messenger,el:t("<div></div>",i).get(0),timeout:r};if("card"==n.type){var l=1;this.preferences.hasPref("countCardNotifications")&&(l=parseInt(this.preferences.getPref("countCardNotifications"))+1),this.preferences.setPref("countCardNotifications",l),s=h.CardNotificationPanelView,5>=l&&(o=!0,n.detailed=!0)}else if("email"==n.type||"post-register"==n.type){var d=1;this.preferences.hasPref("countEmailNotifications")&&(d=parseInt(this.preferences.getPref("countEmailNotifications"))+1),this.preferences.setPref("countEmailNotifications",d),1>=d&&(s=h.DetailedEmailNotificationPanelView,o=!0,n.neverFade=!0)}else"login"==n.type?s=h.SaveLoginNotificationPanelView:"change_password"==n.type?s=h.ChangePasswordNotificationPanelView:"growl"==n.type&&(s=h.GrowlNotificationPanelView);var u=new s(c);u.iframe=a,this.notificationViews||(this.notificationViews=[]),o&&(e.each(this.notificationViews,function(e){e.remove()}),this.notificationViews=[]),this.notificationViews.unshift(u);var f=e.bind(function(){this.messenger.off("background:saveForm:notification:close",f);try{u.remove()}catch(e){}},this);this.messenger.on("background:saveForm:notification:close",f),u.bind("remove",function(){this.messenger.off("background:saveForm:notification:close",f);for(var e=0,n=0;n<this.notificationViews.length;n++)this.notificationViews[n].iframe==a&&(e=n);if(this.removeFromArray(this.notificationViews,e),u.remove(),t(a.parentElement).remove(),this.notificationViews.length>0)for(var i=10,n=this.notificationViews.length-1;n>=0;n--)this.notificationViews[n].iframe.parentElement.style.top=i+"px",i+=this.notificationViews[n].iframe.parentElement.offsetHeight+5},this);var p=10;e.each(this.notificationViews,function(e){e.iframe!=a&&(p+=e.iframe.parentElement.offsetHeight+5)}),a.parentElement.style.top=p+"px",u.bind("render resize",function(){this.autoResizePanels("abineNotificationPanel")},this),t("body",i).append(u.el)},this)})}},createLoginPanel:function(n){n.contentManager=this,n.ready=e.bind(function(i,r){var a=this.innerFrames;T(i,r.parentElement,n.field.element,a);var o=new f({field:n.field,contentManager:n.contentManager,preferences:n.contentManager.preferences,el:t("<div></div>",i).get(0),doc:i});t(n.field.element).one("dntme.closepanel",e.bind(o.closePanel,o)),o.bind("remove",function(){t(n.field.element).unbind("dntme.closepanel"),o.remove(),this.removePanels()},this),o.bind("render resize",function(){this.autoResizePanels()},this),t("body",i).append(o.el)},this)},isPanelShown:function(e){return this._currentPanelField&&this._currentPanelField.element==e.element},closeCurrentPanel:function(){this._currentPanelField&&(t(this._currentPanelField.element).trigger("dntme.closepanel"),this._currentPanelField=null)},autoResizePanels:function(e,t,n){r.autoResizePanels({document:this.document,className:e,extraWidth:t,extraHeight:n})},removePanels:function(e){r.removePanels({document:this.document,iframe:e})},destroy:function(){this.decorator&&this.decorator.cleanup();try{u.securityManager.off("background:securityManager:locked",this.lockedCB)}catch(e){}try{u.securityManager.off("background:securityManager:unlocked",this.unlockedCB)}catch(e){}if("Firefox"!=ABINE_DNTME.config.browser)try{u.disconnect()}catch(e){}try{this.disableFormHelpers()}catch(e){}if(this.messenger){try{this.messenger.send("contentManager:destroy")}catch(e){}this.messenger.off(),this.messenger.destroy(),delete this.messenger}}}),T=function(e,n,i){function r(e){var n=e.frameElement;if(n){var o;try{o=t(n).offset()}catch(s){o=v(n)}a.top+=o.top+1-i.ownerDocument.body.scrollTop,a.left+=o.left-i.ownerDocument.body.scrollLeft,n.ownerDocument.defaultView!=e.top&&r(e.parent)}}var a;try{try{a=t(i).offset();try{i.ownerDocument!=n.ownerDocument&&r(i.ownerDocument.defaultView)}catch(o){}}catch(o){a=v(i),r()}a.top+=t(i,e).outerHeight()}catch(o){a={top:0,left:0}}n.style.top=a.top+"px",n.style.left=a.left+"px"};return{ContentManager:_}}),ABINE_DNTME.define("abine/formAnalyzer",["documentcloud/underscore","jquery","pidcrypt","abine/phoneHeuristics","abine/paymentHeuristics","abine/url"],function(e,t,n,i,r,a){function o(){for(var e=[],t="0123456789ABCDEF",n=0;32>n;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);e[12]="4",e[16]=t.substr(3&e[16]|8,1);var i=e.join("");return i}var s="loginForm",c="registrationForm",l="checkoutForm",d="changepasswordForm",u="otherForm",f="loginRegistrationForm",h="emailField",p="passwordField",m="phoneField",g="usernameField",y="paymentField",b="addressField",v={checkbox:1,radio:1,hidden:1,file:1,button:1,submit:1,reset:1,image:1,time:1,color:1,date:1,datetime:1,"datetime-local":1,month:1,range:1,url:1,week:1},E={LOGIN_FORM:s,REGISTRATION_FORM:c,CHECKOUT_FORM:l,CHANGEPASSWORD_FORM:d,OTHER_FORM:u,LOGIN_REGISTRATION_FORM:f,EMAIL_FIELD:h,PASSWORD_FIELD:p,PHONE_FIELD:m,USERNAME_FIELD:g,PAYMENT_FIELD:y,ADDRESS_FIELD:b,getFormType:function(n,i){var r=E.getFields(n,i);n.getAttribute("abineGuid")||n.setAttribute("abineGuid",o());var a=0,f=0,h=0,p=0,m={},g=0;e(r).each(function(e){"/ignore"!=e.dataType&&("password"==e.fieldType||"/password"==e.dataType||"/passwordold"==e.dataType?(a++,m[e.fieldType]||(m[e.fieldType]=0),m[e.fieldType]++):(t(e.element).is(":visible")&&e.fieldType in{text:1,email:1,tel:1}&&f++,"/contact/email"==e.dataType?h++:"/nameperson/friendly"==e.dataType&&p++,e.dataType&&e.dataType.indexOf("financial")>=0&&g++))}),m.text&&m.password&&(a-=m.text);var y=u;0===a?h>=1?y=c:1===p&&(y=s):1===a?y=f>1?c:s:2===a?y=c:3===a&&(y=d),g>0&&(y=l);var b=(n.ownerDocument.URL||n.ownerDocument.location.href||"").replace(/\?.*/,"").replace(/^http[s]?:\/\/[^\/]*/,""),v=(n.getAttribute("action")||"").replace(/\?.*/,"").replace(/^http[s]?:\/\/[^\/]*/,"");return"FORM"==n.nodeName&&(y==s?(b.match(/(regist|signup|join)/i)||v.match(/(regist|signup|join)/i))&&(n.innerHTML.match(/forgot/i)||(y=c)):y==c&&2!=a&&(b.match(/(login|signin)/i)||v.match(/(login|signin)/i))&&(y=s)),y},hasFormChanged:function(e){for(var n=t(e).find("input, textarea").toArray(),i=0;i<n.length;i++)if(!t(n[i]).data("mmProcessed"))return!0;var r=this.getFields(e);for(var i in r)if(!r[i].element.parentNode)return!0;return!1},clearFormCache:function(e){t(e).removeData("mmSignature"),t(e).removeData("mmFields")},getFormSignature:function(e,i){var r,a,o,s={},c=t(i).find("input, textarea").toArray(),l=t(i).data("mmSignature");if(l)return l;l="",l+=e;for(var d=[],u=0;u<c.length;u++)if(o=c[u],!(o.hasAttribute("type")&&o.getAttribute("type").toLowerCase()in v||o.hasAttribute("readonly"))){if(a=o.nodeName.toLowerCase(),r=o.name||o.id||a,s[r]){for(var f=2;s[r+f];)f++;r+=f}d.push(r),s[r]=1}d.sort();for(var u=0;u<d.length;u++)l+=d[u]+"_";return l=n.SHA1(l),t(i).data("mmSignature",l),l},getFields:function(e,n){var a,o,s,c,l,d,u,f,h=[],p=0,m=0,g=t(e).data("mmFields");if(g)return g;g={},t(e).data("mmFields",g);for(var y=t(e).find("input, textarea, select").toArray(),b=E.getLabelMapFor(e),_=0;_<y.length;_++)if(d=y[_],t(d).data("mmProcessed",1),!(d.hasAttribute("type")&&d.getAttribute("type").toLowerCase()in v||d.hasAttribute("readonly"))){if(p+=1,o=d.nodeName.toLowerCase(),a=d.name||d.id||o,g[a]){for(var k=2;g[a+k];)k++;a+=k}if(l=b[d.id||d.name]?b[d.id||d.name].text:null,null==l&&d.hasAttribute("placeholder")&&(l=d.getAttribute("placeholder")),""==l&&(l=null),"select"==o?u="select":"textarea"==o?u="textarea":"input"==o&&(u=d.getAttribute("type")?d.getAttribute("type").toLowerCase():"text",u in{password:1,text:1,tel:1,email:1}||(u="text")),"email"==u)c="/contact/email";else if("tel"==u)c="/contact/phone";else{var w=T(d.id);f=d.name||w||d.className||"",c=E.getDataTypeByRegExRules(f,l,u,d.innerHTML),!c&&d.name&&w&&(c=E.getDataTypeByRegExRules(w,l,u,d.innerHTML)),"password"!=u||"/passwordold"==c||c&&-1!=c.indexOf("/financial")||(c="/password"),"/password"==c&&(m++,s||(s=a))}n&&n[a]&&(c=n[a]),d.hasAttribute("abinedatatype")&&(c=d.getAttribute("abinedatatype")),g[a]={position:p,element:d,fieldType:u,id:d.id,className:d.className,name:d.name,dataType:c,label:l,signature:a,maxlength:d.hasAttribute("maxlength")?parseInt(d.getAttribute("maxlength")):null,size:d.size?d.size:null},h[p]=g[a],h[p].key=a}return n||(3==m&&(g[s].dataType="/passwordold"),i.apply(g,h),r.apply(g,h)),g},getProtocol:function(e,t){var n=e.getAttribute("action");return n&&0===n.indexOf("http")||(n=t),n.replace(/:.*/,"")},getPageDomain:function(e){return a.getHostname(e)},getFormDomain:function(e,t){var n=e.getAttribute("action");return n?n.match(/(http[s]?:)?\/\//i)?a.getHostname(n):a.getHostname(t):""},getFormData:function(n,i){var r=n.hasAttribute("action")?n.getAttribute("action"):i,o=E.getFields(n),s=E.getFormType(n),c=E.getFormSignature(i,n),l={url:r,type:s,fields:{},pageUrl:i,formSignature:c};return"yes"===t(n).attr("maskMeFilled")&&(l.origin="MaskMe"),l.id=n.getAttribute("abineGuid"),l.protocol=this.getProtocol(n,i),l.domain=a.getTLD(i),l.page_host=this.getPageDomain(i),l.form_host=this.getFormDomain(n,i),e.each(o,function(e){l.fields[e.dataType]=e.signature,e.dataType&&-1=="submit.image.button".indexOf(e.fieldType)&&(-1=="checkbox.radio".indexOf(e.fieldType)||e.element.checked)&&(-1!=e.dataType.indexOf("email")?l.email&&0!=l.email.length||(l.email=t(e.element).val()||""):-1!=e.dataType.indexOf("password")?(l.password&&0!=l.password.length||(l.password=t(e.element).val()||""),"strong"==t(e.element).attr("abineOrigin")&&(l.generated_password=!0)):-1!=e.dataType.indexOf("friendly")&&(l.username&&0!=l.username.length||(l.username=t(e.element).val()||"")))}),l},getFieldType:function(e){var t=e.nodeName.toLowerCase();if("select"==t)return"select";if("textarea"==t)return"textarea";if("input"==t){var n=e.getAttribute("type");return n?n.toLowerCase():"text"}},getLabelMapFor:function(e){var n,i,r={};return t(e).find("label").each(function(e,a){if(n=a.getAttribute("for"))r[n]||(r[n]={element:a,text:t(a).text()||a.name||a.id});else{if(i=t("input",a),i.length>0)return i=i.get(0),r[i.id||i.name]={element:a,text:t(a).text()||a.name||a.id},void 0;var o=a.nextSibling;for(o||(o=a.parentNode.nextSibling);o&&1!=o.nodeType;)o=o.nextSibling;if(o&&!o.form&&o.firstChild)for(o=o.firstChild;o&&1!=o.nodeType;)o=o.nextSibling;o&&o.form&&(o.id||o.name)&&(r[o.id||o.name]={element:a,text:t(a).text()||a.name||a.id})}}),r},getLabelFor:function(e,n){var i=e.id||e.name;return i?t(n).find('label[for="'+i+'"]').get(0):null},getDataTypeByRegExRules:function(t,n,i,r){var a=t&&t.length>0,o=n&&n.length>0,s=a?t.replace(k.nonAlphanumeric,""):null,c=o?n.replace(k.nonAlphanumeric,""):null;s==t&&(alternameName=null),c==n&&(alternameLabel=null);var l=n+t,d=c+s,u=_[i];if(!u)return null;for(var f=[],h=0;h<u.length;h++){var p=u[h],m="undefined"!=typeof p.label,g="undefined"!=typeof p.name;if(!p.negative||!(t&&t.match(p.negative)||n&&n.match(p.negative))){if(o&&!m&&g&&n.match(p.name)||o&&m&&n.match(p.label)||a&&g&&t.match(p.name)||c&&!m&&g&&c.match(p.name)||c&&m&&c.match(p.label)||s&&g&&s.match(p.name)){if(p.options&&r&&!r.match(p.options))continue;f.push(p.data_type);break}if(p.label_name&&o&&a&&(!m&&g&&l.match(p.name)||m&&l.match(p.label)||g&&l.match(p.name)||d&&!m&&g&&d.match(p.name)||d&&m&&d.match(p.label)||d&&g&&d.match(p.name))){f.push(p.data_type);break}if(p.matchByOptions&&p.options&&r&&r.match(p.options)){f.push(p.data_type);break}}}if(1==f.length)return f[0];if(f.length>1){var y=e(f).find(function(e){return"/contact/email"==e?!0:void 0});return y?y:f[0]}return null},isMatchingForm:function(t,n){if(t.formSignature==n.formSignature)return!0;var i=0,r=0;return e.each(t.fields,function(e,t){t in n.fields?i++:r++}),i>=2&&i>r||1==i&&i>=r},getFieldGroupsWithoutForm:function(t){for(var n={text:1,password:1,email:1,tel:1},i=t.getElementsByTagName("input"),r=(e(i).filter(function(e){if(e.form)return!1;var t=e.type?e.type.toLowerCase():"text";return t in n},this)),a=[],o=[],s=[1],c={},l=0;l<r.length;l++){for(var d=r[l].parentNode,u={},f=0,h=!1;d&&3>f;){if(d.id=d.id||"abId"+Math.random(),l>0&&d.id in o[l-1]){s[l]=s[l-1],u=o[l-1],(!(s[l-1]in c)||c[s[l-1]].depth<f)&&(c[s[l-1]]={lca:d,depth:f}),h=!0;break}u[d.id]=1,d=d.parentNode,f++}o.push(u),h||(s[l]=0==l?1:s[l-1]+1,c[s[l]]={lca:r[l].parentNode,depth:0})}var p={};for(var m in c)c[m].lca.id in p||(p[c[m].lca.id]=1,a.push(c[m].lca));return a.length>0,a}},_={text:[{name:/.*(captcha|image).*/i,data_type:"/ignore"},{name:/^q$|find|search|terms/i,data_type:"/ignore"},{name:/hint/i,data_type:"/ignore"},{name:/email|e\-mail/i,label:/windowsliveid|email|e\-mail/i,negative:/search|friend|reference|recipient|reference|receiver/i,data_type:"/contact/email"},{name:/user|userid|alias|login|uname|yahooid|onlineid|session_key|(?:(?:nick|screen|member|usr|user|account|login|display).*(name|id))/i,label:/alias|shortname|login|handle|display.*name|user[\s]*(name|id)/i,negative:/credit|password|full/i,data_type:"/nameperson/friendly"},{name:/(?:title|salutation)/i,data_type:"/nameperson/prefix"},{name:/(?:lname|last|sur).*(?:name)?/i,label:/last.*name/i,data_type:"/nameperson/last",negative:/full/i},{name:/(?:fname|first).*(?:name)?/i,label:/first.*name/i,data_type:"/nameperson/first",negative:/full/i},{name:/(?:.*(?:full|invoice|real|bill|(?:ship.*to)).*name)|(?:^name$)/i,negative:/holder|credit/i,data_type:"/nameperson/full"},{label:/(?:middle|middleinitial)/i,data_type:"/nameperson/middle"},{label:/(?:suffix)/i,data_type:"/nameperson/suffix"},{name:/(?:(?:confirm|new|create|re\-enter)[\s]*)?password(?:(?:confirm|new|create|re\-enter)[\s]*)?/i,label:/(?:(?:confirm|new|create|choose|re\-enter)[\s]*)?password/i,negative:/hint|old|current/i,data_type:"/password"},{name:/(?:old|current)[\s]*(?:pass|pwd)/i,label:/[\s]*(?:(?:current|old)[\s]*)password/i,data_type:"/passwordold"},{label:/.*twitter.*/i,data_type:"/contact/im/twitter"},{label:/.*linkedin.*/i,data_type:"/contact/web/linkedin"},{label:/.*blog.*/i,data_type:"/contact/web/blog"},{label:/.*aim/i,data_type:"/contact/IM/aim"},{label:/.*icq.*/i,data_type:"/contact/IM/icq"},{label:/.*msn(?:m)?/i,data_type:"/contact/IM/msn"},{label:/.*jabber/i,data_type:"/contact/IM/jabber"},{label:/.*skypq/i,data_type:"/contact/IM/skype"},{label:/.*(?:yim|yahoo)/i,data_type:"/contact/IM/yahoo"},{name:/(?:home).*phone.*(?:num|number)/i,label:/even.*phone/,negative:/gift|loyalty/i,data_type:"/contact/phone"},{name:/.*(?:cell|mob(?:ile)?).*/i,data_type:"/contact/phone/mobile"},{name:/.*fax.*/i,data_type:"/contact/phone/fax"},{name:/(?:day|daytime|work|business).*phone/i,label:/(?:day|daytime|work|business).*phone/,data_type:"/contact/phone/work"},{name:/(?:night|nighttime|home).*phone/i,label:/(?:night|nighttime|home).*phone/,data_type:"/contact/phone/home"},{name:/area.*code.*/i,data_type:"/contact/phone/areacode",negative:/zip/i},{name:/(?:phone.*(?:area|1).*)/i,data_type:"/contact/phone/areacode",negative:/zip/i},{name:/(?:phone.*(?:exch|prefix|first|2).*)|(?:exchange)/i,data_type:"/contact/phone/exchange"},{name:/phone.*(?:suffix|end|last|3).*/i,data_type:"/contact/phone/local",negative:/zip/i},{name:/phone.*(?:country|countrycode).*/i,label:/\+1/,data_type:"/contact/phone/countrycode"},{name:/home.*(?:exch|prefix).*/i,data_type:"/contact/phone/exchange"},{name:/home.*area.*/i,data_type:"/contact/phone/areacode",negative:/zip/i},{name:/home.*(?:num|suffix|end).*/i,data_type:"/contact/phone/local"},{name:/home.*(?:country|countrycode).*/i,data_type:"/contact/phone/countrycode"},{name:/area.*code/i,data_type:"/contact/phone/areacode",negative:/zip/i},{name:/exchange/i,data_type:"/contact/phone/exchange"},{name:/local/i,data_type:"/contact/phone/local"},{name:/phone.*(?:ext|extension)/i,data_type:"/contact/phone/extension",negative:/text/i},{name:/extension/i,data_type:"/contact/phone/extension"},{name:/phone/i,label:/phone/i,data_type:"/contact/phone"},{name:/(?:bill|b).*(?:zip|postal|post)(?:.*code)?/i,data_type:"/contact/postalcode/billing"},{name:/.*(?:zip|postal|post)(?:.*code)?/i,data_type:"/contact/postalcode"},{name:/bill.*city/i,data_type:"/contact/city/billing"},{name:/business.*city/i,data_type:"/contact/city/business"},{name:/home.*city/i,data_type:"/contact/city/home"},{name:/city/i,data_type:"/contact/city"},{name:/bill.*country/i,data_type:"/contact/country/billing"},{name:/business.*country/i,data_type:"/contact/country/business"},{name:/home.*country/i,data_type:"/contact/country/home"},{name:/country/i,data_type:"/contact/country"},{name:/bill.*state/i,data_type:"/contact/state/billing"},{name:/business.*state/i,data_type:"/contact/state/business"},{name:/home.*state/i,data_type:"/contact/state/home"},{name:/state/i,data_type:"/contact/state"},{name:/bill.*addr.*2/i,data_type:"/contact/postaladdressAdditional/billing"},{name:/home.*addr.*2/i,data_type:"/contact/postaladdressAdditional/home"},{name:/(?:addr.*2)|(?:(?:ad.*)?line.*2)/i,label:/.*address.*(?:line)?.*2.*/,data_type:"/contact/postaladdressAdditional"},{name:/bill.*addr.*3/i,data_type:"/contact/postaladdress3/billing"},{name:/home.*addr.*3/i,data_type:"/contact/postaladdress3/home"},{name:/(?:addr.*3)|(?:(?:ad.*)?line.*3)/i,label:/.*address.*(?:line)?.*3.*/,data_type:"/contact/postaladdress3"},{name:/bill.*addr/i,data_type:"/contact/postaladdress/billing"},{name:/home.*addr/i,data_type:"/contact/postaladdress/home"},{name:/(?:addr.*1?)|(?:(?:ad.*)?line.*1?)/i,label:/.*address.*(?:line1?)?.*/,negative:/type/i,data_type:"/contact/postaladdress"},{name:/.*(?:comment|message).*/i,data_type:"/message"},{name:/.*(?:(?:(?:cc|card)?.*(?:(?:holder|owner).*)))|(?:name.*on.*card)|(?:issued.*to)|(?:(?:card|cc|payment).*name)/i,label:/(?:issued.*to)|(?:name.*on.*card)|(?:card.*name)|(?:card.*holder)/i,negative:/gift|placeholder|account|acct|first|last|num|cvv/i,data_type:"/financial/creditcard/issuedto"},{name:/.*(?:cc|card|credit.*card)?(?:(?:cvv|cvc|ccv|cv|cid|verify|verif.*(?:code|num)|verification|sec.*code|card.*sec.*num)|cvv).*/i,negative:/gift/i,data_type:"/financial/creditcard/verification"},{name:/.*(?:cc|card|credit.*card|payment).*(?:num|number|no)|ccard/i,label:/card.*number/i,negative:/gift|account|reward|acct|issue/i,data_type:"/financial/creditcard/number"},{name:/.*(?:cc|card|credit.*card).*(?:type|issuer)/i,negative:/gift/i,data_type:"/financial/creditcard/type"},{name:/.*(?:(?:(?:cc|card|billing)?.*(?:exp.*))|(?:(?:cc|card).*(?:exp.*)?)).*(?:date.*)?(?:[m]{2}|mo|mon|month|mn)/i,negative:/gift|start|valid|birth/i,data_type:"/financial/creditcard/expirymonth"},{name:/.*(?:(?:(?:cc|card|billing)?.*(?:exp.*))|(?:(?:cc|card).*(?:exp.*)?)).*(?:date.*)?(?:[y]{2,4}|yr|year)/i,negative:/gift|start|valid|birth/i,data_type:"/financial/creditcard/expiryyear"},{name:/.*(?:(?:(?:cc|card|billing)?.*(?:exp.*))|(?:(?:cc|card).*(?:exp.*)?)|expiration)/i,negative:/gift|year|yr|mon|mm|yy|start|valid|birth/i,data_type:"/financial/creditcard/expiry"},{name:/(?:birth.*year)|(?:dob[y]+)|(?:(?:dob|date).*year.*)|(?:year.*(?:born|birth))|(?:birthday[y]+r?)/i,negative:/exp/i,data_type:"/birthdate/birthyear"},{name:/(?:birth.*mon(?:th)?)|(?:dob[m]+)|(?:(?:dob|date).*mon(?:th)?.*)|(?:month.*(?:born|birth))|(?:birthday[m]+)/i,negative:/exp/i,data_type:"/birthdate/birthmonth"},{name:/(?:birth.*day)|(?:dob[d]+)|(?:(?:dob|date).*(?:day|date).*)|(?:day.*(?:born|birth))|(?:birthday[d]+)/i,data_type:"/birthdate/birthday"},{name:/(?:b|birth|dob)(?:day|date)/i,data_type:"/birthdate"},{name:/.*(?:co|comp|company|business)(?:name)/i,label:/(?:company|business|organization)(?:\s+name)?/i,data_type:"/company/name"},{name:/.*(?:customer).*(?:company).*/i,data_type:"/company/name"},{name:/^pin$/i,label:/^pin$/i,data_type:"/pin"}],password:[{name:/.*(?:cc|card|credit.*card)?(?:cvv|cvc|ccv|id|verify|verif.*(?:code|num)|verification|security.*code|card.*sec.*num).*/i,negative:/gift|password|pass/i,data_type:"/financial/creditcard/verification"},{name:/pin/i,label:/pin/i,data_type:"/pin"},{name:/(?:(?:confirm|new|create|re\-enter|verify)[\s]*)?password(?:(?:confirm|new|create|re\-enter)[\s]*)?/i,label:/(?:(?:confirm|new|create|choose|re\-enter)[\s]*)?password/i,negative:/hint|old|current/i,data_type:"/password"},{name:/(?:old|current)[\s]*(?:pass|pwd)/i,label:/[\s]*(?:(?:current|old)[\s]*)password/i,data_type:"/passwordold"}],select:[{name:/(?:title|salutation)/i,data_type:"/nameperson/prefix"},{name:/country/i,data_type:"/contact/country",options:/united states|italy|usa/i,matchByOptions:!0},{name:/state/i,data_type:"/contact/state",options:/AK|AZ/,matchByOptions:!0},{name:/.*(?:cc|card|credit.*card|payment).*(?:type|issuer)/i,negative:/gift/i,data_type:"/financial/creditcard/type",options:/visa|diner|amex|american[^<]*express/i,matchByOptions:!0},{name:/.*(?:(?:(?:cc|card|billing|payment)?.*(?:exp.*))|(?:(?:cc|card).*(?:exp.*)?)|exp.*)(?:date.*)?(?:[m]{2}|mo|mon|month|mn)/i,negative:/gift|start|valid|birth/i,data_type:"/financial/creditcard/expirymonth",options:/12|jan|feb/i,matchByOptions:!0},{name:/.*(?:(?:(?:cc|card|billing|payment)?.*(?:exp.*))|(?:(?:cc|card).*(?:exp.*)?)|exp.*)(?:date.*)?(?:[y]{2,4}|yr|year)/i,negative:/gift|start|valid|birth/i,data_type:"/financial/creditcard/expiryyear",options:/20[0-9]{2}/i,matchByOptions:!0},{name:/(?:birth.*year)|(?:dob[y]+)|(?:(?:dob|date).*year.*)|(?:year.*(?:born|birth))|(?:birthday[y]+r?)/i,negative:/exp/i,data_type:"/birthdate/birthyear"},{name:/(?:birth.*mon(?:th)?)|(?:dob[m]+)|(?:(?:dob|date).*mon(?:th)?.*)|(?:month.*(?:born|birth))|(?:birthday[m]+)/i,negative:/exp/i,data_type:"/birthdate/birthmonth"},{name:/(?:birth.*day)|(?:dob[d]+)|(?:(?:dob|date).*(?:day|date).*)|(?:day.*(?:born|birth))|(?:birthday[d]+)/i,data_type:"/birthdate/birthday"},{name:/(?:b|birth|dob)(?:day|date)/i,data_type:"/birthdate"},{name:/gender|sex/i,data_type:"/person/gender"},{name:/phone.*(?:country|countrycode).*/i,data_type:"/contact/phone/countrycode"},{name:/home.*(?:country|countrycode).*/i,data_type:"/contact/phone/home/countrycode"},{name:/bill.*country/i,data_type:"/contact/country/billing"},{name:/business.*country/i,data_type:"/contact/country/business"},{name:/home.*country/i,data_type:"/contact/country/home"},{name:/country/i,data_type:"/contact/country"},{name:/bill.*state/i,data_type:"/contact/state/billing"},{name:/business.*state/i,data_type:"/contact/state/business"},{name:/home.*state/i,data_type:"/contact/state/home"},{name:/state/i,data_type:"/contact/state"}],checkbox:[{name:/agree|tos|terms|service/i,data_type:"/agreetos"},{name:/(?:accept|agree|terms|(?:read)?rules|conditions|privacypolicy).*/i,data_type:"/agreetos"},{name:/.*(?:remember|persistent).*/i,label:/keepmesignedin/i,data_type:"/rememberme"}],radio:[{name:/gender|sex/i,label:/^(?:male|female)$/i,data_type:"/person/gender"}]},T=function(e){var t=e.match(/^user\[(.*)\]$/);return t?t[1]:e},k={nonAlphanumeric:/[^a-z0-9]+/gim,nonAlpha:/[^a-z]+/gim,spaces:/[\s]+/gim,startsWithDot:/^\./,trimSepartor:/(^\|\|)|(\|\|$)/g,textOrSelect:/text|select/i,email:/^(?:[a-z0-9!#$%&'*+\/=?^_`{|}~\-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~\-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9\-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i};return E}),ABINE_DNTME.define("abine/formObserver",["documentcloud/underscore","jquery","abine/core","abine/contentMessenger","abine/formAnalyzer","abine/timer","abine/assets"],function(e,t,n,i,r,a,o){function s(e){return e in l?l[e]:(e=e.substr(0,e.lastIndexOf("/")),e in l?l[e]:null)}function c(e){var t=e.dataType;return t?t in l?!0:(t=t.substr(0,t.lastIndexOf("/")),t in l):!1}var l={"/contact/email":r.EMAIL_FIELD,"/password":r.PASSWORD_FIELD,"/contact/phone":r.PHONE_FIELD,"/contact/phone/countrycode":r.PHONE_FIELD,"/contact/phone/areacode":r.PHONE_FIELD,"/contact/phone/exchange":r.PHONE_FIELD,"/contact/phone/local":r.PHONE_FIELD,"/contact/phone/number":r.PHONE_FIELD,"/contact/phone/extension":r.PHONE_FIELD,"/nameperson/friendly":r.USERNAME_FIELD,"/financial/creditcard/number":r.PAYMENT_FIELD,"/financial/creditcard/number/part1":r.PAYMENT_FIELD,"/financial/creditcard/number/part2":r.PAYMENT_FIELD,"/financial/creditcard/number/part3":r.PAYMENT_FIELD,"/financial/creditcard/number/part4":r.PAYMENT_FIELD,"/financial/creditcard/type":r.PAYMENT_FIELD,"/financial/creditcard/issuedto":r.PAYMENT_FIELD,"/financial/creditcard/expiry":r.PAYMENT_FIELD,"/financial/creditcard/expiryyear":r.PAYMENT_FIELD,"/financial/creditcard/expirymonth":r.PAYMENT_FIELD,"/financial/creditcard/verification":r.PAYMENT_FIELD,"/contact/postaladdress":r.ADDRESS_FIELD,"/contact/postaladdressAdditional":r.ADDRESS_FIELD,"/contact/state":r.ADDRESS_FIELD,"/contact/city":r.ADDRESS_FIELD,"/contact/country":r.ADDRESS_FIELD,"/contact/postalcode":r.ADDRESS_FIELD},d=["focus.mmfo","click.mmfo","blur.mmfo","change.mmfo"],u=n.BaseClass.extend({initialize:function(t){if(this.id=e.uniqueId(),this.el=t.el,this.mappedFields=t.mappedFields,this.messenger=t.messenger||this,this.contentManager=t.contentManager,this.strategy=t.strategy,!this.el)throw"Error: FormObserver initialized without a form element.";this.triggerFormPresent(),this.bindToFormEvents()},getType:function(){return this.formType?this.formType:(this.formType=r.getFormType(this.el,this.mappedFields),this.formType)},getFields:function(){return this.fields?this.fields:(this.fields=r.getFields(this.el,this.mappedFields),this.fields)},triggerFormPresent:function(){var e=this.getType();e==r.LOGIN_FORM?this.trigger("loginFormPresent",{formObserver:this,fields:this.getFields()}):e==r.REGISTRATION_FORM?this.trigger("registrationFormPresent",{formObserver:this,fields:this.getFields()}):e==r.CHECKOUT_FORM&&this.trigger("checkoutFormPresent",{formObserver:this,fields:this.getFields()})},bindToFormEvents:function(){var n=d.join(" "),i=this.getFields(),r=this.getType();e(i).each(function(i){var l=c(i);if(l){var d=t(i.element);if(ABINE_DNTME.config.fieldIcons&&"select"!=i.fieldType&&d.css("background-image")in{"":1,none:1}&&(d.css({"background-image":"url("+o.assetUrl("/pages/images/dnt-field-icon.png")+")","background-repeat":"no-repeat","background-position":"calc(100% - 2px) center","background-size":"15px 15px"}),d.attr("old-cursor",d.css("cursor")),d.bind("mousemove.mmfoicon",e.bind(function(e){var n="undefined"!=typeof e.offsetX?e.offsetX:e.clientX-t(e.target).offset().left;n>e.target.offsetWidth-18?d.css("cursor","pointer"):d.css("cursor",d.attr("old-cursor"))},this)),d.bind("mousedown.mmfoicon",e.bind(function(n){var r="undefined"!=typeof n.offsetX?n.offsetX:n.clientX-t(n.target).offset().left;if(r>n.target.offsetWidth-18){d.attr("dntmeIconClick","yes");var o=f(s(i.dataType),"iconclick");a.setTimeout(e.bind(function(){this.trigger(o,{formObserver:this,field:i,type:"iconclick",keyCode:0})},this),0)}},this))),this.strategy.fieldTypeDisabled(i.dataType,r))return;d.bind(n,e.bind(function(t){if(!this.contentManager||this.contentManager.userIntent){if("focus"==t.type){if(d.attr("dntmeHasFocus"))return;d.attr("dntmeHasFocus","yes")}else if("blur"==t.type)return d.removeAttr("dntmeIconClick"),d.removeAttr("dntmeHasFocus"),d.removeAttr("dntmeHasFocusRemoved"),void 0;if(!("click"==t.type&&d.attr("dntmeHasFocus")||d.attr("mmautofilling")||d.attr("dntmeIgnoreBlur"))){if("click"==t.type||"focus"==t.type){if(d.attr("dntmeIgnoreClickFocus"))return;d.attr("dntmeIgnoreClickFocus","yes"),a.setTimeout(function(){d.removeAttr("dntmeIgnoreClickFocus"),d.removeAttr("dntmeIconClick")},1e3)}if(!d.attr("dntmeIconClick")){var n=s(i.dataType);if(n){var r=f(n,t.type);r&&a.setTimeout(e.bind(function(){this.trigger(r,{formObserver:this,field:i,type:t.type,keyCode:"keydown"===t.type?t.keyCode:0})},this),0)}}}}},this))}},this)},unbindFormEvents:function(){var n=this.getFields();e(n).each(function(e){t(e.element).unbind(".mmfo"),t(e.element).unbind(".mmfoicon")})}}),f=function(e,t){var n;return e==r.EMAIL_FIELD?n="emailField":e==r.PHONE_FIELD?n="phoneField":e==r.PASSWORD_FIELD?n="passwordField":e==r.USERNAME_FIELD?n="usernameField":e==r.PAYMENT_FIELD?n="paymentField":e==r.ADDRESS_FIELD&&(n="addressField"),"change"==t?n+="Changed":"focus"==t?n+="Focused":"blur"==t?n+="Blurred":"click"==t?n+="Clicked":"iconclick"==t?n+="IconClicked":"keydown"==t&&(n+="Keydown"),n};return{FormObserver:u,LOGIN_FORM:r.LOGIN_FORM,REGISTRATION_FORM:r.REGISTRATION_FORM,CHECKOUT_FORM:r.CHECKOUT_FORM,OTHER_FORM:r.OTHER_FORM}}),ABINE_DNTME.define("abine/formStrategy",["jquery","documentcloud/underscore","abine/core","abine/formObserver","abine/timer","abine/formAnalyzer","abine/views/emailHelperPanel","abine/views/phoneHelperPanel","abine/views/loginHelperPanel","abine/views/paymentHelperPanel","abine/views/passwordHelperPanel","abine/views/addressHelperPanel","models","abine/config","abine/url","abine/responseCodes"],function(e,t,n,i,r,a,o,s,c,l,d,u,f,h,p,m){var g=!1,y={fieldTypeDisabled:function(e,t){return"/contact/email"==e?t!=a.LOGIN_FORM?this.emailDisabledHere():this.loginDisabledHere():"/nameperson/friendly"==e?this.loginDisabledHere():"/contact/phone"==e?this.phoneDisabledHere():"/password"==e?this.passwordDisabledHere():e&&e.match(/address|state|city|postal|country/)?this.addressDisabledHere():e.match(/creditcard/)?this.cardDisabledHere():!1},emailDisabledHere:function(){var e=this.contentManager,t=e.blacklist;return!e.preferences.getPref("suggestProtectedEmail")||t&&t.get("email")},phoneDisabledHere:function(){var e=this.contentManager,t=e.blacklist;
return!e.preferences.getPref("suggestProtectedPhone")||t&&t.get("phone")},cardDisabledHere:function(){var e=this.contentManager,t=e.blacklist;return!e.preferences.getPref("suggestProtectedCard")||t&&t.get("card")&&t.get("real_card")},loginDisabledHere:function(){var e=this.contentManager,t=e.blacklist;return!e.preferences.getPref("entitledToAccounts")||!e.preferences.getPref("rememberAccounts")||t&&t.get("account")},passwordDisabledHere:function(){var e=this.contentManager,t=e.blacklist;return!e.preferences.getPref("entitledToAccounts")||!e.preferences.getPref("suggestStrongPassword")||t&&t.get("password")},addressDisabledHere:function(){var e=this.contentManager,t=e.blacklist;return!e.preferences.getPref("entitledToAccounts")||!e.preferences.getPref("suggestAddresses")||t&&t.get("address")},disableAutoComplete:function(e){e.hasAttribute("autocomplete")&&!e.hasAttribute("oldautocomplete")?e.setAttribute("oldautocomplete",e.getAttribute("autocomplete")):e.hasAttribute("autocomplete")||e.setAttribute("oldautocomplete","remove"),e.setAttribute("autocomplete","off")},enableAutoComplete:function(e){e.hasAttribute("oldautocomplete")&&("remove"==e.getAttribute("oldautocomplete")?e.removeAttribute("autocomplete"):e.setAttribute("autocomplete",e.getAttribute("oldautocomplete")),e.removeAttribute("oldautocomplete"))},cleanupPanel:function(t,n,i){try{t.remove()}catch(r){}e(n).unbind("dntme.closepanel"),this.contentManager.removePanels(t.iframe),i&&this.enableAutoComplete(n),n.hasAttribute("dntmeHasFocusRemoved")?(n.removeAttribute("dntmeHasFocusRemoved"),n.setAttribute("dntmeHasFocus","yes")):n.removeAttribute("dntmeIgnoreBlur")},canShowDNTMeHelper:function(e,t){var n=e.field.element,i=e.type;if("click"==i&&"register"==t&&g){if(n.hasAttribute("dntmeHasFocus"))return this.contentManager.isPanelShown(e.field)?!0:(n.removeAttribute("dntmeHasFocus"),n.setAttribute("dntmeHasFocusRemoved","yes"),this.disableAutoComplete(n),!1);n.removeAttribute("dntmeHasFocusRemoved"),n.setAttribute("dntmeHasFocus","yes")}return!0},bindFieldChangeObserver:function(){this.formObserver=this.formObserver||new i.FormObserver({el:this.formEl,mappedFields:this.mappedFields,contentManager:this.contentManager,strategy:this});var e=t.bind(this.onAccountFieldActivity,this);this.formObserver.on("emailFieldChanged",e),this.formObserver.on("passwordFieldChanged",e),this.formObserver.on("usernameFieldChanged",e)},onAccountFieldActivity:function(e){var t=e.field;t.origin="change";var n={name:t.name,origin:t.origin,dataType:t.dataType,value:t.value};this.contentManager.messenger.send("contentManager:formFieldChanged",{fieldData:n,formData:a.getFormData(this.formEl,this.contentManager.href)})}},b={bindFormObserver:function(){this.formObserver=this.formObserver||new i.FormObserver({el:this.formEl,mappedFields:this.mappedFields,contentManager:this.contentManager,strategy:this});var e=t.bind(this.onEmailFieldActivity,this);this.formObserver.on("emailFieldFocused",e),this.formObserver.on("emailFieldClicked",e),this.formObserver.on("emailFieldIconClicked",e);var n=t.bind(this.onPhoneFieldActivity,this);this.formObserver.on("phoneFieldFocused",n),this.formObserver.on("phoneFieldClicked",n),this.formObserver.on("phoneFieldIconClicked",n);var r=t.bind(this.onPaymentFieldActivity,this);this.formObserver.on("paymentFieldFocused",r),this.formObserver.on("paymentFieldClicked",r),this.formObserver.on("paymentFieldIconClicked",r);var a=t.bind(this.onPasswordFieldActivity,this);this.formObserver.on("passwordFieldFocused",a),this.formObserver.on("passwordFieldClicked",a);var o=t.bind(this.onAddressFieldActivity,this);this.formObserver.on("addressFieldFocused",o),this.formObserver.on("addressFieldClicked",o);var s=t.bind(this.onAccountFieldActivity,this);this.formObserver.on("emailFieldChanged",s),this.formObserver.on("passwordFieldChanged",s),this.formObserver.on("usernameFieldChanged",s)},cleanup:function(){this.formObserver&&(this.formObserver.unbindFormEvents(),this.formObserver.off())},onEmailFieldActivity:function(n){if(this.canShowDNTMeHelper(n,"register")&&!this.emailDisabledHere()||"iconclick"==n.type){if(this.contentManager.isPanelShown(n.field))return this.contentManager.closeCurrentPanel(),void 0;if(!this.contentManager.preferences.getPref("hasRegistered")||this.contentManager.preferences.getPref("authToken")){var i=this.formObserver,r=n.field.element;if(this.disableAutoComplete(r),!(r.hasAttribute("mmautofilling")||r.hasAttribute("mmclosedfield")&&"iconclick"!=n.type)){var a=this.contentManager.processDynamicPanelForField("/contact/email");if(a.dynamicPanel&&a.dynamicPanel.dontShow&&!this.contentManager.preferences.isPrefTrue("hasRegistered"))return!1;this.contentManager.createPanel({secured:"hadEmail",style:{},field:n.field,ready:t.bind(function(s,c){var l=new o({field:n.field,formEl:this.formEl,contentManager:this.contentManager,fields:i.getFields(),dynamicPanel:a.dynamicPanel,hasRegistered:this.contentManager.preferences.isPrefTrue("hasRegistered"),iconClick:"iconclick"==n.type,domain:this.contentManager.domain,el:e("<div></div>",s).get(0)});l.iframe=c,e(r).one("dntme.closepanel",t.bind(l.closePanel,l)),l.bind("remove",function(){this.cleanupPanel(l,r,g)},this),l.bind("render resize",function(){this.contentManager.autoResizePanels()},this),e("body",s).append(l.el)},this)})}}}},onPasswordFieldActivity:function(n){if(!this.passwordDisabledHere()&&this.canShowDNTMeHelper(n,"register")){if(this.contentManager.isPanelShown(n.field))return this.contentManager.closeCurrentPanel(),void 0;if(!this.contentManager.preferences.getPref("hasRegistered")||this.contentManager.preferences.getPref("authToken")){var i=n.field.element;if("text"!=i.getAttribute("type")){var r=this.formObserver;if(this.disableAutoComplete(i),!i.hasAttribute("mmautofilling")&&!i.hasAttribute("mmclosedfield")){var a=this.contentManager.processDynamicPanelForField("/contact/email");if(a.dynamicPanel&&a.dynamicPanel.dontShow&&!this.contentManager.preferences.isPrefTrue("hasRegistered"))return!1;this.contentManager.createPanel({style:{},secured:"hadEmail",field:n.field,ready:t.bind(function(o,s){var c=new d({field:n.field,formEl:this.formEl,contentManager:this.contentManager,fields:r.getFields(),dynamicPanel:a.dynamicPanel,dynamicPanelsJSON:a.json,hasRegistered:this.contentManager.preferences.isPrefTrue("hasRegistered"),domain:this.contentManager.domain,el:e("<div></div>",o).get(0)});c.iframe=s,e(i).one("mm.closepanel",t.bind(c.closePanel,c)),c.bind("remove",function(){this.cleanupPanel(c,i,g)},this),c.bind("render resize",function(){this.contentManager.autoResizePanels()},this),e("body",o).append(c.el)},this)})}}}}},onAddressFieldActivity:function(n){if(!this.addressDisabledHere()&&this.canShowDNTMeHelper(n,"register")){if(this.contentManager.isPanelShown(n.field))return this.contentManager.closeCurrentPanel(),void 0;if((!this.contentManager.preferences.getPref("hasRegistered")||this.contentManager.preferences.getPref("authToken"))&&this.contentManager.preferences.getSplitTest("wallet01")!=m.SPLIT_WALLET_OFF){var i=n.field.element,r=this.formObserver;if(this.disableAutoComplete(i),!i.hasAttribute("mmautofilling")&&!i.hasAttribute("mmclosedfield")){var a=this.contentManager.processDynamicPanelForField("/contact/email");if(a.dynamicPanel&&a.dynamicPanel.dontShow&&!this.contentManager.preferences.isPrefTrue("hasRegistered"))return!1;this.contentManager.createPanel({style:{},secured:!0,field:n.field,ready:t.bind(function(o,s){var c=new u({field:n.field,formEl:this.formEl,contentManager:this.contentManager,fields:r.getFields(),dynamicPanel:a.dynamicPanel,dynamicPanelsJSON:a.json,hasRegistered:this.contentManager.preferences.isPrefTrue("hasRegistered"),domain:this.contentManager.domain,el:e("<div></div>",o).get(0)});c.iframe=s,e(i).one("mm.closepanel",t.bind(c.closePanel,c)),c.bind("remove",function(){this.cleanupPanel(c,i,g)},this),c.bind("render resize",function(){this.contentManager.autoResizePanels()},this),e("body",o).append(c.el)},this)})}}}},onPhoneFieldActivity:function(n){function i(){this.disableAutoComplete(a),this.contentManager.createPanel({secured:"hadPhone",style:{},hasDynamicPanel:!!l.dynamicPanel,panelWidth:450,field:n.field,ready:t.bind(function(i,o){var c=new s({field:n.field,formEl:this.formEl,contentManager:this.contentManager,dynamicPanel:l.dynamicPanel,entitledToPhone:this.contentManager.preferences.isPrefTrue("entitledToPhone"),hasRegistered:this.contentManager.preferences.isPrefTrue("hasRegistered"),fields:r.getFields(),iconClick:"iconclick"==n.type,domain:this.contentManager.domain,el:e("<div></div>",i).get(0)});c.iframe=o,e(a).one("dntme.closepanel",t.bind(c.closePanel,c)),c.bind("remove",function(){this.cleanupPanel(c,a,g)},this),c.bind("render resize",function(){this.contentManager.autoResizePanels()},this),e("body",i).append(c.el)},this)})}if(this.canShowDNTMeHelper(n,"register")&&!this.phoneDisabledHere()||"iconclick"==n.type){if(this.contentManager.isPanelShown(n.field))return this.contentManager.closeCurrentPanel(),void 0;if(!this.contentManager.preferences.getPref("hasRegistered")||this.contentManager.preferences.getPref("authToken")){var r=this.formObserver,a=n.field.element,o=this.contentManager.preferences.isPrefTrue("entitledToPhone"),c=this.contentManager.preferences.isPrefTrue("hadPhone");if(!(a.hasAttribute("mmautofilling")||a.hasAttribute("mmclosedfield")&&"iconclick"!=n.type)){var l=this.contentManager.processDynamicPanelForField("/contact/phone");if(l.dynamicPanel&&l.dynamicPanel.dontShow&&!o&&!c)return!1;if(!l.dynamicPanel&&"iconclick"!=n.type&&!o&&!c)return;i.call(this)}}}},onPaymentFieldActivity:function(n){function i(){this.disableAutoComplete(a),this.contentManager.createPanel({secured:"hadCard",style:{},panelWidth:"IE"==ABINE_DNTME.config.browser?430:400,hasDynamicPanel:!!o.dynamicPanel,field:n.field,ready:t.bind(function(i,s){var c=new l({field:n.field,formEl:this.formEl,contentManager:this.contentManager,authToken:this.contentManager.preferences.getPref("authToken"),beginnerMode:this.contentManager.preferences.getPref("beginnerMode"),hasRegistered:this.contentManager.preferences.isPrefTrue("hasRegistered"),entitledToPayments:this.contentManager.preferences.isPrefTrue("entitledToPayments"),hasEnabledPayments:this.contentManager.preferences.isPrefTrue("hasEnabledPayments"),entitledToPhone:this.contentManager.preferences.isPrefTrue("entitledToPhone"),cardDisabled:this.contentManager.blacklist&&!!this.contentManager.blacklist.get("card"),realCardDisabled:this.contentManager.blacklist&&!!this.contentManager.blacklist.get("real_card"),dynamicPanel:o.dynamicPanel,fields:r.getFields(),domain:this.contentManager.domain,el:e("<div></div>",i).get(0),paymentsr2:this.contentManager.shouldShowCardAlertPanel(!0),iconClick:"iconclick"==n.type});c.iframe=s,e(a).one("dntme.closepanel",t.bind(c.closePanel,c)),c.bind("remove",function(){this.cleanupPanel(c,a,g)},this),c.bind("render resize",function(e){e=e||{className:null,extraWidth:null,extraHeight:null},this.contentManager.autoResizePanels(e.className,e.extraWidth,e.extraHeight)},this),this.contentManager.notificationViews&&t.each(this.contentManager.notificationViews,function(e){e&&e.style&&(e.style.display="block")}),e("body",i).append(c.el)},this)})}if(this.canShowDNTMeHelper(n,"register")&&!this.cardDisabledHere()&&"select"!=n.field.fieldType||"iconclick"==n.type){if(this.contentManager.isPanelShown(n.field))return this.contentManager.closeCurrentPanel(),void 0;if(!this.contentManager.preferences.getPref("hasRegistered")||this.contentManager.preferences.getPref("authToken")){var r=this.formObserver,a=n.field.element;if(!(a.hasAttribute("mmautofilling")||a.hasAttribute("mmclosedfield")&&"iconclick"!=n.type)){var o=this.contentManager.processDynamicPanelForField("/creditcard");if(o.dynamicPanel&&o.dynamicPanel.dontShow)return;i.call(this)}}}}},v=n.BaseClass.extend({initialize:function(e){if(!e.el)throw"RegistrationFormHelper expects a form element";this.formEl=e.el,this.contentManager=e.contentManager,this.preferences=e.preferences,this.mappedFields=e.mappedFields,this.bindFormObserver(),this.bindFieldChangeObserver()},bindFieldChangeObserver:function(){},bindFormObserver:function(){}});t.extend(v.prototype,b,y);var E=n.BaseClass.extend({initialize:function(e){if(!e.el)throw"LoginHelper expects a form element";this.formEl=e.el,this.contentManager=e.contentManager,this.preferences=e.preferences,this.mappedFields=e.mappedFields,this.accounts=e.accounts,this.bindFieldChangeObserver();var t=this.contentManager.preferences;t.getPref("helpMeLogin")&&!this.loginDisabledHere()&&this.tryToAutoFillLogins()},cleanup:function(){this.formObserver&&(this.formObserver.unbindFormEvents(),this.formObserver.off())},onEmailFieldActivity:function(n){if(this.canShowDNTMeHelper(n,"login")&&!this.emailDisabledHere()||"iconclick"==n.type){if(this.contentManager.isPanelShown(n.field))return this.contentManager.closeCurrentPanel(),void 0;var i=this.formObserver,r=n.field.element;if(this.disableAutoComplete(r),!(r.hasAttribute("mmautofilling")||r.hasAttribute("mmclosedfield")&&"iconclick"!=n.type)){var a=this.contentManager.processDynamicPanelForField("/contact/email");this.contentManager.createPanel({style:{},field:n.field,ready:t.bind(function(o,s){var l=new c({field:n.field,formEl:this.formEl,fields:i.getFields(),contentManager:this.contentManager,domain:this.contentManager.domain,iconClick:"iconclick"==n.type,dynamicPanel:a.dynamicPanel,el:e("<div></div>",o).get(0)});l.iframe=s,e(r).one("dntme.closepanel",t.bind(l.closePanel,l)),l.bind("remove",function(){this.cleanupPanel(l,r,!0)},this),l.bind("render resize",function(){this.contentManager.autoResizePanels()},this),e("body",o).append(l.el)},this)})}}},tryToAutoFillLogins:function(){var n=this.formObserver.getFields(),i=this.accounts;if(this.contentManager.domain&&!this.contentManager.isLocked()&&i&&0!=i.length){var o=t.bind(this.onEmailFieldActivity,this);this.formObserver.on("emailFieldFocused",o),this.formObserver.on("emailFieldClicked",o),this.formObserver.on("emailFieldIconClicked",o),this.formObserver.on("usernameFieldClicked",o),this.formObserver.on("usernameFieldFocused",o),this.formObserver.on("usernameFieldIconFocused",o);var s={};if(t.each(n,t.bind(function(t){t.dataType&&e(t.element).is(":visible")&&(s[t.dataType]=t)},this)),"/contact/email"in s||"/nameperson/friendly"in s){var c=(s["/contact/email"]||s["/nameperson/friendly"]).element.value;if(""!=c){var l=!1;if(t.each(i,function(e){e.getAddress()==c&&(l=!0)}),!l&&"/password"in s&&""!=s["/password"].element.value)return}}var d=null,u=a.getProtocol(this.formEl,this.contentManager.href),f=a.getFormDomain(this.formEl,this.contentManager.href),h=a.getPageDomain(this.contentManager.href),m=p.getTLD(h),g=f==h||p.getTLD(f)==m||""==f,y=!1,b=null;if(this.contentManager.preferences.getPref("autoLoginHost")==m){y=!0;var v=this.contentManager.preferences.getPref("autoLoginAccount");b=this.contentManager.preferences.getPref("autoLoginSubmitBtn"),this.contentManager.preferences.removePref("autoLoginHost"),this.contentManager.preferences.removePref("autoLoginEvents"),this.contentManager.preferences.removePref("autoLoginAccount"),d=i.find(function(e){return e.get("id")==v})}else{var E=-1==this.contentManager.document.location.protocol.indexOf("https");d=i.find(t.bind(function(e){if(e.get("protocol")&&""!=e.get("protocol")){if("https"==e.get("protocol")&&"https"!=u||f&&e.get("form_host")!=f||p.getTLD(e.get("page_host"))!=p.getTLD(h))return!1}else if(!g||E||"https"!=u)return!1;return!0},this))}if(d){var _={};_["/contact/email"]=d.get("email"),_["/nameperson/friendly"]=d.get("username"),_["/password"]=d.get("password");var T=0;if(t.each(t.keys(s),t.bind(function(n){var i=s[n].element;n in _&&_[n].length>0?"/password"===n&&"text"===i.type&&(e(i).focus(),r.setTimeout(t.bind(function(){e("[type='password']",this.formEl).val(_[n]).blur()},this),100),n=null):"/nameperson/friendly"==n&&"/contact/email"in _?n="/contact/email":"/contact/email"==n&&"/nameperson/friendly"in _&&(n="/nameperson/friendly"),n&&n in _&&(i.setAttribute("mmautofilling","now"),e(i).val(_[n]),this.contentManager.triggerKeyboardEvent("keydown",i),this.contentManager.triggerKeyboardEvent("keyup",i),this.contentManager.triggerKeyboardEvent("keypress",i),i.removeAttribute("mmautofilling","now"),T++)},this)),T>=2){var k=d.get("login_url");k&&0!=k.length||d.set("login_url",this.contentManager.href);var w=d.get("times_used")||0;d.set("times_used",w+1),d.set("pushed",0),d.save(),this.contentManager.messenger.send("update:panelActivity:impression",{panelId:7000004})}y&&r.setTimeout(t.bind(function(){var t=this.formEl,n=!1;if(b&&b.length>0){var i=e(b,t.ownerDocument).first();i.length>0&&(i.click(),n=!0)}if(!n){var i=e(":submit",t).first();i.length>0?i.click():e(t).submit()}},this))}}}});t.extend(E.prototype,y);var _=n.BaseClass.extend({initialize:function(e){if(!e.el)throw"OtherHelper expects a form element";this.formEl=e.el,this.contentManager=e.contentManager,this.preferences=e.preferences,this.mappedFields=e.mappedFields,this.bindFieldChangeObserver(),this.bindFormObserver()},bindFormObserver:function(){},bindFieldChangeObserver:function(){}});t.extend(_.prototype,b,y);var T=n.BaseClass.extend({initialize:function(e){if(!e.el)throw"CheckoutHelper expects a form element";this.formEl=e.el,this.contentManager=e.contentManager,this.preferences=e.preferences,this.mappedFields=e.mappedFields,this.bindFieldChangeObserver(),this.bindFormObserver()},bindFormObserver:function(){},bindFieldChangeObserver:function(){}});return t.extend(T.prototype,b,y),{RegistrationHelper:v,LoginHelper:E,OtherHelper:_,CheckoutHelper:T}}),ABINE_DNTME.define("abine/views/panelBase",["documentcloud/underscore","jquery","duckbone/core","abine/timer","models","abine/window","abine/contentMessenger","abine/formAnalyzer","abine/timer","abine/config","abine/proxies"],function(e,t,n,i,r,a,o,s,c,l,d){var u=300,f=13,h=38,p=40,m=8,g=46,y={"short":"jan,feb,mar,apr,may,jun,jul,aug,sep,oct,nov,dec".split(","),"long":"january,february,march,april,may,june,july,august,september,october,november,december".split(",")},b=n.View.extend({opacity:"1.0",render:function(){return this.model?(this.renderTemplate(),c.setTimeout(e.bind(function(){this.trigger("render")},this),50),this):this},autoResize:function(t){c.setTimeout(e.bind(function(){this.trigger("resize",t)},this),50)},triggerRender:function(){c.setTimeout(e.bind(function(){this.trigger("render")},this),50)},ignoreBlur:function(e){return"undefined"==typeof e?this.field.element.getAttribute("dntmeIgnoreBlur"):(e===!1?this.field.element.removeAttribute("dntmeIgnoreBlur"):this.field.element.setAttribute("dntmeIgnoreBlur","true"),void 0)},bindHeaderClose:function(){t(this.el).bind("mousedown",e.bind(function(e){this.ignoreBlur(!0);var n=t(e.target),i=n.data("highlight")||n.parent().data("highlight"),r="settings";i&&(["email","phone","card"].indexOf(i)>-1&&(r="masking"),["account","password"].indexOf(i)>-1&&(r="accounts"),["address","real_card"].indexOf(i)>-1&&(r="wallet")),n.hasClass("close-link")||n.parent().hasClass("close-link")?this.closeHeader():n.hasClass("logo-link")||n.parent().hasClass("logo-link")?(d.webapp.openDashboard(),this.closePanel()):n.hasClass("close-icon")||n.hasClass("close-dd")?this.closePanel():(n.hasClass("settings-link")||n.parent().hasClass("settings-link"))&&(this.options.contentManager.showDNTMe({page:r,highlight:i}),this.closePanel())},this))},bindFieldBlur:function(){t(this.field.element).unbind("blur.dntme").bind("blur.dntme",e.bind(function(){this.ignoreBlur()?i.setTimeout(e.bind(function(){t(this.field.element).focus(),this.ignoreBlur(!1)},this),0):this.closePanel()},this))},bindKeyDown:function(){t(this.field.element).unbind("keydown.dntme").bind("keydown.dntme",e.bind(function(e){return e.keyCode===f?(e.preventDefault(),e.stopPropagation(),!1):void 0}))},bindKeyUp:function(){t(this.field.element).unbind("keyup.dntme").bind("keyup.dntme",e.bind(function(e){if(e.keyCode===h)this.highlightOption(this.selectedField||0===this.selectedField?this.selectedField-1:-1);else if(e.keyCode===p)this.highlightOption(this.selectedField||0===this.selectedField?this.selectedField+1:0);else{if(e.keyCode===f&&(this.selectedField||0===this.selectedField))return e.selectedField=this.selectedField,this.trigger("enter"+this.selectedField,e,this.selectedField),!1;String.fromCharCode(e.keyCode).match(/\w/)&&e.currentTarget.value.length>=5&&!this.doNotCloseOnTyping&&(this.closePanel(),this.field.dataType&&this.field.dataType.match(/creditcard|postal|country|state|city|zip/i)&&this.groupClose(this.field.dataType),delete this.selectedField)}},this))},bindPanelTextInput:function(n){t(this.field.element).add(n).unbind("blur.dntme").bind("blur.dntme",e.bind(function(i){this.ignoreBlur()?(this.ignoreBlur(!1),i.target.element!==this.field.element&&c.setTimeout(e.bind(function(){t(n).focus()},this),1)):(this.cleanupPanel(),this.closingOnBlur(),this.closePanel())},this))},bindBaseEvents:function(){this.bindHeaderClose(),this.bindFieldBlur(),this.bindKeyDown(),this.bindKeyUp()},cleanupPanel:function(){},closingOnBlur:function(){},highlightOption:function(n){var i=e(t(this.el).find(".mmKeyOption")).filter(function(e){return t(e).hasClass("mmKeyOption")&&"none"!==t(e).css("display")&&t(e).is("a")&&!t(e).hasClass("disabled")});n=(n+i.length)%i.length,(this.selectedField||0===this.selectedField)&&t(i[this.selectedField].children[0]).removeClass("hover"),t(i[n].children[0]).addClass("hover"),this.selectedField=n},applyFadingStyle:function(){var e=u/1e3+"s",t="opacity ease "+e+", margin-top ease "+e;this.el.style.transition=this.el.style.WebkitTransition=this.el.style.MozTransition=this.el.style.OTransition=this.el.style.MsTransition=t},fadeIn:function(){this.el.style.opacity="0.0",this.el.style.marginTop="50px",i.setTimeout(e.bind(function(){this.el.style.opacity=this.opacity,this.el.style.marginTop="0px"},this),100)},fadeOut:function(){try{this.el.style.opacity="1.0",this.el.style.marginTop="0px"}catch(t){}i.setTimeout(e.bind(function(){try{this.el.style.opacity="0.0",this.el.style.marginTop="50px"}catch(e){}},this),100);try{delete this.contentManager._currentPanelField}catch(t){}i.setTimeout(e.bind(function(){this.trigger("remove")},this),100+u)},triggerPanelFillEvent:function(e){this.messenger=this.messenger||new o.ContentMessenger,e.field.origin=e.origin;var n={disposableGUID:e.field.disposableGUID,name:e.field.name,origin:e.field.origin,dataType:e.field.dataType,value:e.field.value};e.field.element.setAttribute("abineOrigin",e.field.origin),t(this.options.formEl).attr("maskMeFilled","yes"),this.options.contentManager.triggerPanelFillEvent(this.options.formEl,n)},fillPhoneFieldsWith:function(e,t,n){var i,r,a,o,s;return 1===parseInt(t)?(r=n.substr(0,3),o=n.substr(3,3),s=n.substr(6,4),i="("+r+") "+o+"-"+s,a=o+"-"+s):(i="+"+t+n,a="+"+t+n),this.fillFieldsByType(e,"/contact/phone",i),this.fillFieldsByType(e,"/contact/phone/number",a),this.fillFieldsByType(e,"/contact/phone/countrycode",t),this.fillFieldsByType(e,"/contact/phone/areacode",r),this.fillFieldsByType(e,"/contact/phone/exchange",o),this.fillFieldsByType(e,"/contact/phone/local",s),i},isVisible:function(e){return t(e).is(":visible")&&"hidden"!=t(e).css("visibility")},fillPaymentFieldsWith:function(t,n,r,a,o,s,c){function l(e,n){for(var i=0;i<n.length&&!d.fillFieldsByType(t,e,n[i]);i++);}var d=this,u=[r];return-1!=r.toLowerCase().indexOf("master")&&(u=["master","master card","mastercard"]),l("/financial/creditcard/type",u),this.fillFieldsByType(t,"/financial/creditcard/number",n),this.fillFieldsByType(t,"/financial/creditcard/number/part1",n.substr(0,4)),this.fillFieldsByType(t,"/financial/creditcard/number/part2",n.substr(4,4)),this.fillFieldsByType(t,"/financial/creditcard/number/part3",n.substr(8,4)),this.fillFieldsByType(t,"/financial/creditcard/number/part4",n.substr(12,4)),i.setTimeout(e.bind(function(){var e=[o];e.push(parseInt(o)),e.push(y.short[parseInt(o)-1]),e.push(y.long[parseInt(o)-1]),l("/financial/creditcard/expirymonth",e),l("/financial/creditcard/expiryyear",[s,parseInt(s)%100]),this.fillFieldsByType(t,"/financial/creditcard/issuedto",a),this.fillFieldsByType(t,"/financial/creditcard/expiry",o+"/"+s,null,!0),this.fillFieldsByType(t,"/financial/creditcard/verification",c)},this),500),n},fillAddressFieldsWith:function(t,n,r,a){this.fillFieldsByType(t,"/contact/postaladdress",n.get("address1"),{domain:r,origin:a}),this.fillFieldsByType(t,"/contact/postaladdressAdditional",n.get("address2"),{domain:r,origin:a}),this.fillFieldsByType(t,"/contact/city",n.get("city"),{domain:r,origin:a}),this.fillFieldsByType(t,"/contact/country",n.get("country"),{domain:r,origin:a}),this.fillFieldsByType(t,"/contact/postalcode",n.get("zip"),{domain:r,origin:a}),i.setTimeout(e.bind(function(){this.fillFieldsByType(t,"/contact/state",n.get("state"),{domain:r,origin:a})},this),500)},fillFieldsByType:function(n,r,a,o,s){var c=!1,l=!1,d=this,u=e(n).filter(function(e){return e.dataType&&(!s&&-1!=e.dataType.indexOf(r)||s&&e.dataType==r)&&d.isVisible(e.element)});e(u).each(e.bind(function(e){t(e.element).val(""),e.element.setAttribute("mmautofilling","now")},this));var d=this;return e(u).each(e.bind(function(s){function u(e){if(d.options.contentManager&&d.options.contentManager.triggerKeyboardEvent&&(d.options.contentManager.triggerKeyboardEvent("keydown",t(e.element)[0]),d.options.contentManager.triggerKeyboardEvent("keyup",t(e.element)[0]),d.options.contentManager.triggerKeyboardEvent("keypress",t(e.element)[0]),d.options.contentManager.triggerKeyboardEvent("change",t(e.element)[0])),l)try{t(e.element).change()}catch(n){}o&&(e.disposableGUID=o.disposableGUID,d.triggerPanelFillEvent({domain:o.domain,origin:o.origin,field:e}))}if("/password"==r&&"text"==s.element.type){try{t(s.element).focus()}catch(f){}var h=s.element.form;i.setTimeout(e.bind(function(){var i=t("[type='password']",h);if(i.length>0){var r=e(n).find(function(e){return e.element==i[0]});i.focus().val(a).css({color:"#0000aa","background-color":"#ffffee"}),u(r)}},this),100)}else{a+="";try{t(s.element).focus().val(a)}catch(f){t(s.element).val(a)}if(t(s.element).val()==a){if(c=!0,l="select"==s.fieldType,"select"==s.fieldType&&r.match(/month/i)){var p=s.element.selectedIndex,m=s.element.options[s.element.options.length-1].value;11==parseInt(m)&&(s.element.selectedIndex=p-1)}}else if(s.element.options){a=a.toLowerCase();for(var g=s.element.options,y=0;y<g.length;y++){var b=g[y].text.toLowerCase(),v=g[y].value;if(v&&v.toLowerCase()==a||b==a||-1!=b.indexOf(a)){g[y].selected=!0,l="select"==s.fieldType,c=!0;break}}}this.markFieldFilled(s),u(s)}},this)),e(u).each(e.bind(function(e){e.element.removeAttribute("mmautofilling")},this)),c},markFieldFilled:function(e){t(e.element).css({color:"#0000aa","background-color":"#ffffee"})},hidePanel:function(){this.trigger("hide")},removePanel:function(){this.trigger("remove")},closePanel:function(e){e&&e.preventDefault(),this.field&&(t(this.field.element).unbind("blur.dntme"),this.ignoreBlur(!1),t(this.field.element).unbind("keydown.dntme"),t(this.field.element).unbind("keyup.dntme"),t(this.field.element).bind("keyup.dntme",function(e){e.keyCode!==m&&e.keyCode!==g||0!==e.currentTarget.value.length||e.target.click()})),this.fadeOut()},clickedInsideOfTarget:function(e,t){for(;t.parentNode&&t.id!=e;)t=t.parentNode;return t.id==e?!0:!1},performActions:function(t){this.messenger=this.messenger||new o.ContentMessenger,e.each(this.panelSectionActionMap[t.currentTarget.id],e.bind(function(e){if(e.target_id&&""!=e.target_id&&this.clickedInsideOfTarget(e.target_id,t.target)||e.target_id&&""==e.target_id||!e.target_id)if("open_registration_page"==e.name)this.getStarted(t,{id:this.options.dynamicPanel.id,action:e.name});else if("open_page"==e.name)d.securityManager.openPage(e.extra);else if("trigger_click"==e.name)this.messenger.send("update:panelActivity:click",{panelId:this.options.dynamicPanel.id});else if("trigger_conversion"==e.name)this.messenger.send("update:panelActivity:conversion",{panelId:this.options.dynamicPanel.id});else if("dismiss_panel"==e.name)-1!=this.options.dynamicPanel.field_type.indexOf("new-feature-added")||this.closePanel();else if("change_show_rate"==e.name)d.panelsModule.changePanelShowRate({panelId:this.options.dynamicPanel.id,extra:e.extra});else if("change_preference"==e.name){var n=new r.Preference;n.save(JSON.parse(e.extra))}else"no_action"==e.name||("open_plans_page"==e.name?this.openPlansPage("panelID"+this.options.dynamicPanel.id,null,{id:this.options.dynamicPanel.id,action:e.name}):"open_activate_cards_page"==e.name?this.openActivateCardsPage(null,{id:this.options.dynamicPanel.id,action:e.name}):"open_snowman_page"==e.name?this.openSnowmanPage(null,{id:this.options.dynamicPanel.id,action:e.name}):"open_new_premium_feature_added_page"==e.name&&this.openNewFeatureAdded(null,{id:this.options.dynamicPanel.id,action:e.name}))},this))},setupDynamicPanel:function(){this.panelPositions=this.options.dynamicPanel.panel_positions,this.panelSections=[],this.panelSectionActionMap={},e.each(this.panelPositions,e.bind(function(t){var n=t.panel_section;n.has_action=t.panel_actions.length>0,this.panelSectionActionMap[n.id]=[],e.each(t.panel_actions,e.bind(function(e){this.panelSectionActionMap[n.id].push(e)},this)),this.panelSections.push(n)},this))},closeHeader:function(e){e&&e.preventDefault(),this.ignoreExplicitClose||(t(this.field.element).attr("mmclosedfield",!0),this.groupClose(this.field.dataType)),this.closePanel(e)},groupClose:function(n){n&&-1!=n.indexOf("/financial/creditcard")&&e.each(this.fields,function(e){e.dataType&&-1!=e.dataType.indexOf("/financial/creditcard")&&t(e.element).attr("mmclosedfield",!0)}),n&&n.match(/contact\/(postal|country|state|city|zip)/i)&&e.each(this.fields,function(e){e.dataType&&e.dataType.match(/contact\/(postal|country|state|city|zip)/i)&&t(e.element).attr("mmclosedfield",!0)})},getStarted:function(e,t){d.webapp.openHome(t),this.closePanel()},openTour:function(){d.webapp.openTour(),this.closePanel()},openSetupEmailPage:function(){d.webapp.openEmails(),this.closePanel()},openSettings:function(e){return e&&e.preventDefault(),d.webapp.openSettings(),this.closePanel(),!1},openLoginPage:function(e){e&&"string"!=typeof e&&(e.preventDefault&&e.preventDefault(),e=null),d.webapp.openLogin(e),this.closePanel()},openDnt2UpgradePage:function(){d.webapp.openDnt2UpgradePage(),this.closePanel()},openPasswordSetupPage:function(e){d.webapp.openPasswordSetup(e),this.closePanel()},openActivateCardsPage:function(e,t){d.webapp.openCards(t),this.closePanel()},openPlansPage:function(e,t,n){d.webapp.openPremium(e,null,n)},openSnowmanPage:function(e,t){d.webapp.openSnowman(null,t)},openNewFeatureAdded:function(e,t){d.webapp.openNewFeatureAdded(null,t)}});return b}),ABINE_DNTME.define("abine/password",[],function(){var e="ABCDEFGHJKLMNOPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",t=10,n=1,i=2,r=4,a=8,o={generateRandomPassword:function(o,s,c){o=o||e,(!s||1>s)&&(s=t);var l="",d=o.length;c=c||n|i|a;var u="ABCDEFGHJKLMNOPQRSTUVWXYZ".charAt(Math.floor(26*Math.random()))+"ABCDEFGHJKLMNOPQRSTUVWXYZ".charAt(Math.floor(26*Math.random())),f="0123456789".charAt(Math.floor(10*Math.random()))+"0123456789".charAt(Math.floor(10*Math.random())),h="`~!@#$%^&*()_-+={}|[]\\:\";'<>?,/".charAt(Math.floor(32*Math.random()));c&n||(u=""),c&i||(f=""),c&r||(h=""),c&a&&(h=".");for(var p=Math.floor(Math.random()*(s-(u.length+h.length+f.length))),m=p+u.length+h.length+f.length-1,g=0;s>g;g++)if(p>g||g>m)l+=o.charAt(Math.floor(Math.random()*d));else{if(g!=p)continue;l+=u+h+f}return l},generateSpecialCharsPassword:function(){return this.generateRandomPassword(null,null,n|i|r)},generateNoSpecialCharsPassword:function(){return this.generateRandomPassword(null,null,n|i)},generateNoDigitsPassword:function(){return this.generateRandomPassword(null,null,n)}};return o}),ABINE_DNTME.define("abine/paymentHeuristics",["documentcloud/underscore","jquery"],function(e,t){function n(e,t,n,i){i=i||0,len=e.length;for(var r=i;len>r;r++)if(obj=e[r],obj&&obj[t]===n)return r;return null}var i={apply:function(e,t){var n=!1;for(var i in e)if(e[i].dataType&&0==e[i].dataType.indexOf("/financial")){n=!0;break}n&&(this.fixMissingPaymentFields(e,t),this.fixOrphanedPaymentFields(e,t),this.fixDuplicatePaymentFields(e,t))},fixMissingPaymentFields:function(t,i){var r="/financial/creditcard/number",a=e(t).filter(function(e){return e.dataType&&e.dataType===r});if(0==a.length)for(var o=n(i,"dataType","/financial/creditcard/expirymonth",0),s=o-1;s>=0;s--)if("undefined"!=typeof i[s]&&!i[s].dataType){var c=i[s].name+":"+i[s].id;if(i[s].element.getAttribute("maxlength")>=16||c&&c.match(/num|card/i)&&!c.match(/cvs|cv|code|sec/i)){i[s].dataType="/financial/creditcard/number",a.push(i[s]);
break}}if(0==a.length){for(var l=-1,d=0,s=0;s<i.length;s++)if("undefined"!=typeof i[s]&&!i[s].dataType)if(4==i[s].element.getAttribute("maxlength")){if(-1==l&&(l=s),d++,4==d)break}else 4>d&&(l=-1,d=0);if(4==d){for(var s=l;l+4>s;s++)i[s].dataType="/financial/creditcard/number/part"+(s-l+1),a.push(i[s]);r="/financial/creditcard/number/part4"}}if(a.length>0){var u=e(t).filter(function(e){return e.dataType&&0==e.dataType.indexOf("/financial/creditcard/expiry")});if(u.length<2){var f=e(t).filter(function(e){return e.dataType&&0==e.dataType.indexOf("/financial/creditcard/expirymonth")});if(0==f.length)for(var h=n(i,"dataType",r,0),s=h+1,p=0;s<i.length&&4>p;s++)if("select"==i[s].fieldType&&p++,i[s].element&&i[s].element.innerHTML.match(/jan|feb|dec|\b12\b|\b11\b/i)){i[s].dataType="/financial/creditcard/expirymonth",f.push(i[s]);break}var m=e(t).filter(function(e){return e.dataType&&0==e.dataType.indexOf("/financial/creditcard/expiryyear")});if(0==m.length)for(var h=n(i,"dataType",r,0),s=h+1,p=0;s<i.length&&5>p;s++)if("select"==i[s].fieldType&&p++,i[s].element&&i[s].element.innerHTML.match(/20[0-9]{2}|year/i)){i[s].dataType="/financial/creditcard/expiryyear",m.push(i[s]);break}}var g=e(t).filter(function(e){return e.dataType&&0==e.dataType.indexOf("/financial/creditcard/verification")});if(0==g.length)for(var h=n(i,"dataType",r,0),s=h+1;s<i.length&&h+5>s;s++)if(i[s].name&&i[s].name.match(/cvv|cid|cvs/i)||i[s].id&&i[s].id.match(/cvv|cid|cvs/i)){i[s].dataType="/financial/creditcard/verification";break}}},fixDuplicatePaymentFields:function(e,i){var r=!1,a=0,o={};for(var s in e){var c=e[s].dataType;if(c&&0==c.indexOf("/financial")){if(c in o){r=!0;break}o[c]=1}}for(;r;){r=!1;var l=n(i,"dataType","/financial/creditcard/number",a);if(null==l)break;var d=n(i,"dataType","/financial/creditcard/verification",l+1),u=n(i,"dataType","/financial/creditcard/expirymonth",l+1),f=n(i,"dataType","/financial/creditcard/expiryyear",l+1),h=n(i,"dataType","/financial/creditcard/number",l+1);if(null!==h&&t(i[h].element).is(":visible")){if(r=!0,!(h>f||h>u)){for(var s=1;h>s;s++)i[s].dataType&&0==i[s].dataType.indexOf("/financial")&&-1==i[s].dataType.indexOf("/issuedto")&&-1==i[s].dataType.indexOf("/type")&&(i[s].dataType=null);a=l;continue}i[h].dataType=null}var p=n(i,"dataType","/financial/creditcard/verification",d+1);null!==p&&(r=!0,i[p].dataType=null);var m=n(i,"dataType","/financial/creditcard/expirymonth",u+1);null!==m&&(r=!0,i[m].dataType=null);var g=n(i,"dataType","/financial/creditcard/expiryyear",f+1);null!==g&&(r=!0,i[g].dataType=null)}},fixOrphanedPaymentFields:function(t){var n=e(t).filter(function(e){return e.dataType&&"/financial/creditcard/verification"===e.dataType}),i=e(t).filter(function(e){return e.dataType&&"/financial/creditcard/type"===e.dataType}),r=e(t).filter(function(e){return e.dataType&&("/financial/creditcard/number"===e.dataType||"/financial/creditcard/number/part4"===e.dataType)}),a=e(t).filter(function(e){return e.dataType&&"/financial/creditcard/issuedto"===e.dataType}),o=e(t).filter(function(e){return e.dataType&&0==e.dataType.indexOf("/financial/creditcard/expiry")});n.length>0&&0==r.length&&e(n).each(function(e){e.dataType=null}),a.length>0&&0==r.length&&e(a).each(function(e){e.dataType=null}),i.length>0&&0==r.length&&e(i).each(function(e){e.dataType=null}),o.length>0&&0==r.length&&e(o).each(function(e){e.dataType=null}),r.length>0&&0==o.length&&e(r).each(function(e){e.dataType=null})}};return i}),ABINE_DNTME.define("abine/phoneHeuristics",["documentcloud/underscore","jquery"],function(e){function t(e,t,n,i){i=i||0,len=e.length;for(var r=i;len>r;r++)if(obj=e[r],obj&&obj[t]===n)return obj;return null}var n={apply:function(e,t){var n=!1;for(var i in e)if(e[i].dataType&&e[i].dataType.indexOf("contact/phone")>0){n=!0;break}this.fixUnknownPhoneFieldsWithMaxLengths(e,t),this.fixUnknownPhoneFieldsWithSizes(e,t),n&&(this.fixUnknownPhoneFieldsWithAreaCode(e,t),this.fixThreePhoneFieldsInnaRow(e,t),this.fixOrphanedPaymentFields(e,t),this.normalizeAllPhoneFields(e))},fixUnknownPhoneFieldsWithAreaCode:function(e,n,i){var i=i||1,r=t(n,"dataType","/contact/phone/areacode",i);if(!r)return e;var a=n[r.position+1]?n[r.position+1].key:null,o=n[r.position+2]?n[r.position+2].key:null;return a&&o?(null==e[a].dataType&&null==e[o].dataType&&(e[a].dataType="/contact/phone/exchange",e[o].dataType="/contact/phone/local"),this.fixUnknownPhoneFieldsWithAreaCode(e,n,i+3)):e},fixUnknownPhoneFieldsWithMaxLengths:function(e,n,i){i=i||1;var r=t(n,"maxlength",3,i);if(!r)return e;var a=n[r.position+1]?n[r.position+1].key:null,o=n[r.position+2]?n[r.position+2].key:null;return a&&o?(3===e[a].maxlength&&4===e[o].maxlength&&(e[r.key].dataType="/contact/phone/areacode",e[a].dataType="/contact/phone/exchange",e[o].dataType="/contact/phone/local"),this.fixUnknownPhoneFieldsWithMaxLengths(e,n,i+3)):e},fixUnknownPhoneFieldsWithSizes:function(e,n,i){i=i||1;var r=t(n,"size",3,i);if(!r)return e;var a=n[r.position+1]?n[r.position+1].key:null,o=n[r.position+2]?n[r.position+2].key:null;return a&&o?(3===e[a].size&&4===e[o].size&&(e[r.key].dataType="/contact/phone/areacode",e[a].dataType="/contact/phone/exchange",e[o].dataType="/contact/phone/local"),this.fixUnknownPhoneFieldsWithSizes(e,n,i+3)):e},fixThreePhoneFieldsInnaRow:function(t,n){var i=e(n).filter(function(e){return e?e.dataType&&e.dataType.indexOf("contact/phone")>0:!1});return e(i).each(function(e){if(!(e.dataType&&"/contact/phone/exchange"===e.dataType||e.dataType&&"/contact/phone/local"===e.dataType)){var i=n[e.position+1]?n[e.position+1].key:null,r=n[e.position+2]?n[e.position+2].key:null;if(i&&r){var a=t[i],o=t[r];a.dataType===e.dataType&&o.dataType===e.dataType&&null==a.label&&null==o.label&&(t[e.key].dataType="/contact/phone/areacode",t[i].dataType="/contact/phone/exchange",t[r].dataType="/contact/phone/local")}}}),t},normalizeAllPhoneFields:function(t){var n,i=["/contact/phone/mobile","/contact/phone/home","/contact/phone/work"];for(var r in t)n=t[r],e(i).include(n.dataType)&&(n.dataType="/contact/phone")},fixOrphanedPaymentFields:function(t){var n=e(t).filter(function(e){return e.dataType&&"/contact/phone/areacode"===e.dataType}),i=e(t).filter(function(e){return e.dataType&&"/contact/phone/exchange"===e.dataType}),r=e(t).filter(function(e){return e.dataType&&"/contact/phone/local"===e.dataType});(0===n.length||0===i.length||0===r.length)&&(e(i).each(function(e){e.dataType="/contact/phone"}),e(r).each(function(e){e.dataType="/contact/phone"}));var a=e(t).filter(function(e){return e.dataType&&"/contact/phone"===e.dataType});n.length>0&&a.length>0&&e(a).each(function(e){e.dataType="/contact/phone/number"})}};return n}),ABINE_DNTME.define("abine/proxies",["documentcloud/underscore","abine/core","abine/contentMessenger","abine/timer"],function(e,t,n,i){function r(t,i){o||(i=e.once(i||function(){}),o=t||new n.ContentMessenger({eventAggregator:ABINE_DNTME.eventAggregator||window.eventAggregator}),e.each(s,function(e){e.connect(i)}))}function a(){o&&(e.each(s,function(e){e.disconnect()}),o=null)}var o,s=[],c=t.BaseClass.extend({initialize:function(t){var n=this;e.each(t.methods,function(e){n.addMethod(e)}),e.each(t.asyncMethods,function(e){n.addAsyncMethod(e)}),this._require=t.require,this._events=t.events,s.push(this),o&&this.connect()},connect:function(e){var t=""+Math.random();this._proxyId=t,this._connected=!1;var n=this;o.on("background:stub:events:"+t,function(t){return"stub:connected"==t.name?(n._connected=!0,e&&e(t.tabId),void 0):(n.trigger(t.name,t.payload),void 0)}),o.send("contentManager:proxy:connect",{proxyId:t,require:this._require,events:this._events})},disconnect:function(){o.send("contentManager:proxy:disconnect",{proxyId:this._proxyId}),this._connected=!1},addMethod:function(e){this[e]=function(){var t=function(){},n=arguments;arguments.length>0&&"function"==typeof arguments[arguments.length-1]?(t=arguments[arguments.length-1],n=Array.prototype.slice.call(arguments,0,-1)):n=Array.prototype.slice.call(arguments,0),this.call({method:e,params:n},t)}},addAsyncMethod:function(e){this[e]=function(){var t=function(){},n=arguments;arguments.length>0&&"function"==typeof arguments[arguments.length-1]?(t=arguments[arguments.length-1],n=Array.prototype.slice.call(arguments,0,-1)):n=Array.prototype.slice.call(arguments,0),this.callAsync({method:e,params:n},t)}},call:function(e,t){var n=""+Math.random();e.proxyId=this._proxyId,e.callId=n,e.require=this._require,t&&o.once("background:stub:response:"+n,function(e){t(e)});var r=this,a=100,s=function(){return a--,!r._connected&&a>0?(i.setTimeout(s,50),void 0):(o.send("contentManager:proxy:call",e),void 0)};s()},callAsync:function(e,t){var n=""+Math.random();e.proxyId=this._proxyId,e.callId=n,e.require=this._require,t&&o.once("background:stub:response:"+n,function(e){t(e.err,e.data)});var r=this,a=100,s=function(){return a--,!r._connected&&a>0?(i.setTimeout(s,50),void 0):(o.send("contentManager:proxy:callAsync",e),void 0)};s()}}),l=new c({require:"abine/securityManager",methods:["isLocked","login","isInitialized","openPage","openPostInstall","openLink","refreshData","refreshRules","resetData","openWindow","isMaskmeInstalled","isProxyRunning"],events:["background:securityManager:unlocked","background:securityManager:locked"]}),d=new c({require:"abine/webapp",methods:["openHome","openDashboard","openWallet","openMasking","openEmails","openPhones","openCards","openLogin","openMaskedEmailsIn30","openPremium","openNewFeatureAdded","openSnowman","openBlacklist","openSettings","openStats","openHelp","openPasswordSetup","openDnt2UpgradePage","openPiwikCampaign","openWeeklyReport","openDntAnywhere","openForgotPassword","openDropbox","openFAQ","openPage","openCashForCardsFaq","openCashForCardsSignup","openUnderstandingTracking","openTour","openAccounts"],events:[]}),u=new c({require:"abine/modules/license",methods:[],asyncMethods:["sendFeedbackEmail","refreshEntitlements","refreshLastFourCardDigits","register","login","subscribe","incrementMedalsEarned","incrementMedalsEarnedWithCurrentMedals","retrieveMedalsEarned","logAction","logSplitData","logPasswordFillData"],events:[]}),f=new c({require:"abine/modules/payments",methods:[],asyncMethods:["retrieveCardCredit","retrieveCardFee","verifyCardRequest"],events:[]}),h=new c({require:"abine/modules/panels",methods:[],asyncMethods:["getDNTMePanel","changePanelShowRate","getDNTMeGrowl"],events:[]}),p=new c({require:"abine/pageEvents",asyncMethods:["processAction"],methods:[],events:["entity:changed"]}),m=new c({require:"abine/modules/mappings",asyncMethods:["makeDailyMappingCheck"],methods:[],events:[]}),g=new c({require:"abine/memoryStore",methods:["set"],asyncMethods:["get"],events:[]});return{Proxy:c,connect:r,disconnect:a,securityManager:l,webapp:d,licenseModule:u,paymentsModule:f,panelsModule:h,pageEventsModule:p,mappingsModule:m,memoryStore:g}}),ABINE_DNTME.define("abine/responseCodes",[],function(){return{UNKNOWN_ERROR:"unknown error",SUCCESS:"successful",ERROR:"error",SERVICE_UNAVAILABLE_ERROR:"service unavailable error",SCHEDULED_DOWNTIME:"scheduled downtime",MISSING_PARAMETERS:"missing parameters",UNAUTHORIZED:"unauthorized bad token",NO_ACCESS_FOR_FEATURE:"no access to requested feature",INVALID_PASSWORD:"invalid password",ACCOUNT_ALREADY_EXISTS:"account already exists for that email",SAVE_NEW_USER_ERROR:"error saving new user",FAILED_CREATING_TARGET_EMAIL:"failed to create target email",FAILED_TO_UPDATE_USER:"error updating user",NO_ACCOUNT_FOUND_FOR_EMAIL:"no account found for email",ACCOUNT_MARKED_FOR_DELETION:"account has been marked for deletion",ACCOUNT_HAS_BEEN_LOCKED:"account has been locked",WRONG_PASSWORD:"wrong password",INVALID_EMAIL_ADDRESS:"invalid email address",NO_RECURLY_ACCOUNT_FOUND:"no recurly account found",DOWNGRADE_SCHEMA_NOT_ALLOWED:"downgrade of schema_version is not allowed",SAVE_CLIENT_DATA_ERROR:"errors saving client data",DESTROY_CLIENT_DATA_ERROR:"errors destroying client data",NO_CLIENT_DATA_FOUND:"no client data found",USER_EXISTS_FOR_CLIENT_DATA_DELETION:"cannot destroy client data when user exists",UPGRADE_REQUIRED:"upgrade required",PHONE_NOT_FOUND:"phone not found",NO_DISPOSABLE_PHONE:"no disposable phone",FAILED_TO_SAVE_PHONE:"failed to save phone",PHONE_ALREADY_VALIDATED:"phone already validated",NO_NUMBERS_AVAILABLE:"no numbers available",FAILED_TO_SEND_VERIFICATION_CODE:"failed to send verification code",WRONG_VERIFICATION_CODE:"wrong verification code",OLD_PHONE_NOT_FOUND:"old phone not found",COUNTRY_NOT_SUPPORTED:"country not supported",COUNTRY_CHANGE_NOT_SUPPORTED:"country change not supported",ERROR_CREATING_DISPOSABLE:"error creating disposable",MISSING_USER_PARAMS_ERROR_CODE:"missing user params",NO_BILLING_ACCOUNT_FOR_USER_ERROR_CODE:"no billing account for user",REQUEST_ALREADY_EXISTS_ERROR_CODE:"request already exists",NO_CARDS_AVAILABLE_ERROR_CODE:"no cards available",REQUESTED_AMOUNT_OVER_LIMIT_ERROR_CODE:"requested amount over limit",REQUESTED_AMOUNT_BELOW_MINIMUM_ERROR_CODE:"requested amount below minimum",REQUESTED_AMOUNT_INVALID_ERROR_CODE:"requested amount invalid",BILLING_FAILED_ERROR_CODE:"billing failed",BILLING_DECLINED_ERROR_CODE:"billing declined",NO_CARD_FOUND_ERROR_CODE:"no card found",NO_BILLING_TRANSACTION_FOUND_ERROR_CODE:"no billing transaction found",FRAUD_SOFT_LIMIT_REACHED:"fraud soft limit",REFUND_FAILED_ERROR_CODE:"refund failed",PROVIDER_CANCEL_FAILED_ERROR_CODE:"provider cancel failed",PROVIDER_READ_FAILED_ERROR_CODE:"provider read failed",PROVIDER_CARD_CREATION_FAILED_ERROR_CODE:"provider card creation failed",FRAUD_HARD_LIMIT_REACHED:"fraud hard limit reached",CARD_ALREADY_DEACTIVATED_ERROR_CODE:"card already deactivated",FRAUD_VERIFIED_SOFT_LIMIT_REACHED:"fraud verified soft limit",FRAUD_PLATFORM_UNAVAILABLE:"fraud verification unavailable",FRAUD_HIGH_RISK_COUNTRY_ERROR_CODE:"high risk country ban",BILLING_IN_NON_US_ERROR_CODE:"billing in non us",GREY_LISTED_ERROR_CODE:"grey listed user",GLOBAL_SOFT_LIMIT_REACHED:"global soft limit",DUPLICATE_CARD_ERROR_CODE:"duplicate card used ban",REJECTED_DOMAIN_ERROR_CODE:"domains known to not accept masked cards",BANNED_DOMAIN_ERROR_CODE:"banned domain",SPLIT_INTRUSIVE_NON_INTRUSIVE:"7",SPLIT_INTRUSIVE_CONTROL:"8",SPLIT_INTRUSIVE_ALWAYS_REG:"9",SPLIT_INTRUSIVE_GOT_IT_REG:"10",SPLIT_INTRUSIVE_COMPLETE_SETUP_BUTTON:"11",SPLIT_WALLET_OFF:"12",SPLIT_WALLET_ON:"13"}}),ABINE_DNTME.define("abine/formSubmitDetector",["documentcloud/underscore","jquery","abine/formAnalyzer","abine/core","abine/eventLogger"],function(e,t,n,i,r){var a=i.BaseClass.extend({init:function(e){var t=this;e.on("contentManager:formSubmit",function(e,n){t.trigger("background:formSubmit",{formData:e,tabId:n})}),e.on("contentManager:formFieldChanged",function(e,n){t.trigger("background:formFieldChanged",{formData:e.formData,fieldData:e.fieldData,tabId:n})}),e.on("panel:fill",function(e,n){t.trigger("background:formFieldChanged",{formData:e.formData,fieldData:e.fieldData,tabId:n})})}}),o=i.BaseClass.extend({initialize:function(e,t){function i(i){var r=i.target;"FORM"===r.nodeName&&e.send("contentManager:formSubmit",n.getFormData(r,t.location.href))}t=t||window,t.document.addEventListener("submit",i,!0)}});return{formSubmitDetector:new a,FormSubmitContentHelper:o}}),ABINE_DNTME.define("abine/pageEventsImpl",["documentcloud/underscore","abine/core","abine/proxies","jquery","abine/url","abine/timer"],function(e,t,n,i,r,a){function o(t){var i=t.target,a=i.ownerDocument,o=i.getAttribute("action"),s=i.getAttribute("params")||i.getAttribute("param"),c=i.getAttribute("expectsResponse");if(c||i.parentNode&&i.parentNode.removeChild(i),s)try{s=JSON.parse(s)}catch(l){s={}}else s={};if(-1!=o.indexOf("AuthToken")&&this.trigger("disable:form:helpers",a),"dnt_ping"==o){if(ABINE_DNTME.maskme_installed)return;var d=a.createEvent("Event");d.initEvent("dnt_pong",!0,!0),a.dispatchEvent(d)}else{var u=a.createEvent("Event");u.initEvent("received:"+o,!0,!0),a.dispatchEvent(u)}var f=function(){};c&&(f=function(e){var t=a.createEvent("Event");t.initEvent("data:"+o,!0,!0),i.setAttribute("_data_from_extension",JSON.stringify(e)),i.dispatchEvent(t)});var h="IE"==ABINE_DNTME.config.browser?r.getHostname(a.URL):a.location.host;i.getAttribute("hookEvent")?(n.pageEventsModule.processAction({action:o,host:h,params:s},function(){f("connected")}),this.entityChanged||(this.entityChanged=e.bind(function(e){this.trigger(e,null)},this),n.pageEventsModule.on("entity:changed",this.entityChanged)),e.each(i.getAttribute("hookEvent").split(" "),e.bind(function(e){this.on(e,f)},this))):n.pageEventsModule.processAction({action:o,host:h,params:s},function(e){f(e)})}function s(e){var t=e.target,a=t.ownerDocument,o=t.getAttribute("action"),s=t.getAttribute("param");if(s)try{s=JSON.parse(s)}catch(c){s={}}else s={};var l="IE"==ABINE_DNTME.config.browser?r.getHostname(a.URL):a.location.host;n.pageEventsModule.processAction({action:o,host:l,params:s},function(e){i(t).text(JSON.stringify(e)),i(t).click()})}var c=null,l=t.BaseClass.extend({startup:function(t,n){c=t,this.handlePageEventListener=e.bind(function(){var t=arguments;a.setTimeout(e.bind(function(){o.apply(this,t)},this),0)},this),n.addEventListener("DntPageEvent",this.handlePageEventListener,!0,!0),n.addEventListener("DNTPPageEvent",s,!0,!0);for(var i=n.getElementsByTagName("dntdataelement"),r=0;r<i.length;r++)this.handlePageEventListener({target:i[r]});if("IE"==ABINE_DNTME.config.browser&&0==i.length&&n.documentElement&&n.documentElement.getAttribute("abine_webapp")){var l=n.createEvent("Event");l.initEvent("data:hello_from_plugin",!0,!0),n.dispatchEvent(l)}},shutdown:function(e){e.removeEventListener("DntPageEvent",this.handlePageEventListener,!0,!0),e.removeEventListener("DNTPPageEvent",s,!0,!0),this.entityChanged&&(n.pageEventsModule.off("entity:changed",this.entityChanged),this.entityChanged=null),this.off()}});return l}),ABINE_DNTME.define("abine/contextHelper",["documentcloud/underscore","abine/window","storage","abine/password","abine/config","abine/securityManager","abine/webapp"],function(e,t,n,i,r,a,o){return{onClick:function(t,r,a,s,c){if(r.indexOf("abine_dntme_accountfield_")>=0){var l=r.split("accountfield_")[1];n.DisposableEmail.load(l,e.bind(function(e){this.fillFieldInTab(t,a,{element:c,value:e.getAddress(),dataType:"/contact/email",origin:"disposable"})},this))}else switch(r){case"abine_dntme_email_mask":n.ShieldedEmail.index(null,e.bind(function(i){n.DisposableEmail.createOnServer({sender:a,payload:{targetGuid:i[0].guid,label:s}},e.bind(function(e){this.fillFieldInTab(t,a,{element:c,value:e.getAddress(),dataType:"/contact/email",origin:"disposable",disposableGUID:e.guid})},this))},this));break;case"abine_dntme_email_disclose":n.ShieldedEmail.index(null,e.bind(function(e){this.fillFieldInTab(t,a,{element:c,value:e[0].email,dataType:"/contact/email",origin:""})},this));break;case"abine_dntme_phone_mask":n.DisposablePhone.index(null,e.bind(function(e){this.fillFieldInTab(t,a,{element:c,value:e[0].getPrettyNumber(),origin:"disposable",disposableGUID:e[0].id,dataType:"/contact/phone"})},this));break;case"abine_dntme_phone_disclose":n.ShieldedPhone.index(null,e.bind(function(e){this.fillFieldInTab(t,a,{element:c,value:e[0].getPrettyNumber(),origin:"",dataType:"/contact/phone"})},this));break;case"abine_dntme_card_mask":this.triggerCreditCardPanelInTab(t,a,{});break;case"abine_dntme_activate_card":o.openCards();break;case"abine_dntme_password_mask":this.fillFieldInTab(t,a,{element:c,value:i.generateRandomPassword(),origin:"strong",generatedNow:!0,dataType:"/password"});break;case"abine_dntme_unlock":o.openLogin();break;case"abine_dntme_setup_phone":o.openPhones();break;case"abine_dntme_blacklisted":t.send("background:dntme:show",{tabId:a},a)}},fillFieldInTab:function(e,t,n){e.send("background:contextmenu:fill",n,t)},triggerCreditCardPanelInTab:function(e,t,n){e.send("background:contextmenu:maskcard",n,t)}}}),ABINE_DNTME.define("abine/crypto",["pidcrypt"],function(e){function t(e){for(var t=[],n=E.length,i=0;i<e.length;i+=8){var r=parseInt(e.substr(i,8),16),a=r%n,o=(Math.floor(r/n)+a)%n,s=(Math.floor(Math.floor(r/n)/n)+o)%n;t=t.concat([E[a],E[o],E[s]])}return t.join(" ")}function n(e,t){return 0>e?t+e:e%t}function i(e){for(var t="",i=E.length,r=e.split(" "),a=0;a<r.length;a+=3){var o=E.indexOf(r[a]),s=E.indexOf(r[a+1])%i,c=E.indexOf(r[a+2])%i,l=o+i*n(s-o,i)+i*i*n(c-s,i);t+=("0000000"+l.toString(16)).slice(-8)}return t}function r(t){return e.MD5(t)}function a(t){return e.SHA256(t)}function o(t){return e.SHA1(t)}function s(t,n){var i=t+n;if(!(i in T)){var r=new e.AES.CBC;r.init(t,{salt:n,clear:!1});var a=r.pidcrypt.getParams();T[i]={key:a.key,iv:a.iv,salt:n}}return T[i]}function c(t,n){var i=new e.AES.CBC;i.initByValues("",t.key,t.iv,{salt:t.salt});try{return i.encrypt(n)}catch(r){}return n}function l(t,n){var i=new e.AES.CBC;i.initByValues("",t.key,t.iv,{salt:t.salt});try{return i.decrypt(n)}catch(r){}return n}function d(e,t,n){return c(s(e,n||a(e)),t)}function u(e,t,n,i){var r=s(e,n||a(e)),o=l(r,t);return i&&t!=c(r,o)?t:o}function f(e,t,n){try{return t!=u(e,t,n,!0)}catch(i){}return!1}function h(e,t,n){for(var i=t.id,r=0;r<n.length;r++){var a=t[n[r]],o=d(e,a,i);o!=a&&(t[n[r]]="ENC_"+o)}}function p(e,t,n,i){for(var r=0,a=t.id,o=0;o<n.length;o++){var s=t[n[o]];if(s&&s.length>0)if(0==s.indexOf("ENC_")){if(s=s.substr(4),!e)return 1;if(i){if(!f(e,s,a))return 1;i=!1}var c=u(e,s,a);if(c==s)return 1;t[n[o]]=c}else e&&(r=2)}return r}function m(){return _.convertToHex(_.byteArray2String((new e).getRandomBytes(8)))}function g(e){for(var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz!@#$%^&*(){}[]|\\/<>?,.;~",n="",i=0;e>i;i++){var r=Math.floor(Math.random()*t.length);n+=t.substring(r,r+1)}return n}function y(){return _.convertToHex(_.byteArray2String((new e).getRandomBytes(16)))}function b(e){var t=s(e,e);return a(c(t,e))}function v(e){return b(b(e))}var E=["like","just","love","know","never","want","time","out","there","make","look","eye","down","only","think","heart","back","then","into","about","more","away","still","them","take","thing","even","through","long","always","world","too","friend","tell","try","hand","thought","over","here","other","need","smile","again","much","cry","been","night","ever","little","said","end","some","those","around","mind","people","girl","leave","dream","left","turn","myself","give","nothing","really","off","before","something","find","walk","wish","good","once","place","ask","stop","keep","watch","seem","everything","wait","got","yet","made","remember","start","alone","run","hope","maybe","believe","body","hate","after","close","talk","stand","own","each","hurt","help","home","god","soul","new","many","two","inside","should","true","first","fear","mean","better","play","another","gone","change","use","wonder","someone","hair","cold","open","best","any","behind","happen","water","dark","laugh","stay","forever","name","work","show","sky","break","came","deep","door","put","black","together","upon","happy","such","great","white","matter","fill","past","please","burn","cause","enough","touch","moment","soon","voice","scream","anything","stare","sound","red","everyone","hide","kiss","truth","death","beautiful","mine","blood","broken","very","pass","next","forget","tree","wrong","air","mother","understand","lip","hit","wall","memory","sleep","free","high","realize","school","might","skin","sweet","perfect","blue","kill","breath","dance","against","fly","between","grow","strong","under","listen","bring","sometimes","speak","pull","person","become","family","begin","ground","real","small","father","sure","feet","rest","young","finally","land","across","today","different","guy","line","fire","reason","reach","second","slowly","write","eat","smell","mouth","step","learn","three","floor","promise","breathe","darkness","push","earth","guess","save","song","above","along","both","color","house","almost","sorry","anymore","brother","okay","dear","game","fade","already","apart","warm","beauty","heard","notice","question","shine","began","piece","whole","shadow","secret","street","within","finger","point","morning","whisper","child","moon","green","story","glass","kid","silence","since","soft","yourself","empty","shall","angel","answer","baby","bright","dad","path","worry","hour","drop","follow","power","war","half","flow","heaven","act","chance","fact","least","tired","children","near","quite","afraid","rise","sea","taste","window","cover","nice","trust","lot","sad","cool","force","peace","return","blind","easy","ready","roll","rose","drive","held","music","beneath","hang","mom","paint","emotion","quiet","clear","cloud","few","pretty","bird","outside","paper","picture","front","rock","simple","anyone","meant","reality","road","sense","waste","bit","leaf","thank","happiness","meet","men","smoke","truly","decide","self","age","book","form","alive","carry","escape","damn","instead","able","ice","minute","throw","catch","leg","ring","course","goodbye","lead","poem","sick","corner","desire","known","problem","remind","shoulder","suppose","toward","wave","drink","jump","woman","pretend","sister","week","human","joy","crack","grey","pray","surprise","dry","knee","less","search","bleed","caught","clean","embrace","future","king","son","sorrow","chest","hug","remain","sat","worth","blow","daddy","final","parent","tight","also","create","lonely","safe","cross","dress","evil","silent","bone","fate","perhaps","anger","class","scar","snow","tiny","tonight","continue","control","dog","edge","mirror","month","suddenly","comfort","given","loud","quickly","gaze","plan","rush","stone","town","battle","ignore","spirit","stood","stupid","yours","brown","build","dust","hey","kept","pay","phone","twist","although","ball","beyond","hidden","nose","taken","fail","float","pure","somehow","wash","wrap","angry","cheek","creature","forgotten","heat","rip","single","space","special","weak","whatever","yell","anyway","blame","job","choose","country","curse","drift","echo","figure","grew","laughter","neck","suffer","worse","yeah","disappear","foot","forward","knife","mess","somewhere","stomach","storm","beg","idea","lift","offer","breeze","field","five","often","simply","stuck","win","allow","confuse","enjoy","except","flower","seek","strength","calm","grin","gun","heavy","hill","large","ocean","shoe","sigh","straight","summer","tongue","accept","crazy","everyday","exist","grass","mistake","sent","shut","surround","table","ache","brain","destroy","heal","nature","shout","sign","stain","choice","doubt","glance","glow","mountain","queen","stranger","throat","tomorrow","city","either","fish","flame","rather","shape","spin","spread","ash","distance","finish","image","imagine","important","nobody","shatter","warmth","became","feed","flesh","funny","lust","shirt","trouble","yellow","attention","bare","bite","money","protect","amaze","appear","born","choke","completely","daughter","fresh","friendship","gentle","probably","six","deserve","expect","grab","middle","nightmare","river","thousand","weight","worst","wound","barely","bottle","cream","regret","relationship","stick","test","crush","endless","fault","itself","rule","spill","art","circle","join","kick","mask","master","passion","quick","raise","smooth","unless","wander","actually","broke","chair","deal","favorite","gift","note","number","sweat","box","chill","clothes","lady","mark","park","poor","sadness","tie","animal","belong","brush","consume","dawn","forest","innocent","pen","pride","stream","thick","clay","complete","count","draw","faith","press","silver","struggle","surface","taught","teach","wet","bless","chase","climb","enter","letter","melt","metal","movie","stretch","swing","vision","wife","beside","crash","forgot","guide","haunt","joke","knock","plant","pour","prove","reveal","steal","stuff","trip","wood","wrist","bother","bottom","crawl","crowd","fix","forgive","frown","grace","loose","lucky","party","release","surely","survive","teacher","gently","grip","speed","suicide","travel","treat","vein","written","cage","chain","conversation","date","enemy","however","interest","million","page","pink","proud","sway","themselves","winter","church","cruel","cup","demon","experience","freedom","pair","pop","purpose","respect","shoot","softly","state","strange","bar","birth","curl","dirt","excuse","lord","lovely","monster","order","pack","pants","pool","scene","seven","shame","slide","ugly","among","blade","blonde","closet","creek","deny","drug","eternity","gain","grade","handle","key","linger","pale","prepare","swallow","swim","tremble","wheel","won","cast","cigarette","claim","college","direction","dirty","gather","ghost","hundred","loss","lung","orange","present","swear","swirl","twice","wild","bitter","blanket","doctor","everywhere","flash","grown","knowledge","numb","pressure","radio","repeat","ruin","spend","unknown","buy","clock","devil","early","false","fantasy","pound","precious","refuse","sheet","teeth","welcome","add","ahead","block","bury","caress","content","depth","despite","distant","marry","purple","threw","whenever","bomb","dull","easily","grasp","hospital","innocence","normal","receive","reply","rhyme","shade","someday","sword","toe","visit","asleep","bought","center","consider","flat","hero","history","ink","insane","muscle","mystery","pocket","reflection","shove","silently","smart","soldier","spot","stress","train","type","view","whether","bus","energy","explain","holy","hunger","inch","magic","mix","noise","nowhere","prayer","presence","shock","snap","spider","study","thunder","trail","admit","agree","bag","bang","bound","butterfly","cute","exactly","explode","familiar","fold","further","pierce","reflect","scent","selfish","sharp","sink","spring","stumble","universe","weep","women","wonderful","action","ancient","attempt","avoid","birthday","branch","chocolate","core","depress","drunk","especially","focus","fruit","honest","match","palm","perfectly","pillow","pity","poison","roar","shift","slightly","thump","truck","tune","twenty","unable","wipe","wrote","coat","constant","dinner","drove","egg","eternal","flight","flood","frame","freak","gasp","glad","hollow","motion","peer","plastic","root","screen","season","sting","strike","team","unlike","victim","volume","warn","weird","attack","await","awake","built","charm","crave","despair","fought","grant","grief","horse","limit","message","ripple","sanity","scatter","serve","split","string","trick","annoy","blur","boat","brave","clearly","cling","connect","fist","forth","imagination","iron","jock","judge","lesson","milk","misery","nail","naked","ourselves","poet","possible","princess","sail","size","snake","society","stroke","torture","toss","trace","wise","bloom","bullet","cell","check","cost","darling","during","footstep","fragile","hallway","hardly","horizon","invisible","journey","midnight","mud","nod","pause","relax","shiver","sudden","value","youth","abuse","admire","blink","breast","bruise","constantly","couple","creep","curve","difference","dumb","emptiness","gotta","honor","plain","planet","recall","rub","ship","slam","soar","somebody","tightly","weather","adore","approach","bond","bread","burst","candle","coffee","cousin","crime","desert","flutter","frozen","grand","heel","hello","language","level","movement","pleasure","powerful","random","rhythm","settle","silly","slap","sort","spoken","steel","threaten","tumble","upset","aside","awkward","bee","blank","board","button","card","carefully","complain","crap","deeply","discover","drag","dread","effort","entire","fairy","giant","gotten","greet","illusion","jeans","leap","liquid","march","mend","nervous","nine","replace","rope","spine","stole","terror","accident","apple","balance","boom","childhood","collect","demand","depression","eventually","faint","glare","goal","group","honey","kitchen","laid","limb","machine","mere","mold","murder","nerve","painful","poetry","prince","rabbit","shelter","shore","shower","soothe","stair","steady","sunlight","tangle","tease","treasure","uncle","begun","bliss","canvas","cheer","claw","clutch","commit","crimson","crystal","delight","doll","existence","express","fog","football","gay","goose","guard","hatred","illuminate","mass","math","mourn","rich","rough","skip","stir","student","style","support","thorn","tough","yard","yearn","yesterday","advice","appreciate","autumn","bank","beam","bowl","capture","carve","collapse","confusion","creation","dove","feather","girlfriend","glory","government","harsh","hop","inner","loser","moonlight","neighbor","neither","peach","pig","praise","screw","shield","shimmer","sneak","stab","subject","throughout","thrown","tower","twirl","wow","army","arrive","bathroom","bump","cease","cookie","couch","courage","dim","guilt","howl","hum","husband","insult","led","lunch","mock","mostly","natural","nearly","needle","nerd","peaceful","perfection","pile","price","remove","roam","sanctuary","serious","shiny","shook","sob","stolen","tap","vain","void","warrior","wrinkle","affection","apologize","blossom","bounce","bridge","cheap","crumble","decision","descend","desperately","dig","dot","flip","frighten","heartbeat","huge","lazy","lick","odd","opinion","process","puzzle","quietly","retreat","score","sentence","separate","situation","skill","soak","square","stray","taint","task","tide","underneath","veil","whistle","anywhere","bedroom","bid","bloody","burden","careful","compare","concern","curtain","decay","defeat","describe","double","dreamer","driver","dwell","evening","flare","flicker","grandma","guitar","harm","horrible","hungry","indeed","lace","melody","monkey","nation","object","obviously","rainbow","salt","scratch","shown","shy","stage","stun","third","tickle","useless","weakness","worship","worthless","afternoon","beard","boyfriend","bubble","busy","certain","chin","concrete","desk","diamond","doom","drawn","due","felicity","freeze","frost","garden","glide","harmony","hopefully","hunt","jealous","lightning","mama","mercy","peel","physical","position","pulse","punch","quit","rant","respond","salty","sane","satisfy","savior","sheep","slept","social","sport","tuck","utter","valley","wolf","aim","alas","alter","arrow","awaken","beaten","belief","brand","ceiling","cheese","clue","confidence","connection","daily","disguise","eager","erase","essence","everytime","expression","fan","flag","flirt","foul","fur","giggle","glorious","ignorance","law","lifeless","measure","mighty","muse","north","opposite","paradise","patience","patient","pencil","petal","plate","ponder","possibly","practice","slice","spell","stock","strife","strip","suffocate","suit","tender","tool","trade","velvet","verse","waist","witch","aunt","bench","bold","cap","certainly","click","companion","creator","dart","delicate","determine","dish","dragon","drama","drum","dude","everybody","feast","forehead","former","fright","fully","gas","hook","hurl","invite","juice","manage","moral","possess","raw","rebel","royal","scale","scary","several","slight","stubborn","swell","talent","tea","terrible","thread","torment","trickle","usually","vast","violence","weave","acid","agony","ashamed","awe","belly","blend","blush","character","cheat","common","company","coward","creak","danger","deadly","defense","define","depend","desperate","destination","dew","duck","dusty","embarrass","engine","example","explore","foe","freely","frustrate","generation","glove","guilty","health","hurry","idiot","impossible","inhale","jaw","kingdom","mention","mist","moan","mumble","mutter","observe","ode","pathetic","pattern","pie","prefer","puff","rape","rare","revenge","rude","scrape","spiral","squeeze","strain","sunset","suspend","sympathy","thigh","throne","total","unseen","weapon","weary"],_=e.util,T={};
return{md5:r,sha256:a,sha1:o,salt:m,createKeyAndIV:s,encrypt:c,decrypt:l,encryptKey:d,decryptKey:u,verifyKey:f,encryptObject:h,decryptObject:p,randomString:g,generateKey:y,encode_mnemonic:t,decode_mnemonic:i,getServerPassword:v}}),ABINE_DNTME.define("abine/dntmeInit",["documentcloud/underscore","abine/dnt/api","abine/localStorage","abine/toolbar","storage","abine/timer","persistence","abine/dntmeUpgrade","abine/badgeManager","modules","abine/securityManager"],function(e,t,n,i,r,a,o,s,c,l,d){function u(){ABINE_DNTME.dnt_api.updateRules("http://www.abine.com/rules/update.php",function(e,t){r.Preference.findBy("key","lastRulesCheck",function(e){e||(e=new r.Preference({key:"lastRulesCheck"}),o.add(e)),e.value=Math.floor(I().valueOf()),o.flush()}),"updated"==e?n.setItem("dnt-rules",t):f()})}function f(){var e=18e5+36e5*Math.random();E&&a.clearTimeout(E),E=a.setTimeout(h,e)}function h(){r.Preference.findBy("key","lastRulesCheck",function(e){if(e&&e.value){var t=new Date(parseInt(e.value));t.valueOf()<(new Date).getTime()-T?u():f()}else u()})}function p(e,t,i){if(e){if("trackerMap"in e){t||(t={}),"trackerSettings"in t||(t.trackerSettings={});for(var a in e.trackerMap){a in t.trackerSettings||(t.trackerSettings[a]={});for(var s in e.trackerMap[a])t.trackerSettings[a][s]!=e.trackerMap[a][s]&&(t.trackerSettings[a][s]=!!e.trackerMap[a][s])}}if("settings"in e){if("dntp.showmedals"in e.settings&&r.Preference.createOrModify({key:"showMedals",value:e.settings["dntp.showmedals"]?"true":"false"}),"dntp.useglobalallow"in e.settings&&(t.useSuggestions=e.settings["dntp.useglobalallow"]),"defaultBlocked"in e.settings&&(t.defaultBlocked=e.settings.defaultBlocked),"origin"in e.settings&&e.settings.origin&&""!=e.settings.origin&&(r.Preference.createOrModify({key:"dynamicTag",value:e.settings.origin}),ABINE_DNTME.config.tags.unshift(e.settings.origin)),"install.date"in e.settings&&r.Preference.createOrModify({key:"installDate",value:e.settings["install.date"]}),"original.version"in e.settings&&r.Preference.createOrModify({key:"installVersion",value:e.settings["original.version"]}),"disabled.sites"in e.settings&&e.settings["disabled.sites"]){var c=JSON.parse(e.settings["disabled.sites"]);"disabledSites"in t||(t.disabledSites={});for(var l in c)l in t.trackerSettings&&delete t.trackerSettings[l],l in t.disabledSites||(t.disabledSites[l]=1,r.Blacklist.findBy("domain",l,function(e){e||(e=new r.Blacklist({domain:l}),o.add(e)),e.tracker=!0}))}if("blocked.sites"in e.settings&&e.settings["blocked.sites"]){var d=JSON.parse(e.settings["blocked.sites"]);"blockedSites"in t||(t.blockedSites={});for(var l in d)l in t.trackerSettings&&delete t.trackerSettings[l],l in t.blockedSites||(t.blockedSites[l]=1,r.Blacklist.findBy("domain",l,function(e){e&&(e.tracker=!1)}))}}"totals"in e&&(e.totals.total&&(w=e.totals.total),e.totals.facebook&&(A+=e.totals.facebook),e.totals.twitter&&(A+=e.totals.twitter),e.totals.google&&(A+=e.totals.google),e.totals.linkedin&&(A+=e.totals.linkedin)),"dailyTotals"in e&&(N=e.dailyTotals),"badTrackers"in e&&(D=e.badTrackers),S=!0,b(),n.setItem("dnt-settings",JSON.stringify(t)),o.flush()}i(t)}function m(e,t,n,i,r,a,o){if(i&&n&&N){var s=new Date,c=y(s)+"",l=s.getFullYear();w++,C++,t in k&&A++;var d={};if(l in N?(d=N[l],d[c]=c in d?d[c]+1:w):(d[c]=w,N[l]=d),o){"totals"in D||(D.totals={}),t in D.totals?D.totals[t]++:D.totals[t]=1,"daily"in D||(D.daily={});var u=t+"."+l;u in D.daily||(D.daily[u]={}),c in D.daily[u]?D.daily[u][c]++:D.daily[u][c]=1}x(),S=!0,O()}}function g(e,t,n,a,s,c){var d={tabId:e,disabled:t,total:n,blocked:a,suggested:s,host:c};_.send("background:dntme:tracker-count-changed",d,e),r.Preference.findBy("key","showMedals",function(e){r.DntStats.index(null,function(t){if(!e||"true"==e.value){var n;t&&t.length&&(n=t[0]),n.hasOwnProperty("viewedBadge")&&!n.viewedBadge&&(d.isBadge=!0,d.iconPath=M.icon,n.earnedOn||(n.earnedOn=Date.now(),o.flush()))}d.isBadge?i.updateIcon(d):l.panelsModule.getToolbarPanel(d,function(e){i.updateIcon(e)})})})}function y(e){e=e||new Date;var t=new Date(e.getFullYear(),0,0);return Math.floor((e-t)/864e5)}function b(){S&&(S=!1,r.DntStats.index(null,function(e){var e=e[0];e.totalAllTimeTrackers=w,e.totalAllTimeSocialTrackers=A,e.dailyTrackerCounts=JSON.stringify(N),e.badTrackers=JSON.stringify(D),e.currentBadge=JSON.stringify(M),e.currentBadgeIndex=P,o.flush()}))}function v(e){var i=n.getItem("dnt-settings"),a=n.getItem("dnt-rules");if(i)try{i=JSON.parse(i)}catch(c){!0&&ABINE_DNTME.log.error("Corrupted settings file")}if(a)try{a=JSON.parse(a)}catch(c){!0&&ABINE_DNTME.log.error("Corrupted rules file")}r.DntStats.index(null,function(e){var e,t=!1;!e||e&&!e.length?(e=new r.DntStats({totalAllTimeTrackers:0,totalAllTimeSocialTrackers:0,dailyTrackerCounts:"{}",badTrackers:"{}",viewedBadge:!0,currentBadge:"{}",currentBadgeIndex:-1}),o.add(e),t=!0):e=e[0],e.badTrackers&&""!=e.badTrackers||(e.badTrackers="{}",t=!0),A=e.totalAllTimeSocialTrackers||0,w=e.totalAllTimeTrackers,N=JSON.parse(e.dailyTrackerCounts),D=JSON.parse(e.badTrackers),M=JSON.parse(e.currentBadge),P=e.currentBadgeIndex,t&&o.flush()}),s.getOldData(function(r){function o(i){var r=new t(i,a);ABINE_DNTME.dnt_api=r,r.forceSaveStats=function(){b()},r.getAllTimeTotalTrackers=function(){return w},r.addListener("config-changed",function(e){n.setItem("dnt-settings",JSON.stringify(e))}),r.addListener("update-count",g),r.addListener("tracker-found",m),e.on("contentManager:init",function(e,t){r.triggerUpdateIcon(t),(-1!=e.url.indexOf("dntmeTour=")||-1!=e.url.indexOf("dntmeFullTour="))&&ABINE_DNTME.require(["abine/tour"],function(e){e.show(t)})}),e.on("toolbar:clicked",function(t){var n=t.tabId;l.panelsModule.doToolbarPanelAction(n)||e.send("background:dntme:show",{tabId:n,page:"dashboard"},n),l.licenseModule.logAction({user_action:"clicked icon"})}),f()}r&&"trackerMap"in r&&(ABINE_DNTME.dntme_upgrade=!0);try{p(r,i,o)}catch(s){!0&&ABINE_DNTME.log.error("*** error during upgrade from 2.0\n"+s+"\n"+s.stack),o(i)}})}"undefined"!=typeof ABINE_DNT&&(ABINE_DNT.browser=ABINE_DNTME.config.browser.toLowerCase());var E,_,T=864e5,k={"Facebook Connect":1,"Google +1":1,"Twitter Badge":1,LinkedIn:1},w=0,A=0,N=null,D=null,M=null,P=-1,S=!1,C=0,I=function(){var e=new Date;return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e},x=e.debounce(function(){var e=c.compute(w);if(-1!=e.badgeIndex&&e.badgeIndex!=P){var t=e.badgeIndex-P;t>0&&(r.Preference.createOrIncrementByInteger({key:"cardsEarned",value:t},function(){}),d.hasPassword()&&l.licenseModule.incrementMedalsEarned(t,function(){})),P=e.badgeIndex,M=e.badge,r.DntStats.index(null,function(e){var e=e[0];e.viewedBadge=!1,e.earnedOn=Date.now(),e.currentBadge=JSON.stringify(M),e.currentBadgeIndex=P,o.flush()})}},3e3),O=e.debounce(b,5e3);return{initialize:function(e){_=e,ABINE_DNTME.dnt_api||v(_),d.on("background:securityManager:unlocked",function(){r.Preference.findBy("key","handledFirstAuth",function(e){e||r.Preference.createOrModify({key:"handledFirstAuth",value:!0},function(){r.Preference.findBy("key","cardsEarned",function(e){var t=!0;e&&(t=!1),l.licenseModule.incrementMedalsEarnedWithCurrentMedals(t,function(){})})})})})},getTotalBlockedInThisInstance:function(){return C},updateRules:u}}),ABINE_DNTME.define("abine/dropbox-api",["documentcloud/underscore","abine/core","abine/localStorage","storage","abine/timer","persistence","modules","abine/securityManager","dropbox","abine/crypto"],function(e,t,n,i,r,a,o,s,c,l){function d(e,t,n,i){var r=i,a=e.getSyncStatus();if(!a.uploading)for(var o=0;f>o&&r<n.length;r++,o++){var s=n[r],c=t.getOrInsert(s.id,s);c.update(s)}r<n.length&&setTimeout(function(){d(e,t,n,r)},500)}function u(e){var t=e.getSyncStatus();return t.uploading?(setTimeout(function(){u(e)},500),void 0):(e.close(),void 0)}var f=500,h=t.BaseClass.extend({initialize:function(){this.tables={}},connect:function(){this._pendingConnect||(this._connected=!1,this._pendingConnect=!0,o.licenseModule.retrieveSyncstoreToken(e.bind(function(t,n){return t||!n.token||""==n.token||"dropbox"!=n.manager?(this._pendingConnect=!1,void 0):(this.client=new c.Client({key:n.dropbox_app_key,token:n.token}),this.client.authenticate({interactive:!1},e.bind(function(t){t?this._pendingConnect=!1:this.client.getDatastoreManager().openDefaultDatastore(e.bind(function(t,n){return t?(this._pendingConnect=!1,void 0):(this._connected=!0,this._pendingConnect=!1,this.datastore=n,this.updateAll(),this.updateListener=e.bind(this.updateAll,this),n.recordsChanged.addListener(this.updateListener),void 0)},this))},this)),void 0)},this)))},connectAndLoad:function(){this._connected||this.connect()},disconnect:function(){this._connected&&this.datastore.recordsChanged.removeListener(this.updateListener),this._connected=!1,this.datastore&&u(this.datastore),this.datastore=null},addTable:function(e){this.tables[e]=1},updateAll:function(t){if(t){if(!t.isLocal()){var n=t.affectedRecordsByTable();if("Disconnect."+s.getUserId()in n)return this.disconnect(),void 0;for(var r in n)r=r.replace(/\.[0-9]+/,""),r in i&&this.load(r)}}else e.each(this.tables,e.bind(function(e,t){this.load(t)},this))},load:function(t){if(this._connected){var n=i[t],r=null;n.meta.encrypted&&(r=s.getEncryptionKey());var o=!1,c=this.datastore.getTable(t+"."+s.getUserId()),d=c.query(),u={},f=[],h=!0;e.each(d,function(e){if(e=e.getFields(),n.meta.encrypted&&!o){var t=l.decryptObject(r,e,n.meta.encryptedFields,h);h=!1,1==t?o=!0:2==t&&f.push(e)}u[e.id]=e}),o||n.index(null,e.bind(function(n){e.each(n,function(t){1==t.pushed?t.id in u?(e.extend(t,u[t.id]),delete u[t.id]):a.remove(t):(t.markDirty("pushed"),t.id in u&&delete u[t.id])}),e.each(u,function(e){a.add(new i[t](e))}),a.flush(),f.length>0&&(e.each(f,e.bind(function(e){e.pushed=0},this)),this.save(t))},this))}},save:function(t){if(this._connected){var n=i[t],r=null;n.meta.encrypted&&(r=s.getEncryptionKey());var o=!1,c=this.datastore,u=c.getTable(t+"."+s.getUserId()),f=[];n.index(null,function(t){e.each(t,function(e){if(0==e.pushed){e.pushed=1,o=!0;var t=e.toJSON();n.meta.encrypted&&r&&l.encryptObject(r,t,n.meta.encryptedFields),f.push(t)}}),o&&(a.flush(),d(c,u,f,0))})}}});return new h}),ABINE_DNTME.define("abine/emailServer",["documentcloud/underscore","abine/ajax","abine/config","abine/server","abine/core"],function(e,t,n,i,r){var a=n.protocol+n.emailServerHost,o=a+"/api/v3/disposables",s=a+"/api/v3/disposables",c=r.BaseClass.extend({initialize:function(e){this.options=this.options||e||{},this.server=this.options.server||new i.server},readDisposables:function(e,t){this.server.makeRequest({server:"email",action:"readDisposables",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:o,type:"GET"})},generateDisposable:function(e,t){this.server.makeRequest({server:"email",action:"generateDisposable",defaults:{domain:n.disposableDomain},required:["domain","label"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:s,type:"POST"})}});return c}),ABINE_DNTME.define("abine/licenseServer",["documentcloud/underscore","abine/ajax","abine/config","abine/server","abine/core","abine/responseCodes"],function(e,t,n,i,r){var a=n.protocol+n.licenseServerHost,o=a+"/api/v2/users",s=a+"/api/v2/sessions",c=a+"/api/v2/touches",l=a+"/api/v2/billing_info",d=a+"/api/v2/feedback_email",u=a+"/api/v2/panel_data",f=a+"/api/v3/signatures",h=a+"/api/v3/subscriptions",p=a+"/api/v3/medals",m=a+"/api/v2/log_action",g=a+"/api/v2/log_split_data",y=a+"/api/v2/log_password_fill_data",b=a+"/api/v3/syncstore",v=a+"/api/v2/devices",E=r.BaseClass.extend({initialize:function(e){this.options=this.options||e||{},this.server=this.options.server||new i.server},logAction:function(e,t){this.server.makeRequest({server:"license",action:"logAction",defaults:{},required:["user_action"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:m,type:"POST"})},logSplitData:function(e,t){this.server.makeRequest({server:"license",action:"logSplitData",defaults:{},required:["bucket_id"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:g,type:"POST"})},logPasswordFillData:function(e,t){this.server.makeRequest({server:"license",action:"logPasswordFillData",defaults:{},required:["choice","domain"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:y,type:"POST"})},sendPanelActivity:function(e,t){this.server.makeRequest({server:"license",action:"sendPanelActivity",defaults:{},required:["panel_data"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:u,type:"POST"})},login:function(e,t){this.server.makeRequest({server:"license",action:"login",defaults:{},required:["user_login","application"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:s,type:"POST"})},register:function(e,t){this.server.makeRequest({server:"license",action:"register",defaults:{},required:["user","application"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:o,type:"POST"})},signature:function(e,t){this.server.makeRequest({server:"license",action:"signature",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:f,type:"GET"})},subscribed:function(e,t){this.server.makeRequest({server:"license",action:"subscribed",defaults:{},required:["recurly_token"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:h,type:"POST"})},refreshEntitlements:function(e,t){this.server.makeRequest({server:"license",action:"refreshEntitlements",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:o,type:"GET"})},makeDailyTouch:function(e,t){this.server.makeRequest({server:"license",action:"makeDailyTouch",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:c,type:"POST"})},sendFeedbackEmail:function(e,t){this.server.makeRequest({server:"license",action:"sendFeedbackEmail",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:d,type:"POST"})},billingInfo:function(e,t){this.server.makeRequest({server:"license",action:"billingInfo",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:l,type:"GET"})},retrieveMedalsEarned:function(e,t){this.server.makeRequest({server:"license",action:"retrieveMedalsEarned",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:p,type:"GET"})},incrementMedalsEarned:function(e,t){this.server.makeRequest({server:"license",action:"incrementMedalsEarned",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:p,type:"PUT"})},retrieveSyncstoreToken:function(e,t){this.server.makeRequest({server:"license",action:"retrieveSyncstoreToken",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:b,type:"GET"})},retrieveDevices:function(e,t){this.server.makeRequest({server:"license",action:"retrieveDevices",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:v,type:"GET"})}});return E}),ABINE_DNTME.define("abine/lruCache",[],function(){var e=function(e){var t={},n=e,e=0,i=null,r=null;this.add=function(a,o){var s={id:a,data:o,previous:null,next:i};if(t[a]=s,i&&(i.previous=s),i=s,e===n){var c=r;r=r.previous,r.next=null,delete t[c.id],delete c}else 0===e&&(r=s),e++},this.fetch=function(n){var a=t[n];if(a){if(e>1){var o=a.previous,s=a.next;r==a?r=o:i!=a&&(o.next=s,s.previous=o),a.previous=null,a.next=i,i.previous=a,i=a}return a.data}return null}};return e}),ABINE_DNTME.define("abine/mappingServer",["documentcloud/underscore","abine/ajax","abine/config","abine/server","abine/core"],function(e,t,n,i,r){var a=n.protocol+n.mappingServerHost,o=a+"/api/v2/mappings/manifest",s=a+"/api/v2/mappings/latest",c=a+"/api/v2/panels",l=function(){},d=r.BaseClass.extend({initialize:function(e){this.options=this.options||e||{},this.server=this.options.server||new i.server},sendPanelActivity:function(e,t){t=t||l,this.server.makeRequest({server:"mapping",action:"getMappingManifest",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:o,type:"POST"})},getMappingManifest:function(e,t){this.server.makeRequest({server:"mapping",action:"getMappingManifest",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:o,type:"POST"})},getFormMappings:function(e,t){this.server.makeRequest({server:"mapping",action:"getFormMappings",defaults:{},required:["signatures"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:s,type:"POST"})},getPanels:function(e,t){this.server.makeRequest({server:"mapping",action:"getPanels",defaults:{},required:["browser","tag","user_state"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:c,type:"GET"})}});return d}),ABINE_DNTME.define("abine/memoryStore",["documentcloud/underscore","abine/core","abine/lruCache"],function(e,t,n){var i=new n(1e3);return{set:function(e,t){i.add(e,t)},get:function(e,t){t(i.fetch(e))}}}),ABINE_DNTME.define("abine/pageEvents",["documentcloud/underscore","abine/core","abine/securityManager","abine/config","storage","abine/timer","persistence","abine/modules/license","abine/window","abine/dntmeUpgrade","abine/url","abine/localStorage","abine/webapp"],function(e,t,n,i,r,a,o,s,c,l,d,u,f){var h=null,p=function(){};h="development"==i.environment?/.*/i:/^(.+\.)?abine\.com$/i;var m=t.BaseClass.extend({initialize:function(){},processAction:function(e,t){if(t=t||p,-1!=e.host.indexOf(ABINE_DNTME.config.webAppHost.replace(/:[0-9]+/,""))){if("importAccounts"==e.action&&(ABINE_DNTME.maskme_installed=!1),ABINE_DNTME.maskme_installed)return t(),void 0;switch(e.action){case"setAuthToken":this.setAuthToken(e.params,t);break;case"retrieveAuthToken":this.retrieveAuthToken(e.params,t);break;case"email:created":this.emailCreated(e.params,t);break;case"email:deleted":this.emailDeleted(e.params,t);break;case"refreshData":this.refreshData(e.params,t);break;case"retrieveDntStats":this.retrieveDntStats(e.params,t);break;case"retrieveDntData":this.retrieveDntData(e.params,t);break;case"retrieveInstallAuthToken":this.retrieveInstallAuthToken(e.params,t);break;case"migrationComplete":this.migrationComplete(e.params,t);break;case"dntNewFeaturePageVisited":this.newFeaturePageVisited(e.params,t);break;case"importAccounts":this.importAccounts(e.params,t);break;case"retrieveEntities":this.retrieveEntities(e.params,t);break;case"updateEntity":this.updateEntity(e.params,t);break;case"deleteEntity":this.deleteEntity(e.params,t);break;case"resetEntity":this.resetEntity(e.params,t);break;case"connectEntityEvents":this.connectEntityEvents(e.params,t);break;case"disconnectEntityEvents":this.disconnectEntityEvents(e.params,t);break;case"loginAccount":this.loginAccount(e.params,t);break;case"getBrowserLoginCount":this.getBrowserLoginCount(e.params,t);break;case"getBrowserLogins":this.getBrowserLogins(e.params,t);break;case"dropbox:setup:complete":this.refreshData(e.params,t),f.reload();break;default:e.action&&0==e.action.indexOf("retrieveEntities")?this.retrieveEntities(e.params,t):t()}}else if(e.host.match(h)){switch(e.action){case"getVersion":t({version:ABINE_DNTME.config.version,tag:ABINE_DNTME.config.tags[0]});break;case"getDailyTotals":this.getDailyTotalsByYear(e.params[0],t);break;case"getBadTrackerTotals":this.getBadTrackerTotals(t)}t()}else t()},setAuthToken:function(e){n.setAuthToken(e.auth_token,e.key)},retrieveAuthToken:function(e,t){r.Preference.findBy("key","key",function(e){r.Preference.findBy("key","authToken",function(n){n&&""!=n.value?t({auth_token:n.value,key:e?e.value:""}):t(null)})})},importAccounts:function(t,i){var a=[];try{t.id&&t.key&&n.__setUserIdAndKey(t.id,t.key),r.Account.clearCache(function(){r.Account.index(null,function(s){var c={};e.each(s,function(e){c[e.id]=!0,a.push(e.toJSON())}),e.each(t.accounts,function(e){if(!(e.id in c)){e.domain=d.getTLD(e.domain);var t=new r.Account(e);o.add(t),a.push(t.toJSON())}}),r.Account.saveToLocalStorage(function(){t.id&&t.key&&n.__setUserIdAndKey(null,null),i(a)})})})}catch(s){}},retrieveEntities:function(t,n){var i=[];if(r[t])try{return r[t].decryptionFailed?(n("decryption failed"),void 0):(r[t].index(null,function(t){e.each(t,function(e){i.push(e.toJSON())}),n(i)}),void 0)}catch(a){}n(i)},updateEntity:function(t,n){if(r[t.name]){var i=t.entity;r[t.name].findBy("id",i.id,function(a){a?e.extend(a,i):(a=new r[t.name](i),o.add(a)),o.flush(),n()})}else n()},deleteEntity:function(e,t){if(r[e.name]){var n=e.id;r[e.name].findBy("id",n,function(e){e&&(o.remove(e),o.flush()),t()})}else t()},resetEntity:function(e,t){var n=r[e.name];n?n.clearCache(function(){e.user_id?u.removeItem(e.name+"."+e.user_id):u.removeItem(e.name),t()}):t()},connectEntityEvents:function(t,n){t&&t.split||(t="Account:entity:changed"),this.entityChangeListener&&this.disconnectEntityEvents(t),this.entityChangeListener=e.bind(function(e){this.trigger("entity:changed",e)},this),e.each(t.split(" "),e.bind(function(e){o.GlobalEvent.addEventListener(e,this.entityChangeListener)},this)),n("connected")},disconnectEntityEvents:function(t,n){this.entityChangeListener&&(t&&t.split||(t="Account:entity:changed"),e.each(t.split(" "),e.bind(function(e){o.GlobalEvent.removeEventListener(e,this.entityChangeListener)},this))),this.entityChangeListener=null,n&&n()},emailCreated:function(e){var t=new r.DisposableEmail(e);t.createdAt=e.created_at,o.add(t)},emailDeleted:function(e){r.DisposableEmail.findBy("guid",e.guid,function(e){e&&(o.remove(e),o.flush())})},refreshData:function(){o.reset(),n.refreshData()},loginAccount:function(e,t){var e=r.Account.findBy("id",e,function(t){r.LoginUrl.loginUrlForSite({params:[t.domain]},function(i){(i||t&&t.login_url&&t.login_url.length>0)&&r.Preference.batchCreateOrModify([{key:"autoLoginHost",value:t.domain},{key:"autoLoginEvents",value:i&&i.events?i.events:""},{key:"autoLoginSubmitBtn",value:i&&i.submit_btn?i.submit_btn:""},{key:"autoLoginAccount",value:e}],function(){n.openPage(i?i.href:t.login_url)})})});t()},getBrowserLoginCount:function(e,t){return"Firefox"==ABINE_DNTME.config.browser?(ABINE_DNTME.require(["abine/firefox_import"],function(e){t(e.getLoginCount())}),void 0):(t(-1),void 0)},getBrowserLogins:function(e,t){return"Firefox"==ABINE_DNTME.config.browser?(ABINE_DNTME.require(["abine/firefox_import"],function(e){t(e.getLogins())}),void 0):(t(null),void 0)},migrationComplete:function(){r.Preference.findBy("key","mergedMigrationPending",function(e){e&&(o.remove(e),o.flush())})},retrieveDntStats:function(e,t){ABINE_DNTME.dnt_api.forceSaveStats(),r.DntStats.index(null,function(e){e.length>0?t(e[0].toJSON()):t(null)})},retrieveInstallAuthToken:function(e,t){r.Preference.findBy("key","installAuthToken",function(e){e&&""!=e.value?t({installAuthToken:e.value}):t(null)})},getDailyTotalsByYear:function(e,t){r.DntStats.index(null,function(n){if(n.length>0){var i=n[0],r=JSON.parse(i.dailyTrackerCounts);if(e in r)return r[e].hasBadTrackers=!0,t(r[e]),void 0}t({})})},getBadTrackerTotals:function(e){r.DntStats.index(null,function(t){if(t.length>0){var i=t[0],r=JSON.parse(i.badTrackers);if(!r.totals)return e({}),void 0;var a=(new Date).getFullYear(),o=r.totals,s={},c=[a,a-1];for(var l in o)for(var d=0;d<c.length;d++){var u=l+"."+c[d];r.daily&&u in r.daily&&(s[l]={},s[l][c[d]]=r.daily[u])}var f={};return n.getLink({},function(t){for(var n in o)f[n]=t+"&type=badTracker."+n;e({totals:o,daily:s,links:f})}),void 0}e({})})},retrieveDntData:function(e,t){l.getMaskmeData(t)},newFeaturePageVisited:function(e,t){r.Preference.createOrModify({key:"new_feature_explored",value:(new Date).toString()},function(){t()})}});return new m({})}),ABINE_DNTME.define("abine/paymentsServer",["documentcloud/underscore","abine/ajax","abine/config","abine/server","abine/core"],function(e,t,n,i,r){var a=n.protocol+n.paymentsServerHost,o=a+"/api/v3/cards",s=a+"/api/v3/cardcredit/client",c=a+"/api/v3/cardfee",l=a+"/api/v3/verify_card_request",d=r.BaseClass.extend({initialize:function(e){this.options=this.options||e||{},this.server=this.options.server||new i.server},createCard:function(e,t){this.server.makeRequest({server:"payments",action:"createCard",defaults:{},required:["request_id","amount","domain","card_use"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:o,type:"POST"})},retrieveCardCredit:function(e,t){this.server.makeRequest({server:"payments",action:"retrieveCardCredit",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:s,type:"GET"})},retrieveCardFee:function(e,t){this.server.makeRequest({server:"payments",action:"retrieveCardFee",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:c,type:"GET"})},verifyCardRequest:function(e,t){this.server.makeRequest({server:"payments",action:"verifyCardRequest",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:l,type:"GET"})}});return d}),ABINE_DNTME.define("abine/phoneServer",["documentcloud/underscore","abine/ajax","abine/config","abine/server","abine/core"],function(e,t,n,i,r){var a=n.protocol+n.phoneServerHost,o=a+"/api/v3/shieldedphones",s=r.BaseClass.extend({initialize:function(e){this.options=this.options||e||{},this.server=this.options.server||new i.server},getPhone:function(e,t){this.server.makeRequest({server:"phone",action:"getPhone",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:o,type:"GET"})}});return s}),ABINE_DNTME.define("abine/saveForms",["documentcloud/underscore","abine/formSubmitDetector","abine/core","abine/formAnalyzer","storage","persistence","abine/url","abine/securityManager","abine/timer"],function(e,t,n,i,r,a,o,s,c){function l(e,t){var n=e.tabId;e=e.formData;var i=p[n];if(t&&delete p[n],i&&!s.isLocked()){e.metrics=i.metrics;var a=e.domain;r.Blacklist.findBy("domain",a,function(a){var o=a?a.account:!1;r.Preference.findBy("key","rememberAccounts",function(r){(i.saveRequired||r&&!r.isFalse()&&!o)&&(i.saveRequired?(h(e),delete p[n]):t&&d(e)&&(f(e,function(t){var r=null;if(t?t.password!=i.password&&(t.password&&t.password.length>0?r="change_password":h(e)):r="login",r){var a={type:r,account:i,neverFade:!0,panelWidth:420};m[n]=a}}),delete p[n]))})})}}function d(e){var t=e.email&&e.email.length>0,n=e.password&&e.password.length>0,i=e.username&&e.username.length>0;return n&&(t||i)||n&&e.generated_password}function u(e){var t=p[e.tabId]||{};if(t.saveInProgress)return c.setTimeout(function(){u(e)},100),void 0;t&&t.id!=e.formData.id&&t.saveRequired&&d(t)&&(h(t),delete p[t.tabId],t={});var n=!1,i=e.fieldData.origin;(t.saveRequired||i&&i.match(/disposable|primary|strong/i))&&(n=!0);var r=t.metrics||{};t=e.formData,t.saveRequired=n,t.metrics=r,p[e.tabId]=t,n&&d(t)&&h(t)}function f(e,t){r.Account.findBy("id",e.id,function(n){if(!n){var i=function(t){return e.domain==t.domain&&(e.email&&e.email.length>0&&(t.email==e.email||t.username==e.email)||e.username&&e.username.length>0&&(t.username==e.username||t.email==e.username))};return r.Account.listCached(i,function(e){0==e.length?t(null):t(e[0])}),void 0}t(n)})}function h(e){function t(t){t.domain=e.domain,t.page_host=e.page_host,t.form_host=e.form_host,t.protocol=e.protocol,t.email=e.email||"",t.username=e.username||"",t.password=e.password||"",t.login_url=e.login_url||"",t.times_used=0,t.pushed=0,t.modifiedAt=new Date,a.flush();var n=e.metrics||{};for(var i in n)r.PanelActivity[i]({payload:{panelId:7000005,revert:!0}});e.metrics={},e.generated_password&&e.email&&-1!=e.email.indexOf(ABINE_DNTME.config.disposableDomain)?e.metrics.addMasked=!0:e.generated_password?e.metrics.addClosed=!0:e.email&&-1!=e.email.indexOf(ABINE_DNTME.config.disposableDomain)?e.metrics.addImpression=!0:e.metrics.addDisclosed=!0;for(var i in e.metrics)r.PanelActivity[i]({payload:{panelId:7000005}});delete e.saveInProgress}e.saveInProgress=!0,f(e,function(n){n||(n=new r.Account({id:e.id}),n.createdAt=new Date,a.add(n)),t(n)})}var p={},m={},g=n.BaseClass.extend({init:function(t){this.messenger=t,this.messenger.on("contentManager:init",function(e,t){p[t]&&l({tabId:t,formData:p[t]},!0)}),this.messenger.on("contentManager:formsInitialized",function(t,n){var r=m[n];if(r){delete m[n];var a=r.account,o=t.hasLogin;o||e.each(t.forms,function(e){!o&&"loginForm"==e.type&&e.visible&&i.isMatchingForm(e,a)&&(o=!0)}),o||y.messenger.send("background:saveForm:notification",r,n)}}),this.messenger.on("background:save:account",function(e,t){delete m[t],e.pageUrl&&e.pageUrl.match(/^http[s]?:\/\//i)&&(e.login_url=e.pageUrl),h(e)})}}),y=new g;return t.formSubmitDetector.on("background:formSubmit",l),t.formSubmitDetector.on("background:formFieldChanged",u),y}),ABINE_DNTME.define("abine/securityManager",["documentcloud/underscore","abine/core","storage","persistence","abine/timer","abine/config","abine/window"],function(e,t,n,i,r,a,o){function s(e,t){t=t||p,ABINE_DNTME.require(["abine/memoryStore"],function(e){e.set("login-panel-ignored",0),e.set("login-panel-closed",null)}),g.refreshData(function(){g.trigger("background:securityManager:unlocked",e),t(null,e)})}var c=!0,l=!1,d=null,u=!1,f=null,h=null,p=function(){},m=t.BaseClass.extend({initialize:function(){},load:function(e){e&&(this.messenger=e);var t=function(){u=!0;var e=function(){g.trigger("background:securityManager:initialized")};c||s(),e()},i=this;n.Preference.findBy("key","authToken",function(e){n.Preference.findBy("key","key",function(n){e&&""!=e.value?(l=!0,c=!1,d=e.value,i.setEncryptionKey(n?n.value:null,t)):(c=!0,l=!1,d=null,i.setEncryptionKey(null,t))})})},getUserId:function(){return h},setUserId:function(e){h=e},getEncryptionKey:function(){return f},setEncryptionKey:function(e,t){function i(){n.Account.clearCache(function(){n.Address.clearCache(function(){n.Note.clearCache(function(){n.RealCard.clearCache(t)})})})}if(t=t||p,e&&""!=e&&"undefined"!=e){if(f!=e)return f=e,n.Preference.createOrModify({key:"key",value:e},function(){i()}),void 0}else if(null!=f)return f=null,i(),void 0;t()},__setUserIdAndKey:function(e,t){h=e,f=t&&""!=t&&"undefined"!=t?t:null},setAuthToken:function(t,r,a){a=a||p;var o=t&&t.length>0;n.Preference.findBy("key","authToken",e.bind(function(u){return u&&u.value==t&&t==d?(this.setEncryptionKey(r,function(){o&&g.refreshData(a)}),void 0):(i.reset(),this.setEncryptionKey(r,e.bind(function(){n.Preference.findBy("key","hasRegistered",e.bind(function(i){n.Preference.batchCreateOrModify([{key:"authToken",value:t},{key:"key",value:r},{key:"oldHasRegistered",value:i?i.value:"false"},{key:"hasRegistered",value:o?"true":"false"}],e.bind(function(){t&&""!=t?(c=!1,l=!0,d=t,s(null,a)):(c=!0,d=null,ABINE_DNTME.require(["abine/dropbox-api"],function(e){e.disconnect()}),n.Preference.retainDefaults(e.bind(function(){this.messenger.broadcastToAllTabs("broadcast:preference:reload",{}),g.trigger("background:securityManager:locked"),a()},this)))},this))},this))},this)),void 0)},this))},login:function(){o.reloadTab({url:("production"==ABINE_DNTME.config.environment?"http://":"http://")+ABINE_DNTME.config.webAppHost})},isProxyRunning:function(){return ABINE_DNTME.googleSharingManager&&ABINE_DNTME.googleSharingManager.isEnabled()
},openPage:function(e,t){if(t===!0){var n="";e.match(/[&\?]$/)||(n="&"),n+="v="+ABINE_DNTME.config.version,n+="&tag="+ABINE_DNTME.config.tags[0],e+=n}else t&&(ABINE_DNTME.lastPanel||(ABINE_DNTME.lastPanel={}),ABINE_DNTME.lastPanel[t.action]=t.id);0!==e.indexOf("http")&&(e.match(/^\//)||(e="/"+e),e=("production"==ABINE_DNTME.config.environment?"http://":"http://")+ABINE_DNTME.config.webAppHost+e),o.createTab({url:e})},openPostInstall:function(){n.Preference.findBy("key","postInstallUrl",e.bind(function(e){e&&e.value&&this.openPage(e.value)},this))},openWindow:function(e,t,n){o.openWindow(e,t,n)},openLink:function(e){this.getLink(e,function(e){o.createTab({url:e})})},getLink:function(e,t){e.lang="en",e.v=ABINE_DNTME.config.version,n.Preference.batchFindBy([{by:"key",value:"installVersion"},{by:"key",value:"installDate"}],function(n){if(n.installVersion&&(e.ov=n.installVersion.value),n.installDate){var i=new Date(parseInt(n.installDate.value));e.cohort=i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate()}e.o=ABINE_DNTME.config.tags[0];var r="";for(var a in e)r+=""==r?"?":"&",r+=encodeURIComponent(a)+"="+encodeURIComponent(e[a]);t("http://donottrackplus.com/link.php"+r)})},isLocked:function(){return c},hasPassword:function(){return l},isInitialized:function(){return u},isMaskmeInstalled:function(){return ABINE_DNTME.maskme_installed},refreshRules:function(){ABINE_DNTME.require(["abine/dntmeInit"],function(e){e.updateRules()})},refreshData:function(t,r){function a(){e.each(o._refreshCallbacks,function(e){try{e()}catch(t){}}),delete o._refreshCallbacks,delete o._refreshInProgress}if(t&&t!==!0&&(r=t,t=!1),r=r||p,this._refreshInProgress)return this._refreshCallbacks.push(r),void 0;this._refreshCallbacks=[r],this._refreshInProgress=!0;var o=this;ABINE_DNTME.require(["modules","abine/modules/mappings","abine/modules/panels"],function(r){function o(t){n.Preference.batchFindBy([{by:"key",value:"oldHasRegistered"},{by:"key",value:"hasRegistered"},{by:"key",value:"hasEnabledPayments"},{by:"key",value:"entitledToPhone"}],e.bind(function(e){var n="unregistered",r=!1;e.oldHasRegistered&&(i.remove(e.oldHasRegistered),e.hasRegistered=e.oldHasRegistered),e.hasRegistered&&e.hasRegistered.isTrue()&&(e.entitledToPhone&&e.entitledToPhone.isTrue()?(n="premium",e.hasEnabledPayments&&e.hasEnabledPayments.isTrue()&&(r=!0)):n="registered"),t(n,r)},this))}function s(){t?r.mappingsModule.makeDailyMappingCheck():r.mappingsModule.refreshPanels(t)}o(e.bind(function(t,c){n.Preference.retainDefaults(function(){r.licenseModule.refreshEntitlements(function(l,d){n.ShieldedEmail.cached=!0,g.setUserId(null),l?(s(),a()):(g.setUserId(d.user.id),n.Preference.createOrModify({key:"sync_store_manager",value:d.user.sync_store_manager}),r.licenseModule.retrieveDevices(),n.clearAllCache(d.user.sync_store_manager,e.bind(function(){o(e.bind(function(o,l){var u=[];"unregistered"==t&&"unregistered"!=o&&u.push("open_registration_page"),"premium"!=t&&"premium"==o&&(u.push("open_plans_page"),u.push("open_snowman_page")),!c&&l&&u.push("open_activate_cards_page"),e.async.forEach(u,function(e,t){r.panelsModule.panelConversionCheck(e,t)},s),n.ShieldedEmail.findBy("email",d.user.email,function(e){e&&i.remove(e),n.Preference.createOrModify({key:"oldEmail",value:d.user.email}),e=new n.ShieldedEmail({email:d.user.email}),i.add(e),n.DisposableEmail.indexFromServer(null,function(){n.Preference.findBy("key","entitledToPhone",function(e){return!e||e.isFalse()?(a(),void 0):(r.phoneModule.getPhone(null,function(e,t){if(n.ShieldedPhone.cached=!0,e||!t.shielded_phone)return a(),void 0;var r=t.shielded_phone;n.ShieldedPhone.findBy("number",r.number,function(e){if(e&&i.remove(e),e=new n.ShieldedPhone({country_code:r.country_code,number:r.number,is_validated:r.is_validated?"true":"false",rails_id:r.id}),i.add(e),r.disposable_phones.length>0){var t=r.disposable_phones[0];n.DisposablePhone.findBy("number",t.number,function(r){r&&i.remove(r),r=new n.DisposablePhone({country_code:t.country_code,number:t.number,rails_id:t.id,shielded_phone_id:e.id}),i.add(r),a()})}else a()})}),void 0)})})})},this))},this)))})})},this))})}}),g=new m;return g}),ABINE_DNTME.define("abine/server",["documentcloud/underscore","abine/ajax","abine/config","storage","abine/core","abine/responseCodes","abine/window","persistence","abine/timer","abine/securityManager","abine/localStorage"],function(e,t,n,i,r,a,o,s,c,l,d){var u=function(){},f=function(e,t){i.Preference.findBy("key","authToken",function(n){i.Preference.findBy("key","installAuthToken",function(i){var r=!n||n.isEmpty()?null:n.value,a=!i||i.isEmpty()?null:i.value;r&&(e.data.auth_token=r),a&&(e.data.install_auth_token=a),t.call(this,e)})})},h=function(e,t){var i=n.version;ABINE_DNTME.dntme_upgrade&&!ABINE_DNTME.merged_data_available&&(i="dnt2-"+i),e.data.client_application.version=i,e.data.client_application.environment=n.environment,e.data.client_application.tag=n.tags[0],e.data.client_application.browser=n.browser,e.data.client_application.build_num=n.buildNum,e.data.client_application.user_agent=ABINE_DNTME.userAgent,e.data.client_application.product="DNT3",e.data.client_application.device="Extension";var r=d.getItem("device_id");r||(r=Math.floor(1e8*Math.random()),d.setItem("device_id",r)),e.data.client_application.device_id=r,t.call(this,e)},p=r.BaseClass.extend({makeRequest:function(n){n.defaults=n.defaults||{},n.required=n.required||[],n.data=e.defaults(n.data||{},n.defaults),n.type=n.type||"POST",n.dataType=n.dataType||"json";var i=n.success||u,r=n.error||u;return n.data.client_application||(n.data.client_application={}),n.success=e.bind(function(e,t,n){var o=n.status,s=e.data;"scheduled downtime"==e.error_code?r(o,a.SCHEDULED_DOWNTIME,{error_code:a.SCHEDULED_DOWNTIME}):i(s,o)},this),n.error=e.bind(function(e){var t=e.status,n={error_code:a.UNKNOWN_ERROR};try{n=JSON.parse(e.responseText)}catch(i){}var o=n.error_code;500==t?o=a.UNKNOWN_ERROR:503==t&&(o=a.SERVICE_UNAVAILABLE_ERROR),o==a.UNAUTHORIZED&&l.setAuthToken("",""),r(t,o,n)},this),this.hasRequiredParams(n.required,n.data)?(f(n,function(e){h(e,function(e){t.ajax(e)})}),void 0):(!0&&ABINE_DNTME.log.error("[ERROR HANDLER]#["+n.server+"]#["+n.action+"]# client missing required parameters"),r(422,a.MISSING_PARAMETERS,{}),void 0)},hasRequiredParams:function(t,n){var i=!0;return e.each(t,e.bind(function(t){(!e.has(n,t)||this.isEmpty(n[t]))&&(i=!1)},this)),i},isEmpty:function(e){return null===e||void 0===e||0/0===e||""===e}}),m=p.extend({makeRequest:function(e){if(!e.url)throw"server calls must have a url";e.data=e.data||{},e.type=e.type||"POST",e.dataType=e.dataType||"json";var t=e.success||u,n=e.error||u;e.success=function(e,n,i){var r=i.status,a=e.data;t(a,r,this)},e.error=function(e){var t=e.status,i={error_code:a.UNKNOWN_ERROR};try{i=JSON.parse(e.responseText)}catch(r){}var o=i.error_code;500==t&&(o=a.UNKNOWN_ERROR),n(t,o,i)},e.data.client_application||(e.data.client_application={}),this.lastRequest=e,this.tokenSet=!1;var i=this;f(e,function(e){h(e,function(){i.tokenSet=!0,i.waitingRequest&&(i.waitingRequest(),delete i.waitingRequest)})}),this.trigger("request:made")},respondWithSuccess:function(t,n,i){return this.tokenSet?(this.lastRequest.success.call(this.lastRequest,t,n,i),delete this.lastRequest,void 0):(this.waitingRequest=e.bind(this.respondWithSuccess,this,t,n,i),void 0)},respondWithError:function(t,n,i){return this.tokenSet?(this.lastRequest.error=!0,this.lastRequest.error.call(this.lastRequest,t,n,i),delete this.lastRequest,void 0):(this.waitingRequest=e.bind(this.respondWithError,this,t,n,i),void 0)}});return{server:p,mock:m}}),ABINE_DNTME.define("abine/storageMixins",["documentcloud/underscore","persistence","abine/localStorage","abine/crypto","abine/securityManager"],function(e,t,n,i,r){var a={index:function(e,n){var i=this;if(i.meta.cached&&i.cached){var r=t.getCachedEntities(i);i.respondWithEntities(r,e,n)}else if(i.cachingQueryInProgress)i.waitingCallbacks.push({req:e,cb:n});else{i.cachingQueryInProgress=!0,i.waitingCallbacks=[];try{i.meta.localStorage&&i.loadFromLocalStorage(),this.all().list(null,function(r){i.meta.cached&&(i.cached=!0);var a=i.waitingCallbacks;delete i.cachingQueryInProgress,delete i.waitingCallbacks;try{i.respondWithEntities(r,e,n)}catch(o){!0&&ABINE_DNTME.log.error(o)}for(var s=0;s<a.length;s++)try{r=t.getCachedEntities(i),i.respondWithEntities(r,a[s].req,a[s].cb)}catch(o){!0&&ABINE_DNTME.log.error(o)}t.GlobalEvent.triggerEvent(i.meta.name+":entity:changed")})}catch(a){var o=i.waitingCallbacks;delete i.cachingQueryInProgress,delete i.waitingCallbacks;for(var s=0;s<o.length;s++)try{i.respondWithEntities([],o[s].req,o[s].cb)}catch(a){!0&&ABINE_DNTME.log.error(a)}}}},isCached:function(){return this.meta.cached&&this.cached},show:function(e,t){var n=e.params[0];this.load(n,function(n){t?t.call(this,n):e.returnEntities&&e.returnEntities(n)})},create:function(e,n){var i=this;e.payload.createdAt=new Date,e.payload.modifiedAt=new Date;var r=new i(e.payload);t.add(r),t.flush(null,function(){n?n.call(this,r):e.returnEntities&&e.returnEntities(r)})},update:function(n,i){var r=n.params[0];n.payload.modifiedAt=new Date,this.load(r,function(r){e.extend(r,n.payload),t.flush(null,function(){i?i.call(this,r):n.returnEntities&&n.returnEntities(r)})})},destroy:function(e,n){var i=e.params[0];this.load(i,function(i){t.remove(i),t.flush(null,function(){n?n.call():e.returnStatus&&e.returnStatus("ok")})})},respondWithEntities:function(e,t,n){n?n.call(this,e):t&&t.returnEntities&&t.returnEntities(e)},respondWithJSON:function(e,t,n){n?n.call(null,e):t.returnJSON&&t.returnJSON(e)},clearCache:function(n){if(this.decryptionFailed=!1,!this.cached)return n&&n(),void 0;try{this.index(null,e.bind(function(i){e.each(i,function(e){t.clearFromEntityCache(e)}),this.cached=!1,n&&n()},this))}catch(i){}},listCached:function(t,n,i,r){if(!this.meta.cached)throw"listCached cannot be used with entities that do not have caching enabled.";"function"==typeof t?(i=t,r=n,t=null):r||(r=i,i=null),this.index(null,function(a){var o=[];e.each(a,function(e){t&&e[t]!=n||i&&!i(e)||o.push(e)}),r&&r(o)})},initCache:function(e){this.meta.cached&&!this.cached?this.index(null,function(){e()}):e()},useLocalStorage:function(){this.meta.localStorage=!0},useEncryption:function(e){this.meta.encrypted=!0,this.meta.encryptedFields=e||[]},useDropboxStorage:function(){this.meta.dropboxStorage=!0,this.meta.keepId=!0,ABINE_DNTME.require(["abine/dropbox-api"],e.bind(function(e){e.addTable(this.meta.name)},this))},loadFromLocalStorage:function(){var a=this,o=!1,s=null,c=a.meta.name,l=n.getItem(c),d=r.getUserId();d&&a.meta.encrypted&&(s=r.getEncryptionKey(),c+="."+d,l&&(n.getItem(c)||n.setItem(c,l),n.removeItem(a.meta.name)),l=n.getItem(c)),a.decryptionFailed=!1;var u=null;if(l&&""!=l){if(-1!=l.indexOf("ENC_")){if(l=l.substr(4),!s)throw a.decryptionFailed=!0,"encryption key not present for decrypting "+this.meta.name;var f=i.decryptKey(s,l,null,!0);if(f==l)throw a.decryptionFailed=!0,"decryption error for "+this.meta.name;l=f}else s&&(o=!0);try{u=JSON.parse(l)}catch(h){}}else u=this._defaults;u&&e.each(u,function(e){var n=new a(e);t.forceAdd(n),n._dirtyProperties={},n._new=!1}),this.meta.dropboxStorage&&ABINE_DNTME.require(["abine/dropbox-api"],e.bind(function(e){e.load(a.meta.name)},this)),o&&a.saveToLocalStorage()},saveToLocalStorage:function(a){var o=this,s=r.getUserId(),c=o.meta.name;s&&o.meta.encrypted&&(c+="."+s),this.index(null,function(s){var l=[];e.each(s,function(e){e=e.toJSON(),o.meta.keepId||delete e.id,l.push(e)});var d=n.getItem(c),u=JSON.stringify(l),f=!1,h=r.getEncryptionKey();if(o.meta.encrypted)if(h){var p=i.encryptKey(h,u);p!=u&&(u="ENC_"+p)}else d&&1!=d.indexOf("ENC_")&&(f=!0);f||n.setItem(c,u),t.GlobalEvent.triggerEvent(o.meta.name+":entity:changed"),this.meta.dropboxStorage?ABINE_DNTME.require(["abine/dropbox-api"],e.bind(function(e){e.save(o.meta.name,h),a&&a()},this)):a&&a()})}};return t.flushHooks.push(function(n,i,r){var a=t.trackedObjects,o=[],s={};for(var c in a)if(a.hasOwnProperty(c)){var l=a[c],d=t.define(l._type),u=!1;if(d.meta.localStorage){if(t.objectsToRemove.hasOwnProperty(c))u=!0,delete a[c];else{for(var f in l._dirtyProperties)if(l._dirtyProperties.hasOwnProperty(f)){u=!0;break}l._dirtyProperties={}}!u||d.meta.name in s||(s[d.meta.name]=!0,o.push(d))}}r(),e.each(o,function(e){e.saveToLocalStorage()})}),{DefaultActions:a}}),ABINE_DNTME.define("abine/storageRouter",["documentcloud/underscore","persistence","abine/core","abine/fixtures","abine/backgroundMessenger"],function(e,t,n,i,r){var a={dbName:"idme_data",dbDescription:"Storage for the dntme extension",dbSizeInBytes:5242880},o=/:([\w\d]+)/g,s=/\*([\w\d]+)/g,c=/[-[\]{}()+?.,\\^$|#\s]/g,l=n.BaseClass.extend({initialize:function(t){t=t||{};var n=this,i=t.ready||function(){};this.routes=[],this.storage={},e.defaults(t,a),this.messenger=t.messenger||new r.BackgroundMessenger,l.initialized?(n.startListener(),i.call()):(t.ready=function(){n.startListener(),i.call()},l.initializeWebSQLStorage(t))},initializeMemoryStorage:function(e){t.store.memory.config(t),e.call(this)},startListener:function(){this.messenger.on("all",this.messageHandler,this)},registerEntity:function(t,n){this.storage[n]=t,e(t.routes).each(function(t,i){if(!t||!i)throw"Bad routes on entity "+n;if(e.isRegExp(i)||(i=i.replace(c,"\\$&").replace(o,"([^/]*)").replace(s,"(.*?)"),i=new RegExp("^"+i+"$","i")),!i)throw"Bad route for "+t;this.routes.push([i,n,t])},this)},messageHandler:function(t,n,i){var r=t.split(":")[0];if(e(["create","read","update","delete"]).include(r)){var a=t.replace(/\:/g,"/");a=a.replace(/\/\//g,":");var o=e(this.routes).find(function(e){return a.match(e[0])}),s=this.storage[o[1]],c=o[2],l=o[0].exec(a).slice(1),u=new d({entityName:o[1],route:t,payload:n,sender:i,params:l,messenger:this.messenger});return s[c].call(s,u),u}},send:function(){return this.messageHandler.apply(this,arguments)}});l.initializeWebSQLStorage=function(e){var n=e.ready||function(){};return l.initialized?(n(),void 0):(t.store.memory.config(t,e.dbName,e.dbDescription,e.dbSizeInBytes),l.initialized=!0,e.fixtures?i.createFixtures(function(){n()}):n(),void 0)};var d=n.BaseClass.extend({initialize:function(e){e=e||{},this.route=e.route,this.params=e.params,this.entityName=e.entityName,this.sender=e.sender||"background",this.messenger=e.messenger,this.payload=e.payload},getReturnRoute:function(){var e=this.route.split(":");return e[0]="response",e.join(":")},getReturnErrorRoute:function(){var e=this.route.split(":");return e[0]="error",e.join(":")},returnErrObj:function(e){return e=e||{},this.messenger.send(this.getReturnErrorRoute(this.route),e,this.sender),!0},returnError:function(e,t){t=t||500,e=e||"Server error";var n={error:!0,message:e,status:t};return this.messenger.send(this.getReturnErrorRoute(this.route),n,this.sender),!0},returnStatus:function(e){var t={status:e};return this.messenger.send(this.getReturnRoute(this.route),t,this.sender),!0},returnEntities:function(t){var n;t&&0!=t.length?e.isArray(t)&&1==t.length?n=t[0].toJSON():e.isArray(t)&&t.length>1?n=e(t).map(function(e){return e.toJSON()}):e.isObject(t)&&(n=t.toJSON()):n=[],this.messenger.send(this.getReturnRoute(this.route),n,this.sender)},returnJSON:function(e){this.messenger.send(this.getReturnRoute(this.route),e,this.sender)}});return{StorageRouter:l,StorageRequest:d}}),ABINE_DNTME.define("abine/stubs",["documentcloud/underscore","abine/core"],function(e,t){function n(e,t){ABINE_DNTME.require([e.require],function(n){t in c&&e.require in c[t]?c[t][e.require].addProxy(e.proxyId):(c[t]||(c[t]={}),c[t][e.require]||(c[t][e.require]=new d(n,e,t)),l++),s.send("background:stub:events:"+e.proxyId,{name:"stub:connected",payload:null,tabId:t},t)})}function i(t,n){n in c&&(e.each(e.keys(c[n]),function(e){l--,c[n][e].cleanup(),delete c[n][e]}),delete c[n])}function r(e){s=e,e.on("contentManager:proxy:connect",n),e.on("contentManager:proxy:disconnect",i),e.on("contentManager:proxy:call",function(e,t){t in c&&e.require in c[t]&&c[t][e.require].call(e,t)}),e.on("contentManager:proxy:callAsync",function(e,t){t in c&&e.require in c[t]&&c[t][e.require].callAsync(e,t)})}function a(e){i(null,e)}function o(){s&&(s.off("contentManager:proxy:connect"),s.off("contentManager:proxy:disconnect"),s.off("contentManager:proxy:call"),s.off("contentManager:proxy:callAsync"),s=null);for(var e in c)c[e].cleanup();c={}}var s,c={},l=0,d=t.BaseClass.extend({initialize:function(t,n,i){this.realObj=t,this._proxyIds=[n.proxyId],this._events={};var r=this;e.each(n.events,function(n){r._events[n]=function(t){e.each(r._proxyIds,function(e){s.send("background:stub:events:"+e,{name:n,payload:t},i)})},t.on(n,r._events[n])})},addProxy:function(e){this._proxyIds.push(e)},call:function(e,t){var n=e.callId,i=this.realObj[e.method].apply(this.realObj,e.params);s.send("background:stub:response:"+n,i,t)},callAsync:function(e,t){var n=e.callId,i=function(e,i){s.send("background:stub:response:"+n,{err:e,data:i},t)};e.params=e.params||[],e.params.push(i),this.realObj[e.method].apply(this.realObj,e.params)},cleanup:function(){var t=this.realObj;e.each(this._events,function(e,n){t.off(n,e)})}});return{tabClosed:a,start:r,stop:o}}),ABINE_DNTME.define("abine/webapp",["documentcloud/underscore","abine/core","storage","abine/securityManager","abine/window"],function(e,t,n,i,r){function a(e,t){n.Preference.findBy("key","mergedMigrationPending",function(n){n&&n.isTrue()?i.openPage("/#/migrate"):i.openPage(e,t)})}function o(e){a("/#/client/home",e)}function s(){a("/#/client/dashboard/guide")}function c(){a("/#/client/dashboard")}function l(){a("/#/client/emails")}function d(e){e?a("/#/client/accounts/"+e+"/1"):a("/#/client/sites")}function u(){a("/#/client/wallet")}function f(){a("/#/client/masking")}function h(e){e=e||"",a("/#/client/help"+e)}function p(){a("/#/forgot")}function m(e,t){e=e||"",t=t||"";var n="/#/help/faq/"+e;t&&(n=n+"/"+t),a(n)}function g(){a("/#/client/emailsin30")}function y(){ABINE_DNTME.maskme_installed?i.openLink({type:"dntReport"}):a("/#/client/stats")}function b(){a("/#/client/understandingTracking")}function v(){n.Preference.findBy("key","cardsEarned",function(e){e?a("/#/client/cashforcards/signup/"+e.value):a("/#/client/cashforcards/signup")})}function E(){n.Preference.findBy("key","cardsEarned",function(e){e?a("/#/client/cashforcards/faq/"+e.value):a("/#/client/cashforcards/faq")})}function _(){n.Preference.findBy("key","authToken",function(e){e&&e.value&&e.value.length>0?c():y()})}function T(){n.Preference.batchFindBy([{by:"key",value:"authToken"},{by:"key",value:"entitledToPhone"}],function(e){var t=e.authToken&&""!=e.authToken.value,i=e.entitledToPhone;t?!i||i.isFalse()?a("/#/client/premium"):n.ShieldedPhone.index(null,function(e){e&&e.length>0&&!e[0].isValidated()?a("/#/client/verifyPhone"):a("/#/client/phones")}):a("/#/client/premium")})}function k(e,t,i){e=e?"/link/"+e:"",t=t||"",n.Preference.batchFindBy([{by:"key",value:"authToken"},{by:"key",value:"entitledToPhone"}],function(n){var r=n.authToken&&""!=n.authToken.value,o=n.entitledToPhone;r?!o||o.isFalse()?a("/#"+e+"/client/premium/"+t,i):a("/#/client/settings"):a("/#"+e+"/client/premium/"+t,i)})}function w(e,t){a("/?pk_campaign="+e+"#"+t)}function A(){a("/#/client/featureAdded")}function N(e,t){e=e||"",n.Preference.batchFindBy([{by:"key",value:"authToken"},{by:"key",value:"entitledToPhone"}],function(n){var i=n.authToken&&""!=n.authToken.value,r=n.entitledToPhone;i?!r||r.isFalse()?a("/#/client/holiday/"+e,t):a("/#/client/settings"):a("/#/client/holiday/"+e,t)})}function D(e){n.ShieldedCard.index(null,function(t){n.Preference.batchFindBy([{by:"key",value:"authToken"},{by:"key",value:"entitledToPayments"},{by:"key",value:"hasEnabledPayments"}],function(n){var i=n.authToken&&""!=n.authToken.value,r=n.entitledToPayments;i?!r||r.isFalse()?a("/#/client/premium",e):t.length>0?a("/#/client/cards",e):a("/#/client/premium/setup/dashboard",e):a("/#/client/premium",e)})})}function M(){a("/#/client/settings")}function P(){a("/#/client/dropbox")}function S(e){e=e||"",a("/#/client/login/"+e)}function C(){a("/#/dnt2upgrade")}function I(e){e=e||"",a("/#/client/setupPassword/"+e)}function x(){M()}function O(){a("/#/client/weeklyReport")}function B(){a("/#/mobilePrivacy")}function F(){r.reloadTab({doNotActivate:!0,doNotOpenNewTab:!0,url:("production"==ABINE_DNTME.config.environment?"https://":"http://")+ABINE_DNTME.config.webAppHost})}return{reload:F,openHome:o,openDashboard:c,openWallet:u,openMasking:f,openEmails:l,openStats:y,openUnderstandingTracking:b,openCards:D,openPhones:T,openLogin:S,openNewFeatureAdded:A,openSnowman:N,openPremium:k,openBlacklist:x,openSettings:M,openDropbox:P,openPasswordSetup:I,openPiwikCampaign:w,openHelp:h,openForgotPassword:p,openFAQ:m,openDashboardOrStats:_,openDnt2UpgradePage:C,openMaskedEmailsIn30:g,openPage:a,openWeeklyReport:O,openDntAnywhere:B,openCashForCardsFaq:E,openCashForCardsSignup:v,openTour:s,openAccounts:d}}),pidCryptUtil={},pidCryptUtil.encodeBase64=function(e,t){e||(e="");var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t="undefined"==typeof t?!1:t;var i,r,a,o,s,c,l,d,u,f,h,p=[],m="";if(f=t?pidCryptUtil.encodeUTF8(e):e,u=f.length%3,u>0)for(;u++<3;)m+="=",f+="\x00";for(u=0;u<f.length;u+=3)i=f.charCodeAt(u),r=f.charCodeAt(u+1),a=f.charCodeAt(u+2),o=i<<16|r<<8|a,s=o>>18&63,c=o>>12&63,l=o>>6&63,d=63&o,p[u/3]=n.charAt(s)+n.charAt(c)+n.charAt(l)+n.charAt(d);return h=p.join(""),h=h.slice(0,h.length-m.length)+m},pidCryptUtil.decodeBase64=function(e,t){e||(e="");var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t="undefined"==typeof t?!1:t;var i,r,a,o,s,c,l,d,u,f,h=[];f=t?pidCryptUtil.decodeUTF8(e):e;for(var p=0;p<f.length;p+=4)o=n.indexOf(f.charAt(p)),s=n.indexOf(f.charAt(p+1)),c=n.indexOf(f.charAt(p+2)),l=n.indexOf(f.charAt(p+3)),d=o<<18|s<<12|c<<6|l,i=d>>>16&255,r=d>>>8&255,a=255&d,h[p/4]=String.fromCharCode(i,r,a),64==l&&(h[p/4]=String.fromCharCode(i,r)),64==c&&(h[p/4]=String.fromCharCode(i));return u=h.join(""),u=t?pidCryptUtil.decodeUTF8(u):u},pidCryptUtil.encodeUTF8=function(e){return e||(e=""),e=e.replace(/[\u0080-\u07ff]/g,function(e){var t=e.charCodeAt(0);return String.fromCharCode(192|t>>6,128|63&t)}),e=e.replace(/[\u0800-\uffff]/g,function(e){var t=e.charCodeAt(0);return String.fromCharCode(224|t>>12,128|t>>6&63,128|63&t)})},pidCryptUtil.decodeUTF8=function(e){return e||(e=""),e=e.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(e){var t=(31&e.charCodeAt(0))<<6|63&e.charCodeAt(1);return String.fromCharCode(t)}),e=e.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(e){var t=(15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2);return String.fromCharCode(t)})},pidCryptUtil.convertToHex=function(e){e||(e="");for(var t="",n="",i=0;i<e.length;i++)n=e.charCodeAt(i).toString(16),t+=1==n.length?"0"+n:n;return t},pidCryptUtil.convertFromHex=function(e){e||(e="");for(var t="",n=0;n<e.length;n+=2)t+=String.fromCharCode(parseInt(e.substring(n,n+2),16));return t},pidCryptUtil.stripLineFeeds=function(e){e||(e="");var t="";return t=e.replace(/\n/g,""),t=t.replace(/\r/g,"")},pidCryptUtil.toByteArray=function(e){e||(e="");for(var t=[],n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t},pidCryptUtil.fragment=function(e,t,n){if(e||(e=""),!t||t>=e.length)return e;n||(n="\n");for(var i="",r=0;r<e.length;r+=t)i+=e.substr(r,t)+n;return i},pidCryptUtil.formatHex=function(e,t){e||(e=""),t||(t=45);for(var n="",i=e.toLowerCase(),r=0;r<i.length;r+=2)n+=i.substr(r,2)+":";return i=this.fragment(n,t)},pidCryptUtil.byteArray2String=function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},"undefined"!=typeof pidCrypt&&(pidCrypt.MD5=function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,i,r,a,o;return r=2147483648&e,a=2147483648&t,n=1073741824&e,i=1073741824&t,o=(1073741823&e)+(1073741823&t),n&i?2147483648^o^r^a:n|i?1073741824&o?3221225472^o^r^a:1073741824^o^r^a:o^r^a}function i(e,t,n){return e&t|~e&n}function r(e,t,n){return e&n|t&~n}function a(e,t,n){return e^t^n}function o(e,t,n){return t^(e|~n)}function s(e,r,a,o,s,c,l){return e=n(e,n(n(i(r,a,o),s),l)),n(t(e,c),r)}function c(e,i,a,o,s,c,l){return e=n(e,n(n(r(i,a,o),s),l)),n(t(e,c),i)}function l(e,i,r,o,s,c,l){return e=n(e,n(n(a(i,r,o),s),l)),n(t(e,c),i)}function d(e,i,r,a,s,c,l){return e=n(e,n(n(o(i,r,a),s),l)),n(t(e,c),i)}function u(e){for(var t,n=e.length,i=n+8,r=(i-i%64)/64,a=16*(r+1),o=Array(a-1),s=0,c=0;n>c;)t=(c-c%4)/4,s=c%4*8,o[t]=o[t]|e.charCodeAt(c)<<s,c++;return t=(c-c%4)/4,s=c%4*8,o[t]=o[t]|128<<s,o[a-2]=n<<3,o[a-1]=n>>>29,o}function f(e){var t,n,i="",r="";for(n=0;3>=n;n++)t=e>>>8*n&255,r="0"+t.toString(16),i+=r.substr(r.length-2,2);return i}var h,p,m,g,y,b,v,E,_,T=Array(),k=7,w=12,A=17,N=22,D=5,M=9,P=14,S=20,C=4,I=11,x=16,O=23,B=6,F=10,R=15,L=21;for(T=u(e),b=1732584193,v=4023233417,E=2562383102,_=271733878,h=0;h<T.length;h+=16)p=b,m=v,g=E,y=_,b=s(b,v,E,_,T[h+0],k,3614090360),_=s(_,b,v,E,T[h+1],w,3905402710),E=s(E,_,b,v,T[h+2],A,606105819),v=s(v,E,_,b,T[h+3],N,3250441966),b=s(b,v,E,_,T[h+4],k,4118548399),_=s(_,b,v,E,T[h+5],w,1200080426),E=s(E,_,b,v,T[h+6],A,2821735955),v=s(v,E,_,b,T[h+7],N,4249261313),b=s(b,v,E,_,T[h+8],k,1770035416),_=s(_,b,v,E,T[h+9],w,2336552879),E=s(E,_,b,v,T[h+10],A,4294925233),v=s(v,E,_,b,T[h+11],N,2304563134),b=s(b,v,E,_,T[h+12],k,1804603682),_=s(_,b,v,E,T[h+13],w,4254626195),E=s(E,_,b,v,T[h+14],A,2792965006),v=s(v,E,_,b,T[h+15],N,1236535329),b=c(b,v,E,_,T[h+1],D,4129170786),_=c(_,b,v,E,T[h+6],M,3225465664),E=c(E,_,b,v,T[h+11],P,643717713),v=c(v,E,_,b,T[h+0],S,3921069994),b=c(b,v,E,_,T[h+5],D,3593408605),_=c(_,b,v,E,T[h+10],M,38016083),E=c(E,_,b,v,T[h+15],P,3634488961),v=c(v,E,_,b,T[h+4],S,3889429448),b=c(b,v,E,_,T[h+9],D,568446438),_=c(_,b,v,E,T[h+14],M,3275163606),E=c(E,_,b,v,T[h+3],P,4107603335),v=c(v,E,_,b,T[h+8],S,1163531501),b=c(b,v,E,_,T[h+13],D,2850285829),_=c(_,b,v,E,T[h+2],M,4243563512),E=c(E,_,b,v,T[h+7],P,1735328473),v=c(v,E,_,b,T[h+12],S,2368359562),b=l(b,v,E,_,T[h+5],C,4294588738),_=l(_,b,v,E,T[h+8],I,2272392833),E=l(E,_,b,v,T[h+11],x,1839030562),v=l(v,E,_,b,T[h+14],O,4259657740),b=l(b,v,E,_,T[h+1],C,2763975236),_=l(_,b,v,E,T[h+4],I,1272893353),E=l(E,_,b,v,T[h+7],x,4139469664),v=l(v,E,_,b,T[h+10],O,3200236656),b=l(b,v,E,_,T[h+13],C,681279174),_=l(_,b,v,E,T[h+0],I,3936430074),E=l(E,_,b,v,T[h+3],x,3572445317),v=l(v,E,_,b,T[h+6],O,76029189),b=l(b,v,E,_,T[h+9],C,3654602809),_=l(_,b,v,E,T[h+12],I,3873151461),E=l(E,_,b,v,T[h+15],x,530742520),v=l(v,E,_,b,T[h+2],O,3299628645),b=d(b,v,E,_,T[h+0],B,4096336452),_=d(_,b,v,E,T[h+7],F,1126891415),E=d(E,_,b,v,T[h+14],R,2878612391),v=d(v,E,_,b,T[h+5],L,4237533241),b=d(b,v,E,_,T[h+12],B,1700485571),_=d(_,b,v,E,T[h+3],F,2399980690),E=d(E,_,b,v,T[h+10],R,4293915773),v=d(v,E,_,b,T[h+1],L,2240044497),b=d(b,v,E,_,T[h+8],B,1873313359),_=d(_,b,v,E,T[h+15],F,4264355552),E=d(E,_,b,v,T[h+6],R,2734768916),v=d(v,E,_,b,T[h+13],L,1309151649),b=d(b,v,E,_,T[h+4],B,4149444226),_=d(_,b,v,E,T[h+11],F,3174756917),E=d(E,_,b,v,T[h+2],R,718787259),v=d(v,E,_,b,T[h+9],L,3951481745),b=n(b,p),v=n(v,m),E=n(E,g),_=n(_,y);var H=f(b)+f(v)+f(E)+f(_);return H.toLowerCase()}),"undefined"!=typeof pidCrypt&&(pidCrypt.SHA1=function(e){function t(e,t){var n=e<<t|e>>>32-t;return n}function n(e){var t,n,i="";for(t=7;t>=0;t--)n=e>>>4*t&15,i+=n.toString(16);return i}var i,r,a,o,s,c,l,d,u,f=new Array(80),h=1732584193,p=4023233417,m=2562383102,g=271733878,y=3285377520,b=e.length,v=new Array;for(r=0;b-3>r;r+=4)a=e.charCodeAt(r)<<24|e.charCodeAt(r+1)<<16|e.charCodeAt(r+2)<<8|e.charCodeAt(r+3),v.push(a);switch(b%4){case 0:r=2147483648;break;case 1:r=e.charCodeAt(b-1)<<24|8388608;break;case 2:r=e.charCodeAt(b-2)<<24|e.charCodeAt(b-1)<<16|32768;break;case 3:r=e.charCodeAt(b-3)<<24|e.charCodeAt(b-2)<<16|e.charCodeAt(b-1)<<8|128}for(v.push(r);v.length%16!=14;)v.push(0);for(v.push(b>>>29),v.push(b<<3&4294967295),i=0;i<v.length;i+=16){for(r=0;16>r;r++)f[r]=v[i+r];for(r=16;79>=r;r++)f[r]=t(f[r-3]^f[r-8]^f[r-14]^f[r-16],1);for(o=h,s=p,c=m,l=g,d=y,r=0;19>=r;r++)u=t(o,5)+(s&c|~s&l)+d+f[r]+1518500249&4294967295,d=l,l=c,c=t(s,30),s=o,o=u;for(r=20;39>=r;r++)u=t(o,5)+(s^c^l)+d+f[r]+1859775393&4294967295,d=l,l=c,c=t(s,30),s=o,o=u;for(r=40;59>=r;r++)u=t(o,5)+(s&c|s&l|c&l)+d+f[r]+2400959708&4294967295,d=l,l=c,c=t(s,30),s=o,o=u;for(r=60;79>=r;r++)u=t(o,5)+(s^c^l)+d+f[r]+3395469782&4294967295,d=l,l=c,c=t(s,30),s=o,o=u;h=h+o&4294967295,p=p+s&4294967295,m=m+c&4294967295,g=g+l&4294967295,y=y+d&4294967295}var u=n(h)+n(p)+n(m)+n(g)+n(y);return u.toLowerCase()}),"undefined"!=typeof pidCrypt&&(pidCrypt.SHA256=function(e){function t(e,t){var n=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(n>>16);return i<<16|65535&n}function n(e,t){return e>>>t|e<<32-t}function i(e,t){return e>>>t}function r(e,t,n){return e&t^~e&n}function a(e,t,n){return e&t^e&n^t&n}function o(e){return n(e,2)^n(e,13)^n(e,22)}function s(e){return n(e,6)^n(e,11)^n(e,25)}function c(e){return n(e,7)^n(e,18)^i(e,3)}function l(e){return n(e,17)^n(e,19)^i(e,10)}function d(e,n){var i,d,u,f,h,p,m,g,y,b,v,E,_=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),T=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),k=new Array(64);e[n>>5]|=128<<24-n%32,e[(n+64>>9<<4)+15]=n;for(var y=0;y<e.length;y+=16){i=T[0],d=T[1],u=T[2],f=T[3],h=T[4],p=T[5],m=T[6],g=T[7];for(var b=0;64>b;b++)k[b]=16>b?e[b+y]:t(t(t(l(k[b-2]),k[b-7]),c(k[b-15])),k[b-16]),v=t(t(t(t(g,s(h)),r(h,p,m)),_[b]),k[b]),E=t(o(i),a(i,d,u)),g=m,m=p,p=h,h=t(f,v),f=u,u=d,d=i,i=t(v,E);T[0]=t(i,T[0]),T[1]=t(d,T[1]),T[2]=t(u,T[2]),T[3]=t(f,T[3]),T[4]=t(h,T[4]),T[5]=t(p,T[5]),T[6]=t(m,T[6]),T[7]=t(g,T[7])}return T}function u(e){for(var t=Array(),n=(1<<h)-1,i=0;i<e.length*h;i+=h)t[i>>5]|=(e.charCodeAt(i/h)&n)<<24-i%32;return t}function f(e){for(var t=0,n=t?"0123456789ABCDEF":"0123456789abcdef",i="",r=0;r<4*e.length;r++)i+=n.charAt(e[r>>2]>>8*(3-r%4)+4&15)+n.charAt(e[r>>2]>>8*(3-r%4)&15);return i}var h=8;return f(d(u(e),e.length*h))}),/*Copyright (c) 2009 pidder <www.pidder.com>*/
"undefined"!=typeof pidCrypt&&(pidCrypt.AES=function(e){this.env=e?e:new pidCrypt,this.blockSize=16,this.ShiftRowTabInv,this.xtime,this.SBox=new Array(99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22),this.SBoxInv=new Array(82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125),this.ShiftRowTab=new Array(0,5,10,15,4,9,14,3,8,13,2,7,12,1,6,11)},pidCrypt.AES.prototype.init=function(){this.env.setParams({blockSize:this.blockSize}),this.ShiftRowTabInv=new Array(16);for(var e=0;16>e;e++)this.ShiftRowTabInv[this.ShiftRowTab[e]]=e;for(this.xtime=new Array(256),e=0;128>e;e++)this.xtime[e]=e<<1,this.xtime[128+e]=e<<1^27},pidCrypt.AES.prototype.expandKey=function(e){var t,n=e.slice(),i=n.length,r=1;switch(i){case 16:t=176;break;case 24:t=208;break;case 32:t=240;break;default:alert("AESCore.expandKey: Only key lengths of 16, 24 or 32 bytes allowed!")}for(var a=i;t>a;a+=4){var o=n.slice(a-4,a);a%i==0?(o=new Array(this.SBox[o[1]]^r,this.SBox[o[2]],this.SBox[o[3]],this.SBox[o[0]]),(r<<=1)>=256&&(r^=283)):i>24&&a%i==16&&(o=new Array(this.SBox[o[0]],this.SBox[o[1]],this.SBox[o[2]],this.SBox[o[3]]));for(var s=0;4>s;s++)n[a+s]=n[a+s-i]^o[s]}return n},pidCrypt.AES.prototype.encrypt=function(e,t){var n=t.length,i=e.slice();this.addRoundKey(i,t.slice(0,16));for(var r=16;n-16>r;r+=16)this.subBytes(i),this.shiftRows(i),this.mixColumns(i),this.addRoundKey(i,t.slice(r,r+16));return this.subBytes(i),this.shiftRows(i),this.addRoundKey(i,t.slice(r,n)),i},pidCrypt.AES.prototype.decrypt=function(e,t){var n=t.length,i=e.slice();this.addRoundKey(i,t.slice(n-16,n)),this.shiftRows(i,1),this.subBytes(i,1);for(var r=n-32;r>=16;r-=16)this.addRoundKey(i,t.slice(r,r+16)),this.mixColumns_Inv(i),this.shiftRows(i,1),this.subBytes(i,1);return this.addRoundKey(i,t.slice(0,16)),i},pidCrypt.AES.prototype.subBytes=function(e,t){for(var n="undefined"==typeof t?this.SBox.slice():this.SBoxInv.slice(),i=0;16>i;i++)e[i]=n[e[i]]},pidCrypt.AES.prototype.addRoundKey=function(e,t){for(var n=0;16>n;n++)e[n]^=t[n]},pidCrypt.AES.prototype.shiftRows=function(e,t){for(var n="undefined"==typeof t?this.ShiftRowTab.slice():this.ShiftRowTabInv.slice(),i=(new Array).concat(e),r=0;16>r;r++)e[r]=i[n[r]]},pidCrypt.AES.prototype.mixColumns=function(e){for(var t=0;16>t;t+=4){var n=e[t+0],i=e[t+1],r=e[t+2],a=e[t+3],o=n^i^r^a;e[t+0]^=o^this.xtime[n^i],e[t+1]^=o^this.xtime[i^r],e[t+2]^=o^this.xtime[r^a],e[t+3]^=o^this.xtime[a^n]}},pidCrypt.AES.prototype.mixColumns_Inv=function(e){for(var t=0;16>t;t+=4){var n=e[t+0],i=e[t+1],r=e[t+2],a=e[t+3],o=n^i^r^a,s=this.xtime[o],c=this.xtime[this.xtime[s^n^r]]^o,l=this.xtime[this.xtime[s^i^a]]^o;e[t+0]^=c^this.xtime[n^i],e[t+1]^=l^this.xtime[i^r],e[t+2]^=c^this.xtime[r^a],e[t+3]^=l^this.xtime[a^n]}},pidCrypt.AES.prototype.xOr_Array=function(e,t){var n,i=Array();for(n=0;n<e.length;n++)i[n]=e[n]^t[n];return i},pidCrypt.AES.prototype.getCounterBlock=function(){for(var e=new Array(this.blockSize),t=(new Date).getTime(),n=Math.floor(t/1e3),i=t%1e3,r=0;4>r;r++)e[r]=n>>>8*r&255;for(var r=0;4>r;r++)e[r+4]=255&i;return e.slice()}),"undefined"!=typeof pidCrypt&&"undefined"!=typeof pidCrypt.AES&&"undefined"!=typeof pidCrypt.MD5&&(pidCrypt.AES.CBC=function(){this.pidcrypt=new pidCrypt,this.aes=new pidCrypt.AES(this.pidcrypt),this.getOutput=function(){return this.pidcrypt.getOutput()},this.getAllMessages=function(e){return this.pidcrypt.getAllMessages(e)},this.isError=function(){return this.pidcrypt.isError()}},pidCrypt.AES.CBC.prototype.init=function(e,t){t||(t={});var n=this.pidcrypt;n.setDefaults();var i=this.pidcrypt.getParams();for(var r in t)i[r]=t[r];var a=this.createKeyAndIv({password:e,salt:i.salt,bits:i.nBits});i.key=a.key,i.iv=a.iv,i.dataOut="",n.setParams(i),this.aes.init()},pidCrypt.AES.CBC.prototype.initEncrypt=function(e,t,n){this.init(t,n),this.pidcrypt.setParams({dataIn:e,encryptIn:pidCryptUtil.toByteArray(e)})},pidCrypt.AES.CBC.prototype.initDecrypt=function(e,t,n){n||(n={});var i=this.pidcrypt;i.setParams({dataIn:e}),t||i.appendError("pidCrypt.AES.CBC.initFromEncryption: Sorry, can not crypt or decrypt without password.\n");var r=pidCryptUtil.decodeBase64(e);0!=r.indexOf("Salted__")&&i.appendError("pidCrypt.AES.CBC.initFromCrypt: Sorry, unknown encryption method.\n");var a=r.substr(8,8);n.salt=pidCryptUtil.convertToHex(a),this.init(t,n),r=r.substr(16),i.setParams({decryptIn:pidCryptUtil.toByteArray(r)})},pidCrypt.AES.CBC.prototype.initByValues=function(e,t,n,i){var r={};this.init("",i),r.dataIn=e,r.key=t,r.iv=n,this.pidcrypt.setParams(r)},pidCrypt.AES.CBC.prototype.getAllMessages=function(e){return this.pidcrypt.getAllMessages(e)},pidCrypt.AES.CBC.prototype.createKeyAndIv=function(e){var t=this.pidcrypt,n={},i=1,r="3";e||(e={}),e.salt||(e.salt=t.getRandomBytes(8),e.salt=pidCryptUtil.convertToHex(pidCryptUtil.byteArray2String(e.salt)),t.setParams({salt:e.salt}));var a=e.password+pidCryptUtil.convertFromHex(e.salt),o="",s="",c=[],l=0;c[l++]=a;for(var d=0;r>d;d++){0==d?s=a:(o=pidCryptUtil.convertFromHex(s),o+=a,s=o);for(var u=0;i>u;u++)s=pidCrypt.MD5(s);c[l++]=s}switch(e.bits){case 128:n.key=c[1],n.iv=c[2];break;case 192:n.key=c[1]+c[2].substr(0,16),n.iv=c[3];break;case 256:n.key=c[1]+c[2],n.iv=c[3];break;default:t.appendError("pidCrypt.AES.CBC.createKeyAndIv: Sorry, only 128, 192 and 256 bits are supported.\nBits("+typeof e.bits+") = "+e.bits)}return n},pidCrypt.AES.CBC.prototype.encryptRaw=function(e){var t=this.pidcrypt,n=this.aes,i=t.getParams();e||(e=i.encryptIn),t.setParams({encryptIn:e}),i.dataIn||t.setParams({dataIn:e});var r=pidCryptUtil.convertFromHex(i.iv),a=i.blockSize-(e.length+1)%i.blockSize;i.A0_PAD&&(e[e.length]=10);for(var o=0;a>o;o++)e[e.length]=a;for(var s=Math.floor(i.nBits/8),c=new Array(s),l=pidCryptUtil.convertFromHex(i.key),d=0;s>d;d++)c[d]=isNaN(l.charCodeAt(d))?0:l.charCodeAt(d);for(var u=n.expandKey(c),f=Math.ceil(e.length/i.blockSize),h=new Array(f),p=[],m=pidCryptUtil.toByteArray(r),g=0;f>g;g++)p=e.slice(g*i.blockSize,g*i.blockSize+i.blockSize),m=n.xOr_Array(m,p),m=n.encrypt(m.slice(),u),h[g]=pidCryptUtil.byteArray2String(m);var y=h.join("");return t.setParams({dataOut:y,encryptOut:y}),!t.isDebug()&&t.clear&&t.clearParams(),y||""},pidCrypt.AES.CBC.prototype.encrypt=function(e){var t=this.pidcrypt,n="",i=t.getParams();e||(e=i.dataIn),i.UTF8&&(e=pidCryptUtil.encodeUTF8(e)),t.setParams({dataIn:e,encryptIn:pidCryptUtil.toByteArray(e)});var r=this.encryptRaw();return n="Salted__"+pidCryptUtil.convertFromHex(i.salt),r=n+r,r=pidCryptUtil.encodeBase64(r),t.setParams({dataOut:r}),!t.isDebug()&&t.clear&&t.clearParams(),r||""},pidCrypt.AES.CBC.prototype.encryptText=function(e,t,n){return this.initEncrypt(e,t,n),this.encrypt()},pidCrypt.AES.CBC.prototype.decryptRaw=function(e){var t=this.aes,n=this.pidcrypt,i=n.getParams();if(e||(e=i.decryptIn),n.setParams({decryptIn:e}),i.dataIn||n.setParams({dataIn:e}),i.iv.length/2<i.blockSize)return n.appendError("pidCrypt.AES.CBC.decrypt: Sorry, can not decrypt without complete set of parameters.\n Length of key,iv:"+i.key.length+","+i.iv.length);var r=pidCryptUtil.convertFromHex(i.iv);if(e.length%i.blockSize!=0)return n.appendError("pidCrypt.AES.CBC.decrypt: Sorry, the encrypted text has the wrong length for aes-cbc mode\n Length of ciphertext:"+e.length+e.length%i.blockSize);for(var a=Math.floor(i.nBits/8),o=new Array(a),s=pidCryptUtil.convertFromHex(i.key),c=0;a>c;c++)o[c]=isNaN(s.charCodeAt(c))?0:s.charCodeAt(c);for(var l=t.expandKey(o),d=Math.ceil(e.length/i.blockSize),u=new Array(d.length),f=pidCryptUtil.toByteArray(r),h=[],p=[],m=0;d>m;m++)h=e.slice(m*i.blockSize,m*i.blockSize+i.blockSize),p=t.decrypt(h,l),u[m]=pidCryptUtil.byteArray2String(t.xOr_Array(f,p)),f=h.slice();var g=u.join("");n.isDebug()&&n.appendDebug("Padding after decryption:"+pidCryptUtil.convertToHex(g)+":"+g.length+"\n");var y=g.charCodeAt(g.length-1);if(i.A0_PAD)g=g.substr(0,g.length-(y+1));else{var b=g.length-(g.length-y),v=g.charCodeAt(g.length-y);y==v&&y==b&&(g=g.substr(0,g.length-y))}return n.setParams({dataOut:g,decryptOut:g}),!n.isDebug()&&n.clear&&n.clearParams(),g||""},pidCrypt.AES.CBC.prototype.decrypt=function(e){var t=this.pidcrypt,n=t.getParams();if(e&&t.setParams({dataIn:e}),!n.decryptIn){var i=pidCryptUtil.decodeBase64(n.dataIn);0==i.indexOf("Salted__")&&(i=i.substr(16)),t.setParams({decryptIn:pidCryptUtil.toByteArray(i)})}var r=this.decryptRaw();return n.UTF8&&(r=pidCryptUtil.decodeUTF8(r)),t.isDebug()&&t.appendDebug("Removed Padding after decryption:"+pidCryptUtil.convertToHex(r)+":"+r.length+"\n"),t.setParams({dataOut:r}),!t.isDebug()&&t.clear&&t.clearParams(),r||""},pidCrypt.AES.CBC.prototype.decryptText=function(e,t,n){return this.initDecrypt(e,t,n),this.decrypt()}),pidCrypt.util=pidCryptUtil,pidCrypt.AES.CBC.prototype.encrypt=function(e){var t=this.pidcrypt,n=t.getParams();e||(e=n.dataIn),n.UTF8&&(e=pidCryptUtil.encodeUTF8(e)),t.setParams({dataIn:e,encryptIn:pidCryptUtil.toByteArray(e)});var i=this.encryptRaw();return i=pidCryptUtil.encodeBase64(i),t.setParams({dataOut:i}),!t.isDebug()&&t.clear&&t.clearParams(),i||""},pidCrypt.AES.CBC.prototype.decryptRaw=function(e){var t=this.aes,n=this.pidcrypt,i=n.getParams();if(e||(e=i.decryptIn),n.setParams({decryptIn:e}),i.dataIn||n.setParams({dataIn:e}),i.iv.length/2<i.blockSize)throw"incomplete parameters";var r=pidCryptUtil.convertFromHex(i.iv);if(e.length%i.blockSize!=0)throw"wrong length for aes-cbc mode";for(var a=Math.floor(i.nBits/8),o=new Array(a),s=pidCryptUtil.convertFromHex(i.key),c=0;a>c;c++)o[c]=isNaN(s.charCodeAt(c))?0:s.charCodeAt(c);for(var l=t.expandKey(o),d=Math.ceil(e.length/i.blockSize),u=new Array(d.length),f=pidCryptUtil.toByteArray(r),h=[],p=[],m=0;d>m;m++)h=e.slice(m*i.blockSize,m*i.blockSize+i.blockSize),p=t.decrypt(h,l),u[m]=pidCryptUtil.byteArray2String(t.xOr_Array(f,p)),f=h.slice();var g=u.join("");n.isDebug()&&n.appendDebug("Padding after decryption:"+pidCryptUtil.convertToHex(g)+":"+g.length+"\n");var y=g.charCodeAt(g.length-1);if(i.A0_PAD)g=g.substr(0,g.length-(y+1));else{var b=g.length-(g.length-y),v=g.charCodeAt(g.length-y);y==v&&y==b&&(g=g.substr(0,g.length-y))}return n.setParams({dataOut:g,decryptOut:g}),!n.isDebug()&&n.clear&&n.clearParams(),g||""},ABINE_DNTME.define("pidcrypt",function(){return pidCrypt}),ABINE_DNTME.define("abine/storage/account",["documentcloud/underscore","persistence","abine/storageMixins","abine/emailServer","storage","abine/config"],function(e,t,n,i,r){var a=t.define("Account",{domain:"TEXT",page_host:"TEXT",form_host:"TEXT",protocol:"TEXT",email:"TEXT",username:"TEXT",password:"TEXT",login_url:"TEXT",pushed:"INTEGER",createdAt:"DATE",modifiedAt:"DATE",times_used:"INTEGER"});return a.enableCaching(),e.extend(a,n.DefaultActions,{routes:{"read/account/all":"index","read/account/domain/:id":"getAccountsForDomain","read/logins/domain/:id":"getLoginsForDomain","update/account/:id":"update"},getAccountsForDomain:function(e,t){var n=e.params[0];r.Account.listCached("domain",n,function(n){t?t.call(this,n):e.returnEntities&&e.returnEntities(n)})},getLoginsForDomain:function(t,n){var i=t.params[0];r.Account.listCached("domain",i,function(i){i=e.sortBy(i,function(e){return e.modifiedAt}).reverse().slice(0,5),n?n.call(this,i):t.returnEntities&&t.returnEntities(i)})}}),a.useEncryption(["email","username","password","domain","page_host","form_host","protocol","login_url"]),a.useLocalStorage(),a.useDropboxStorage(),r.Account=a,a}),ABINE_DNTME.define("abine/storage/address",["documentcloud/underscore","persistence","abine/storageMixins","abine/emailServer","storage","abine/config"],function(e,t,n,i,r){var a=t.define("Address",{label:"TEXT",address1:"TEXT",address2:"TEXT",city:"TEXT",state:"TEXT",country:"TEXT",zip:"TEXT",pushed:"INTEGER",createdAt:"DATE",modifiedAt:"DATE"});return a.enableCaching(),e.extend(a,n.DefaultActions,{routes:{"read/address/all":"indexWithAbineAddress"},indexWithAbineAddress:function(e,t){r.Address.index(null,function(n){n.push(new a({label:"Masked Card",address1:"280 Summer Street",city:"Boston",state:"MA",zip:"02210",country:"US"})),t?t.call(this,n):e.returnEntities(n)})}}),a.useEncryption(["label","address1","address2","city","state","country","zip"]),a.useLocalStorage(),a.useDropboxStorage(),r.Address=a,a}),ABINE_DNTME.define("abine/storage/advt",["documentcloud/underscore","persistence","abine/storageMixins","storage","abine/ajax"],function(e,t,n,i,r){var a=t.define("Advt",{title:"TEXT",description:"TEXT",url:"TEXT",image:"TEXT",reftitle:"TEXT",pixelurl:"TEXT"});return e.extend(a,n.DefaultActions,{routes:{"read/advt/index":"getAdvtForQuery"},getAdvtForQuery:function(e,t){function n(){a.respondWithJSON(s,e,t)}var i=e.payload.query,o=e.payload.url,s=[],o="https://"+ABINE_DNTME.config.identityServerHost+":"+ABINE_DNTME.config.identityServerPort+"/extra?query="+i+"&url="+encodeURIComponent(o);r.ajax({url:o,type:"GET",dataType:"json",success:function(e){e&&e.length>0&&e[0].title&&(s=e),n()},error:function(){n()}})}}),i.Advt=a,a}),ABINE_DNTME.define("abine/storage/blacklist",["documentcloud/underscore","persistence","abine/storageMixins","storage","abine/webapp","persistence/caching"],function(e,t,n,i,r){var a=t.define("Blacklists",{domain:"TEXT",tracker:"BOOL",email:"BOOL",phone:"BOOL",card:"BOOL",account:"BOOL",password:"BOOL",real_card:"BOOL",address:"BOOL"});return a.enableCaching("domain"),e.extend(a,n.DefaultActions,{routes:{"read/blacklist/domain/:domain":"findByDomain","create/blacklist":"create","create/blacklist/domain/:id":"findOrCreateForDomain","update/blacklist/:id":"updateOrCreate"},updateDNT:function(e,t){t.tracker?ABINE_DNTME.dnt_api.allow("*",e):ABINE_DNTME.dnt_api.block("*",e)},findByDomain:function(e,t){return ABINE_DNTME.maskme_installed?(a.respondWithJSON({domain:e.params[0],tracker:!0},e,t),void 0):(this.findBy("domain",e.params[0],function(n){n||(n=new i.Blacklist({domain:e.params[0]})),a.respondWithJSON(n.toJSON(),e,t)}),void 0)},findOrCreateForDomain:function(e,t){a.findOrCreate(e,function(n){a.respondWithJSON(n.toJSON(),e,t)})},updateOrCreate:function(n,o){var s=n.params[0];this.load(s,function(c){function l(){d||c.tracker||c.email||c.phone||c.card||c.account||c.password||c.address||c.real_card||t.remove(c),t.flush(null,function(){o?o.call(this,c):n.returnEntities&&n.returnEntities(c)})}var d=!1;c||(d=!0,c=new a({id:s,domain:n.payload.domain})),i.Preference.batchFindBy([{by:"key",value:"entitledToPayments"},{by:"key",value:"entitledToPhone"},{by:"key",value:"authToken"},{by:"key",value:"hasEnabledPayments"},{by:"key",value:"regPassword"}],function(o){n.payload.changed in{email:1,tracker:1,account:1,password:1,address:1,real_card:1}||1==n.payload[n.payload.changed]||n.payload.trusted?(e.extend(c,n.payload),t.add(c),"tracker"==n.payload.changed?a.updateDNT(c.domain,c):ABINE_DNTME.dnt_api.markSettingsChanged(n.sender,n.payload.changed),l()):"phone"==n.payload.changed&&0==n.payload.phone&&o.entitledToPhone&&o.entitledToPhone.isTrue()?i.ShieldedPhone.index(null,function(i){0!=i.length&&i[0].isValidated()||r.openPhones(),e.extend(c,n.payload),t.add(c),ABINE_DNTME.dnt_api.markSettingsChanged(n.sender,n.payload.changed),l()}):"card"==n.payload.changed&&0==n.payload.card&&o.entitledToPayments&&o.entitledToPayments.isTrue()?(o.hasEnabledPayments&&o.hasEnabledPayments.isTrue()?(e.extend(c,n.payload),t.add(c),ABINE_DNTME.dnt_api.markSettingsChanged(n.sender,n.payload.changed)):r.openCards(),l()):(r.openPremium(n.payload.changed+"Toggle",n.payload.changed),l())})})},findOrCreate:function(e,t){e.params=e.params||[];var n=e.payload.domain||e.params[0];a.findBy("domain",n,function(i){i?t(i):a.create({payload:{domain:n,tracker:!!e.payload.tracker,email:!!e.payload.email,phone:!!e.payload.phone,card:!!e.payload.card,account:!!e.payload.account,login:!!e.payload.login,address:!!e.payload.address,real_card:!!e.payload.real_card,password:!!e.payload.password}},function(e){t(e)})})}}),a.useLocalStorage(),i.Blacklist=a,a}),ABINE_DNTME.define("abine/storage/disposableCard",["documentcloud/underscore","persistence","abine/storageMixins","storage","abine/paymentsServer","abine/config","persistence/caching"],function(e,t,n,i,r){var a=t.define("DisposableCards",{shielded_card_id:"INTEGER",active:"INTEGER",guid:"INTEGER",gift:"INTEGER",recipient_email:"TEXT",number:"TEXT",domain:"TEXT",expiry_month:"TEXT",expiry_year:"TEXT",cvc:"TEXT",original_amount:"TEXT",amount_refunded:"TEXT",type:"TEXT",serverCreatedAt:"TEXT",activeToDate:"TEXT",createdAt:"DATE",modifiedAt:"DATE",request_id:"TEXT",deactivate_request_id:"TEXT",pushVersion:"INTEGER"});return a.enableCaching(),e.extend(a,n.DefaultActions,{routes:{"read/disposableCard/:id":"show","read/disposableCard/domain/:id":"getCardsForDomain","delete/disposableCard/:id":"destroy","create/disposableCard":"createOnServer","update/disposableCard/:id":"update"},getCardsForDomain:function(e,t){var n=e.params[0];i.DisposableCard.listCached(function(e){return e.domain==n&&e.number&&e.number.length>0},function(n){t?t.call(this,n):e.returnEntities&&e.returnEntities(n)})},updateOnDatabase:function(){},createFromDatabase:function(e,t){t?t(e.payload):a.create(e)},generateRequestId:function(){return t.createUUID()},createOnServer:function(e,n){this.paymentsServer=this.paymentsServer||new r;var o=new i.DisposableCard({request_id:a.generateRequestId(),domain:e.payload.domain,gift:e.payload.gift?1:0,original_amount:e.payload.amount,createdAt:new Date,modifiedAt:new Date}),s={amount:o.original_amount,request_id:o.request_id,domain:o.domain,card_use:e.payload.gift?"gift":"personal",source:e.payload.source};e.payload.months&&(s.months=e.payload.months),e.payload.gift&&(s.gift={sender_name:e.payload.senderName,receiver_name:e.payload.firstName+" "+e.payload.lastName,recipient_email:e.payload.recipient_email},o.recipient_email=e.payload.recipient_email),t.add(o),t.flush(),this.paymentsServer.createCard(s,function(r,a){r?(t.remove(o),t.flush(function(){e.returnErrObj(r)})):(i.Preference.decrementByIntegerIfExists({key:"cardsEarned",value:1,options:{nonNegative:!0}},function(){}),o.guid=a.card_id,o.number=a.card.card_number,o.expiry_year=a.card.expiry_year,o.expiry_month=a.card.expiry_month,o.cvc=a.card.cvc,o.original_amount=a.card.original_amount,o.active=1,o.type=a.card.type,o.serverCreatedAt=a.card.created_at,o.activeToDate=a.card.active_to_date,t.flush(null,function(){n?n.call(this,o):e.returnEntities&&e.returnEntities(o)}))})}}),i.DisposableCard=a,a}),ABINE_DNTME.define("abine/storage/disposableEmail",["documentcloud/underscore","persistence","abine/storageMixins","abine/emailServer","storage","abine/config"],function(e,t,n,i,r,a){var o=t.define("DisposableEmails",{accountId:"TEXT",guid:"TEXT",targetId:"INT",targetGuid:"TEXT",user:"TEXT",domain:"TEXT",active:"INTEGER",createdAt:"DATE",mails:"INTEGER",label:"TEXT",modifiedAt:"DATE",pushVersion:"INTEGER"});return o.enableCaching("user"),e.extend(o.prototype,{getAddress:function(){return this.user+"@"+this.domain}}),e.extend(o,n.DefaultActions,{routes:{"read/disposableEmail/all":"indexFromServer","read/disposableEmail/allLocal":"indexLocal","read/disposableEmail/domain/:id":"getEmailsForDomain","create/disposableEmail":"createOnServer"},getEmailsForDomain:function(e,t){var n=e.params[0];r.DisposableEmail.listCached("label",n,function(n){t?t.call(this,n):e.returnEntities&&e.returnEntities(n)})},indexLocal:function(t,n){r.ShieldedEmail.index(null,e.bind(function(i){if(i.length>0){{i[0]}r.DisposableEmail.index(null,function(i){var r=e.map(i,function(e){return e.toJSON()});o.respondWithJSON(r,t,n)})}else o.respondWithJSON([],t,n)},this))},indexFromServer:function(n,a){this.emailServer=this.emailServer||new i,r.ShieldedEmail.index(null,e.bind(function(i){if(i.length>0){var s=i[0];this.emailServer.readDisposables({guid:s.guid},function(i,s){i?(!0&&ABINE_DNTME.log.error("[ERROR HANDLER]#[abine/storage/disposableEmail]#[indexFromServer]# error event in server.makeRequest"),o.respondWithJSON([],n,a)):r.DisposableEmail.index(null,function(i){var c={};e.each(i,function(e){c[e.guid]=e}),e.each(s.disposables,function(e){c[e.guid]||(c[e.guid]=new r.DisposableEmail(e),t.add(c[e.guid])),c[e.guid].createdAt=e.created_at||e.created,c[e.guid].mails=e.num_mails,c[e.guid].active=e.active}),t.flush(function(){var t=e.map(i,function(e){return e.toJSON()});o.respondWithJSON(t,n,a)})})})}else o.respondWithJSON([],n,a)},this))},createOnServer:function(t,n){this.emailServer=this.emailServer||new i;var s=null;r.DisposableEmail.findBy("accountId",s,e.bind(function(i){if(i)n?n(i):t.returnEntities(i);else{var s=e.bind(function(){this.emailServer.generateDisposable({label:t.payload.label,domain:a.disposableDomain,source:t.payload.source},function(e,i){e?(!0&&ABINE_DNTME.log.error("[ERROR HANDLER]#[abine/storage/disposableEmail]#[createOnServer]# error event in server.generateDisposable"),t.returnError(e)):(t.payload.guid=i.guid,t.payload.domain=i.domain,t.payload.user=i.user,t.payload.active=1,t.payload.createdAt=i.created,o.create(t,n))})},this);t.payload.label&&"MaskMe Feedback"==t.payload.label?r.DisposableEmail.findBy("label","MaskMe Feedback",function(e){e?n?n(e):t.returnEntities(e):s()}):s()}},this))}}),r.DisposableEmail=o,o}),ABINE_DNTME.define("abine/storage/disposablePhone",["documentcloud/underscore","persistence","abine/storageMixins","storage","persistence/caching"],function(e,t,n,i){var r=t.define("DisposablePhones",{accountId:"TEXT",shielded_phone_id:"INTEGER",rails_id:"INTEGER",country_code:"TEXT",number:"TEXT",createdAt:"DATE",modifiedAt:"DATE",pushVersion:"INTEGER",isSuspended:"TEXT",nextBillingDate:"DATE"});return r.enableCaching(),e.extend(r.prototype,{getPrettyNumber:function(){var e="("+this.getAreaCode()+") "+this.getExchange()+"-"+this.getLocal();return e},getAreaCode:function(){return this.number.substr(0,3)},getExchange:function(){return this.number.substr(3,3)},getLocal:function(){return this.number.substr(6,4)}}),e.extend(r,n.DefaultActions,{routes:{"read/disposablePhone/all":"index","read/disposablePhone/:id":"show","delete/disposablePhone/:id":"destroy","create/disposablePhone":"createFromDatabase"},createFromDatabase:function(e,t){i.DisposablePhone.all().one(function(n){n&&(e.payload.number=n.number,e.payload.country_code=n.country_code,r.create(e,t))})}}),i.DisposablePhone=r,r}),ABINE_DNTME.define("abine/storage/dntStats",["documentcloud/underscore","persistence","abine/storageMixins","storage","abine/localStorage","abine/securityManager","abine/badgeManager"],function(e,t,n,i,r,a,o){var s=t.define("DntStats",{totalAllTimeTrackers:"INTEGER",dailyTrackerCounts:"TEXT",badTrackers:"TEXT",viewedBadge:"BOOL",earnedOn:"INTEGER",currentBadge:"TEXT",currentBadgeIndex:"INTEGER"});return s.enableCaching(),e.extend(s,n.DefaultActions,{routes:{"create/dntStats":"create","read/dntStats/all":"index","read/dntStats/getBadgeData":"getBadgeData","update/dntStats/:id":"update"},getBadgeData:function(e){e.returnJSON(o.badges)}}),s.useLocalStorage(),i.DntStats=s,s}),ABINE_DNTME.define("abine/fixtures",["documentcloud/underscore","persistence","storage"],function(){return{createFixtures:function(e){this.createRidiculousDatabase(100,3),e()},getRandomInteger:function(e){return Math.floor(Math.random()*e)},getRandomString:function(e,t){t=t||"abcdefghijklmnopqrstuvwxyz1234567890";for(var n="",i=0;12>i;i++)n+=t.charAt(Math.floor(Math.random()*t.length));return n},generateFieldsForAccount:function(e,t,n){var i={value:this.getRandomString(10)+"@"+(t?"opayq.com":"gmail.com"),dataType:"/contact/email",origin:t?"disposable":"",name:"email"},r={value:i.value,dataType:"/contact/email",origin:t?"disposable":"",name:"confirm_email"},a={value:this.getRandomString(10,"0123456789"),dataType:"/contact/phone",origin:e?"disposable":"",name:"phone"},o={value:n?this.getRandomString(12):["password","tedted","iloveabine","maskme","a"][this.getRandomInteger(5)],dataType:"/password",origin:n?"strong":"",name:"password"},s={value:o.value,dataType:"/password",origin:n?"strong":"",name:"confirm_password"};return[i,r,a,o,s]},asyncCreateAccounts:function(e){if(e.length>0){e.shift()}},createRidiculousDatabase:function(e,t){for(var n=[],i=0;e>i;i++)for(var r="http://"+this.getRandomString(10)+[".com",".net",".org"][Math.floor(3*Math.random())],a=0;t>a;a++)n.push({data:{data:this.generateFieldsForAccount(0==this.getRandomInteger(3),0==this.getRandomInteger(3),0==this.getRandomInteger(3)),pageUrl:r,type:"registrationForm",url:r},fixture:!0,tabId:null});this.asyncCreateAccounts(n)}}}),ABINE_DNTME.define("abine/storage/globalData",["documentcloud/underscore","persistence","abine/storageMixins","storage","abine/webapp"],function(e,t,n,i,r){var a=function(){};e.extend(a,n.DefaultActions,{routes:{"create/globalTracker":"toggleTracker"},toggleTracker:function(e){e.payload.blocked?ABINE_DNTME.dnt_api.block(e.payload.name,"*"):ABINE_DNTME.dnt_api.allow(e.payload.name,"*")}});var o=function(){};e.extend(o,n.DefaultActions,{routes:{"create/globalPreference":"togglePreference"},togglePreference:function(e){"suggestions"==e.payload.name?ABINE_DNTME.dnt_api.setSuggestionsEnabled(e.payload.value):i.Preference.createOrModify({key:e.payload.name,value:e.payload.value?"true":"false"})}});var s=function(){};e.extend(s,n.DefaultActions,{routes:{"create/globalFeature":"toggleFeature"},toggleFeature:function(e,t){function n(n){s.respondWithJSON({name:e.payload.name,value:n?!e.payload.value:e.payload.value},e,t)}"browsing"==e.payload.name?(ABINE_DNTME.dnt_api.setDefaultBlocking(e.payload.value),n(!1)):this.setFeatureState(e.payload.name,e.payload.value,n)},setFeatureState:function(e,t,n){function a(){var r="suggestProtected"+e.charAt(0).toUpperCase()+e.slice(1);i.Preference.createOrModify({key:r,value:t?"true":"false"},function(){n(!1)})}return n=n||function(){},t&&e in{phone:1,card:1}?(i.Preference.batchFindBy([{by:"key",value:"entitledToPayments"},{by:"key",value:"entitledToPhone"},{by:"key",value:"authToken"},{by:"key",value:"hasEnabledPayments"},{by:"key",value:"suggestProtectedCard"},{by:"key",value:"regPassword"}],function(t){if("phone"==e&&t.entitledToPhone&&t.entitledToPhone.isTrue())i.ShieldedPhone.index(null,function(e){a(),0!=e.length&&e[0].isValidated()||(r.openPhones(),n(!0))});else if("card"==e&&t.entitledToPayments&&t.entitledToPayments.isTrue())if(t.hasEnabledPayments&&t.hasEnabledPayments.isTrue())a();else{var o=!0;t.suggestProtectedCard&&t.suggestProtectedCard.isFalse()&&(t.suggestProtectedCard.setTrue(),o=!1),r.openCards(),n(o)}else if("card"!=e||t.entitledToPayments&&t.entitledToPayments.isTrue())r.openPremium(e+"ToggleGlobal",e),n(!0);else if(!t.hasEnabledPayments||!t.hasEnabledPayments.isTrue()){var o=!0;t.suggestProtectedCard&&t.suggestProtectedCard.isFalse()&&(t.suggestProtectedCard.setTrue(),o=!1),r.openPremium(e+"ToggleGlobal",e),n(o)}}),void 0):void 0}});var c=function(){};return e.extend(c,n.DefaultActions,{routes:{"read/globalData/:id":"getGlobalData"},getSettings:function(e){i.Preference.batchFindBy([{by:"key",value:"authToken"},{by:"key",value:"suggestProtectedEmail"},{by:"key",value:"suggestProtectedPhone"},{by:"key",value:"suggestProtectedCard"},{by:"key",value:"hasEnabledPayments"},{by:"key",value:"entitledToPhone"},{by:"key",value:"entitledToAccounts"},{by:"key",value:"suggestStrongPassword"},{by:"key",value:"suggestAddresses"},{by:"key",value:"rememberAccounts"},{by:"key",value:"helpMeLogin"},{by:"key",value:"showMedals"},{by:"key",value:"showNotifications"},{by:"key",value:"showTrackersOnload"},{by:"key",value:"showInTheKnowGrowls"},{by:"key",value:"showWeeklyReports"},{by:"key",value:"autoPremiumRegisterShown"},{by:"key",value:"shouldSendErrorReports"}],function(t){var n={};n.loggedIn=t.authToken&&""!=t.authToken.value,n.browsing=ABINE_DNTME.dnt_api.getDefaultBlocking(),n.email=t.suggestProtectedEmail&&t.suggestProtectedEmail.isTrue(),n.phone=t.suggestProtectedPhone&&t.suggestProtectedPhone.isTrue()&&t.entitledToPhone&&t.entitledToPhone.isTrue(),n.card=t.suggestProtectedCard&&t.suggestProtectedCard.isTrue()&&(t.autoPremiumRegisterShown&&t.autoPremiumRegisterShown.isTrue()||t.hasEnabledPayments&&t.hasEnabledPayments.isTrue()),n.suggestions=ABINE_DNTME.dnt_api.getSuggestionsEnabled(),n.showMedals=t.showMedals&&t.showMedals.isTrue(),n.helpMeLogin=t.helpMeLogin&&t.helpMeLogin.isTrue(),n.showNotifications=t.showNotifications&&t.showNotifications.isTrue(),n.shouldSendErrorReports=t.shouldSendErrorReports&&t.shouldSendErrorReports.isTrue(),n.showTrackersOnload=t.showTrackersOnload&&t.showTrackersOnload.isTrue(),n.showInTheKnowGrowls=t.showInTheKnowGrowls&&t.showInTheKnowGrowls.isTrue(),n.showWeeklyReports=!t.showWeeklyReports||t.showWeeklyReports.isTrue(),n.premium=n.loggedIn&&t.entitledToPhone&&t.entitledToPhone.isTrue(),n.accounts=n.loggedIn&&t.entitledToAccounts&&t.entitledToAccounts.isTrue(),n.suggestStrongPassword=t.suggestStrongPassword&&t.suggestStrongPassword.isTrue(),n.rememberAccounts=t.rememberAccounts&&t.rememberAccounts.isTrue(),n.suggestAddresses=t.suggestAddresses&&t.suggestAddresses.isTrue(),e(n)})},getGlobalData:function(t,n){var r=ABINE_DNTME.dnt_api.getTabData(t.sender),a=ABINE_DNTME.dnt_api.getTrackerDefaults(),o=[];for(var s in a)o.push({name:s,blocked:a[s]});o.sort(function(e,t){return e=e.name.toLowerCase(),t=t.name.toLowerCase(),t>e?-1:e>t?1:0}),this.getSettings(e.bind(function(a){i.Blacklist.index(null,e.bind(function(s){var l=[];e.each(s,function(e){var e=e.toJSON();a.accounts&&(e.globalAccounts=!0),l.push(e)});var d=[],u=[],f={showTrackersOnload:1,suggestions:1,showMedals:1,shouldSendErrorReports:1,showInTheKnowGrowls:1,showWeeklyReports:1},h={browsing:1,email:1,card:1,phone:1};ABINE_DNTME.maskme_installed?(f={showTrackersOnload:1,suggestions:1,showMedals:1},h={browsing:1,search:1}):a.accounts&&(f.rememberAccounts=1,f.suggestStrongPassword=1,f.helpMeLogin=1,f.suggestAddresses=1);for(var p in f)p in a&&(d.push({name:p,value:a[p]}),delete a[p]);for(var m in h)u.push({name:m,value:a[m]}),delete a[m];a.tabId=r.tabId,a.host=r.host,a.trackers=o,a.preferences=d,a.globalFeatures=u,a.blacklist=l.sort(function(e,t){return e.domain.localeCompare(t.domain)}),a.maskmeInstalled=!!ABINE_DNTME.maskme_installed,i.Preference.findBy("key","new_version",function(e){e&&(a.new_version=e.value),c.respondWithJSON(a,t,n)})},this))},this))}}),i.GlobalData=c,i.GlobalTracker=a,i.GlobalPreference=o,i.GlobalFeature=s,c}),ABINE_DNTME.define("abine/storage/googleSharingManager",["documentcloud/underscore","persistence","abine/storageMixins","storage","abine/webapp","persistence/caching"],function(e,t,n,i){var r={};return e.extend(r,n.DefaultActions,{routes:{"read/googleSharingManager/background":"getStatus","read/googleSharingManager/disable":"disable","read/googleSharingManager/enable":"enable"},getStatus:function(e,t){var n=ABINE_DNTME.googleSharingManager?{enabled:ABINE_DNTME.googleSharingManager.isEnabled(),isMaintenance:ABINE_DNTME.googleSharingManager.isMaintenance(),maintenanceMessage:ABINE_DNTME.googleSharingManager.getMaintenanceMessage()}:{};r.respondWithJSON(n,e,t)},disable:function(e,t){ABINE_DNTME.googleSharingManager&&ABINE_DNTME.googleSharingManager.isEnabled()&&ABINE_DNTME.googleSharingManager.setEnabled(!1,e.payload.doNotSave,e.payload.error,e.payload.maintenance),r.respondWithJSON({},e,t)
},enable:function(e,t){ABINE_DNTME.googleSharingManager&&ABINE_DNTME.googleSharingManager.setEnabled(!0,e.payload.doNotSave),r.respondWithJSON({},e,t)}}),i.GoogleSharingManager=r,r}),ABINE_DNTME.define("abine/storage/loginUrl",["documentcloud/underscore","persistence","abine/storageMixins","storage","abine/lruCache","pidcrypt","abine/localStorage"],function(e,t,n,i,r,a,o){function s(e){return a.SHA1(e).substr(0,2)}var c=t.define("LoginUrl",{domain:"TEXT",href:"TEXT",events:"TEXT"}),l=50,d=new r(l);return e.extend(c,n.DefaultActions,{routes:{"read/loginUrl/site/:id":"loginUrlForSite"},loginUrlForSite:function(e,t){function n(){t?t(a):e.returnJSON(a)}var r=e.params[0],a=null;return r&&"null"!=r&&(a=d.fetch(r),!a)?(i.LoginUrl.getByDomain(r,function(e){a=e,d.add(r,a),n()}),void 0):(n(),void 0)},getByDomain:function(e,t){var n=s(e),i=o.getItem("loginurl-"+n,null);i?(i=JSON.parse(i),t(i[e])):t(null)},getAllLoginUrls:function(e){var t=o.getItem("loginurl-buckets",null),n=[];if(t){t=JSON.parse(t);for(var i=0;i<t.length;i++){var r=o.getItem("loginurl-"+t[i],null);if(r){r=JSON.parse(r);for(var a in r)for(var s=r[a],c=0;c<s.length;c++)n.push(s[c])}}}e(n)},saveAll:function(e){var t={},n=[];for(var i in e){var r=s(i);r in t||(t[r]={},n.push(r)),t[r][i]=e[i]}o.setItem("loginurl-buckets",JSON.stringify(n));for(var r in t)o.setItem("loginurl-"+r,JSON.stringify(t[r]));this.clearCache()},clearCache:function(){delete d,d=new r(l)}}),i.LoginUrl=c,c}),ABINE_DNTME.define("abine/storage/mappedField",["documentcloud/underscore","persistence","abine/storageMixins","storage"],function(e,t,n,i){var r=t.define("MappedField",{formId:"TEXT",signature:"TEXT",dataType:"TEXT"});return e.extend(r,n.DefaultActions,{routes:{"read/mappedField/all":"index","read/mappedField/:id":"show","create/mappedField":"create","update/mappedField/:id":"update","delete/mappedField/:id":"destroy"}}),i.MappedField=r,r}),ABINE_DNTME.define("abine/storage/mappedForm",["documentcloud/underscore","persistence","abine/storageMixins","storage","abine/lruCache","pidcrypt","abine/localStorage"],function(e,t,n,i,r,a,o){function s(e){return a.SHA1(e).substr(0,2)}var c=t.define("MappedForm",{domain:"TEXT",signature:"TEXT",mapping_signature:"TEXT",formType:"TEXT"}),l=50,d=new r(l);return e.extend(c,n.DefaultActions,{routes:{"read/mappedForm/all":"index","read/mappedForm/:id":"show","read/mappedForm/site/:id":"mappingsForSite","create/mappedForm":"create","update/mappedForm/:id":"update","delete/mappedForm/:id":"destroy"},mappingsForSite:function(e,t){var n=e.params[0];if("null"==n)return e.returnJSON?e.returnJSON([]):t&&t(),void 0;var r=d.fetch(n);r?e.returnJSON(r):i.MappedForm.getByDomain(n,function(t){d.add(n,t),e.returnJSON(t)})},getByDomain:function(e,t){var n=s(e),i=o.getItem("mapping-"+n,null);i?(i=JSON.parse(i),t(i[e])):t([])},getAllForms:function(e){var t=o.getItem("mapping-buckets",null),n=[];if(t){t=JSON.parse(t);for(var i=0;i<t.length;i++){var r=o.getItem("mapping-"+t[i],null);if(r){r=JSON.parse(r);for(var a in r)for(var s=r[a],c=0;c<s.length;c++)n.push(s[c])}}}e(n)},saveAllForms:function(e){for(var t={},n=[],i=0;i<e.length;i++){var r=e[i],a=s(r.domain);a in t||(t[a]={},n.push(a)),r.domain in t[a]||(t[a][r.domain]=[]),t[a][r.domain].push(r)}o.setItem("mapping-buckets",JSON.stringify(n));for(var a in t)o.setItem("mapping-"+a,JSON.stringify(t[a]));this.clearCache()},clearCache:function(){delete d,d=new r(l)}}),i.MappedForm=c,c}),ABINE_DNTME.define("abine/storage/note",["documentcloud/underscore","persistence","abine/storageMixins","abine/emailServer","storage","abine/config"],function(e,t,n,i,r){var a=t.define("Note",{label:"TEXT",description:"TEXT",pushed:"INTEGER",createdAt:"DATE",modifiedAt:"DATE"});return a.enableCaching(),e.extend(a,n.DefaultActions,{routes:{"read/note/all":"index"}}),a.useEncryption(["label","description"]),a.useLocalStorage(),a.useDropboxStorage(),r.Note=a,a}),ABINE_DNTME.define("abine/storage/panelActivity",["documentcloud/underscore","persistence","abine/storageMixins","storage"],function(e,t,n,i){var r=t.define("PanelActivity",{panelId:"INTEGER",impressions:"INTEGER",clicks:"INTEGER",users:"INTEGER",completions:"INTEGER",masks:"INTEGER",discloses:"INTEGER",closes:"INTEGER"});return r.enableCaching("panelId"),e.extend(r.prototype,{reset:function(e){e?(this.impressions-=e.impressions,this.clicks-=e.clicks,this.completions-=e.completions,this.users-=e.users,this.masks-=e.masks,this.discloses-=e.discloses,this.closes-=e.closes):(this.impressions=0,this.clicks=0,this.completions=0,this.users=0,this.masks=0,this.discloses=0,this.closes=0),t.flush()},hasData:function(){return this.impressions+this.clicks+this.completions+this.masks+this.discloses+this.closes>0},isMarketingPanel:function(){return this.panelId<1e6}}),e.extend(r,n.DefaultActions,{routes:{"read/panelActivity/all":"index","read/panelActivity/:id":"showByPanelId","create/panelActivity":"create","update/panelActivity/click":"addClick","update/panelActivity/conversion":"addConversion","update/panelActivity/impression":"addImpression","update/panelActivity/masked":"addMasked","update/panelActivity/disclosed":"addDisclosed","update/panelActivity/closed":"addClosed","update/panelActivity/:id":"update","delete/panelActivity/:id":"destroy"},createPanelActivity:function(e){var n=new i.PanelActivity({panelId:e,impressions:0,users:0,clicks:0,masks:0,discloses:0,closes:0,completions:0});return t.add(n),n},updateMetric:function(n,r,a){i.PanelActivity.findBy("panelId",n.payload.panelId,e.bind(function(e){e=e||this.createPanelActivity(n.payload.panelId),n.payload.revert?e[r]--:e[r]++,t.flush(),a?a.call(this,e):n.returnEntities&&n.returnEntities(e)},this))},addImpression:function(e,t){this.updateMetric(e,"impressions",t)},addClick:function(e,t){this.updateMetric(e,"clicks",t)},addMasked:function(e,t){this.updateMetric(e,"masks",t)},addDisclosed:function(e,t){this.updateMetric(e,"discloses",t)},addClosed:function(e,t){this.updateMetric(e,"closes",t)},addConversion:function(e,t){this.updateMetric(e,"completions",t)},showByPanelId:function(e,t){i.PanelActivity.findBy("panelId",e.params[0],function(n){t?t.call(this,n):e.returnEntities&&e.returnEntities(n)})}}),r.useLocalStorage(),i.PanelActivity=r,r}),ABINE_DNTME.define("abine/storage/preference",["documentcloud/underscore","persistence","abine/storageMixins","storage","abine/config","persistence/caching"],function(e,t,n,i,r){var a=function(){},o=t.define("Preferences",{key:"TEXT",value:"TEXT"});return o.enableCaching("key"),e.extend(o.prototype,{setTrue:function(){this.value="true"},setFalse:function(){this.value="false"},isTrue:function(){return 1==this.value||"true"===this.value},isFalse:function(){return!this.isTrue()},isEmpty:function(){return!this.value||""==this.value||"null"==(this.value+"").toLowerCase()}}),e.extend(o,n.DefaultActions,{routes:{"read/preference/all":"index","read/preference/name/:key":"showOneByKey","read/preference/prefspage":"showForPrefsPage","read/preference/:id":"show","create/preference":"create","update/preference/restore":"restore","update/preference/:id":"update","delete/preference/:id":"destroy"},showOneByKey:function(e,t){o.findBy("key",e.params[0],function(n){t?t.call(this,n):e&&e.returnEntities&&e.returnEntities(n)})},getSync:function(e){var t=null;return i.Preference.isCached()&&i.Preference.findBy("key",e,function(e){t=e}),t},findOrCreate:function(e,n){n=n||a,i.Preference.findBy("key",e.key,function(r){if(r)n(r);else{var a=new i.Preference(e);t.add(a),t.flush(function(){n(a)})}})},createOrModify:function(e,n){n=n||a,i.Preference.findBy("key",e.key,function(r){r?r.value=e.value:(r=new i.Preference(e),t.add(r)),t.flush(function(){n(r)})})},createOrIncrementByInteger:function(e,n){n=n||a,i.Preference.findBy("key",e.key,function(r){r?r.value===parseInt(r.value)&&(r.value=r.value+e.value):(r=new i.Preference(e),t.add(r)),t.flush(function(){n(r)})})},decrementByIntegerIfExists:function(e,n){n=n||a,i.Preference.findBy("key",e.key,function(i){i&&i.value===parseInt(i.value)&&(i.value=i.value-e.value,e.options&&e.options.nonNegative&&i.value<0&&(i.value=0)),t.flush(function(){n(i)})})},batchFindBy:function(t,n){n=n||a;var i={};e.async.forEach(t,e.bind(function(e,t){this.findBy(e.by,e.value,function(n){i[e.value]=n,t()})},this),function(){n(i)})},batchCreateOrModify:function(t,n){n=n||a,e.async.forEach(t,e.bind(function(e,t){this.createOrModify(e,function(){t()})},this),function(){n()})},retainDefaults:function(n){var r=function(e){return e.key in{entitledToSync:1,entitledToPayments:1,entitledToPhone:1,hasEnabledPayments:1}};i.Preference.listCached(r,e.bind(function(i){e.each(i,function(e){t.remove(e)}),t.flush(function(){n()})},this))}}),o.useLocalStorage(),o._defaults=[{key:"freshInstall",value:"true"},{key:"showNotifications",value:"true"},{key:"helpMeLogin",value:"true"},{key:"showMedals",value:r.silent?"false":"true"},{key:"suggestProtectedEmail",value:r.silent?"false":"true"},{key:"suggestStrongPassword",value:r.silent?"false":"true"},{key:"suggestProtectedPhone",value:r.silent?"false":"true"},{key:"suggestProtectedCard",value:r.silent?"false":"true"},{key:"suggestAddresses",value:r.silent?"false":"true"},{key:"confirmProtectedCard",value:"true"},{key:"shouldSendErrorReports",value:"true"},{key:"showTrackersOnload",value:r.silent?"false":"false"},{key:"showInTheKnowGrowls",value:"true"},{key:"showPremiumSubscriptionPanel",value:"true"},{key:"rememberAccounts",value:r.silent?"false":"true"},{key:"showWeeklyReports",value:r.silent?"false":"true"},{key:"footerCampaign",value:Math.random()>.5?"A":"B"},{key:"countNotifications",value:"0"},{key:"splitTests",value:""}],i.Preference=o,o}),ABINE_DNTME.define("abine/storage/realCard",["documentcloud/underscore","persistence","abine/storageMixins","abine/emailServer","storage","abine/config"],function(e,t,n,i,r){var a=t.define("RealCard",{label:"TEXT",first_name:"TEXT",last_name:"TEXT",number:"TEXT",expiry_month:"TEXT",expiry_year:"TEXT",cvc:"TEXT",type:"TEXT",address_id:"TEXT",pushed:"INTEGER",createdAt:"DATE",modifiedAt:"DATE"});return a.enableCaching(),e.extend(a,n.DefaultActions,{routes:{"read/realCard/all":"indexWithAddress"},indexWithAddress:function(t,n){r.Address.index(null,function(i){var a={};e.each(i,function(e){a[e.id]=e.toJSON()}),r.RealCard.index(null,function(i){var r=[];e.each(i,function(e){var e=e.toJSON();e.address=e.address_id&&e.address_id in a?a[e.address_id]:e.address_id=null,r.push(e)}),n?n.call(this,i):t.returnJSON(r)})})}}),a.useEncryption(["label","first_name","last_name","number","expiry_month","expiry_year","cvc","type"]),a.useLocalStorage(),a.useDropboxStorage(),r.RealCard=a,a}),ABINE_DNTME.define("abine/storage/registry",["abine/timer","abine/storageRouter","storage"],function(e,t,n){return{registerStorageEntities:function(e){e.registerEntity(n.Blacklist,"blacklist"),e.registerEntity(n.DisposableCard,"disposableCard"),e.registerEntity(n.DisposableEmail,"disposableEmail"),e.registerEntity(n.DisposablePhone,"disposablePhone"),e.registerEntity(n.LoginUrl,"loginUrl"),e.registerEntity(n.MappedForm,"mappedForm"),e.registerEntity(n.MappedField,"mappedField"),e.registerEntity(n.PanelActivity,"panelActivity"),e.registerEntity(n.Preference,"preference"),e.registerEntity(n.ShieldedCard,"shieldedCard"),e.registerEntity(n.ShieldedEmail,"shieldedEmail"),e.registerEntity(n.ShieldedPhone,"shieldedPhone"),e.registerEntity(n.TabData,"tabData"),e.registerEntity(n.Address,"address"),e.registerEntity(n.Account,"account"),e.registerEntity(n.RealCard,"realCard"),e.registerEntity(n.Note,"note"),e.registerEntity(n.PageTracker,"pageTracker"),e.registerEntity(n.CustomTabData,"customTabData"),e.registerEntity(n.BlacklistOrPreference,"blacklistOrPreference"),e.registerEntity(n.GlobalData,"globalData"),e.registerEntity(n.GlobalTracker,"globalTracker"),e.registerEntity(n.GlobalPreference,"globalPreference"),e.registerEntity(n.GlobalFeature,"globalFeature"),e.registerEntity(n.DntStats,"dntStats"),e.registerEntity(n.TrackerInfo,"trackerInfo"),e.registerEntity(n.Advt,"advt"),e.registerEntity(n.GoogleSharingManager,"googleSharingManager")},emptyDatabase:function(i,r){t.StorageRouter.initializeWebSQLStorage({dbName:"idme_test",dbDescription:"Storage for the unit tests",dbSizeInBytes:5242880,ready:function(){var t=14;n.Account.all().destroyAll(function(){t--}),n.Address.all().destroyAll(function(){t--}),n.Blacklist.all().destroyAll(function(){t--}),n.RealCard.all().destroyAll(function(){t--}),n.Note.all().destroyAll(function(){t--}),n.DisposableCard.all().destroyAll(function(){t--}),n.DisposableEmail.all().destroyAll(function(){t--}),n.DisposablePhone.all().destroyAll(function(){t--}),n.Preference.all().destroyAll(function(){t--}),n.MappedForm.all().destroyAll(function(){t--}),n.MappedField.all().destroyAll(function(){t--}),n.ShieldedCard.all().destroyAll(function(){t--}),n.ShieldedEmail.all().destroyAll(function(){t--}),n.ShieldedPhone.all().destroyAll(function(){t--});var i=function(){t>0?e.setTimeout(i,50):r.call()};e.setTimeout(i,50)}})}}}),ABINE_DNTME.define("abine/storage/shieldedCard",["documentcloud/underscore","persistence","abine/storageMixins","storage","abine/eventLogger","persistence/caching","abine/config","abine/licenseServer"],function(e,t,n,i,r,a,o,s,c){var l=t.define("ShieldedCards",{last_four:"TEXT",first_name:"TEXT",last_name:"TEXT",month:"TEXT",year:"TEXT",card_type:"TEXT",address1:"TEXT",address2:"TEXT",city:"TEXT",state_abbreviation:"TEXT",zip:"TEXT",createdAt:"DATE",modifiedAt:"DATE",pushVersion:"INTEGER"});return l.enableCaching(),e.extend(l.prototype,{}),e.extend(l,n.DefaultActions,{routes:{"read/shieldedCard/all":"index","read/shieldedCard/:id":"show","create/shieldedCard":"createFromServer","update/shieldedCard/:id":"update","delete/shieldedCard/:id":"destroy"},createFromServer:function(e,t){i.Preference.findBy("key","authToken",function(n){!n||n.isEmpty(),this.licenseServer=this.licenseServer||new c,this.licenseServer.billingInfo({},function(n,i){n?!0&&ABINE_DNTME.log.error("[ERROR HANDLER]#[abine/storage/shieldedCard]#[createFromServer]# error event in shieldedCard.createFromServer call to license server"):(e.payload.first_name=i.first_name,e.payload.last_name=i.last_name,e.payload.month=i.month,e.payload.year=i.year,e.payload.card_type=i.card_type,e.payload.zip=i.zip,e.payload.last_four=i.last_four,e.payload.address1=i.address1,e.payload.address2=i.address2,e.payload.city=i.city,e.payload.state_abbreviation=i.state,l.create(e,t))})})}}),i.ShieldedCard=l,l}),ABINE_DNTME.define("abine/storage/shieldedEmail",["documentcloud/underscore","persistence","abine/storageMixins","abine/config","abine/emailServer","storage","persistence/caching"],function(e,t,n,i,r,a){var o=t.define("ShieldedEmails",{guid:"TEXT",userId:"INT",email:"TEXT",active:"BOOL",createdAt:"DATE",modifiedAt:"DATE",pushVersion:"INTEGER"});return o.enableCaching("email"),e.extend(o,n.DefaultActions,{routes:{"read/shieldedEmail/all":"index","read/shieldedEmail/:id":"show","delete/shieldedEmail/:id":"destroy"},getDefault:function(e,t){o.index(e,function(n){var i=n?n[0]:null;o.respondWithEntities(i,e,t)})}}),a.ShieldedEmail=o,o}),ABINE_DNTME.define("abine/storage/shieldedPhone",["documentcloud/underscore","persistence","abine/storageMixins","storage","persistence/caching","abine/phoneServer","abine/config"],function(e,t,n,i){var r=t.define("ShieldedPhones",{country_code:"TEXT",number:"TEXT",is_validated:"TEXT",rails_id:"INTEGER",auth_token:"TEXT",createdAt:"DATE",modifiedAt:"DATE",pushVersion:"INTEGER"});return r.enableCaching(),e.extend(r.prototype,{refresh:function(e){e()},getPrettyNumber:function(){var e="("+this.getAreaCode()+") "+this.getExchange()+"-"+this.getLocal();return e},getAreaCode:function(){return this.number.substr(0,3)},getExchange:function(){return this.number.substr(3,3)},getLocal:function(){return this.number.substr(6,4)},isValidated:function(){return"true"==this.is_validated}}),e.extend(r,n.DefaultActions,{routes:{"read/shieldedPhone/all":"indexWithRefresh","read/shieldedPhone/:id":"showWithRefresh"},showWithRefresh:function(e,t){r.load(e.params[0],function(n){n.refresh(function(){r.show(e,t)})})},indexWithRefresh:function(t,n){r.index(null,function(i){e.async.forEach(i,function(e,t){e.refresh(t)},function(e){e&&!0&&ABINE_DNTME.log.error("[ERROR CALLBACK]#[abine/storage/shieldedPhone]#[indexWithRefresh]# error event in ShieldedPhone.index async forEach"),r.index(t,n)})})}}),i.ShieldedPhone=r,r}),ABINE_DNTME.define("abine/storage/tabData",["documentcloud/underscore","persistence","abine/storageMixins","storage","abine/ajax"],function(e,t,n,i,r){function a(e){e=e||new Date;var t=new Date(e.getFullYear(),0,0);return Math.floor((e-t)/864e5)}var o=864e5,s=function(){};e.extend(s,n.DefaultActions,{routes:{"create/pageTracker":"toggleTracker"},toggleTracker:function(e){var t=e.sender,n=ABINE_DNTME.dnt_api.getTabData(t);e.payload.blocked?ABINE_DNTME.dnt_api.block(e.payload.name,n.host):ABINE_DNTME.dnt_api.allow(e.payload.name,n.host)}});var c=function(){};e.extend(c,n.DefaultActions,{routes:{"create/customTabData":"setCustomData"},setCustomData:function(e){ABINE_DNTME.dnt_api.setCustomTabData(e.sender,e.payload.name,e.payload.value)}});var l=function(){};e.extend(l,n.DefaultActions,{routes:{"update/blacklistOrPreference/:id":"save"},save:function(e,t){var n=e.payload.type;if("blacklist"==n){var r={payload:{domain:e.payload.domain,changed:e.payload.name},params:[e.payload.id],sender:e.sender};r.payload[e.payload.name]=e.payload.value,i.Blacklist.updateOrCreate(r,t)}else i.GlobalPreference.togglePreference(e,t)}});var d=function(){};return e.extend(d,n.DefaultActions,{routes:{"read/tabData/:id":"getTabData","create/tabData":"reportIssue"},reportIssue:function(e){var t=ABINE_DNTME.dnt_api.getTabData(e.sender);i.Preference.batchFindBy([{by:"key",value:"installVersion"}],function(n){var i="";if(t){for(var i=[],a=0;a<t.trackers.length;a++)i.push(t.trackers[a].name);i=i.join(",")}var o={};o.reason="dntme-feedback",o.version=ABINE_DNTME.config.version,o.origin=ABINE_DNTME.config.tags[0],o.revision=ABINE_DNTME.config.buildNum,o.oversion=n.installVersion?n.installVersion.value:"",o.url=t?encodeURIComponent(t.url):"",o.description=encodeURIComponent(e.payload.feedback),o.rulesversion=encodeURIComponent(ABINE_DNTME.dnt_api.getRulesVersion()),o.trackers=i,o.domain=encodeURIComponent(t?t.host:""),o.log="",r.ajax({url:"http://www.abine.com/checkin/dntmefeedback.php",data:"data="+JSON.stringify(o)})})},getWeeklyReportData:function(e,t,n,i){var r=(e.getTime()-t.getTime())/o,s=7,c=t.getDay();c>1&&(s+=7-t.getDay());var l=e.getDay();if(r>=s&&l>0&&3>=l){var d=null;n&&(d=parseInt(n));var u=new Date(e.getTime()-l*o);u.setHours(0,0,0,0);for(var f=!1,h=i.dailyTrackerCounts?JSON.parse(i.dailyTrackerCounts):{},p=0;7>p;p++){var m=new Date(u.getFullYear(),u.getMonth(),u.getDate()-p),g=a(m),y=m.getFullYear();if(y in h&&h[y][g]>0){f=!0;break}}if(f&&(!d||d<u.getTime()))return["January","February","March","April","May","June","July","August","September","October","November","December"][u.getMonth()]+" "+u.getDate()}return null},getTabData:function(e,t){var n=ABINE_DNTME.dnt_api.getTabData(e.sender);n||ABINE_DNTME.require(["abine/dnt/tabData"],function(t){t.get(e.sender),n=ABINE_DNTME.dnt_api.getTabData(e.sender)},null,!0);var r=this;i.Preference.batchFindBy([{by:"key",value:"authToken"},{by:"key",value:"installDate"},{by:"key",value:"suggestProtectedEmail"},{by:"key",value:"suggestProtectedPhone"},{by:"key",value:"suggestProtectedCard"},{by:"key",value:"hasEnabledPayments"},{by:"key",value:"entitledToPayments"},{by:"key",value:"entitledToPhone"},{by:"key",value:"entitledToAccounts"},{by:"key",value:"rememberAccounts"},{by:"key",value:"sync_store_manager"},{by:"key",value:"devices"},{by:"key",value:"showMedals"},{by:"key",value:"oldEmail"},{by:"key",value:"suggestStrongPassword"},{by:"key",value:"showTrackersOnload"},{by:"key",value:"showWeeklyReports"},{by:"key",value:"weeklyReportClickedOn"},{by:"key",value:"autoPremiumRegisterShown"}],function(a){i.ShieldedPhone.index(null,function(o){i.DisposableEmail.index(null,function(s){i.Blacklist.findBy("domain",n.host,function(c){ABINE_DNTME.dnt_api.forceSaveStats(),i.DntStats.index(null,function(l){n.dntStats=l[0].toJSON(),n.dntStats.showMedals=!a.showMedals||"true"==a.showMedals.value,n.loggedIn=a.authToken&&a.authToken.value&&""!=a.authToken.value,!n.loggedIn&&a.oldEmail&&a.oldEmail.value&&""!=a.oldEmail.value&&(n.email=a.oldEmail.value),n.showTrackersOnload=a.showTrackersOnload&&a.showTrackersOnload.isTrue(),n.hasMobileApp=n.loggedIn&&(a.devices&&a.devices.value?a.devices.value.match(/(Phone|Tablet)App/i):!1),n.dropboxEnabled=n.loggedIn&&(a.sync_store_manager?"dropbox"==a.sync_store_manager.value:!1),c||(c=new i.Blacklist({domain:n.host,tracker:n.disabled})),n.blacklist=c.toJSON(),n.blacklist.loggedIn=n.loggedIn,n.blacklist.globalPhone=a.suggestProtectedPhone&&a.suggestProtectedPhone.isTrue(),n.blacklist.globalCard=a.suggestProtectedCard&&a.suggestProtectedCard.isTrue(),n.blacklist.globalEmail=a.suggestProtectedEmail&&a.suggestProtectedEmail.isTrue(),n.blacklist.globalPassword=a.suggestStrongPassword&&a.suggestStrongPassword.isTrue(),n.blacklist.globalLogin=a.rememberAccounts&&a.rememberAccounts.isTrue(),n.blacklist.hasEnabledPhone=a.entitledToPhone&&a.entitledToPhone.isTrue()&&o.length>0&&o[0].isValidated(),n.blacklist.hasEnabledCard=a.autoPremiumRegisterShown&&a.autoPremiumRegisterShown.isTrue()||a.hasEnabledPayments&&a.hasEnabledPayments.isTrue(),n.blacklist.hasEnabledAccounts=a.entitledToAccounts&&a.entitledToAccounts.isTrue(),n.blacklist.has_masked_emails=s.length>1,n.blacklist.has_masked_phones=o.length>0,n.blacklist.premium=n.premium,n.premium=a.authToken&&""!=a.authToken.value&&a.entitledToPhone&&a.entitledToPhone.isTrue(),n.cardMoney=a.authToken&&""!=a.authToken.value&&a.entitledToPayments&&a.entitledToPayments.isTrue()&&!n.premium,n.showFreeCard=!(n.premium||n.cardMoney),n.dntStats.premium=n.premium,n.dntStats.maskmeInstalled=n.blacklist.maskmeInstalled=n.maskmeInstalled=!!ABINE_DNTME.maskme_installed;var u=new Date;u.setHours(0,0,0,0);var f=new Date(a.installDate?a.installDate.value:u.getTime());if(f.setHours(0,0,0,0),n.installMonth=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][f.getMonth()]+" '"+f.getFullYear().toString().substr(2),n.weeklyReport=null,!ABINE_DNTME.maskme_installed&&(!a.showWeeklyReports||a.showWeeklyReports.isTrue())){var h=null;a.weeklyReportClickedOn&&(h=a.weeklyReportClickedOn.value),n.weeklyReport=r.getWeeklyReportData(u,f,h,n.dntStats)}d.respondWithJSON(n,e,t)})})})})})}}),i.TabData=d,i.PageTracker=s,i.CustomTabData=c,i.BlacklistOrPreference=l,d}),ABINE_DNTME.define("abine/storage/trackerInfo",["documentcloud/underscore","persistence","abine/storageMixins","storage","abine/ajax"],function(e,t,n,i,r){var a={},o="/api/v1/lookup",s=t.define("TrackerInfo",{domain:"TEXT",trackers:"TEXT",color:"TEXT",info:"TEXT"});return e.extend(s,n.DefaultActions,{routes:{"read/trackerInfo/index":"getTrackersForDomains"},getTrackersForDomains:function(e,t){function n(){s.respondWithJSON(c,e,t)}var i=e.payload.domains,c=[],l=[];for(var d in i)a[d]?c.push(a[d]):l.push(d);if(l.length>0){var u="https://"+ABINE_DNTME.config.trackerHost+o;r.ajax({url:u,type:"POST",data:{urls:l},success:function(e){for(var t in e)if(e[t].trackers){if("No data"==e[t].trackers)a[t]={domain:t};else{var i,r=e[t].trackers.length;i=1>=r?"green":r>1&&5>=r?"yellow":"red",a[t]={domain:t,trackers:e[t].trackers.join(":"),color:i,info:e[t].info}}c.push(a[t])}n()},error:function(){n()}})}else n()}}),i.TrackerInfo=s,s}),ABINE_DNTME.define("storage",["persistence","documentcloud/underscore"],function(e,t){var n={dumpToJSON:function(){var t=[];for(var i in n)"meta"in n[i]&&t.push(n[i]);e.dump(t,function(e){JSON.stringify(e)})},purgeDatabase:function(i){e.clean();var r=[];for(var a in n)"meta"in n[a]&&r.push(n[a]);t.async.forEach(r,function(t,n){e.transaction(function(e){e.executeSql("delete from "+t.meta.name,null,function(){n()})})},function(){i()})},clearAllCache:function(e,i){n.Account.clearCache(function(){n.Address.clearCache(function(){n.Note.clearCache(function(){n.RealCard.clearCache(function(){n.Account.index(null,function(r){n.Address.index(null,function(a){n.Note.index(null,function(o){n.RealCard.index(null,function(n){ABINE_DNTME.require(["abine/dropbox-api"],function(s){"dropbox"==e?s.connectAndLoad():(s.disconnect(),t.each(r,function(e){e.pushed=0}),t.each(a,function(e){e.pushed=0}),t.each(o,function(e){e.pushed=0}),t.each(n,function(e){e.pushed=0})),i()})})})})})})})})})}};return n}),ABINE_DNTME.require("abine/storage/blacklist"),ABINE_DNTME.require("abine/storage/disposableCard"),ABINE_DNTME.require("abine/storage/disposableEmail"),ABINE_DNTME.require("abine/storage/disposablePhone"),ABINE_DNTME.require("abine/storage/loginUrl"),ABINE_DNTME.require("abine/storage/mappedForm"),ABINE_DNTME.require("abine/storage/mappedField"),ABINE_DNTME.require("abine/storage/panelActivity"),ABINE_DNTME.require("abine/storage/preference"),ABINE_DNTME.require("abine/storage/shieldedCard"),ABINE_DNTME.require("abine/storage/shieldedEmail"),ABINE_DNTME.require("abine/storage/shieldedPhone"),ABINE_DNTME.require("abine/storage/tabData"),ABINE_DNTME.require("abine/storage/address"),ABINE_DNTME.require("abine/storage/account"),ABINE_DNTME.require("abine/storage/realCard"),ABINE_DNTME.require("abine/storage/globalData"),ABINE_DNTME.require("abine/storage/dntStats"),ABINE_DNTME.require("abine/storage/note"),ABINE_DNTME.require("abine/storage/trackerInfo"),ABINE_DNTME.require("abine/storage/advt"),ABINE_DNTME.require("abine/storage/googleSharingManager"),ABINE_DNTME.define("abine/modules/license",["documentcloud/underscore","jquery","abine/core","abine/timer","storage","persistence","abine/ajax","abine/config","abine/securityManager","abine/licenseServer","abine/responseCodes","modules","abine/crypto","abine/ajax","abine/webapp"],function(e,t,n,i,r,a,o,s,c,l,d,u,f,o,h){var p=function(){},m=function(){var e=new Date;return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e},g=n.BaseClass.extend({initialize:function(e){this.options=e,this.licenseServer=this.options.licenseServer||new l},setMessenger:function(e){this.messenger=e},startDailyTouch:function(t){t=t||p,r.Preference.findBy("key","lastTouch",e.bind(function(e){if(e&&e.value){var n=new Date(parseInt(e.value));n.valueOf()<m().valueOf()?this.makeDailyActiveTouch(!1,t):this.delayDailyActiveTouch(t)}else this.makeDailyActiveTouch(!0,function(){t()})},this))},makeDailyActiveTouch:function(t,n){if(n=n||p,ABINE_DNTME.maskme_installed)return n(),void 0;var i={};i.install=!!t,r.Preference.batchFindBy([{by:"key",value:"authToken"},{by:"key",value:"installAuthToken"}],e.bind(function(t){var a=t.authToken,o=t.installAuthToken;a&&!a.isEmpty()&&(i.auth_token=a.value),o&&!o.isEmpty()&&(i.install_auth_token=o.value),this.licenseServer.makeDailyTouch(i,e.bind(function(t,i){t?this.delayDailyActiveTouch(function(){n(t)}):this.writeDailyTouchPref(e.bind(function(){this.delayDailyActiveTouch(function(){if(i.install_auth_token){if(i.splits&&i.splits.length>0){var t=e.reduce(i.splits,function(e,t){return e[t.test_name]=t.bucket_id,e},{});try{r.Preference.createOrModify({key:"splitTests",value:JSON.stringify(t)})}catch(a){}}if(i.config_overrides&&i.config_overrides.length>0){var o=e.reduce(i.config_overrides,function(e,t){return e[t.config_name]=t.config_value,e},{});try{r.Preference.createOrModify({key:"configOverrides",value:JSON.stringify(o)})}catch(a){}}r.Preference.createOrModify({key:"installAuthToken",value:i.install_auth_token},n)}else n()})},this))},this))},this))},removeDailyTouchPref:function(e){r.Preference.findBy("key","lastTouch",function(t){t?(a.remove(t),a.flush(e)):e()})},delayDailyActiveTouch:function(t){t=t||p;var n=18e5+36e5*Math.random();this.dailyActiveTimeout&&i.clearTimeout(this.dailyActiveTimeout),this.dailyActiveTimeout=i.setTimeout(e.bind(this.startDailyTouch,this),n),t()},writeDailyTouchPref:function(e){e=e||p,r.Preference.findOrCreate({key:"lastTouch"},function(t){t.value=Math.floor(m().valueOf()),t.modifiedAt=m(),a.flush(function(){e()})})},sendFeedbackEmail:function(t,n){n=n||p,this.licenseServer.sendFeedbackEmail(t,e.bind(function(e,t){e?n(e):n(null,t)},this))},logAction:function(t,n){n=n||p,r.Preference.findBy("key","sendToolbarClick",e.bind(function(i){i||r.Preference.createOrModify({key:"sendToolbarClick",value:"true"},e.bind(function(){this.licenseServer.logAction(t,e.bind(function(e,t){e?n(e):n(null,t)},this))},this))},this))},logSplitData:function(t,n){n=n||p,this.licenseServer.logSplitData(t,e.bind(function(e,t){e?n(e):n(null,t)},this))},logPasswordFillData:function(t,n){n=n||p,this.licenseServer.logPasswordFillData(t,e.bind(function(e,t){e?n(e):n(null,t)},this))},login:function(t,n){n=n||p;var i=t.password;t.password=f.getServerPassword(i);var r=f.generateKey();t.key=f.encryptKey(i,r),t.verify_key=f.encryptKey(r,r),this.licenseServer.login({application:"manageme",user_login:t},e.bind(function(e,r){e?(t.password=i,n(e,r)):this._afterLoginOrRegister(r,i,function(){n(null,r)})},this))},_afterLoginOrRegister:function(t,n,o){var s=f.decryptKey(n,t.user.key,null,!0);s==t.user.key&&(s=null),r.Preference.batchCreateOrModify([{key:"authToken",value:t.auth_token},{key:"key",value:s},{key:"installAuthToken",value:t.install_auth_token},{key:"hasRegistered",value:"true"},{key:"passwordHint",value:t.password_hint}],e.bind(function(){c.setAuthToken(t.auth_token,s,e.bind(function(){a.flush(e.bind(function(){i.setTimeout(function(){u.mappingsModule.refreshPanels()},2e4),this.messenger.broadcastToAllTabs("broadcast:preference:reload",{}),this.messenger.broadcastToAllTabs("broadcast:register:success",{}),h.reload(),o()},this))},this))},this))},register:function(t,n){n=n||p;var i=t.password,o=t.register_type,c="send_password_email"in t?t.send_password_email:!0;if(!t.generated_password){var l=f.generateKey();t.key=f.encryptKey(i,l),t.verify_key=f.encryptKey(l,l)}delete t.generated_password,t.password=f.getServerPassword(i),t.password_confirmation=t.password,t.tag=s.tags[0],delete t.register_type,delete t.send_password_email;var d=t;r.Preference.createOrModify({key:"registerInProgress",value:"true"},e.bind(function(r){this.licenseServer.register({user:d,application:"manageme",send_password_email:c,register_type:o},e.bind(function(o,s){o?(t.password=i,t.password_confirmation=i,a.remove(r),a.flush(e.bind(function(){this.messenger.broadcastToAllTabs("broadcast:register:failed",{err:o,serverData:s}),n(o,s)},this))):(a.remove(r),this._afterLoginOrRegister(s,i,function(){n(null,s)}))},this))},this))},subscribe:function(t,n,i,r){r=r||p,this.licenseServer.signature({},e.bind(function(a,s){function c(t){var n=t.indexOf("{"),a=t.lastIndexOf("}"),o=JSON.parse(t.substr(n,a-n+1));o.success?this.licenseServer.subscribed({recurly_token:o.success.token,source:i},e.bind(function(t){t?r(!0,{errors:{base:["Error activating payments"]}}):this.refreshEntitlements(e.bind(function(){this.refreshLastFourCardDigits({},function(){r(!1,{})})},this))},this)):r(!0,o)}var l={signature:s[n+"_options_signature"],account:s[n+"_options"].account,billing_info:t,subscription:s[n+"_options"].subscription,currency:s.recurly_config.currency},d=s.recurly_config.subdomain,u="https://"+d+".recurly.com/jsonp/"+d+"/subscribe";o.ajax({dataType:"text",url:u,data:l,success:e.bind(c,this),error:e.bind(c,this)})},this))},refreshEntitlements:function(t){t=t||p,this.licenseServer.refreshEntitlements({},e.bind(function(n,i){n?t(n,i):this.updateEntitlementPrefs(i.user.licenses,e.bind(function(){this.updateHasEnabledPaymentsPref(i.user.activated_cards_at,e.bind(function(){a.flush(e.bind(function(){this.messenger.broadcastToAllTabs("broadcast:preference:reload",{}),t(null,i)},this))},this))},this))},this))},updateEntitlementPrefs:function(t,n){n=n||p;var i={entitledToSync:"sync",entitledToPhone:"protected_phone",entitledToPayments:"payments",entitledToAccounts:"accounts"},o={},s={},c=function(e){return e.key in i};r.Preference.listCached(c,e.bind(function(c){e.each(c,function(e){o[i[e.key]]=e});for(var l in i)i[l]in o||(o[i[l]]=new r.Preference({key:l,value:"false"}),a.add(o[i[l]]));var d=o.protected_phone.isTrue(),u=o.payments.isTrue(),f=o.accounts.isTrue();e.each(t,function(e){o[e.feature_code]&&o[e.feature_code].setTrue(),s[e.feature_code]=1}),e.each(e.keys(o),function(e){e in s||o[e].setFalse()}),d&&o.protected_phone.isFalse()&&(r.ShieldedPhone.all().destroyAll(),r.DisposablePhone.all().destroyAll()),r.Preference.createOrModify({key:"hadEmail",value:"true"}),r.Preference.createOrModify({key:"hadPhone",value:o.protected_phone&&o.protected_phone.isTrue()?"true":"false"}),r.Preference.createOrModify({key:"hadCard",value:o.payments&&o.payments.isTrue()?"true":"false"}),o.payments&&o.payments.isTrue()&&this.refreshLastFourCardDigits(),u&&o.payments.setTrue(),!f&&o.accounts&&o.accounts.isTrue()&&r.Preference.batchCreateOrModify([{key:"suggestStrongPassword",value:"true"},{key:"suggestAddresses",value:"true"},{key:"helpMeLogin",value:"true"},{key:"rememberAccounts",value:"true"}]),e.each(c,function(e){a.forceAdd(e)
}),a.flush(function(){n()})},this))},refreshLastFourCardDigits:function(t,n){n=n||p,this.licenseServer.billingInfo({},e.bind(function(t,i){t?n(t,i):i.subscription&&!i.subscription.card_not_setup?(r.Preference.findBy("key","cardNotSetup",function(e){e&&a.remove(e)}),r.ShieldedCard.index(null,e.bind(function(t){if(t&&t[0]){var o=t[0];o.last_four=i.last_four,o.first_name=i.first_name,o.last_name=i.last_name,o.month=i.month,o.year=i.year,o.card_type=i.card_type,o.zip=i.zip,a.flush(e.bind(function(){this.messenger.broadcast("broadcast:billinginfo:updated",{}),n(null,i)},this))}else r.ShieldedCard.create({payload:i},e.bind(function(){this.messenger.broadcast("broadcast:billinginfo:updated",{}),n(null,i)},this))},this))):i.subscription&&i.subscription.card_not_setup?r.Preference.createOrModify({key:"cardNotSetup",value:"true"},function(){n(null,i)}):n(null,i)},this))},updateHasEnabledPaymentsPref:function(t,n){n=n||p(),r.Preference.batchFindBy([{by:"key",value:"hasEnabledPayments"},{by:"key",value:"suggestProtectedCard"},{by:"key",value:"autoPremiumRegisterShown"}],e.bind(function(e){var i=e.hasEnabledPayments;i||(i=new r.Preference({key:"hasEnabledPayments",value:"false"}),a.add(i)),i&&i.isTrue()!=Boolean(t)&&(t?(e.autoPremiumRegisterShown&&e.autoPremiumRegisterShown.isTrue()&&(a.remove(e.autoPremiumRegisterShown),e.suggestProtectedCard||(e.suggestProtectedCard=new r.Preference({key:"suggestProtectedCard",value:"true"}),a.add(e.suggestProtectedCard)),e.suggestProtectedCard.setTrue()),i.setTrue()):i.setFalse()),a.flush(function(){n()})},this))},retrieveMedalsEarned:function(t){this.licenseServer.retrieveMedalsEarned({},e.bind(function(e,n){e?t(e):t(null,n)}))},incrementMedalsEarned:function(t,n){var i={additional_medals_earned:t};this.licenseServer.incrementMedalsEarned(i,e.bind(function(e,t){e?n(e):n(null,t)},this))},incrementMedalsEarnedWithCurrentMedals:function(t,n){r.DntStats.index(null,e.bind(function(e){var e=e[0],i=e.currentBadgeIndex+1;i>0?(t&&r.Preference.createOrIncrementByInteger({key:"cardsEarned",value:i},function(){}),this.incrementMedalsEarned(i,n)):n()},this))},retrieveSyncstoreToken:function(t){t=t||p,this.licenseServer.retrieveSyncstoreToken({},e.bind(function(e,n){e?t(e):t(null,n)}))},retrieveDevices:function(t){t=t||p,this.licenseServer.retrieveDevices({},e.bind(function(n,i){if(n)t();else{var a=i.devices||[],o={};e.each(a,function(e){var t=e.platform,n=e.device_type,i=e.device;"Android"==t&&("Desktop"==n&&(n="Phone"),i&&i.match(/nexus 10/i)&&(n="Tablet")),o[n+e.product]=!0}),r.Preference.createOrModify({key:"devices",value:JSON.stringify(o)},function(){t()})}}))}}),y=new g({});return u.licenseModule=y,y}),ABINE_DNTME.define("abine/modules/panels",["documentcloud/underscore","jquery","abine/core","abine/timer","storage","persistence","abine/ajax","abine/config","abine/securityManager","abine/mappingServer","abine/responseCodes","modules","abine/licenseServer","abine/webapp"],function(e,t,n,i,r,a,o,s,c,l,d,u,f,h){function p(e,t,n,i){var r=[];for(var a in e)if("length"!=a){var o=e[a],s=parseFloat(o.show_rate);if(!(Math.random()>s||parseInt(o.masked_emails)>0))if(-1!=o.field_type.indexOf("new-feature-added")){if(i<new Date(o.created_at)&&m(o,t,n)){r.unshift(o);break}}else m(o,t,n)&&(m>1?r.unshift(o):r.push(o))}return r}function m(e,t,n){var i=e.targeting_option;if(!i)return 1;if(i.masking&&("off"==i.masking&&!ABINE_DNTME.maskme_installed||"on"==i.masking&&ABINE_DNTME.maskme_installed))return 0;if(i.blocked&&ABINE_DNTME.dnt_api.getAllTimeTotalTrackers()<parseInt(i.blocked))return 0;if(i.install_age&&parseInt(i.install_age)>(Date.now()-T)/864e5)return 0;if(i.domain){if(t&&t.match(new RegExp(i.domain,"i")))return 10}else{if(!i.trackers)return 1;if(n>=parseInt(i.trackers))return 1}}function g(e,t,n){r.Preference.findBy("key","new_feature_explored",function(i){var a=!1;i&&(a=new Date(i.value));var o=p(k,e.host,e.total,a);if(o.length>0){if(!o[0].image){var s=o[0].panel_positions[0].panel_section,c=s.body.match(/data:[^\'"]+/);c&&(o[0].image=c[0])}r.PanelActivity.addImpression({payload:{panelId:o[0].id}}),w[t]={id:o[0].id,host:e.host}}else w[t]={id:-1,host:e.host};n(w[t])})}function y(t,n){if(k){var i=t.tabId;i in w&&w[i].host!=t.host&&delete w[i],i in w?(i in w&&-1!=w[i].id&&(t.customImage=k[w[i].id].image),n()):g(t,i,function(){i in w&&-1!=w[i].id&&(t.customImage=k[w[i].id].image),n()})}else w={},r.Preference.findBy("key","dynamicPanels",function(i){if(k={length:0},i){var r=JSON.parse(i.value).panels;e.each(r,function(e){-1!=e.field_type.indexOf("dntme-toolbar-button")&&(k[e.id]=e,k.length++)})}k.length>0?y(t,n):n()})}function b(t,n){A?r.Preference.findBy("key","new_feature_explored",function(e){var i=!1;e&&(i=new Date(e.value));var a=p(A,t.host,t.trackers.length,i);a.length>0?(r.PanelActivity.addImpression({payload:{panelId:a[0].id}}),n(a[0])):n(null)}):r.Preference.findBy("key","dynamicPanels",function(i){if(A={length:0},i){var r=JSON.parse(i.value).panels;e.each(r,function(e){-1!=e.field_type.indexOf("dntme-panel")&&(A[e.id]=e,A.length++)})}A.length>0?b(t,n):n(null)})}function v(t,n){if(N){var i=p(N,t.host,t.trackers.length);if(i.length>0&&!(i[0].id in D))return r.PanelActivity.addImpression({payload:{panelId:i[0].id}}),D[i[0].id]=!0,n(i[0]),void 0;n(null)}else r.Preference.findBy("key","dynamicPanels",function(i){if(N={length:0},i){var r=JSON.parse(i.value).panels;e.each(r,function(e){-1!=e.field_type.indexOf("dntme-growl")&&(N[e.id]=e,N.length++)})}N.length>0?v(t,n):n(null)})}function E(t){T?t():r.Preference.findBy("key","installDate",e.bind(function(e){T=e?parseInt(e.value):Date.now(),t()},this))}var _=function(){},T=null,k=null,w={},A=null,N=null,D={},M=n.BaseClass.extend({initialize:function(e){this.mappingServer=e.mappingServer||new l,this.licenseServer=e.licenseServer||new f},getToolbarPanel:function(e,t){E(function(){y(e,function(){t(e)})})},doToolbarPanelAction:function(t){if(k&&t in w&&-1!=w[t].id){var n=k[w[t].id],i=n.panel_positions[0].panel_actions;return i.length>0&&e.each(i,e.bind(function(e){"open_registration_page"==e.name?h.openHome({id:n.id,action:e.name}):"open_page"==e.name?c.openPage(e.extra):"trigger_click"==e.name?r.PanelActivity.addClick({payload:{panelId:n.id}}):"trigger_conversion"==e.name?r.PanelActivity.addConversion({payload:{panelId:n.id}}):"change_show_rate"==e.name?this.changePanelShowRate({panelId:n.id,extra:e.extra}):"no_action"==e.name||("open_plans_page"==e.name?h.openPremium("panelID"+n.id,null,{id:n.id,action:e.name}):"open_snowman_page"==e.name?h.openSnowman(null,{id:n.id,action:e.name}):"open_activate_cards_page"==e.name?h.openCards({id:n.id,action:e.name}):"open_new_premium_feature_added_page"==e.name&&h.openNewFeatureAdded({id:n.id,action:e.name}))},this)),k.length--,delete w[t],ABINE_DNTME.dnt_api.triggerUpdateIcon(t),!0}return!1},getDNTMePanel:function(e,t){var n=ABINE_DNTME.dnt_api.getTabData(e);return n?(E(function(){b(n,function(e){t(e)})}),void 0):(t(null),void 0)},getDNTMeGrowl:function(e,t){var n=ABINE_DNTME.dnt_api.getTabData(e);return n?(E(function(){v(n,function(e){t(e)})}),void 0):(t(null),void 0)},changePanelShowRate:function(t,n){n=n||_;var i=t.panelId,o=t.extra;r.Preference.findBy("key","dynamicPanels",e.bind(function(t){var r=JSON.parse(t.value);e.each(r.panels,function(e){e.id==i&&(e.show_rate=o,A&&A[i]&&(A[i].show_rate=o),k&&k[i]&&(k[i].show_rate=o),t.value=JSON.stringify(r))}),a.flush(n)},this))},processPanelData:function(t,n){n=n||_,k=null,A=null,N=null,r.DisposableEmail.index(null,e.bind(function(i){var o=i.length;e.each(t.panels,function(e){o>=e.masked_emails&&(e.masked_emails=0)}),r.Preference.findBy("key","dynamicPanels",e.bind(function(i){if(i){var s;try{s=JSON.parse(i.value).panels}catch(c){}s||(s=[]);var l=[],d={},u={};t=t.panels,t.forEach(function(e){u[e.id]=1}),e.each(s,function(t){t.id in u?(l.push(t),d[t.id]=1,-1==t.field_type.indexOf("dntme")&&(d[t.field_type]=t.id),o>=t.masked_emails&&(t.masked_emails=0)):r.PanelActivity.findBy("panelId",t.id,e.bind(function(e){e&&a.remove(e)},this))}),t.forEach(function(e){if(!d[e.id]){if(e.field_type in d)for(var t=0;t<l.length;t++)l[t].id==d[e.field_type]&&(l.splice(t,1),t--);l.push(e)}}),i.value=JSON.stringify({panels:l})}else i=new r.Preference({key:"dynamicPanels",value:JSON.stringify(t)}),a.add(i),t=t.panels;e.async.forEach(t,e.bind(function(t,n){r.PanelActivity.findBy("panelId",t.id,e.bind(function(e){e||(e=new r.PanelActivity({panelId:t.id,impressions:0,users:1,clicks:0,completions:0}),a.add(e)),n()},this))},this),e.bind(function(){a.flush(e.bind(function(){n()},this))},this))},this))},this))},setupDynamicPanels:function(t,n){n=n||_,this.mappingServer.getPanels({browser:s.browser,tag:s.tags[0],user_state:t?t:"unregistered"},e.bind(function(e,t){e?n():this.processPanelData(t.panels,n)},this))},panelConversionCheck:function(e,t){if(t=t||_,ABINE_DNTME.lastPanel&&ABINE_DNTME.lastPanel[e]){var n=ABINE_DNTME.lastPanel[e];delete ABINE_DNTME.lastPanel[e],r.PanelActivity.findBy("panelId",n,function(e){e&&e.completions++,a.flush(function(){t()})})}else t()},sendPanelActivity:function(t){function n(){t&&t(),t=null}r.Preference.batchFindBy([{by:"key",value:"shouldSendErrorReports"},{by:"key",value:"suggestProtectedEmail"},{by:"key",value:"suggestProtectedPhone"},{by:"key",value:"suggestProtectedCard"}],e.bind(function(t){t.browsing=ABINE_DNTME.dnt_api.getDefaultBlocking(),t.errors=t.shouldSendErrorReports&&t.shouldSendErrorReports.isTrue(),t.email=t.suggestProtectedEmail&&t.suggestProtectedEmail.isTrue(),t.phone=t.suggestProtectedPhone&&t.suggestProtectedPhone.isTrue()&&t.entitledToPhone&&t.entitledToPhone.isTrue()&&phones.length>0&&phones[0].isValidated(),t.card=t.suggestProtectedCard&&t.suggestProtectedCard.isTrue()&&t.hasEnabledPayments&&t.hasEnabledPayments.isTrue(),t.errors?r.PanelActivity.index(null,e.bind(function(i){var r={panel_data:{global_settings:{impressions:t.email?1:0,masks:t.phone?1:0,discloses:t.card?1:0,closes:t.browsing?1:0}}};e.each(i,function(e){!e.isMarketingPanel()&&e.hasData()&&(r.panel_data||(r.panel_data={}),r.panel_data[e.panelId]=e.toJSON())}),r.panel_data?this.licenseServer.sendPanelActivity(r,function(t){t?n():(e.each(i,function(e){e.panelId in r.panel_data&&e.reset(r.panel_data[e.panelId])}),a.flush(function(){n()}))}):n()},this)):n()},this))}}),P=new M({});return u.panelsModule=P,P}),ABINE_DNTME.define("abine/modules/mappings",["documentcloud/underscore","abine/core","abine/timer","storage","persistence","abine/ajax","abine/config","abine/securityManager","abine/mappingServer","modules"],function(e,t,n,i,r,a,o,s,c,l){var d=function(){},u=864e5,f=function(){var e=new Date;return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e},h=t.BaseClass.extend({initialize:function(e){this.mappingServer=e.mappingServer||new c},startDailyMappingCheck:function(t){t=t||d,i.Preference.findBy("key","lastMappingCheck",e.bind(function(e){if(e&&e.value){var n=new Date(parseInt(e.value));n.valueOf()<(new Date).getTime()-u?this.makeDailyMappingCheck(t):this.delayDailyMappingCheck(t)}else this.makeDailyMappingCheck(t)},this))},processMappingManifest:function(t,n){{var r=[],a={};Date.now()}i.MappedForm.getAllForms(e.bind(function(o){var s=[];return e.each(o,function(e){t.manifest[e.signature]&&(t.manifest[e.signature]!=e.mapping_signature||(a[e.signature]=e.mapping_signature,s.push(e)))}),o=null,e.each(e.keys(t.manifest),function(e){a[e]||r.push(e)}),t.login_urls&&i.LoginUrl.saveAll(t.login_urls),0==r.length?(this.writeDailyMappingCheckPref(e.bind(function(){this.delayDailyMappingCheck(function(){n()})},this)),void 0):(this.mappingServer.getFormMappings({signatures:r},e.bind(function(t,r){if(t)n();else{e.each(r.forms,function(e){var t={domain:e.domain,signature:e.signature,mapping_signature:e.mapping_signature,formType:e.formType,fields:e.fields};s.push(t)});{Date.now()}i.MappedForm.saveAllForms(s),this.writeDailyMappingCheckPref(e.bind(function(){this.delayDailyMappingCheck(function(){n()})},this))}},this)),void 0)},this))},refreshPanels:function(){i.Preference.batchFindBy([{by:"key",value:"lastUserState"},{by:"key",value:"dynamicPanels"},{by:"key",value:"hasRegistered"},{by:"key",value:"entitledToPhone"}],e.bind(function(e){var t=e.lastUserState?e.lastUserState.value:"",n="unregistered";e.hasRegistered&&e.hasRegistered.isTrue()&&(n=e.entitledToPhone&&e.entitledToPhone.isTrue()?"premium":"registered"),t==n&&e.dynamicPanels||this.makeDailyMappingCheck(!0)},this))},makeDailyMappingCheck:function(t,n){return t&&t!==!0&&(n=t,t=!1),n=n||d,ABINE_DNTME.maskme_installed?(n(),void 0):(l.panelsModule.sendPanelActivity(e.bind(function(){var a={get_panels:1,get_login_urls:1,product:"dntme",tag:ABINE_DNTME.config.tags[0],browser:ABINE_DNTME.config.browser};t&&(a.exclude_mapping=!0);var o=e.bind(function(t){this.mappingServer.getMappingManifest(a,e.bind(function(o,s){o?n():(s.new_version?i.Preference.createOrModify({key:"new_version",value:s.new_version},d):i.Preference.findBy("key","new_version",function(e){e&&r.remove(e)}),s.manifest&&this.processMappingManifest(s,n),s.panels&&i.Preference.createOrModify({key:"lastUserState",value:a.user_state},e.bind(function(){l.panelsModule.processPanelData({panels:s.panels})},this)),t&&t())},this))},this);i.Preference.batchFindBy([{by:"key",value:"shouldSendErrorReports"},{by:"key",value:"dynamicPanels"},{by:"key",value:"hasRegistered"},{by:"key",value:"entitledToPhone"}],e.bind(function(t){if(a.user_state=t.hasRegistered&&t.hasRegistered.isTrue()?t.entitledToPhone&&t.entitledToPhone.isTrue()?"premium":"registered":"unregistered",t.dynamicPanels){var n=JSON.parse(t.dynamicPanels.value);e.each(n.panels,function(e){a.current_panels||(a.current_panels=[]),a.current_panels.push(e.id)})}a.current_panels||(a.current_panels=[-1]),t.shouldSendErrorReports&&t.shouldSendErrorReports.isTrue()?i.PanelActivity.index(null,e.bind(function(t){e.each(t,function(e){e.isMarketingPanel()&&e.hasData()&&(a.panel_data||(a.panel_data={}),a.panel_data[e.panelId]=e.toJSON())}),a.panel_data?o(function(){e.each(t,function(e){e.panelId in a.panel_data&&e.reset(a.panel_data[e.panelId])}),r.flush()}):o()},this)):o()},this))},this)),void 0)},writeDailyMappingCheckPref:function(e){e=e||d,i.Preference.findOrCreate({key:"lastMappingCheck"},function(t){t.value=Math.floor(f().valueOf()),t.modifiedAt=f(),r.flush(function(){e()})})},delayDailyMappingCheck:function(t){t=t||d;var i=18e5+36e5*Math.random();this.dailyMappingCheckTimeout&&n.clearTimeout(this.dailyMappingCheckTimeout),this.dailyMappingCheckTimeout=n.setTimeout(e.bind(this.startDailyMappingCheck,this),i),t()}}),p=new h({});return l.mappingsModule=p,p}),ABINE_DNTME.define("abine/modules/criticalProcess",["documentcloud/underscore","jquery","abine/core","abine/timer","storage","persistence","modules"],function(e,t,n,i,r,a,o){var s=function(){},c=n.BaseClass.extend({initialize:function(e,t){t=t||s},setMessenger:function(e){this.messenger=e},start:function(e){this.messenger.broadcast("background:criticalprocess:start",e)},end:function(e){this.messenger.broadcast("background:criticalprocess:end",e)},update:function(e){this.messenger.broadcast("background:criticalprocess:update",e)},askForReview:function(e){this.messenger.broadcast("background:criticalprocess:review",e)},error:function(e){this.messenger.broadcast("background:criticalprocess:error",e)}}),l=new c({});return o.criticalProcess=l,l}),ABINE_DNTME.define("abine/modules/payments",["documentcloud/underscore","jquery","abine/core","abine/timer","storage","persistence","modules","abine/paymentsServer"],function(e,t,n,i,r,a,o,s){var c=n.BaseClass.extend({initialize:function(e){this.paymentsServer=e.paymentsServer||new s},retrieveCardCredit:function(t){this.paymentsServer.retrieveCardCredit({},e.bind(function(e,n){e?t(e):t(null,n)}))},retrieveCardFee:function(t,n){this.paymentsServer.retrieveCardFee(t,e.bind(function(e,t){e?n(e):n(null,t)}))},verifyCardRequest:function(t,n){this.paymentsServer.verifyCardRequest(t,e.bind(function(e,t){e?n(e):n(null,t)}))}}),l=new c({});return o.paymentsModule=l,l}),ABINE_DNTME.define("abine/modules/phone",["documentcloud/underscore","jquery","abine/core","abine/timer","storage","persistence","modules","abine/phoneServer"],function(e,t,n,i,r,a,o,s){var c=function(){},l=n.BaseClass.extend({initialize:function(e){this.phoneServer=e.phoneServer||new s},getPhone:function(t,n){n=n||c,this.phoneServer.getPhone(t,e.bind(function(e,t){n(e,t)},this))}}),d=new l({});return o.phoneModule=d,d}),ABINE_DNTME.define("modules",[],function(){return{}}),ABINE_DNTME.require("abine/modules/license"),ABINE_DNTME.require("abine/modules/payments"),ABINE_DNTME.require("abine/modules/panels"),ABINE_DNTME.require("abine/modules/phone"),ABINE_DNTME.require("abine/modules/mappings"),ABINE_DNTME.require("abine/modules/criticalProcess"),ABINE_DNTME.require(["documentcloud/underscore","abine/window","abine/backgroundMessenger","abine/backgroundInit","abine/eventLogger","abine/stubs","abine/contextMenu","abine/webapp","abine/localStorage","abine/proxies"],function(e,t,n,i,r,a,o,s,c){function l(){chrome.windows.getLastFocused({populate:!0},function(e){for(var t=0;t<e.tabs.length;t++)if(e.tabs[t].active){d.trigger("toolbar:clicked",{tabId:e.tabs[t].id});break}})}ABINE_DNTME.MASKME_EXTENSION_ID="dpkiidbpeijnaaacjlfnijncdlkicejg",ABINE_DNTME.userAgent=window.navigator.userAgent,chrome.runtime&&chrome.runtime.onMessageExternal&&chrome.runtime.onMessageExternal.addListener(function(e,t){t.id==ABINE_DNTME.MASKME_EXTENSION_ID&&(ABINE_DNTME.maskme_installed=!0,c.setItem("maskme.installed","1"))});var d=new n.BackgroundMessenger;i.once("storage:initialized",function(){chrome.browserAction.onClicked.addListener(function(){"development"===ABINE_DNTME.config.environment,l()}),o.contextMenuHelper.init(d),chrome.tabs.query({},function(e){for(var t={file:"old_tab_content.js",allFrames:!1,runAt:"document_idle"},n=0;n<e.length;n++)try{-1==e[n].url.indexOf(ABINE_DNTME.config.webAppHost)&&0==e[n].url.indexOf("http")&&chrome.tabs.executeScript(e[n].id,t)}catch(i){}}),s.reload()}),i.initialize(d);var u=new n.BackgroundMessenger;u.on("test:respond",function(e,t){u.send("test:response",{status:"ok"},t)}),chrome.extension.onRequest.addListener(function(e,t){function n(e){if(!(e>=i.length)){if(i[e].file)var r=i[e];else var r={file:i[e],allFrames:!0,runAt:"document_idle"};chrome.tabs.executeScript(t.tab.id,r,function(){n(e+1)})}}if(!ABINE_DNTME.maskme_installed)if("injectContentScript"==e.eventName){var i=["almond-min.js","jquery-min.js","underscore-min.js","backbone-min.js"];i.push(e.payload),n(0)}else"processFormsInNewFrame"==e.eventName&&d.send("contentManager:processNewFrame",e.frame_id,t.tab.id)}),chrome.tabs.onRemoved.addListener(function(e){a.tabClosed(e)});Date.now()-ABINE_DNTME.startTime});